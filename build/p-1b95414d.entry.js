import{r as n,h as t,c as r}from"./p-cd08f63e.js";
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(n,t)};function i(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function o(n,t,r,e){return new(r||(r=Promise))((function(i,o){function a(n){try{s(e.next(n))}catch(n){o(n)}}function u(n){try{s(e.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new r((function(t){t(n.value)})).then(a,u)}s((e=e.apply(n,t||[])).next())}))}function a(n,t){var r,e,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,e&&(i=2&o[0]?e.return:o[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,o[1])).done)return i;switch(e=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,e=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(n,a)}catch(n){o=[6,n],e=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}var u=function(){function n(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(n,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=n,this.platform=t},n.prototype.registerFlag=function(n,t,r){if(this.flagRegistry[n]={evaluationFn:t,setHook:r},null!=this.urlFlags[n]){var e=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+e+"."),this.set(n,e)}},n.prototype.get=function(n){return n in this.flags||(this.flags[n]=this.evaluateFlag(n)),this.flags[n]},n.prototype.getNumber=function(n){return this.get(n)},n.prototype.getBool=function(n){return this.get(n)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(n,t){if(null==this.flagRegistry[n])throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=t,null!=this.flagRegistry[n].setHook&&this.flagRegistry[n].setHook(t)},n.prototype.evaluateFlag=function(n){if(null==this.flagRegistry[n])throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},n.prototype.setFlags=function(n){this.flags=Object.assign({},n)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var n=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,r=(t={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(n){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];return s(t,r[0],r[1]),r.join("=")})),t);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var r=t.split(":"),e=r[0];n.urlFlags[e]=function(n,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+n+".")}(e,r[1])}))}},n}();function s(n,t,r){n[decodeURIComponent(t)]=decodeURIComponent(r||"")}function c(){return f}var f=null,l=new Map,d=new Map;function h(n,t){var r=y(n,t);return l.get(r)}function v(n){return d.get(n)}function p(n){for(var t=l.entries(),r=[];;){var e=t.next(),i=e.value;if(e.done)break;var o=i[1];i[0].split("_")[0]===n&&r.push(o)}return r}function m(n){var t=n.kernelName,r=n.backendName,e=y(t,r);if(l.has(e))throw new Error("The kernel '"+t+"' for backend '"+r+"' is already registered");l.set(e,n)}function x(n){var t=n.kernelName;d.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),d.set(t,n)}function y(n,t){return t+"_"+n}function b(n){for(var t=n.length,r=0,e=0;t>0;)e=Math.random()*t|0,r=n[--t],n[t]=n[e],n[e]=r}function g(n,t,r){return Math.max(n,Math.min(t,r))}function w(n){return n%2==0?n:n+1}function C(n){for(var t=0,r=0;r<n.length;r++)t+=n[r];return t}function N(n,t){if(!n)throw new Error("string"==typeof t?t:t())}function E(n,t,r){void 0===r&&(r=""),N(O(n,t),(function(){return r+" Shapes "+n+" and "+t+" must match"}))}function R(n){N(null!=n,(function(){return"The input to the tensor constructor must be a non-null value."}))}function A(n,t,r){if(void 0===t&&(t=[]),void 0===r&&(r=!1),null==t&&(t=[]),Array.isArray(n)||G(n)&&!r)for(var e=0;e<n.length;++e)A(n[e],t,r);else t.push(n);return t}function _(n){if(0===n.length)return 1;for(var t=n[0],r=1;r<n.length;r++)t*=n[r];return t}function O(n,t){if(n===t)return!0;if(null==n||null==t)return!1;if(n.length!==t.length)return!1;for(var r=0;r<n.length;r++)if(n[r]!==t[r])return!1;return!0}function S(n){return n%1==0}function T(n){if(null!=Math.tanh)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var t=Math.exp(2*n);return(t-1)/(t+1)}function I(n){var t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function M(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function k(n,t,r){return void 0===t&&(t=function(){return 0}),new Promise((function(e,i){var o=0,a=function(){if(n())e();else{o++;var u=t(o);null!=r&&o>=r?i():setTimeout(a,u)}};a()}))}function D(n,t){for(var r=1,e=-1,i=0;i<n.length;++i)if(n[i]>=0)r*=n[i];else if(-1===n[i]){if(-1!==e)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+e+" and dim "+i);e=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(-1===e){if(t>0&&t!==r)throw Error("Size("+t+") must match the product of shape "+n);return n}if(0===r)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(t%r!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+r);var o=n.slice();return o[e]=t/r,o}function F(n,t){var r=t.length;return N((n=null==n?t.map((function(n,t){return t})):[].concat(n)).every((function(n){return n>=-r&&n<r})),(function(){return"All values in axis param must be in range [-"+r+", "+r+") but got axis "+n})),N(n.every((function(n){return S(n)})),(function(){return"All values in axis param must be integers but got axis "+n})),n.map((function(n){return n<0?r+n:n}))}function V(n,t){for(var r=[],e=[],i=null!=t&&Array.isArray(t)&&0===t.length,o=null==t||i?null:F(t,n).sort(),a=0,u=0;u<n.length;++u){if(null!=o){if(o[a]===u&&1!==n[u])throw new Error("Can't squeeze axis "+u+" since its dim '"+n[u]+"' is not 1");(null==o[a]||o[a]>u)&&1===n[u]&&(r.push(n[u]),e.push(u)),o[a]<=u&&a++}1!==n[u]&&(r.push(n[u]),e.push(u))}return{newShape:r,keptDims:e}}function P(n,t){var r=null;if(null==n||"float32"===n)r=new Float32Array(t);else if("int32"===n)r=new Int32Array(t);else{if("bool"!==n)throw new Error("Unknown data type "+n);r=new Uint8Array(t)}return r}function L(n,t){var r=null;if(null==n||"float32"===n)r=new Float32Array(t);else if("int32"===n)r=new Int32Array(t);else if("bool"===n)r=new Uint8Array(t);else{if("string"!==n)throw new Error("Unknown data type "+n);r=new Array(t)}return r}function B(n,t){for(var r=0;r<n.length;r++){var e=n[r];if(isNaN(e)||!isFinite(e))throw Error("A tensor of type "+t+" being uploaded contains "+e+".")}}function W(n){return"bool"===n||"complex64"===n||"float32"===n||"int32"===n||"string"===n}function z(n,t){return!("complex64"===t||"float32"===t&&"complex64"!==n||"int32"===t&&"float32"!==n&&"complex64"!==n||"bool"===t&&"bool"===n)}function G(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function U(n){if("float32"===n||"int32"===n)return 4;if("complex64"===n)return 8;if("bool"===n)return 1;throw new Error("Unknown dtype "+n)}function q(n){if(null==n)return 0;var t=0;return n.forEach((function(n){return t+=n.length})),t}function j(n){return"string"==typeof n||n instanceof String}function H(n){return"boolean"==typeof n}function X(n){return"number"==typeof n}function $(n){return Array.isArray(n)?$(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":X(n)?"float32":j(n)?"string":H(n)?"bool":"float32"}function K(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Y(n,t){for(var r=t;r<n;++r)if(n%r==0)return r;return n}function J(n){var t=n.length;if(t<2)return[];var r=new Array(t-1);r[t-2]=n[t-1];for(var e=t-3;e>=0;--e)r[e]=r[e+1]*n[e+1];return r}function Z(n,t,r){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=A(n)),r&&B(n,t),function(n,t){return n instanceof Float32Array&&"float32"===t||n instanceof Int32Array&&"int32"===t||n instanceof Uint8Array&&"bool"===t}(n,t))return n;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(n);if("int32"===t)return new Int32Array(n);if("bool"===t){for(var e=new Uint8Array(n.length),i=0;i<e.length;++i)0!==Math.round(n[i])&&(e[i]=1);return e}throw new Error("Unknown data type "+t)}function Q(n,t){if(0===n.length)return t[0];var r=n.reduce((function(n,t){return n*t}));if(0===r)return[];if(r!==t.length)throw new Error("["+n+"] does not match the input size.");return function n(t,r,e){var i=new Array;if(1===r.length)for(var o=r[0],a=0;a<o;a++)i[a]=e[t+a];else{o=r[0];var u=r.slice(1),s=u.reduce((function(n,t){return n*t}));for(a=0;a<o;a++)i[a]=n(t+a*s,u,e)}return i}(0,n,t)}function nn(n,t){for(var r=tn(n,t),e=0;e<r.length;e++)r[e]=1;return r}function tn(n,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(n);if("int32"===t)return new Int32Array(n);if("bool"===t)return new Uint8Array(n);throw new Error("Unknown data type "+t)}function rn(){return c().platform.now()}function en(n){n.forEach((function(t){N(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."}))}))}function on(n,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",c().platform.encode(n,t)}function an(n,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",c().platform.decode(n,t)}function un(n,t,r){if(0===t)return 0;if(1===t)return n[0];for(var e=n[n.length-1],i=0;i<n.length-1;++i)e+=r[i]*n[i];return e}function sn(n,t,r){if(0===t)return[];if(1===t)return[n];for(var e=new Array(t),i=0;i<e.length-1;++i)e[i]=Math.floor(n/r[i]),n-=e[i]*r[i];return e[e.length-1]=n,e}var cn=Object.freeze({shuffle:b,clamp:g,nearestLargerEven:w,sum:C,randUniform:function(n,t){var r=Math.random();return t*r+(1-r)*n},distSquared:function(n,t){for(var r=0,e=0;e<n.length;e++){var i=Number(n[e])-Number(t[e]);r+=i*i}return r},assert:N,assertShapesMatch:E,assertNonNull:R,flatten:A,sizeFromShape:_,isScalarShape:function(n){return 0===n.length},arraysEqual:O,isInt:S,tanh:T,sizeToSquarishShape:I,createShuffledIndices:function(n){for(var t=new Uint32Array(n),r=0;r<n;++r)t[r]=r;return b(t),t},rightPad:M,repeatedTry:k,inferFromImplicitShape:D,parseAxisParam:F,squeezeShape:V,getTypedArrayFromDType:P,getArrayFromDType:L,checkConversionForErrors:B,isValidDtype:W,hasEncodingLoss:z,isTypedArray:G,bytesPerElement:U,bytesFromStringArray:q,isString:j,isBoolean:H,isNumber:X,inferDtype:$,isFunction:K,nearestDivisor:Y,computeStrides:J,toTypedArray:Z,toNestedArray:Q,makeOnesTypedArray:nn,makeZerosTypedArray:tn,now:rn,assertNonNegativeIntegerDimensions:en,fetch:function(n,t){return c().platform.fetch(n,t)},encodeString:on,decodeString:an,locToIndex:un,indexToLoc:sn}),fn=function(){function n(n,t){this.backendTimer=n,this.logger=t,null==t&&(this.logger=new ln)}return n.prototype.profileKernel=function(n,t,r){var e,i=this,o=this.backendTimer.time((function(){e=r()}));return e.forEach((function(r){r.data().then((function(e){!function(n,t,r){if("float32"!==t)return!1;for(var e=0;e<n.length;e++){var i=n[e];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+r+"'"),!0}}(e,r.dtype,n),o.then((function(o){var a="";null!=o.getExtraProfileInfo&&(a=o.getExtraProfileInfo()),i.logger.logKernelProfile(n,r,e,o.kernelMs,t,a)}))}))})),e},n}(),ln=function(){function n(){}return n.prototype.logKernelProfile=function(n,t,r,e,i,o){var a="number"==typeof e?M(e+"ms",9):e.error,u=M(n,25),s=t.rank,c=t.size,f=M(t.shape.toString(),14),l="";for(var d in i){var h=i[d].shape||t.shape,v=h.length;l+=d+": "+v+"D "+(v>0?h:"")+" "}console.log("%c"+u+"\t%c"+a+"\t%c"+s+"D "+f+"\t%c"+c+"\t%c"+l+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function dn(n,t,r){return M(Array.isArray(n)?parseFloat(n[0].toFixed(7))+" + "+parseFloat(n[1].toFixed(7))+"j":j(n)?"'"+n+"'":"bool"===r?hn(n):parseFloat(n.toFixed(7)).toString(),t)}function hn(n){return 0===n?"false":"true"}function vn(n){for(var t=[],r=0;r<n.length;r+=2)t.push([n[r],n[r+1]]);return t}var pn=function(){function n(n,t,r){var e=this;if(this.dtype=t,this.shape=n.slice(),this.size=_(n),null!=r){var i=r.length;N(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+e.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||L(t,this.size),this.strides=J(n)}return n.prototype.set=function(n){for(var t=this,r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];0===r.length&&(r=[0]),N(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(r);this.values[i]=n},n.prototype.get=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];0===n.length&&(n=[0]);for(var r=0,e=0,i=n;e<i.length;e++){var o=i[e];if(o<0||o>=this.shape[r]){var a="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=n[n.length-1],s=0;s<n.length-1;++s)u+=this.strides[s]*n[s];return this.values[u]},n.prototype.locToIndex=function(n){if(0===this.rank)return 0;if(1===this.rank)return n[0];for(var t=n[n.length-1],r=0;r<n.length-1;++r)t+=this.strides[r]*n[r];return t},n.prototype.indexToLoc=function(n){if(0===this.rank)return[];if(1===this.rank)return[n];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(n/this.strides[r]),n-=t[r]*this.strides[r];return t[t.length-1]=n,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return mn().makeTensor(this.values,this.shape,this.dtype)},n}(),mn=null,xn=null,yn=null,bn=function(){function n(n,t,r,e){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=t||"float32",this.size=_(n),this.strides=J(n),this.dataId=r,this.id=e,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),N(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(n,t){return this.throwIfDisposed(),this.reshape([n,t])},n.prototype.as3D=function(n,t,r){return this.throwIfDisposed(),this.reshape([n,t,r])},n.prototype.as4D=function(n,t,r,e){return this.throwIfDisposed(),this.reshape([n,t,r,e])},n.prototype.as5D=function(n,t,r,e,i){return this.throwIfDisposed(),this.reshape([n,t,r,e,i])},n.prototype.asType=function(n){return this.throwIfDisposed(),xn.cast(this,n)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return o(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,xn.buffer(this.shape,this.dtype,n)]}}))}))},n.prototype.bufferSync=function(){return xn.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return o(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,Q(this.shape,n)]}}))}))},n.prototype.arraySync=function(){return Q(this.shape,this.dataSync())},n.prototype.data=function(){return o(this,void 0,void 0,(function(){var n,t;return a(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=mn().read(this.dataId),"string"!==this.dtype?[3,2]:[4,n];case 1:t=r.sent();try{return[2,t.map((function(n){return an(n)}))]}catch(n){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}}))}))},n.prototype.dataSync=function(){this.throwIfDisposed();var n=mn().readSync(this.dataId);if("string"===this.dtype)try{return n.map((function(n){return an(n)}))}catch(n){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},n.prototype.bytes=function(){return o(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,mn().read(this.dataId)];case 1:return n=t.sent(),"string"===this.dtype?[2,n]:[2,new Uint8Array(n.buffer)]}}))}))},n.prototype.dispose=function(){this.isDisposed||(mn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(n){return void 0===n&&(n=!1),xn.print(this,n)},n.prototype.reshape=function(n){return this.throwIfDisposed(),xn.reshape(this,n)},n.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},n.prototype.expandDims=function(n){return void 0===n&&(n=0),xn.expandDims(this,n)},n.prototype.cumsum=function(n,t,r){return void 0===n&&(n=0),void 0===t&&(t=!1),void 0===r&&(r=!1),xn.cumsum(this,n,t,r)},n.prototype.squeeze=function(n){return this.throwIfDisposed(),xn.squeeze(this,n)},n.prototype.clone=function(){return this.throwIfDisposed(),xn.clone(this)},n.prototype.toString=function(n){return void 0===n&&(n=!1),function(n,t,r,e){var i=J(t),o=function(n,t,r,e){var i=_(t),o=e[e.length-1],a=new Array(o).fill(0),u=t.length,s="complex64"===r?vn(n):n;if(u>1)for(var c=0;c<i/o;c++)for(var f=c*o,l=0;l<o;l++)a[l]=Math.max(a[l],dn(s[f+l],0,r).length);return a}(n,t,r,i),a=t.length,u=function n(t,r,e,i,o,a){void 0===a&&(a=!0);var u="complex64"===e?2:1,s=r[0],c=r.length;if(0===c)return"complex64"===e?[dn(vn(t)[0],0,e)]:"bool"===e?[hn(t[0])]:[t[0].toString()];if(1===c){if(s>20){var f=Array.from(t.slice(0,3*u)),l=Array.from(t.slice((s-3)*u,s*u));return"complex64"===e&&(f=vn(f),l=vn(l)),["["+f.map((function(n,t){return dn(n,o[t],e)})).join(", ")+", ..., "+l.map((function(n,t){return dn(n,o[s-3+t],e)})).join(", ")+"]"]}return["["+("complex64"===e?vn(t):Array.from(t)).map((function(n,t){return dn(n,o[t],e)})).join(", ")+"]"]}var d=r.slice(1),h=i.slice(1),v=i[0]*u,p=[];if(s>20){for(var m=0;m<3;m++){var x=(y=m*v)+v;p.push.apply(p,n(t.slice(y,x),d,e,h,o,!1))}for(p.push("..."),m=s-3;m<s;m++)x=(y=m*v)+v,p.push.apply(p,n(t.slice(y,x),d,e,h,o,m===s-1))}else for(m=0;m<s;m++){var y;x=(y=m*v)+v,p.push.apply(p,n(t.slice(y,x),d,e,h,o,m===s-1))}var b=2===c?",":"";for(p[0]="["+p[0]+b,m=1;m<p.length-1;m++)p[m]=" "+p[m]+b;var g=",\n";for(m=2;m<c;m++)g+="\n";return p[p.length-1]=" "+p[p.length-1]+"]"+(a?"":g),p}(n,t,r,i,o),s=["Tensor"];return e&&(s.push("  dtype: "+r),s.push("  rank: "+a),s.push("  shape: ["+t+"]"),s.push("  values:")),s.push(u.map((function(n){return"    "+n})).join("\n")),s.join("\n")}(this.dataSync(),this.shape,this.dtype,n)},n.prototype.gather=function(n,t){return void 0===t&&(t=0),this.throwIfDisposed(),xn.gather(this,n,t)},n.prototype.matMul=function(n,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),this.throwIfDisposed(),xn.matMul(this,n,t,r)},n.prototype.dot=function(n){return this.throwIfDisposed(),xn.dot(this,n)},n.prototype.norm=function(n,t,r){return void 0===n&&(n="euclidean"),void 0===t&&(t=null),void 0===r&&(r=!1),this.throwIfDisposed(),xn.norm(this,n,t,r)},n.prototype.slice=function(n,t){return this.throwIfDisposed(),xn.slice(this,n,t)},n.prototype.reverse=function(n){return this.throwIfDisposed(),xn.reverse(this,n)},n.prototype.concat=function(t,r){return void 0===r&&(r=0),this.throwIfDisposed(),t instanceof n&&(t=[t]),xn.concat([this].concat(t),r)},n.prototype.split=function(n,t){return void 0===t&&(t=0),this.throwIfDisposed(),xn.split(this,n,t)},n.prototype.stack=function(n,t){return void 0===t&&(t=0),xn.stack([this,n],t)},n.prototype.unstack=function(n){return void 0===n&&(n=0),xn.unstack(this,n)},n.prototype.batchNormalization=function(n,t,r,e,i){return void 0===r&&(r=.001),yn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,t,i,e,r)},n.prototype.all=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.all(this,n,t)},n.prototype.any=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.any(this,n,t)},n.prototype.logSumExp=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.logSumExp(this,n,t)},n.prototype.sum=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.sum(this,n,t)},n.prototype.prod=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.prod(this,n,t)},n.prototype.mean=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.mean(this,n,t)},n.prototype.min=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.min(this,n,t)},n.prototype.max=function(n,t){return void 0===n&&(n=null),void 0===t&&(t=!1),this.throwIfDisposed(),xn.max(this,n,t)},n.prototype.argMin=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),xn.argMin(this,n)},n.prototype.argMax=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),xn.argMax(this,n)},n.prototype.cast=function(n){return this.throwIfDisposed(),xn.cast(this,n)},n.prototype.addStrict=function(n){return this.throwIfDisposed(),xn.addStrict(this,n)},n.prototype.atan2=function(n){return this.throwIfDisposed(),xn.atan2(this,n)},n.prototype.sub=function(n){return this.throwIfDisposed(),xn.sub(this,n)},n.prototype.subStrict=function(n){return this.throwIfDisposed(),xn.subStrict(this,n)},n.prototype.pow=function(n){return this.throwIfDisposed(),xn.pow(this,n)},n.prototype.powStrict=function(n){return this.throwIfDisposed(),xn.powStrict(this,n)},n.prototype.mul=function(n){return this.throwIfDisposed(),xn.mul(this,n)},n.prototype.mulStrict=function(n){return this.throwIfDisposed(),xn.mulStrict(this,n)},n.prototype.floorDiv=function(n){return this.throwIfDisposed(),xn.floorDiv(this,n)},n.prototype.divStrict=function(n){return this.throwIfDisposed(),xn.divStrict(this,n)},n.prototype.minimum=function(n){return this.throwIfDisposed(),xn.minimum(this,n)},n.prototype.minimumStrict=function(n){return this.throwIfDisposed(),xn.minimumStrict(this,n)},n.prototype.maximum=function(n){return this.throwIfDisposed(),xn.maximum(this,n)},n.prototype.maximumStrict=function(n){return this.throwIfDisposed(),xn.maximumStrict(this,n)},n.prototype.mod=function(n){return this.throwIfDisposed(),xn.mod(this,n)},n.prototype.modStrict=function(n){return this.throwIfDisposed(),xn.modStrict(this,n)},n.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),xn.squaredDifferenceStrict(this,n)},n.prototype.notEqual=function(n){return this.throwIfDisposed(),xn.notEqual(this,n)},n.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),xn.notEqualStrict(this,n)},n.prototype.less=function(n){return this.throwIfDisposed(),xn.less(this,n)},n.prototype.lessStrict=function(n){return this.throwIfDisposed(),xn.lessStrict(this,n)},n.prototype.equal=function(n){return this.throwIfDisposed(),xn.equal(this,n)},n.prototype.equalStrict=function(n){return this.throwIfDisposed(),xn.equalStrict(this,n)},n.prototype.lessEqual=function(n){return this.throwIfDisposed(),xn.lessEqual(this,n)},n.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),xn.lessEqualStrict(this,n)},n.prototype.greater=function(n){return this.throwIfDisposed(),xn.greater(this,n)},n.prototype.greaterStrict=function(n){return this.throwIfDisposed(),xn.greaterStrict(this,n)},n.prototype.greaterEqual=function(n){return this.throwIfDisposed(),xn.greaterEqual(this,n)},n.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),xn.greaterEqualStrict(this,n)},n.prototype.logicalAnd=function(n){return this.throwIfDisposed(),xn.logicalAnd(this,n)},n.prototype.logicalOr=function(n){return this.throwIfDisposed(),xn.logicalOr(this,n)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),xn.logicalNot(this)},n.prototype.logicalXor=function(n){return this.throwIfDisposed(),xn.logicalXor(this,n)},n.prototype.where=function(n,t){return this.throwIfDisposed(),xn.where(n,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),xn.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),xn.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),xn.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),xn.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),xn.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),xn.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),xn.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),xn.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),xn.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),xn.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),xn.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),xn.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),xn.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),xn.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),xn.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),xn.abs(this)},n.prototype.clipByValue=function(n,t){return this.throwIfDisposed(),xn.clipByValue(this,n,t)},n.prototype.relu=function(){return this.throwIfDisposed(),xn.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),xn.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),xn.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),xn.selu(this)},n.prototype.leakyRelu=function(n){return void 0===n&&(n=.2),this.throwIfDisposed(),xn.leakyRelu(this,n)},n.prototype.prelu=function(n){return this.throwIfDisposed(),xn.prelu(this,n)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),xn.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),xn.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),xn.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),xn.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),xn.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),xn.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),xn.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),xn.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),xn.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),xn.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),xn.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),xn.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),xn.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),xn.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),xn.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),xn.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),xn.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),xn.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),xn.round(this)},n.prototype.step=function(n){return void 0===n&&(n=0),this.throwIfDisposed(),xn.step(this,n)},n.prototype.softmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),xn.softmax(this,n)},n.prototype.logSoftmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),xn.logSoftmax(this,n)},n.prototype.resizeBilinear=function(n,t){return void 0===t&&(t=!1),this.throwIfDisposed(),xn.image.resizeBilinear(this,n,t)},n.prototype.resizeNearestNeighbor=function(n,t){return void 0===t&&(t=!1),this.throwIfDisposed(),xn.image.resizeNearestNeighbor(this,n,t)},n.prototype.conv1d=function(n,t,r,e,i,o){return void 0===e&&(e="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),xn.conv1d(this,n,t,r,e,i,o)},n.prototype.conv2d=function(n,t,r,e,i,o){return void 0===e&&(e="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),xn.conv2d(this,n,t,r,e,i,o)},n.prototype.conv2dTranspose=function(n,t,r,e,i){return this.throwIfDisposed(),xn.conv2dTranspose(this,n,t,r,e,i)},n.prototype.depthwiseConv2D=function(n,t,r,e,i,o){return void 0===e&&(e="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),xn.depthwiseConv2d(this,n,t,r,e,i,o)},n.prototype.separableConv2d=function(n,t,r,e,i,o){return void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),xn.separableConv2d(this,n,t,r,e,i,o)},n.prototype.avgPool=function(n,t,r,e){return this.throwIfDisposed(),xn.avgPool(this,n,t,r,e)},n.prototype.maxPool=function(n,t,r,e){return this.throwIfDisposed(),xn.maxPool(this,n,t,r,e)},n.prototype.localResponseNormalization=function(n,t,r,e){return void 0===n&&(n=5),void 0===t&&(t=1),void 0===r&&(r=1),void 0===e&&(e=.5),xn.localResponseNormalization(this,n,t,r,e)},n.prototype.pool=function(n,t,r,e,i){return this.throwIfDisposed(),xn.pool(this,n,t,r,e,i)},n.prototype.variable=function(n,t,r){return void 0===n&&(n=!0),this.throwIfDisposed(),mn().makeVariable(this,n,t,r)},n.prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),xn.unsortedSegmentSum(this,n,t)},n.prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),xn.batchToSpaceND(this,n,t)},n.prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),xn.spaceToBatchND(this,n,t)},n.prototype.topk=function(n,t){return void 0===n&&(n=1),void 0===t&&(t=!0),this.throwIfDisposed(),xn.topk(this,n,t)},n.prototype.stridedSlice=function(n,t,r,e,i,o,a,u){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=0),this.throwIfDisposed(),xn.stridedSlice(this,n,t,r,e,i,o,a,u)},n.prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),xn.depthToSpace(this,n,t)},n.prototype.fft=function(){return this.throwIfDisposed(),xn.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),xn.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),xn.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),xn.spectral.irfft(this)},n}();Object.defineProperty(bn,Symbol.hasInstance,{value:function(n){return!!n&&null!=n.dataId&&null!=n.shape&&null!=n.dtype}});var gn,wn,Cn,Nn,En,Rn=function(n){function t(t,r,e,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=e,o}return i(t,n),t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!O(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");mn().disposeTensor(this),this.dataId=n.dataId,mn().incRef(this,null)},t.prototype.dispose=function(){mn().disposeVariable(this),this.isDisposedInternal=!0},t}(bn);Object.defineProperty(Rn,Symbol.hasInstance,{value:function(n){return n instanceof bn&&null!=n.assign&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(gn||(gn={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(wn||(wn={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(Cn||(Cn={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(Nn||(Nn={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(En||(En={}));var An={float32:Nn,int32:wn,bool:Cn,complex64:En};function _n(n,t){if("string"===n||"string"===t){if("string"===n&&"string"===t)return"string";throw new Error("Can not upcast "+n+" with "+t)}return An[n][t]}function On(n){return _n(n,"int32")}function Sn(n,t){if(n.dtype===t.dtype)return[n,t];var r=_n(n.dtype,t.dtype);return[n.cast(r),t.cast(r)]}function Tn(n,t){N(n.dtype===t.dtype,(function(){return"The dtypes of the first("+n.dtype+") and second("+t.dtype+") input must match"}))}function In(n){var t=[];return function n(t,r,e){if(null!=t)if(t instanceof bn)r.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,o=t;for(var a in o){var u=o[a];e.has(u)||(e.add(u),n(u,r,e))}}}(n,t,new Set),t}var Mn,kn=Object.freeze({makeTypesMatch:Sn,assertTypesMatch:Tn,isTensorInList:function(n,t){return t.some((function(t){return t.id===n.id}))},getTensorsInContainer:In}),Dn=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},n}(),Fn=function(){function n(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Dn}return n.prototype.ready=function(){return o(this,void 0,void 0,(function(){var n,t,r;return a(this,(function(e){switch(e.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];n=this.getSortedBackends(),t=0,e.label=1;case 1:return t<n.length?[4,this.initializeBackend(r=n[t]).success]:[3,5];case 2:return e.sent()?[4,this.setBackend(r)]:[3,4];case 3:return e.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(n.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var n=this.initializeBackendsAndReturnBest(),t=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(n){if(!(n in this.registry)){if(!(n in this.registryFactory))return null;if(this.initializeBackend(n).asyncInit)return null}return this.registry[n]},n.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},n.prototype.registerBackend=function(n,t,r){return void 0===r&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:t,priority:r},!0)},n.prototype.setBackend=function(n){return o(this,void 0,void 0,(function(){var t,r,e;return a(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[n])throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,null!=this.registry[n]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(n),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return e=i.sent(),[3,3];case 2:e=r,i.label=3;case 3:if(!e)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new fn(this.backendInstance),[2,!0]}}))}))},n.prototype.setupRegisteredKernels=function(){var n=this;p(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(n.backendInstance)}))},n.prototype.disposeRegisteredKernels=function(n){var t=this;p(n).forEach((function(r){null!=r.disposeFunc&&r.disposeFunc(t.registry[n])}))},n.prototype.initializeBackend=function(n){var t=this,r=this.registryFactory[n];if(null==r)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var e=r.factory();if(Promise.resolve(e)===e){var i=++this.pendingBackendInitId,o=e.then((function(r){return!(i<t.pendingBackendInitId||(t.registry[n]=r,t.pendingBackendInit=null,0))})).catch((function(r){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(r.stack||r.message),1))}));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[n]=e,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+n+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var n=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return n.registryFactory[r].priority-n.registryFactory[t].priority}))},n.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),t=0;t<n.length;t++){var r=n[t],e=this.initializeBackend(r),i=e.asyncInit;if(i||e.success)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(n,t){var r=this.state.tensorInfo.get(t),e=r.backend,i=this.readSync(t);e.disposeData(t),r.backend=n,n.move(t,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(n,t){var r,e=this,i=null;if(null==t){if("function"!=typeof n)throw new Error("Please provide a function to tidy()");t=n}else{if("string"!=typeof n&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun((function(){return e.startScope(i)}),(function(){return e.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},n.prototype.scopedRun=function(n,t,r){n();try{var e=r();return t(),e}catch(n){throw t(),n}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(n){var t=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype);return this.addTapeNode(this.state.activeScope.name,{x:n},[t],(function(n){return{x:function(){return n.toFloat()}}}),[],{}),t},n.prototype.runKernel=function(n,t,r,e,i){return this.runKernelFunc(null,t,null,n,r,e,i)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(n,t,r){var e=this.backend.numDataIds(),i=0;r.forEach((function(n){i+="complex64"===n.dtype?3:1}));var o=e-t-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+n+"'")},n.prototype.runKernelFunc=function(n,t,r,e,i,o,a){var u,s=this,c=[],f=this.isTapeOn();null==e&&(e=null!=this.state.activeScope?this.state.activeScope.name:"");var l,d=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,m=h(e,this.backendName);if(null!=m)l=function(){var n=s.backend.numDataIds();p=m.kernelFunc({inputs:t,attrs:i,backend:s.backend});var r=Array.isArray(p)?p:[p];s.shouldCheckForMemLeaks()&&s.checkKernelForMemLeak(e,n,r);var u=r.map((function(n){return s.makeTensorFromDataId(n.dataId,n.shape,n.dtype)}));if(f){var l=s.getTensorsForGradient(e,t,u);if(null==l){null==a&&(a=[]);var d=u.filter((function(n,t){return a[t]}));l=(o||[]).slice().concat(d)}c=s.saveTensorsForBackwardMode(l)}return u};else{var x=function(n){f&&(c=n.map((function(n){return s.keep(s.clone(n))})))};l=function(){var t=s.backend.numDataIds();p=s.tidy((function(){return n(s.backend,x)}));var r=Array.isArray(p)?p:[p];return s.shouldCheckForMemLeaks()&&s.checkKernelForMemLeak(e,t,r),r}}return this.scopedRun((function(){return s.state.kernelDepth++}),(function(){return s.state.kernelDepth--}),(function(){u=s.ENV.getBool("DEBUG")?s.profiler.profileKernel(e,t,(function(){return l()})):l()})),f&&this.addTapeNode(e,t,u,r,c,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:e,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(n){return t[n].shape})),outputShapes:u.map((function(n){return n.shape}))}),Array.isArray(p)?u:u[0]},n.prototype.saveTensorsForBackwardMode=function(n){var t=this;return n.map((function(n){return t.keep(t.clone(n))}))},n.prototype.getTensorsForGradient=function(n,t,r){var e=v(n);if(null!=e){var i=e.inputsToSave||[],o=e.outputsToSave||[],a=void 0;e.saveAllInputs?(N(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(n){return t[n]}))):a=i.map((function(n){return t[n]}));var u=r.filter((function(n,t){return o[t]}));return a.concat(u)}return null},n.prototype.makeTensor=function(n,t,r,e){if(null==n)throw new Error("Values passed to engine.makeTensor() are null");e=e||this.backend;var i=n;"string"===(r=r||"float32")&&j(n[0])&&(i=n.map((function(n){return on(n)})));var o=e.write(i,t,r),a=new bn(t,r,o,this.nextTensorId());if(this.incRef(a,e),"string"===r){var u=this.state.tensorInfo.get(o),s=q(i);this.state.numBytes+=s-u.bytes,u.bytes=s}return a},n.prototype.makeTensorFromDataId=function(n,t,r,e){var i=new bn(t,r=r||"float32",n,this.nextTensorId());return this.incRef(i,e),i},n.prototype.makeVariable=function(n,t,r,e){void 0===t&&(t=!0),r=r||this.nextVariableId().toString(),null!=e&&e!==n.dtype&&(n=n.asType(e));var i=new Rn(n,t,r,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.incRef=function(n,t){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,"string"===n.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var e=0;"complex64"!==n.dtype&&"string"!==n.dtype&&(e=n.size*U(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:t||this.backend,dtype:n.dtype,shape:n.shape,bytes:e,refCount:0}),this.state.numBytes+=e}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Rn||this.track(n)},n.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,"string"===n.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(n.dataId);t.refCount<=1?("complex64"!==n.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[n])},n.prototype.disposeVariable=function(n){this.disposeTensor(n),null!=this.state.registeredVariables[n.name]&&delete this.state.registeredVariables[n.name]},n.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,null==n.reasons&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},n.prototype.profile=function(n){return o(this,void 0,void 0,(function(){var t,r;return a(this,(function(){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(n){return n.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},n.prototype.addTapeNode=function(n,t,r,e,i,o){var a=this,u={id:this.state.nextTapeNodeId++,kernelName:n,inputs:t,outputs:r,saved:i},s=v(n);null!=s&&(e=s.gradFunc),null!=e&&(u.gradient=function(n){return n=n.map((function(n,t){if(null==n){var e=r[t],i=tn(e.size,e.dtype);return a.makeTensor(i,e.shape,e.dtype)}return n})),e(n.length>1?n:n[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(n){return n.kept=!0,n},n.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(n){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(t.name=n),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(n){for(var t=this,r=In(n),e=new Set(r.map((function(n){return n.id}))),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];o.kept||e.has(o.id)||o.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(n){n.kept||n.scopeId!==a.id||t.track(n)}))},n.prototype.gradients=function(n,t,r,e){var i=this;if(void 0===e&&(e=!1),N(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",n)}));N(o instanceof bn,(function(){return"The result y returned by f() must be a tensor."}));var a=function(n,t,r){for(var e={},i={},o=0;o<t.length;o++)e[t[o].id]=!0;for(o=0;o<n.length;o++){var a=(v=n[o]).inputs;for(var u in a){for(var s=a[u],c=!1,f=0;f<t.length;f++)if(e[s.id]){v.outputs.forEach((function(n){return e[n.id]=!0})),c=!0,i[v.id]=!0;break}if(c)break}}var l={};l[r.id]=!0;var d={};for(o=n.length-1;o>=0;o--)for(a=(v=n[o]).inputs,f=0;f<v.outputs.length;f++)if(l[v.outputs[f].id]){for(var u in a)l[a[u].id]=!0,d[v.id]=!0;break}var h=[];for(o=0;o<n.length;o++){var v;if(i[(v=n[o]).id]&&d[v.id]){var p={};for(var u in v.inputs){var m=v.inputs[u];e[m.id]&&(p[u]=m)}var x=Object.assign({},v);x.inputs=p,x.outputs=v.outputs,h.push(x)}}return h}(this.state.activeTape,t,o);if(!e&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var n,e,u={};u[o.id]=null==r?(e=nn(_(n=o.shape),"float32"),Vn.makeTensor(e,n,"float32")):r,function(n,t,r){for(var e=function(e){var i=t[e],o=[];if(i.outputs.forEach((function(t){var r=n[t.id];o.push(null!=r?r:null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var a=i.gradient(o),u=function(t){if(!(t in a))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(a)+".");var e=r((function(){return a[t]()}));if("float32"!==e.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+e.dtype+"'");var o=i.inputs[t];if(!O(e.shape,o.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+e.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==n[o.id])n[o.id]=e;else{var u=n[o.id];n[o.id]=u.add(e),u.dispose()}};for(var s in i.inputs)u(s)},i=t.length-1;i>=0;i--)e(i)}(u,a,(function(n){return i.tidy(n)}));var s=t.map((function(n){return u[n.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(n){for(var t=0,r=n.saved;t<r.length;t++)r[t].dispose()})),i.state.activeTape=null),{value:o,grads:s}}))},n.prototype.customGrad=function(n){var t=this;return N(K(n),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];N(e.every((function(n){return n instanceof bn})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return e.forEach((function(n,t){o[t]=n})),t.runKernelFunc((function(t,i){return N((r=n.apply(void 0,e.concat([i]))).value instanceof bn,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),N(K(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),o,(function(n,t){var i=r.gradFunc(n,t),o=Array.isArray(i)?i:[i];N(o.length===e.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),N(o.every((function(n){return n instanceof bn})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var a={};return o.forEach((function(n,t){a[t]=function(){return n}})),a}))}},n.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},n.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},n.prototype.time=function(n){return o(this,void 0,void 0,(function(){var t,r;return a(this,(function(e){switch(e.label){case 0:return t=rn(),[4,this.backend.time(n)];case 1:return(r=e.sent()).wallMs=rn()-t,[2,r]}}))}))},n.prototype.track=function(n){return null!=this.state.activeScope&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Dn,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),Vn=function(){var n=function(){if(null==Mn){var n=void 0;if("undefined"!=typeof window)n=window;else if("undefined"!=typeof global)n=global;else if("undefined"!=typeof process)n=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");n=self}Mn=n}return Mn}();if(null==n._tfengine){var t=new u(n);n._tfengine=new Fn(t)}return function(n){f=n}(n._tfengine.ENV),mn=function(){return n._tfengine},n._tfengine}();function Pn(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Ln=c();Ln.registerFlag("DEBUG",(function(){return!1}),(function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ln.registerFlag("IS_BROWSER",(function(){return Pn()})),Ln.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),Ln.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ln.registerFlag("PROD",(function(){return!1})),Ln.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ln.getBool("DEBUG")})),Ln.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ln.registerFlag("IS_TEST",(function(){return!1}));var Bn,Wn,zn,Gn={},Un={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qn(n,t){Gn[n]=t}function jn(n){n in Gn||(Gn[n]=function(n){if(1!==n&&2!==n)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(n){if("undefined"!=typeof OffscreenCanvas&&2===n)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Gn[n]}),!1),1===n?t.getContext("webgl",Un)||t.getContext("experimental-webgl",Un):t.getContext("webgl2",Un)}(n));var t=Gn[n];return t.isContextLost()?(delete Gn[n],jn(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Gn[n])}function Hn(n,t){return[t,n]}function Xn(n){var t=_(n);return I(Math.ceil(t/4))}function $n(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function Kn(n,t){var r,e,i,o,a,u,s,f,l,d=n;return 2===c().getNumber("WEBGL_VERSION")?(r=d.R32F,e=d.R16F,i=d.RGBA16F,o=d.RGBA32F,a=d.RED,u=4,s=1,f=d.HALF_FLOAT,l=d.FLOAT):(r=n.RGBA,e=n.RGBA,i=n.RGBA,o=d.RGBA,a=n.RGBA,u=4,s=4,f=null!=t?t.HALF_FLOAT_OES:null,l=n.FLOAT),{internalFormatFloat:r,internalFormatHalfFloat:e,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:s,textureTypeHalfFloat:f,textureTypeFloat:l}}function Yn(n,t,r){var e=r();return t&&function(n){var t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+Zn(n,t))}(n),e}function Jn(n){return!!(c().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===n||5.96e-8<Math.abs(n)&&Math.abs(n)<65504)}function Zn(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Qn(n,t,r){return Ct(n,t,(function(){return n.getExtension(r)}),'Extension "'+r+'" not supported on this browser.')}function nt(n,t,r){var e=Ct(n,t,(function(){return n.createShader(n.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Yn(n,t,(function(){return n.shaderSource(e,r)})),Yn(n,t,(function(){return n.compileShader(e)})),!1===n.getShaderParameter(e,n.COMPILE_STATUS))throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function tt(n,t,r){var e=Ct(n,t,(function(){return n.createShader(n.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Yn(n,t,(function(){return n.shaderSource(e,r)})),Yn(n,t,(function(){return n.compileShader(e)})),!1===n.getShaderParameter(e,n.COMPILE_STATUS))throw function(n,t){var r=it.exec(t);if(null==r)return console.log("Couldn't parse line number in error: "+t),void console.log(n);for(var e=+r[1],i=n.split("\n"),o=i.length.toString().length+2,a=i.map((function(n,t){return M((t+1).toString(),o)+n})),u=0,s=0;s<a.length;s++)u=Math.max(a[s].length,u);var c=a.slice(0,e-1),f=a.slice(e-1,e),l=a.slice(e);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+M(f[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}(r,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}!function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"}(Bn||(Bn={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(Wn||(Wn={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(zn||(zn={}));var rt,et,it=/ERROR: [0-9]+:([0-9]+):/g;function ot(n,t){return Ct(n,t,(function(){return n.createProgram()}),"Unable to create WebGLProgram.")}function at(n,t,r){if(Yn(n,t,(function(){return n.linkProgram(r)})),!1===n.getProgramParameter(r,n.LINK_STATUS))throw console.log(n.getProgramInfoLog(r)),new Error("Failed to link vertex and fragment shaders.")}function ut(n,t,r){if(Yn(n,t,(function(){return n.validateProgram(r)})),!1===n.getProgramParameter(r,n.VALIDATE_STATUS))throw console.log(n.getProgramInfoLog(r)),new Error("Shader program validation failed.")}function st(n,t,r){var e=Ct(n,t,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Yn(n,t,(function(){return n.bindBuffer(n.ARRAY_BUFFER,e)})),Yn(n,t,(function(){return n.bufferData(n.ARRAY_BUFFER,r,n.STATIC_DRAW)})),e}function ct(n,t,r){var e=Ct(n,t,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Yn(n,t,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)})),Yn(n,t,(function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,r,n.STATIC_DRAW)})),e}function ft(n,t){return Ct(n,t,(function(){return n.createTexture()}),"Unable to create WebGLTexture.")}function lt(n,t){var r=c().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){var e="["+n+"x"+t+"]";throw new Error("Requested texture size "+e+" is invalid.")}if(n>r||t>r)throw e="["+n+"x"+t+"]",new Error("Requested texture size "+e+" greater than WebGL maximum on this browser / GPU ["+r+"x"+r+"].")}function dt(n,t){return Ct(n,t,(function(){return n.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function ht(n,t,r,e,i,o,a,u){var s=n.getAttribLocation(r,e);return-1!==s&&(Yn(n,t,(function(){return n.bindBuffer(n.ARRAY_BUFFER,i)})),Yn(n,t,(function(){return n.vertexAttribPointer(s,o,n.FLOAT,!1,a,u)})),Yn(n,t,(function(){return n.enableVertexAttribArray(s)})),!0)}function vt(n,t,r,e){Nt(n,e),Yn(n,t,(function(){return n.activeTexture(n.TEXTURE0+e)})),Yn(n,t,(function(){return n.bindTexture(n.TEXTURE_2D,r)}))}function pt(n,t,r,e){return Ct(n,t,(function(){return n.getUniformLocation(r,e)}),'uniform "'+e+'" not present in program.')}function mt(n,t,r){return n.getUniformLocation(t,r)}function xt(n,t,r,e,i,o){Yn(n,t,(function(){return vt(n,t,e,o)})),Yn(n,t,(function(){return n.uniform1i(i,o)}))}function yt(n,t,r,e){Yn(n,t,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)})),Yn(n,t,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0)}))}function bt(n,t,r){Yn(n,t,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)})),Yn(n,t,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)}))}function gt(n){var t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+wt(n,t))}function wt(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Ct(n,t,r,e){var i=Yn(n,t,(function(){return r()}));if(null==i)throw new Error(e);return i}function Nt(n,t){var r=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,e=t+n.TEXTURE0;if(e<n.TEXTURE0||e>r)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+r+"].")}function Et(n,t){return void 0===t&&(t=2),_(n.slice(0,n.length-t))}function Rt(n){if(0===n.length)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function At(n){var t=[1,1,1];return 0===n.length||1===n.length&&1===n[0]||(t=[Et(n)].concat(Rt(n))),t}function _t(n,t){var r;void 0===t&&(t=!1);var e=c().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(e*=2,1===(n=n.map((function(t,r){return r>=n.length-2?w(n[r]):n[r]}))).length&&(n=[2,n[0]])),2!==n.length){var i=V(n);n=i.newShape}var o=_(n);if(n.length<=1&&o<=e)return[1,o];if(2===n.length&&n[0]<=e&&n[1]<=e)return n;if(3===n.length&&n[0]*n[1]<=e&&n[2]<=e)return[n[0]*n[1],n[2]];if(3===n.length&&n[0]<=e&&n[1]*n[2]<=e)return[n[0],n[1]*n[2]];if(4===n.length&&n[0]*n[1]*n[2]<=e&&n[3]<=e)return[n[0]*n[1]*n[2],n[3]];if(4===n.length&&n[0]<=e&&n[1]*n[2]*n[3]<=e)return[n[0],n[1]*n[2]*n[3]];if(t){var a=Et(n),u=2,s=2;return n.length&&(u=(r=Rt(n))[0],s=r[1]),I(o=a*(u/2)*(s/2)).map((function(n){return 2*n}))}return I(o)}function Ot(n){return n%2==0}function St(n,t){if(O(n=n.slice(-2),t=t.slice(-2)))return!0;if(!n.length||!t.length)return!0;if(0===n[0]||0===n[1]||0===t[0]||0===t[1])return!0;if(n.length!==t.length){var r=n.slice(-1)[0],e=t.slice(-1)[0];if(r===e)return!0;if(Ot(r)&&Ot(e)&&(1===n[0]||1===t[0]))return!0}return n[1]===t[1]&&Ot(n[0])&&Ot(t[0])}function Tt(n){if(null==rt){var t=jn(n);rt=t.getParameter(t.MAX_TEXTURE_SIZE)}return rt}function It(n){if(null==et){var t=jn(n);et=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,et)}function Mt(n){if(0===n)return 0;var t=jn(n);return kt(t,"EXT_disjoint_timer_query_webgl2")&&2===n?2:kt(t,"EXT_disjoint_timer_query")?1:0}function kt(n,t){return null!=n.getExtension(t)}function Dt(n){try{if(null!=jn(n))return!0}catch(n){return!1}return!1}function Ft(n){if(0===n)return!1;var t=jn(n);if(1===n){if(!kt(t,"OES_texture_float"))return!1}else if(!kt(t,"EXT_color_buffer_float"))return!1;return Pt(t)}function Vt(n){if(0===n)return!1;var t=jn(n);if(1!==n){if(kt(t,"EXT_color_buffer_float"))return Pt(t);if(kt(t,"EXT_color_buffer_half_float")){var r=t.getExtension("EXT_color_buffer_half_float");return function(n,t){var r=Kn(n,t),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,r.internalFormatHalfFloat,1,1,0,r.textureFormatFloat,r.textureTypeHalfFloat,null);var i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(i),o}(t,r)}return!1}return!!kt(t,"OES_texture_float")&&!!kt(t,"WEBGL_color_buffer_float")&&Pt(t)}function Pt(n){var t=Kn(n),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var e=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(e),i}function Lt(n){return 2===n&&null!=jn(n).fenceSync}var Bt=Object.freeze({callAndCheck:Yn,canBeRepresented:Jn,getWebGLErrorMessage:Zn,getExtensionOrThrow:Qn,createVertexShader:nt,createFragmentShader:tt,createProgram:ot,linkProgram:at,validateProgram:ut,createStaticVertexBuffer:st,createStaticIndexBuffer:ct,getNumChannels:function(){return 2===c().getNumber("WEBGL_VERSION")?1:4},createTexture:ft,validateTextureSize:lt,createFramebuffer:dt,bindVertexBufferToProgramAttribute:ht,bindTextureUnit:vt,unbindTextureUnit:function(n,t,r){Nt(n,r),Yn(n,t,(function(){return n.activeTexture(n.TEXTURE0+r)})),Yn(n,t,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:pt,getProgramUniformLocation:mt,bindTextureToProgramUniformSampler:xt,bindCanvasToFramebuffer:function(n,t){Yn(n,t,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)})),Yn(n,t,(function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)})),Yn(n,t,(function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)}))},bindColorTextureToFramebuffer:yt,unbindColorTextureFromFramebuffer:bt,validateFramebuffer:gt,getFramebufferErrorMessage:wt,getBatchDim:Et,getRowsCols:Rt,getShapeAs3D:At,getTextureShapeFromLogicalShape:_t,isReshapeFree:St,getWebGLMaxTextureSize:Tt,resetMaxTextureSize:function(){rt=null},resetMaxTexturesInShader:function(){et=null},getMaxTexturesInShader:It,getWebGLDisjointQueryTimerVersion:Mt,hasExtension:kt,isWebGLVersionEnabled:Dt,isCapableOfRenderingToFloatTexture:Ft,isDownloadFloatTextureEnabled:Vt,isWebGLFenceEnabled:Lt}),Wt=c();function zt(n){c().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Gt(n,t){return Vn.tidy(n,t)}function Ut(n){In(n).forEach((function(n){return n.dispose()}))}function qt(n){return Vn.keep(n)}function jt(n){return Vn.setBackend(n)}function Ht(){return Vn.backendName}function Xt(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];c().getBool("IS_TEST")||console.warn.apply(console,n)}function $t(n,t){var r=n;if(G(n))return"string"===t?[]:[n.length];if(!Array.isArray(n))return[];for(var e=[];Array.isArray(r)||G(r)&&"string"!==t;)e.push(r.length),r=r[0];return Array.isArray(n)&&c().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function n(t,r,e){if(e=e||[],Array.isArray(t)||G(t)){N(r.length>0,(function(){return"Element arr["+e.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),N(t.length===r[0],(function(){return"Element arr["+e.join("][")+"] should have "+r[0]+" elements, but has "+t.length+" elements"}));for(var i=r.slice(1),o=0;o<t.length;++o)n(t[o],i,e.concat(o))}else N(0===r.length,(function(){return"Element arr["+e.join("][")+"] is a primitive, but should be an array/TypedArray of "+r[0]+" elements"}))}(n,e,[]),e}function Kt(n,t,r,e){if(null!=n&&("numeric"!==n&&n!==t||"numeric"===n&&"string"===t))throw new Error("Argument '"+r+"' passed to '"+e+"' must be "+n+" tensor, but got "+t+" tensor")}function Yt(n,t,r,e){if(void 0===e&&(e="numeric"),n instanceof bn)return Kt(e,n.dtype,t,r),n;var i=$(n);if("string"!==i&&["bool","int32","float32"].indexOf(e)>=0&&(i=e),Kt(e,i,t,r),null==n||!G(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("Argument '"+t+"' passed to '"+r+"' must be a Tensor or TensorLike, but got '"+(null==n?"null":n.constructor.name)+"'");var o=$t(n,i);G(n)||Array.isArray(n)||(n=[n]);var a="string"!==i?Z(n,i,c().getBool("DEBUG")):A(n,[],!0);return Vn.makeTensor(a,o,i)}function Jt(n,t,r,e){if(void 0===e&&(e="numeric"),!Array.isArray(n))throw new Error("Argument "+t+" passed to "+r+" must be a `Tensor[]` or `TensorLike[]`");return n.map((function(n,e){return Yt(n,t+"["+e+"]",r)}),e)}function Zt(n,t){for(var r=0;r<n.length;++r)if(n[n.length-r-1]!==t-1-r)return!1;return!0}function Qt(n,t,r){for(var e=n.length+t.length,i=[],o=0,a=0,u=0;u<e;u++)-1===r.indexOf(u)?i.push(n[o++]):i.push(t[a++]);return i}function nr(n,t){for(var r=[],e=n.length,i=0;i<e;i++)-1===t.indexOf(i)&&r.push(n[i]);return[r,t.map((function(t){return n[t]}))]}function tr(n,t){return Qt(n,t.map((function(){return 1})),t)}function rr(n,t,r){N(Zt(t,r),(function(){return n+" supports only inner-most axes for now. Got axes "+t+" and rank-"+r+" input."}))}function er(n,t){if(Zt(n,t))return null;for(var r=[],e=0;e<t;++e)-1===n.indexOf(e)&&r.push(e);return n.forEach((function(n){return r.push(n)})),r}function ir(n){return n.map((function(n,t){return[t,n]})).sort((function(n,t){return n[1]-t[1]})).map((function(n){return n[0]}))}function or(n,t){for(var r=[],e=t-n;e<t;++e)r.push(e);return r}function ar(n,t){var r=n[0].length;n.forEach((function(n,t){N(n.length===r,(function(){return"Error in concat"+r+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+r+")"}))})),N(t>=0&&t<r,(function(){return"Error in concat"+r+"D: axis must be between 0 and "+(r-1)+"."}));var e=n[0];n.forEach((function(n,i){for(var o=0;o<r;o++)N(o===t||n[o]===e[o],(function(){return"Error in concat"+r+"D: Shape of tensors["+i+"] ("+n+") does not match the shape of the rest ("+e+") along the non-concatenated axis "+i+"."}))}))}function ur(n,t){for(var r=n[0].slice(),e=1;e<n.length;e++)r[t]+=n[e][t];return r}function sr(n){var t=Object.keys(n);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var r=t[0],e=n[r];r.endsWith("_")&&(r=r.substring(0,r.length-1));var i=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];Vn.startScope(r);try{var i=e.apply(void 0,n);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Vn.endScope(i),i}catch(n){throw Vn.endScope(null),n}};return Object.defineProperty(i,"name",{value:r,configurable:!0}),i}Wt.registerFlag("HAS_WEBGL",(function(){return Wt.getNumber("WEBGL_VERSION")>0})),Wt.registerFlag("WEBGL_VERSION",(function(){return Dt(2)?2:Dt(1)?1:0})),Wt.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Wt.get("WEBGL_VERSION")})),Wt.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Wt.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Wt.registerFlag("WEBGL_PACK",(function(){return Wt.getBool("HAS_WEBGL")})),Wt.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_PACK_CLIP",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Wt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_PACK_REDUCE",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_CONV_IM2COL",(function(){return Wt.getBool("WEBGL_PACK")})),Wt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Tt(Wt.getNumber("WEBGL_VERSION"))})),Wt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return It(Wt.getNumber("WEBGL_VERSION"))})),Wt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var n=Wt.getNumber("WEBGL_VERSION");return 0===n?0:Mt(n)})),Wt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Wt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n})),Wt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Ft(Wt.getNumber("WEBGL_VERSION"))})),Wt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Wt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Wt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Wt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Vt(Wt.getNumber("WEBGL_VERSION"))})),Wt.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Lt(Wt.getNumber("WEBGL_VERSION"))})),Wt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Wt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),yn=zt;var cr=sr({complex_:function(n,t){var r=Yt(n,"real","complex"),e=Yt(t,"imag","complex");return E(r.shape,e.shape,"real and imag shapes, "+r.shape+" and "+e.shape+", must match in call to tf.complex()."),Vn.runKernelFunc((function(n){return n.complex(r,e)}),{$real:r,$imag:e})}}),fr=sr({real_:function(n){var t=Yt(n,"input","real");return Vn.runKernelFunc((function(n){return n.real(t)}),{$input:t})}}),lr=sr({imag_:function(n){var t=Yt(n,"input","imag");return Vn.runKernelFunc((function(n){return n.imag(t)}),{$input:t})}});function dr(n,t,r){return hr(n,t,$t(n,r),r)}function hr(n,t,r,e){if(null==e&&(e=$(n)),"complex64"===e)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!G(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){en(t);var i=_(t),o=_(r);N(i===o,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+o}));for(var a=0;a<r.length;++a){var u=a!==r.length-1||r[a]!==_(t.slice(a));N(r[a]===t[a]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "}))}}return G(n)||Array.isArray(n)||(n=[n]),t=t||r,n="string"!==e?Z(n,e,c().getBool("DEBUG")):A(n,[],!0),Vn.makeTensor(n,t,e)}function vr(n,t){if((G(n)&&"string"!==t||Array.isArray(n))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&G(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return hr(n,[],[],t)}function pr(n,t){R(n);var r=$t(n,t);if(1!==r.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return hr(n,null,r,t)}function mr(n,t,r){if(R(n),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var e=$t(n,r);if(2!==e.length&&1!==e.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===e.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return hr(n,t,e,r)}function xr(n,t,r){if(R(n),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var e=$t(n,r);if(3!==e.length&&1!==e.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===e.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return hr(n,t,e,r)}function yr(n,t,r){if(R(n),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var e=$t(n,r);if(4!==e.length&&1!==e.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===e.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return hr(n,t,e,r)}function br(n,t,r){if(R(n),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var e=$t(n,r);if(5!==e.length&&1!==e.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===e.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return hr(n,t,e,r)}function gr(n,t,r){if(R(n),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var e=$t(n,r);if(6!==e.length&&1!==e.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===e.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return hr(n,t=t||e,e,r)}function wr(n,t,r,e){return void 0===t&&(t=!0),Vn.makeVariable(n,t,r,e)}function Cr(n,t){if(void 0===t&&(t="float32"),"complex64"===t){var r=Cr(n,"float32"),e=Nr(n,"float32");return cr(r,e)}var i=nn(_(n),t);return Vn.makeTensor(i,n,t)}function Nr(n,t){if(void 0===t&&(t="float32"),"complex64"===t){var r=Nr(n,"float32"),e=Nr(n,"float32");return cr(r,e)}var i=tn(_(n),t);return Vn.makeTensor(i,n,t)}function Er(n,t,r){return Vn.runKernelFunc((function(e){return e.fill(n,t,r)}),{})}function Rr(n,t,r){if(r<=0)throw new Error("The number of values should be positive.");return Vn.runKernelFunc((function(e){return e.linspace(n,t,r)}),{})}function Ar(n,t,r,e){if(void 0===r&&(r=1),void 0===e&&(e="float32"),0===r)throw new Error("Cannot have a step of zero");if(n===t||n<t&&r<0||t<n&&r>1)return Nr([0],e);var i=tn(Math.abs(Math.ceil((t-n)/r)),e);t<n&&1===r&&(r=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return pr(i,e)}var _r=sr({onesLike_:function(n){var t=Yt(n,"x","onesLike");if("complex64"===t.dtype){var r=_r(fr(t)),e=Or(lr(t));return cr(r,e)}return Vn.runKernelFunc((function(n){return n.onesLike(t)}),{x:t},(function(n){return{x:function(){return Or(n)}}}),"OnesLike")}}),Or=sr({zerosLike_:function(n){var t=Yt(n,"x","zerosLike");return Vn.runKernelFunc((function(n){return n.zerosLike(t)}),{x:t},(function(n){return{x:function(){return Or(n)}}}),"ZerosLike")}}),Sr=sr({concat_:function(n,t){void 0===t&&(t=0),N(n.length>=1,(function(){return"Pass at least one tensor to concat"}));var r=Jt(n,"tensors","concat");"complex64"===r[0].dtype&&r.forEach((function(n){if("complex64"!==n.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+n.dtype+". ")})),t=F(t,r[0].shape)[0];var e=ur(r.map((function(n){return n.shape})),t);if(0===_(e))return dr([],e);if(1===(r=r.filter((function(n){return n.size>0}))).length)return r[0];var i=r.map((function(n){return n.shape}));return ar(i,t),Vn.runKernelFunc((function(n){return n.concat(r,t)}),r,(function(n){var r=i.map((function(n){return n[t]}));return Dr(n,r,t).map((function(n){return function(){return n}}))}),"Concat",{axis:t})}}),Tr=sr({concat1d_:function(n){return Sr(n,0)}}),Ir=sr({concat2d_:function(n,t){return Sr(n,t)}}),Mr=sr({concat3d_:function(n,t){return Sr(n,t)}}),kr=sr({concat4d_:function(n,t){return Sr(n,t)}}),Dr=sr({split_:function(n,t,r){void 0===r&&(r=0);var e,i=Yt(n,"x","split");return r=F(r,i.shape)[0],"number"==typeof t?(N(i.shape[r]%t==0,(function(){return"Number of splits must evenly divide the axis."})),e=new Array(t).fill(i.shape[r]/t)):(N(i.shape[r]===t.reduce((function(n,t){return n+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),e=t),Vn.runKernelFunc((function(n){return n.split(i,e,r)}),{$x:i},(function(n){return{$x:function(){return Sr(n,r)}}}))}});function Fr(n,t,r){return void 0===t&&(t="float32"),t=t||"float32",en(n),new pn(n,t,r)}function Vr(n,t){void 0===t&&(t=!1),console.log(n.toString(t))}var Pr=sr({batchToSpaceND_:function(n,t,r){var e=Yt(n,"x","batchToSpaceND"),i=t.reduce((function(n,t){return n*t}));return N(e.rank>=1+t.length,(function(){return"input rank is "+e.rank+" but should be > than blockShape.length "+t.length})),N(r.length===t.length,(function(){return"crops.length is "+r.length+" but should be equal to blockShape.length  "+t.length})),N(e.shape[0]%i==0,(function(){return"input tensor batch is "+e.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),Vn.runKernelFunc((function(n){return n.batchToSpaceND(e,t,r)}),{$x:e},(function(n){return{$x:function(){return n.spaceToBatchND(t,r)}}}))}}),Lr=sr({cast_:function(n,t){var r=Yt(n,"x","cast");if(!W(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==r.dtype||"string"!==t&&"string"===r.dtype)throw new Error("Only strings can be casted to strings");return Vn.runKernelFunc((function(n){return n.cast(r,t)}),{x:r},(function(n){return{x:function(){return n.clone()}}}),"Cast",{dtype:t})}}),Br=sr({cumsum_:function(n,t,r,e){void 0===t&&(t=0),void 0===r&&(r=!1),void 0===e&&(e=!1);var i=Yt(n,"x","cumsum"),o=er([t|=0],i.rank),a=i;null!=o&&(a=i.transpose(o));var u=or(1,i.rank)[0],s=Vn.runKernelFunc((function(n){return n.cumsum(a,u,r,e)}),{permutedX:a},(function(n){return{permutedX:function(){return n.cumsum(t,r,!e)}}}));return null!=o&&(s=s.transpose(o)),s}}),Wr=sr({depthToSpace_:function(n,t,r){void 0===r&&(r="NHWC");var e=Yt(n,"x","depthToSpace"),i="NHWC"===r?e.shape[1]:e.shape[2],o="NHWC"===r?e.shape[2]:e.shape[3],a="NHWC"===r?e.shape[3]:e.shape[1];return N(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+e.shape})),N(o*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+" for depthToSpace with input shape\n          "+e.shape})),N(a%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+e.shape})),Vn.runKernelFunc((function(n){return n.depthToSpace(e,t,r)}),{$x:e})}}),zr=sr({expandDims_:function(n,t){void 0===t&&(t=0);var r=Yt(n,"x","expandDims",null);N(t<=r.rank,(function(){return"Axis must be <= rank of the tensor"}));var e=r.shape.slice();return t<0&&(N(-(r.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(r.rank+1)+", "+r.rank+"]"})),t=r.rank+t+1),e.splice(t,0,1),Gr(r,e)}}),Gr=sr({reshape_:function(n,t){var r=Yt(n,"x","reshape",null);return t=D(t,r.size),N(r.size===_(t),(function(){return"new shape and old shape must have the same number of elements."})),Vn.runKernelFunc((function(n){return n.reshape(r,t)}),{x:r},(function(n){return{x:function(){return n.reshape(r.shape)}}}),"Reshape",{shape:t})}}),Ur=sr({spaceToBatchND_:function(n,t,r){var e=Yt(n,"x","spaceToBatchND");return N(e.rank>=1+t.length,(function(){return"input rank "+e.rank+" should be > than [blockShape] "+t.length})),N(r.length===t.length,(function(){return"paddings.shape[0] "+r.length+" must be equal to [blockShape] "+t.length})),N(e.shape.reduce((function(n,e,i){return i>0&&i<=t.length?n&&(e+r[i-1][0]+r[i-1][1])%t[i-1]==0:n}),!0),(function(){return"input spatial dimensions "+e.shape.slice(1)+" with paddings "+r.toString()+" must be divisible by blockShapes "+t.toString()})),Vn.runKernelFunc((function(n){return n.spaceToBatchND(e,t,r)}),{$x:e},(function(n){return{$x:function(){return n.batchToSpaceND(t,r)}}}))}}),qr=sr({squeeze_:function(n,t){var r=Yt(n,"x","squeeze");return Gr(r,V(r.shape,t).newShape)}}),jr=sr({stack_:function(n,t){void 0===t&&(t=0);var r=Jt(n,"tensors","stack");if(N(r.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===r.length)return r[0].expandDims(t);var e=r[0].shape,i=r[0].dtype;N(t<=r[0].rank,(function(){return"Axis must be <= rank of the tensor"})),r.forEach((function(n){E(e,n.shape,"All tensors passed to stack must have matching shapes")})),r.forEach((function(n){N(i===n.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=r.map((function(n){return n.expandDims(t)}));return Sr(o,t)}}),Hr=sr({unstack_:function(n,t){void 0===t&&(t=0),t=t||0;var r=Yt(n,"x","unstack");return N(t>=-r.shape.length&&t<r.shape.length,(function(){return"Axis = "+t+" is not in [-"+r.shape.length+", "+r.shape.length+")"})),t<0&&(t+=r.shape.length),Vn.runKernelFunc((function(n){return n.unstack(r,t)}),{x:r},(function(n){return{x:function(){return jr(n,t)}}}),"Unpack",{axis:t})}}),Xr=function(n,t){return o(this,void 0,void 0,(function(){var r,e,i,o,u,s,c,f,l,d;return a(this,(function(a){switch(a.label){case 0:return r=Yt(n,"x","setdiff1d"),e=Yt(t,"y","setdiff1d"),N(r.dtype===e.dtype,(function(){return"x and y should have the same dtype, but got x ("+r.dtype+") and y ("+e.dtype+")."})),N(1===r.rank,(function(){return"x should be 1D tensor, but got x ("+r.shape+")."})),N(1===e.rank,(function(){return"y should be 1D tensor, but got y ("+e.shape+")."})),[4,r.data()];case 1:return i=a.sent(),[4,e.data()];case 2:for(o=a.sent(),u=new Set(o),s=0,l=0;l<i.length;l++)u.has(i[l])||s++;for(c=new pn([s],r.dtype),f=new pn([s],"int32"),l=0,d=0;l<i.length;l++)u.has(i[l])||(c.values[d]=i[l],f.values[d]=l,d++);return[2,[c.toTensor(),f.toTensor()]]}}))}))};function $r(n,t,r,e){void 0===e&&(e=!0);var i=[];if(e)(i=i.concat(t.slice(0))).push(n[0]/r),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=t.length,a=0;a<o;++a)i=i.concat([n[a+1]/t[a],t[a]]);i=i.concat(n.slice(o+1))}return i}function Kr(n,t,r){void 0===r&&(r=!0);var e=[];if(r){e.push(t);for(var i=t+1;i<n;++i)i<=2*t?(e.push(i),e.push(i-(t+1))):e.push(i)}else{var o=[],a=[];for(i=1;i<n;++i)i>=2*t+1||i%2==1?a.push(i):o.push(i);e.push.apply(e,o),e.push(0),e.push.apply(e,a)}return e}function Yr(n,t,r,e){void 0===e&&(e=!0);var i=[];i.push(e?n[0]/r:n[0]*r);for(var o=1;o<n.length;++o)i.push(o<=t.length?e?t[o-1]*n[o]:n[o]/t[o-1]:n[o]);return i}function Jr(n,t){for(var r=[0],e=0;e<t;++e)r.push(n[e][0]);return r}function Zr(n,t,r){for(var e=n.slice(0,1),i=0;i<r;++i)e.push(n[i+1]-t[i][0]-t[i][1]);return e}var Qr="Div",ne="SquaredDifference",te="BroadcastTo",re="OneHot",ee="Identity",ie="Tile",oe="PadV2",ae=sr({add_:function(n,t){var r,e=Yt(n,"a","add"),i=Yt(t,"b","add");return r=Sn(e,i),Vn.runKernelFunc((function(n,t){var r=n.add(e,i);return t([e,i]),r}),{a:e=r[0],b:i=r[1]},null,"Add")}});function ue(n,t){for(var r=n.length,e=[],i=0;i<r;i++){var o=r-1-i;(t[t.length-1-i]||1)>1&&1===(n[o]||1)&&e.unshift(o)}return e}function se(n,t){for(var r=[],e=0;e<t.length;e++){var i=n[n.length-e-1],o=t.length-e-1;(null==i||1===i&&t[o]>1)&&r.unshift(o)}return r}function ce(n,t){for(var r=[],e=Math.max(n.length,t.length),i=0;i<e;i++){var o=n[n.length-i-1];null==o&&(o=1);var a=t[t.length-i-1];if(null==a&&(a=1),1===o)r.unshift(a);else if(1===a)r.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+t+".");r.unshift(o)}}return r}var fe=sr({abs_:function(n){var t=Yt(n,"x","abs");return"complex64"===t.dtype?Vn.runKernelFunc((function(n){return n.complexAbs(t)}),{$x:t}):Vn.runKernelFunc((function(n,r){var e=n.abs(t);return r([t]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return n.mul(r.toFloat().step(-1))}}}),"Abs")}}),le=sr({acos_:function(n){var t=Yt(n,"x","acos");return Vn.runKernelFunc((function(n,r){var e=n.acos(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.divStrict(vr(1).sub(r.toFloat().square()).sqrt()).neg()}}}))}}),de=sr({acosh_:function(n){var t=Yt(n,"x","acosh");return Vn.runKernelFunc((function(n,r){var e=n.acosh(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.divStrict(r.toFloat().square().sub(1).sqrt())}}}))}}),he=sr({asin_:function(n){var t=Yt(n,"x","asin");return Vn.runKernelFunc((function(n,r){var e=n.asin(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.divStrict(vr(1).sub(r.toFloat().square()).sqrt())}}}))}}),ve=sr({asinh_:function(n){var t=Yt(n,"x","asinh");return Vn.runKernelFunc((function(n,r){var e=n.asinh(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.divStrict(vr(1).add(r.toFloat().square()).sqrt())}}}))}}),pe=sr({atan_:function(n){var t=Yt(n,"x","atan");return Vn.runKernelFunc((function(n,r){var e=n.atan(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.div(r.toFloat().square().add(1))}}}))}}),me=sr({atanh_:function(n){var t=Yt(n,"x","atanh");return Vn.runKernelFunc((function(n,r){var e=n.atanh(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.div(vr(1).sub(r.toFloat().square()))}}}))}}),xe=sr({ceil_:function(n){var t=Yt(n,"x","ceil");return Vn.runKernelFunc((function(n){return n.ceil(t)}),{$x:t},(function(n){return{$x:function(){return Or(n)}}}))}}),ye=sr({clipByValue_:function(n,t,r){var e=Yt(n,"x","clipByValue");return N(t<=r,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+r+")."})),Vn.runKernelFunc((function(n,i){var o=n.clip(e,t,r);return i([e]),o}),{x:e},(function(n,e){var i=e[0];return{x:function(){return n.where(i.greaterEqual(t).logicalAnd(i.lessEqual(r)),Or(n))}}}),"ClipByValue",{min:t,max:r},[e])}}),be=sr({cos_:function(n){var t=Yt(n,"x","cos");return Vn.runKernelFunc((function(n,r){var e=n.cos(t);return r([t]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return r.toFloat().sin().neg().mul(n)}}}),"Cos",{},[t])}}),ge=sr({cosh_:function(n){var t=Yt(n,"x","cosh");return Vn.runKernelFunc((function(n,r){var e=n.cosh(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return r.toFloat().sinh().mulStrict(n)}}}))}}),we=sr({erf_:function(n){var t=Yt(n,"x","erf");return N("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),Vn.runKernelFunc((function(n,r){var e=n.erf(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.mul(r.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),Ce=sr({exp_:function(n){var t=Yt(n,"x","exp");return Vn.runKernelFunc((function(n,r){var e=n.exp(t);return r([e]),e}),{x:t},(function(n,t){return{x:function(){return n.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),Ne=sr({expm1_:function(n){var t=Yt(n,"x","expm1");return Vn.runKernelFunc((function(n,r){var e=n.expm1(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.mul(r.exp())}}}))}}),Ee=sr({floor_:function(n){var t=Yt(n,"x","floor");return Vn.runKernelFunc((function(n){return n.floor(t)}),{$x:t},(function(n){return{$x:function(){return Or(n)}}}))}}),Re=sr({log_:function(n){var t=Yt(n,"x","log");return Vn.runKernelFunc((function(n,r){var e=n.log(t);return r([t]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return n.div(r.toFloat())}}}),"Log",{},[t])}}),Ae=sr({log1p_:function(n){var t=Yt(n,"x","log1p");return Vn.runKernelFunc((function(n,r){var e=n.log1p(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.div(r.add(1))}}}))}}),_e=sr({logSigmoid_:function(n){var t=Yt(n,"x","logSigmoid");return Vn.runKernelFunc((function(n,r){var e=n.softplus(t.neg()).neg();return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.mul(r.neg().sigmoid())}}}))}}),Oe=sr({neg_:function(n){var t=Yt(n,"x","neg");return Vn.runKernelFunc((function(n){return n.neg(t)}),{x:t},(function(n){return{x:function(){return n.neg()}}}),"Neg",{},[t])}}),Se=sr({reciprocal_:function(n){var t=Yt(n,"x","reciprocal");return Vn.runKernelFunc((function(n,r){var e=n.reciprocal(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.div(r.square().neg())}}}))}}),Te=sr({round_:function(n){var t=Yt(n,"x","round");return Vn.runKernelFunc((function(n){return n.round(t)}),{$x:t},(function(n){return{$x:function(){return Or(n)}}}))}}),Ie=sr({rsqrt_:function(n){var t=Yt(n,"x","rsqrt");return Vn.runKernelFunc((function(n,r){var e=n.rsqrt(t);return r([t]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return n.div(r.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},[t])}}),Me=sr({sigmoid_:function(n){var t=Yt(n,"x","sigmoid");return Vn.runKernelFunc((function(n,r){var e=n.sigmoid(t);return r([e]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return n.mul(r.mul(vr(1).sub(r)))}}}),"Sigmoid")}}),ke=sr({sign_:function(n){var t=Yt(n,"x","sign");return Vn.runKernelFunc((function(n){return n.sign(t)}),{$x:t},(function(n){return{$x:function(){return Or(n)}}}))}}),De=sr({isNaN_:function(n){var t=Yt(n,"x","isNaN");return Vn.runKernelFunc((function(n){return n.isNaN(t)}),{$x:t},(function(n){return{$x:function(){return Or(n)}}}))}}),Fe=sr({isInf_:function(n){var t=Yt(n,"x","isInf");return Vn.runKernelFunc((function(n){return n.isInf(t)}),{$x:t},(function(n){return{$x:function(){return Or(n)}}}))}}),Ve=sr({isFinite_:function(n){var t=Yt(n,"x","isFinite");return Vn.runKernelFunc((function(n){return n.isFinite(t)}),{$x:t},(function(n){return{$x:function(){return Or(n)}}}))}}),Pe=sr({sin_:function(n){var t=Yt(n,"x","sin");return Vn.runKernelFunc((function(n,r){var e=n.sin(t);return r([t]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return r.toFloat().cos().mul(n)}}}),"Sin",{},[t])}}),Le=sr({sinh_:function(n){var t=Yt(n,"x","sinh");return Vn.runKernelFunc((function(n,r){var e=n.sinh(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return r.toFloat().cosh().mulStrict(n)}}}))}}),Be=sr({softplus_:function(n){var t=Yt(n,"x","softplus");return Vn.runKernelFunc((function(n,r){var e=n.softplus(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.mul(r.sigmoid())}}}))}}),We=sr({sqrt_:function(n){var t=Yt(n,"x","sqrt");return Vn.runKernelFunc((function(n,r){var e=n.sqrt(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.div(r.toFloat().sqrt().mul(2))}}}))}}),ze=sr({step_:function(n,t){void 0===t&&(t=0);var r=Yt(n,"x","step");return Vn.runKernelFunc((function(n){return n.step(r,t)}),{$x:r},(function(n){return{$x:function(){return Or(n)}}}))}}),Ge=sr({tan_:function(n){var t=Yt(n,"x","tan");return Vn.runKernelFunc((function(n,r){var e=n.tan(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return n.div(r.cos().square())}}}))}}),Ue=sr({tanh_:function(n){var t=Yt(n,"x","tanh");return Vn.runKernelFunc((function(n,r){var e=n.tanh(t);return r([e]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return vr(1).sub(r.square()).mulStrict(n)}}}),"Tanh",{},null,[!0])}}),qe=sr({addStrict_:function(n,t){var r=Yt(n,"a","addStrict"),e=Yt(t,"b","addStrict");return E(r.shape,e.shape,"Error in addStrict: "),r.add(e)}}),je=sr({atan2_:function(n,t){var r,e=Yt(n,"a","atan2"),i=Yt(t,"b","atan2");r=Sn(e,i);var o=ce((e=r[0]).shape,(i=r[1]).shape);return Vn.runKernelFunc((function(n,t){var r=n.atan2(e,i);return t([e,i]),r}),{$a:e,$b:i},(function(n,t){var r=t[0],e=t[1];return{$a:function(){var t=ae(r.square(),e.square()),i=n.mul(e.div(t)),a=se(r.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)},$b:function(){var t=ae(r.square(),e.square()),i=Oe(n.mul(r.div(t))),a=se(e.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(e.shape)}}}))}}),He=sr({divStrict_:function(n,t){var r=Yt(n,"a","div"),e=Yt(t,"b","div");return E(r.shape,e.shape,"Error in divideStrict: "),r.div(e)}}),Xe=sr({floorDiv_:function(n,t){var r,e=Yt(n,"a","floorDiv"),i=Yt(t,"b","floorDiv");r=Sn(e,i);var o=ce((e=r[0]).shape,(i=r[1]).shape);return Vn.runKernelFunc((function(n,t){var r=n.floorDiv(e,i);return t([e,i]),r}),{a:e,b:i},(function(n,t){var r=t[0],e=t[1];return{a:function(){var t=n.div(e.toFloat()),i=se(r.shape,o);return i.length>0?t.sum(i).reshape(r.shape):t},b:function(){var t=n.mul(r.toFloat()),i=se(e.shape,o);i.length>0&&(t=t.sum(i).reshape(e.shape));var a=e.square();return t.div(a.toFloat()).neg()}}}),"FloorDiv")}}),$e=sr({maximum_:function(n,t){var r,e=Yt(n,"a","maximum"),i=Yt(t,"b","maximum");return r=Sn(e,i),i=r[1],"bool"===(e=r[0]).dtype&&(e=e.toInt(),i=i.toInt()),ce(e.shape,i.shape),Vn.runKernelFunc((function(n,t){var r=n.maximum(e,i);return t([e,i]),r}),{a:e,b:i},(function(n,t){var r=t[0],e=t[1];return{a:function(){return n.mul(r.greaterEqual(e).toFloat())},b:function(){return n.mul(r.less(e).toFloat())}}}),"Maximum")}}),Ke=sr({maximumStrict_:function(n,t){var r=Yt(n,"a","maximumStrict"),e=Yt(t,"b","maximumStrict");return E(r.shape,e.shape,"Error in maximumStrict: "),r.maximum(e)}}),Ye=sr({minimum_:function(n,t){var r,e=Yt(n,"a","minimum"),i=Yt(t,"b","minimum");return r=Sn(e,i),i=r[1],"bool"===(e=r[0]).dtype&&(e=e.toInt(),i=i.toInt()),ce(e.shape,i.shape),Vn.runKernelFunc((function(n,t){var r=n.minimum(e,i);return t([e,i]),r}),{a:e,b:i},(function(n,t){var r=t[0],e=t[1];return{a:function(){return n.mul(r.lessEqual(e).toFloat())},b:function(){return n.mul(r.greater(e).toFloat())}}}),"Minimum")}}),Je=sr({minimumStrict_:function(n,t){var r=Yt(n,"a","minimumStrict"),e=Yt(t,"b","minimumStrict");return E(r.shape,e.shape,"Error in minimumStrict: "),r.minimum(e)}}),Ze=sr({mod_:function(n,t){var r,e=Yt(n,"a","mod"),i=Yt(t,"b","mod");r=Sn(e,i);var o=ce((e=r[0]).shape,(i=r[1]).shape);return Vn.runKernelFunc((function(n,t){var r=n.mod(e,i);return t([e,i]),r}),{$a:e,$b:i},(function(n,t){var r=t[0],e=t[1];return{$a:function(){var t=se(r.shape,o);return t.length>0?n.sum(t).reshape(r.shape):n},$b:function(){var t=n.mul(r.div(e).floor().neg()),i=se(e.shape,o);return i.length>0?t.sum(i).reshape(e.shape):t}}}))}}),Qe=sr({modStrict_:function(n,t){var r=Yt(n,"a","modStrict"),e=Yt(t,"b","modStrict");return E(r.shape,e.shape,"Error in modStrict: "),r.mod(e)}}),ni=sr({mul_:function(n,t){var r,e=Yt(n,"a","mul"),i=Yt(t,"b","mul");r=Sn(e,i);var o=ce((e=r[0]).shape,(i=r[1]).shape);return Vn.runKernelFunc((function(n,t){var r=n.multiply(e,i);return t([e,i]),r}),{a:e,b:i},(function(n,t){var r=t[0],e=t[1];return{a:function(){var t=n.mul(e.toFloat()),i=se(r.shape,o);return i.length>0?t.sum(i).reshape(r.shape):t},b:function(){var t=n.mul(r.toFloat()),i=se(e.shape,o);return i.length>0?t.sum(i).reshape(e.shape):t}}}),"Mul")}}),ti=sr({mulStrict_:function(n,t){var r=Yt(n,"a","mul"),e=Yt(t,"b","mul");return E(r.shape,e.shape,"Error in multiplyStrict: "),r.mul(e)}}),ri=sr({pow_:function(n,t){var r,e=Yt(n,"base","pow"),i=Yt(t,"exp","pow");r=Sn(e,i);var o=ce((e=r[0]).shape,(i=r[1]).shape);return Vn.runKernelFunc((function(n,t){var r=n.pow(e,i);return t([e,i,r]),r}),{a:e,b:i},(function(n,t){var r=t[0],e=t[1],i=t[2];return{a:function(){var t=e.toFloat(),i=n.mul(t.mul(r.pow(t.sub(vr(1))))),a=se(r.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)},b:function(){var t=r.greater(0),a=r.log().where(t,Or(r)),u=n.mul(i.mul(a)),s=se(e.shape,o);return s.length>0&&(u=u.sum(s)),u.reshape(e.shape)}}}),"Pow",{},[e,i],[!0])}}),ei=sr({powStrict_:function(n,t){return E(n.shape,t.shape,"Error in powStrict: "),n.pow(t)}}),ii=sr({squaredDifferenceStrict_:function(n,t){var r=Yt(n,"a","squaredDifferenceStrict"),e=Yt(t,"b","squaredDifferenceStrict");return E(r.shape,e.shape,"Error in squaredDifferenceStrict: "),r.squaredDifference(e)}}),oi=sr({sub_:function(n,t){var r,e=Yt(n,"a","sub"),i=Yt(t,"b","sub");r=Sn(e,i);var o=ce((e=r[0]).shape,(i=r[1]).shape);return Vn.runKernelFunc((function(n){return n.subtract(e,i)}),{a:e,b:i},(function(n){return{a:function(){var t=n,r=se(e.shape,o);return r.length>0&&(t=t.sum(r)),t.reshape(e.shape)},b:function(){var t=n,r=se(i.shape,o);return r.length>0&&(t=t.sum(r)),t.neg().reshape(i.shape)}}}),"Sub")}}),ai=sr({subStrict_:function(n,t){var r=Yt(n,"a","subStrict"),e=Yt(t,"b","subStrict");return E(r.shape,e.shape,"Error in subStrict: "),r.sub(e)}}),ui=sr({div_:function(n,t){var r,e=Yt(n,"a","div"),i=Yt(t,"b","div");return r=Sn(e,i),i=r[1],"int32"===(e=r[0]).dtype&&"int32"===i.dtype?Xe(e,i):Vn.runKernelFunc((function(n,t){var r=n.realDivide(e,i);return t([e,i]),r}),{a:e,b:i},null,Qr,{})}});function si(n,t){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+n.rank);if(0===n.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var r=t.shape,e=r[r.length-1],i=1,o=0;o<r.length-1;++o)i*=r[o];var a=n.shape,u=r.slice();u.pop();var s=1;for(o=e;o<n.rank;++o)s*=a[o],u.push(a[o]);var c=J(n.shape).map((function(n){return n/s})).concat([1]).slice(0,e);return[u,i,s,c]}var ci=Object.freeze({prepareAndValidate:si});function fi(n){return n<=30?n:Y(n,Math.floor(Math.sqrt(n)))}function li(n,t,r){var e=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+r.shape+", indices.shape: "+t.shape+", shape: "+n+", sliceDim: "+e+", and batchDim: "+i+".";if(r.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<e+(r.rank-i))throw new Error(o+" Output shape length < "+(e+(r.rank-i)));if(r.rank!==i+n.length-e)throw new Error(o+" update.rank != "+(i+n.length-e));for(var a=0;a<i;++a)if(r.shape[a]!==t.shape[a])throw new Error(o+" updates.shape["+a+"] ("+r.shape[a]+") != indices.shape["+a+"] ("+t.shape[a]+").");for(a=0;a<r.rank-i;++a)if(r.shape[a+i]!==n[a+e])throw new Error(o+" updates.shape["+(a+i)+"] ("+r.shape[a+i]+") != shape["+(a+i)+"] ("+n[a+i]+")")}function di(n,t,r){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(r.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+r);if(0===r.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===n.size)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}li(r,t,n)}function hi(n,t,r){for(var e=t.shape.length,i=e>1?t.shape[e-1]:1,o=r.length,a=1,u=i;u<o;++u)a*=r[u];var s=i<1?1:i;return{sliceRank:i,numUpdates:_(t.shape)/s,sliceSize:a,strides:J(r.slice(0,i)).concat([1]),outputSize:_(r)}}var vi=Object.freeze({validateUpdateShape:li,validateInput:di,calculateShapes:hi});function pi(n,t,r){N(n.rank===t.length,(function(){return"Error in slice"+n.rank+"D: Length of begin "+t+" must match the rank of the array ("+n.rank+")."})),N(n.rank===r.length,(function(){return"Error in slice"+n.rank+"D: Length of size "+r+" must match the rank of the array ("+n.rank+")."}));for(var e=function(e){N(t[e]+r[e]<=n.shape[e],(function(){return"Error in slice"+n.rank+"D: begin["+e+"] + size["+e+"] ("+(t[e]+r[e])+") would overflow input.shape["+e+"] ("+n.shape[e]+")"}))},i=0;i<n.rank;++i)e(i)}function mi(n){for(var t=[],r=0;n>0;)1&n&&t.push(r),n/=2,r++;return t}function xi(n,t,r){for(var e=[],i=0;i<n.length;i++)e[i]=Math.ceil((t[i]-n[i])/r[i]);return e}function yi(n,t,r,e,i){var o=t[i];(n&1<<i||null==o)&&(o=(r[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=e[i];return o<0&&(o+=a),g(0,o,a-1)}function bi(n,t,r,e,i){var o=t[i],a=r[i]||1;(n&1<<i||null==o)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=e[i];return o<0&&(o+=u),a>0?g(0,o,u):g(-1,o,u-1)}function gi(n,t,r){for(var e=r.length,i=0;i<r.length;i++)if(r[i]>1){e=i;break}for(i=e+1;i<r.length;i++)if(t[i]>0||r[i]!==n[i])return!1;return!0}function wi(n,t){for(var r=n.length>0?n[n.length-1]:1,e=0;e<n.length-1;e++)r+=n[e]*t[e];return r}var Ci=Object.freeze({assertParamsValid:pi,maskToAxes:mi,computeOutShape:xi,startForAxis:yi,stopForAxis:bi,isSliceContinous:gi,computeFlatOffset:wi});function Ni(n,t){N(K(n),(function(){return"The f passed in variableGrads(f) must be a function"})),N(null==t||Array.isArray(t)&&t.every((function(n){return n instanceof Rn})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var r=null!=t;if(!r)for(var e in t=[],Vn.registeredVariables)t.push(Vn.registeredVariables[e]);var i=r?t.filter((function(n){return!n.trainable})):null,o=t.length;N((t=t.filter((function(n){return n.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."}));var a=Vn.gradients(n,t,null,!0),u=a.value,s=a.grads;N(s.some((function(n){return null!=n})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),N(0===u.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"}));var c={};return t.forEach((function(n,t){null!=s[t]&&(c[n.name]=s[t])})),null!=i&&i.forEach((function(n){return c[n.name]=null})),{value:u,grads:c}}function Ei(n){return Vn.customGrad(n)}function Ri(n){if(n.filter((function(n){return null==n})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var Ai=sr({softmax_:function(n,t){void 0===t&&(t=-1);var r=Yt(n,"logits","softmax","float32");if(-1===t&&(t=r.rank-1),t!==r.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and dim was "+t);return Vn.runKernelFunc((function(n,e){var i=n.softmax(r,t);return e([i]),i}),{logits:r},(function(n,r){var e=r[0],i=n.mul(e);return{logits:function(){return i.sub(i.sum([t],!0).mul(e))}}}),"Softmax",{dim:t},[],[!0])}}),_i=sr({logSoftmax_:function(n,t){void 0===t&&(t=-1);var r=Yt(n,"logits","logSoftmax");if(-1===t&&(t=r.rank-1),t!==r.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and axis was "+t);return Ei((function(n,r){var e=n.max(t,!0),i=n.sub(e),o=i.toFloat().sub(i.exp().sum(t,!0).log());return r([o]),{value:o,gradFunc:function(n,r){var e=r[0].exp();return n.sub(n.sum(t,!0).mul(e))}}}))(r)}}),Oi=sr({transpose_:function(n,t){var r=Yt(n,"x","transpose");return null==t&&(t=r.shape.map((function(n,t){return t})).reverse()),N(r.rank===t.length,(function(){return"Error in transpose: rank of input "+r.rank+" must match length of perm "+t+"."})),t.forEach((function(n){N(n>=0&&n<r.rank,(function(){return"All entries in 'perm' must be between 0 and "+(r.rank-1)+" but got "+t}))})),r.rank<=1?r.clone():Vn.runKernelFunc((function(n){return n.transpose(r,t)}),{x:r},null,"Transpose",{perm:t})}}),Si=function(){function n(n,t){this.backend=n,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},n.prototype.set=function(n,t){this.dataIdsCount++,this.data.set(n,t)},n.prototype.has=function(n){return this.data.has(n)},n.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),Ti=function(){function n(){}return n.prototype.time=function(){return Ii("time")},n.prototype.read=function(){return Ii("read")},n.prototype.readSync=function(){return Ii("readSync")},n.prototype.numDataIds=function(){return Ii("numDataIds")},n.prototype.disposeData=function(){return Ii("disposeData")},n.prototype.write=function(){return Ii("write")},n.prototype.move=function(){return Ii("move")},n.prototype.memory=function(){return Ii("memory")},n.prototype.floatPrecision=function(){return Ii("floatPrecision")},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.batchMatMul=function(){return Ii("batchMatMul")},n.prototype.fusedBatchMatMul=function(){return Ii("fusedBatchMatMul")},n.prototype.slice=function(){return Ii("slice")},n.prototype.stridedSlice=function(){return Ii("stridedSlice")},n.prototype.unstack=function(){return Ii("unstack")},n.prototype.reverse=function(){return Ii("reverse")},n.prototype.concat=function(){return Ii("concat")},n.prototype.neg=function(){return Ii("neg")},n.prototype.add=function(){return Ii("add")},n.prototype.addN=function(){return Ii("addN")},n.prototype.subtract=function(){return Ii("subtract")},n.prototype.multiply=function(){return Ii("multiply")},n.prototype.realDivide=function(){return Ii("realDivide")},n.prototype.floorDiv=function(){return Ii("floorDiv")},n.prototype.sum=function(){return Ii("sum")},n.prototype.prod=function(){return Ii("prod")},n.prototype.unsortedSegmentSum=function(){return Ii("unsortedSegmentSum")},n.prototype.argMin=function(){return Ii("argMin")},n.prototype.argMax=function(){return Ii("argMax")},n.prototype.equal=function(){return Ii("equal")},n.prototype.notEqual=function(){return Ii("notEqual")},n.prototype.less=function(){return Ii("less")},n.prototype.lessEqual=function(){return Ii("lessEqual")},n.prototype.greater=function(){return Ii("greater")},n.prototype.greaterEqual=function(){return Ii("greaterEqual")},n.prototype.logicalNot=function(){return Ii("logicalNot")},n.prototype.logicalAnd=function(){return Ii("logicalAnd")},n.prototype.logicalOr=function(){return Ii("logicalOr")},n.prototype.where=function(){return Ii("where")},n.prototype.select=function(){return Ii("select")},n.prototype.topk=function(){return Ii("topk")},n.prototype.min=function(){return Ii("min")},n.prototype.minimum=function(){return Ii("minimum")},n.prototype.mod=function(){return Ii("mod")},n.prototype.max=function(){return Ii("max")},n.prototype.maximum=function(){return Ii("maximum")},n.prototype.all=function(){return Ii("all")},n.prototype.any=function(){return Ii("any")},n.prototype.squaredDifference=function(){return Ii("squaredDifference")},n.prototype.ceil=function(){return Ii("ceil")},n.prototype.floor=function(){return Ii("floor")},n.prototype.round=function(){return Ii("round")},n.prototype.sign=function(){return Ii("sign")},n.prototype.isNaN=function(){return Ii("isNaN")},n.prototype.isInf=function(){return Ii("isInf")},n.prototype.isFinite=function(){return Ii("isFinite")},n.prototype.pow=function(){return Ii("pow")},n.prototype.exp=function(){return Ii("exp")},n.prototype.expm1=function(){return Ii("expm1")},n.prototype.softmax=function(){return Ii("softmax")},n.prototype.log=function(){return Ii("log")},n.prototype.log1p=function(){return Ii("log1p")},n.prototype.sqrt=function(){return Ii("sqrt")},n.prototype.rsqrt=function(){return Ii("rsqrt")},n.prototype.square=function(){return Ii("square")},n.prototype.reciprocal=function(){return Ii("reciprocal")},n.prototype.relu=function(){return Ii("relu")},n.prototype.relu6=function(){return Ii("relu6")},n.prototype.prelu=function(){return Ii("prelu")},n.prototype.elu=function(){return Ii("elu")},n.prototype.eluDer=function(){return Ii("eluDer")},n.prototype.selu=function(){return Ii("selu")},n.prototype.int=function(){return Ii("int")},n.prototype.clip=function(){return Ii("clip")},n.prototype.abs=function(){return Ii("abs")},n.prototype.complexAbs=function(){return Ii("complexAbs")},n.prototype.sigmoid=function(){return Ii("sigmoid")},n.prototype.softplus=function(){return Ii("softplus")},n.prototype.sin=function(){return Ii("sin")},n.prototype.cos=function(){return Ii("cos")},n.prototype.tan=function(){return Ii("tan")},n.prototype.asin=function(){return Ii("asin")},n.prototype.acos=function(){return Ii("acos")},n.prototype.atan=function(){return Ii("atan")},n.prototype.atan2=function(){return Ii("atan2")},n.prototype.sinh=function(){return Ii("sinh")},n.prototype.cosh=function(){return Ii("cosh")},n.prototype.tanh=function(){return Ii("tanh")},n.prototype.asinh=function(){return Ii("asinh")},n.prototype.acosh=function(){return Ii("acosh")},n.prototype.atanh=function(){return Ii("atanh")},n.prototype.erf=function(){return Ii("erf")},n.prototype.step=function(){return Ii("step")},n.prototype.fusedConv2d=function(){return Ii("fusedConv2d")},n.prototype.conv2d=function(){return Ii("conv2d")},n.prototype.conv2dDerInput=function(){return Ii("conv2dDerInput")},n.prototype.conv2dDerFilter=function(){return Ii("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(){return Ii("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(){return Ii("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(){return Ii("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(){return Ii("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(){return Ii("conv3d")},n.prototype.conv3dDerInput=function(){return Ii("conv3dDerInput")},n.prototype.conv3dDerFilter=function(){return Ii("conv3dDerFilter")},n.prototype.maxPool=function(){return Ii("maxPool")},n.prototype.maxPoolBackprop=function(){return Ii("maxPoolBackprop")},n.prototype.avgPool=function(){return Ii("avgPool")},n.prototype.avgPoolBackprop=function(){return Ii("avgPoolBackprop")},n.prototype.avgPool3d=function(){return Ii("avgPool3d")},n.prototype.avgPool3dBackprop=function(){return Ii("avgPool3dBackprop")},n.prototype.maxPool3d=function(){return Ii("maxPool3d")},n.prototype.maxPool3dBackprop=function(){return Ii("maxPool3dBackprop")},n.prototype.reshape=function(){return Ii("reshape")},n.prototype.cast=function(){return Ii("cast")},n.prototype.tile=function(){return Ii("tile")},n.prototype.pad=function(){return Ii("pad")},n.prototype.transpose=function(){return Ii("transpose")},n.prototype.gather=function(){return Ii("gather")},n.prototype.gatherND=function(){return Ii("gatherND")},n.prototype.scatterND=function(){return Ii("scatterND")},n.prototype.batchToSpaceND=function(){return Ii("batchToSpaceND")},n.prototype.spaceToBatchND=function(){return Ii("spaceToBatchND")},n.prototype.resizeBilinear=function(){return Ii("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(){return Ii("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(){return Ii("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(){return Ii("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(){return Ii("batchNormalization")},n.prototype.localResponseNormalization4D=function(){return Ii("localResponseNormalization4D")},n.prototype.LRNGrad=function(){return Ii("LRNGrad")},n.prototype.multinomial=function(){return Ii("multinomial")},n.prototype.oneHot=function(){return Ii("oneHot")},n.prototype.cumsum=function(){return Ii("cumsum")},n.prototype.nonMaxSuppression=function(){return Ii("nonMaxSuppression")},n.prototype.fft=function(){return Ii("fft")},n.prototype.ifft=function(){return Ii("ifft")},n.prototype.complex=function(){return Ii("complex")},n.prototype.real=function(){return Ii("real")},n.prototype.imag=function(){return Ii("imag")},n.prototype.cropAndResize=function(){return Ii("cropAndResize")},n.prototype.depthToSpace=function(){return Ii("depthToSpace")},n.prototype.split=function(){return Ii("split")},n.prototype.sparseToDense=function(){return Ii("sparseToDense")},n.prototype.diag=function(){return Ii("diag")},n.prototype.fill=function(){return Ii("fill")},n.prototype.onesLike=function(){return Ii("onesLike")},n.prototype.zerosLike=function(){return Ii("zerosLike")},n.prototype.linspace=function(){return Ii("linspace")},n.prototype.dispose=function(){return Ii("dispose")},n}();function Ii(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Mi(n,t,r,e,i,o,a){void 0===a&&(a="channelsLast");var u,s=Pi(t),c=s[0],f=s[1];if("channelsLast"===a)u=[c,f,n[3],n[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);u=[c,f,n[1],n[1]]}return Di(n,u,r,e,i,o,!1,a)}function ki(n,t,r,e,i,o,a){void 0===a&&(a="NDHWC");var u,s,c=Li(t),f=c[0],l=c[1],d=c[2];if("NDHWC"===a)s="channelsLast",u=[f,l,d,n[4],n[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);s="channelsFirst",u=[f,l,d,n[1],n[1]]}return Fi(n,u,r,e,i,!1,s,o)}function Di(n,t,r,e,i,o,a,u){void 0===a&&(a=!1),void 0===u&&(u="channelsLast");var s=[-1,-1,-1,-1],c=s[0],f=s[1],l=s[2],d=s[3];if("channelsLast"===u)c=n[0],f=n[1],l=n[2],d=n[3];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat "+u);c=n[0],d=n[1],f=n[2],l=n[3]}var h,v=t[0],p=t[1],m=t[3],x=Pi(r),y=x[0],b=x[1],g=Pi(e),w=g[0],C=g[1],E=Bi(v,w),R=Bi(p,C),A=function(n,t,r,e,i,o,a,u){var s,c,f;if("number"==typeof n){s={top:n,bottom:n,left:n,right:n,type:0===n?"VALID":"NUMBER"};var l=function(n,t,r,e,i){null==e&&(e=Vi(n,t,r));var o=n[1],a=Wi((n[0]-t+2*e)/r+1,i);N(S(a),(function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"}));var u=Wi((o-t+2*e)/r+1,i);return N(S(u),(function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"})),[a,u]}([t,r],o,e,n,u);c=l[0],f=l[1]}else if("same"===n){c=Math.ceil(t/e),f=Math.ceil(r/i);var d=Math.max(0,(c-1)*e+o-t),h=Math.max(0,(f-1)*i+a-r),v=Math.floor(d/2),p=d-v,m=Math.floor(h/2);s={top:v,bottom:p,left:m,right:h-m,type:"SAME"}}else{if("valid"!==n)throw Error("Unknown padding parameter: "+n);s={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-o+1)/e),f=Math.ceil((r-a+1)/i)}return{padInfo:s,outHeight:c,outWidth:f}}(i,f,l,y,b,E,R,o),_=A.outHeight,O=A.outWidth,T=a?m*d:m;return"channelsFirst"===u?h=[c,T,_,O]:"channelsLast"===u&&(h=[c,_,O,T]),{batchSize:c,dataFormat:u,inHeight:f,inWidth:l,inChannels:d,outHeight:_,outWidth:O,outChannels:T,padInfo:A.padInfo,strideHeight:y,strideWidth:b,filterHeight:v,filterWidth:p,effectiveFilterHeight:E,effectiveFilterWidth:R,dilationHeight:w,dilationWidth:C,inShape:n,outShape:h,filterShape:t}}function Fi(n,t,r,e,i,o,a,u){void 0===o&&(o=!1),void 0===a&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],c=s[0],f=s[1],l=s[2],d=s[3],h=s[4];if("channelsLast"===a)c=n[0],f=n[1],l=n[2],d=n[3],h=n[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=n[0],h=n[1],f=n[2],l=n[3],d=n[4]}var v,p=t[0],m=t[1],x=t[2],y=t[4],b=Li(r),g=b[0],w=b[1],C=b[2],E=Li(e),R=E[0],A=E[1],_=E[2],O=Bi(p,R),T=Bi(m,A),I=Bi(x,_),M=function(n,t,r,e,i,o,a,u,s,c,f){var l,d,h,v;if("number"==typeof n){l={top:n,bottom:n,left:n,right:n,front:n,back:n,type:0===n?"VALID":"NUMBER"};var p=function(n,t,r,e,i,o){null==i&&(i=Vi(n,t,e));var a=n[1],u=n[2],s=Wi((n[0]-t+2*i)/e+1,o);N(S(s),(function(){return"The output # of depths ("+s+") must be an integer. Change the stride and/or zero pad parameters"}));var c=Wi((a-t+2*i)/e+1,o);N(S(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var f=Wi((u-t+2*i)/e+1,o);return N(S(f),(function(){return"The output # of columns ("+f+") must be an integer. Change the stride and/or zero pad parameters"})),[s,c,f,1]}([t,r,e,1],u,0,i,n,f);d=p[0],h=p[1],v=p[2]}else if("same"===n){var m=((d=Math.ceil(t/i))-1)*i+u-t,x=((h=Math.ceil(r/o))-1)*o+s-r,y=((v=Math.ceil(e/a))-1)*a+c-e,b=Math.floor(m/2),g=m-b,w=Math.floor(x/2),C=x-w,E=Math.floor(y/2);l={top:w,bottom:C,left:E,right:y-E,front:b,back:g,type:"SAME"}}else{if("valid"!==n)throw Error("Unknown padding parameter: "+n);l={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-u+1)/i),h=Math.ceil((r-s+1)/o),v=Math.ceil((e-c+1)/a)}return{padInfo:l,outDepth:d,outHeight:h,outWidth:v}}(i,f,l,d,g,w,C,O,T,I,u),k=M.outDepth,D=M.outHeight,F=M.outWidth,V=o?y*h:y;return"channelsFirst"===a?v=[c,V,k,D,F]:"channelsLast"===a&&(v=[c,k,D,F,V]),{batchSize:c,dataFormat:a,inDepth:f,inHeight:l,inWidth:d,inChannels:h,outDepth:k,outHeight:D,outWidth:F,outChannels:V,padInfo:M.padInfo,strideDepth:g,strideHeight:w,strideWidth:C,filterDepth:p,filterHeight:m,filterWidth:x,effectiveFilterDepth:O,effectiveFilterHeight:T,effectiveFilterWidth:I,dilationDepth:R,dilationHeight:A,dilationWidth:_,inShape:n,outShape:v,filterShape:t}}function Vi(n,t,r,e){void 0===e&&(e=1);var i=Bi(t,e);return Math.floor((n[0]*(r-1)-r+i)/2)}function Pi(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}function Li(n){return"number"==typeof n?[n,n,n]:n}function Bi(n,t){return t<=1?n:n+(n-1)*(t-1)}function Wi(n,t){if(!t)return n;switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+t)}}function zi(n){var t=Pi(n);return 1===t[0]&&1===t[1]&&1===t[2]}function Gi(n,t){return zi(n)||zi(t)}function Ui(n){if("NHWC"===n)return"channelsLast";if("NCHW"===n)return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function qi(n,t,r){if("complex64"===t){if("complex64"===n.dtype)return n.clone();var e=Nr(n.shape),i=n.toFloat(),o=r.complex(i,e);return e.dispose(),i.dispose(),o}if(!z(n.dtype,t))return Vn.makeTensorFromDataId(n.dataId,n.shape,t);if("complex64"===n.dtype){var a=r.real(n);return o=a.cast(t),a.dispose(),o}if("int32"===t)return r.int(n);if("bool"===t){var u=vr(0,n.dtype);return o=r.notEqual(n,u),u.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+t)}function ji(n,t){return Vn.makeTensorFromDataId(n.dataId,t,n.dtype)}function Hi(n,t,r){var e=(t-n)/(r-1),i=tn(r,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+e;return pr(i,"float32")}var Xi=Object.freeze({castTensor:qi,reshapeTensor:ji,linspaceImpl:Hi,upcastType:_n,axesAreInnerMostDims:Zt,combineLocations:Qt,computeOutAndReduceShapes:nr,expandShapeToKeepDim:tr,assertAxesAreInnerMostDims:rr,getAxesPermutation:er,getUndoAxesPermutation:ir,getInnerMostAxes:or,getBroadcastDims:ue,getReductionAxes:se,assertAndGetBroadcastShape:ce,assertParamsConsistent:ar,computeOutShape:ur,computePool2DInfo:Mi,computePool3DInfo:ki,computeConv2DInfo:Di,computeConv3DInfo:Fi,computeDefaultPad:Vi,tupleValuesAreOne:zi,eitherStridesOrDilationsAreOne:Gi,convertConv2DDataFormat:Ui,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:fi});function $i(n,t){if(n.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+t.length+".");for(var r=new Float32Array(2*n.length),e=0;e<r.length;e+=2)r[e]=n[e/2],r[e+1]=t[e/2];return r}function Ki(n,t){return{real:n[2*t],imag:n[2*t+1]}}function Yi(n,t,r,e){n[2*e]=t,n[2*e+1]=r}function Ji(n,t,r){var e=(r?2:-2)*Math.PI*(n/t);return{real:Math.cos(e),imag:Math.sin(e)}}function Zi(n,t,r){var e=function(n,t,r){return function(n,t,r){for(var e=0,i=n.length,o=0,a=!1;e<i;){var u=r(t,n[o=e+(i-e>>>1)]);u>0?e=o+1:(i=o,a=!u)}return a?e:-e-1}(n,t,r||Qi)}(n,t,r);n.splice(e<0?-(e+1):e,0,t)}function Qi(n,t){return n>t?1:n<t?-1:0}function no(n,t,r,e,i){return ro(n,t,r,e,i,0).selectedIndices}function to(n,t,r,e,i,o){var a=ro(n,t,r,e,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function ro(n,t,r,e,i,o,a,u){void 0===u&&(u=!1);for(var s=Array.from(t).map((function(n,t){return{score:n,boxIndex:t,suppressBeginIndex:0}})).filter((function(n){return n.score>i})).sort(oo),c=o>0?-.5/o:0,f=[],l=[];f.length<r&&s.length>0;){var d=s.pop(),h=d.score,v=d.boxIndex,p=d.suppressBeginIndex;if(h<i)break;for(var m=!1,x=f.length-1;x>=p;--x){var y=eo(n,v,f[x]);if(y>=e){m=!0;break}if(d.score=d.score*io(e,c,y),d.score<=i)break}d.suppressBeginIndex=f.length,m||(d.score===h?(f.push(v),l.push(d.score)):d.score>i&&Zi(s,d,oo))}var b=f.length;return u&&(f.fill(0,b),l.fill(0,b)),{selectedIndices:pr(f,"int32"),selectedScores:pr(l,"float32"),numValidOutputs:vr(b,"int32")}}function eo(n,t,r){var e=n.subarray(4*t,4*t+4),i=n.subarray(4*r,4*r+4),o=Math.min(e[0],e[2]),a=Math.min(e[1],e[3]),u=Math.max(e[0],e[2]),s=Math.max(e[1],e[3]),c=Math.min(i[0],i[2]),f=Math.min(i[1],i[3]),l=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),h=(u-o)*(s-a),v=(l-c)*(d-f);if(h<=0||v<=0)return 0;var p=Math.max(o,c),m=Math.max(a,f),x=Math.min(u,l),y=Math.min(s,d),b=Math.max(x-p,0)*Math.max(y-m,0);return b/(h+v-b)}function io(n,t,r){var e=Math.exp(t*r*r);return r<=n?e:0}function oo(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}function ao(n,t,r){var e=new Array(n.rank).fill(0),i=n.shape.slice();return t.map((function(t){i[r]=t;var o=n.slice(e,i);return e[r]+=t,o}))}function uo(n,t){for(var r=new Array(n.rank),e=0;e<r.length;e++)r[e]=n.shape[e]*t[e];var i=Fr(r,n.dtype);for(e=0;e<i.values.length;++e){for(var o=i.indexToLoc(e),a=new Array(n.rank),u=0;u<a.length;u++)a[u]=o[u]%n.shape[u];var s=n.locToIndex(a);i.values[e]=n.values[s]}return i.toTensor()}function so(n,t,r,e){for(var i=t[t.length-1],o=[n.length/i,i],a=o[0],u=o[1],s=P(r,a*e),c=P("int32",a*e),f=0;f<a;f++){for(var l=f*u,d=n.subarray(l,l+u),h=[],v=0;v<d.length;v++)h.push({value:d[v],index:v});h.sort((function(n,t){return t.value-n.value}));var p=f*e,m=s.subarray(p,p+e),x=c.subarray(p,p+e);for(v=0;v<e;v++)m[v]=h[v].value,x[v]=h[v].index}var y=t.slice();return y[y.length-1]=e,[dr(s,y,r),dr(c,y,"int32")]}function co(n,t){for(var r=[],e=0;e<t.length;e++)t[e]&&r.push(e);var i=Fr(n,"int32"),o=Fr([r.length,n.length],"int32");for(e=0;e<r.length;e++){var a=i.indexToLoc(r[e]);o.values.set(a,e*n.length)}return o.toTensor()}var fo=function(n,t){this.outputShape=[],this.outputShape=n,this.variableNames=t.map((function(n,t){return"T"+t}));var r=[];this.variableNames.forEach((function(n){r.push("float v"+n+" = get"+n+"AtOutCoords();")}));var e=this.variableNames.map((function(n){return"v"+n})).join(" + ");this.userCode="\n      void main() {\n        "+r.join("\n        ")+"\n\n        float result = "+e+";\n        setOutput(result);\n      }\n    "},lo=function(n,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=t.map((function(n,t){return"T"+t}));var r=[];this.variableNames.forEach((function(n){r.push("vec4 v"+n+" = get"+n+"AtOutCoords();")}));var e=this.variableNames.map((function(n){return"v"+n})).join(" + ");this.userCode="\n      void main() {\n        "+r.join("\n        ")+"\n\n        vec4 result = "+e+";\n        setOutput(result);\n      }\n    "},ho=function(n,t,r){this.variableNames=["A"];var e=n.windowSize,i=n.batchSize,o=Math.ceil(n.inSize/e);r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+e+"; i++) {\n          int inIdx = "+(r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===t?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function vo(n,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return n+"."+t}))}function po(n,t){return 1===t?[n]:vo(n,t)}function mo(){var n,t,r,e,i,o,a,u,s,f;return 2===c().getNumber("WEBGL_VERSION")?(n="#version 300 es",t="in",r="out",e="in",i="texture",o="outputColor",a="out vec4 outputColor;",u="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",s="",f="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",t="attribute",r="varying",e="varying",i="texture2D",o="gl_FragColor",a="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",s="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",f="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:t,varyingVs:r,varyingFs:e,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:u,defineSpecialInf:s,defineRound:f}}function xo(n,t,r){void 0===r&&(r="index");var e=J(t);return e.map((function(t,i){return"int "+n[i]+" = "+r+" / "+t+"; "+(i===e.length-1?"int "+n[i+1]+" = "+r+" - "+n[i]+" * "+t:"index -= "+n[i]+" * "+t)+";"})).join("")}function yo(n){var t=J(n).map((function(n){return n.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var bo="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";var go="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",wo="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Co="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",No="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Eo(n){return"offset"+n}function Ro(n){var t=n.name,r=_(n.shapeInfo.logicalShape);return r<2?"return "+t+";":"\n    for (int i = 0; i < "+r+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function Ao(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";if(5===n)return"ivec5";if(6===n)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function _o(n,t){var r=JSON.parse(JSON.stringify(n));return r.shapeInfo.logicalShape=t,r}function Oo(n,t){return t.map((function(t){return n[t]})).join(", ")}var So=function(n,t,r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,N(n.length>2,(function(){return"Packed arg"+(r.charAt(0).toUpperCase()+r.slice(1))+" supports only inputs with rank above 2."}));var i=Math.ceil(n[n.length-1]/t);this.outputShape=n.slice(0,-1),i>1&&this.outputShape.push(i),e||this.variableNames.push("bestIndicesA");var o,a,u=this.outputShape,s=u.length,c=Ao(s),f=po("coords",s);if(1===i){var l=Ao(a=s+1);o="\n        "+l+" sourceLocR = "+l+"("+f.join()+", 0);\n        ++"+f[s-1]+";\n        "+l+" sourceLocG = "+l+"("+f.join()+", 0);\n        ++"+f[s-2]+";\n        "+l+" sourceLocA = "+l+"("+f.join()+", 0);\n        --"+f[s-1]+";\n        "+l+" sourceLocB = "+l+"("+f.join()+", 0);\n        --"+f[s-2]+";"}else a=s,o="\n        "+c+" sourceLocR = coords;\n        ++"+f[s-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+f[s-2]+";\n        "+c+" sourceLocA = coords;\n        --"+f[s-1]+";\n        "+c+" sourceLocB = coords;\n        --"+f[s-2]+";";var d=["x","y","z","w","u","v"].slice(0,a),h="."+d[a-1],v=d.map((function(n){return"int "+n})),p=po("sourceLocR",a-1).concat("inIdx.r"),m=po("sourceLocG",a-1).concat("inIdx.g"),x=po("sourceLocB",a-1).concat("inIdx.b"),y=po("sourceLocA",a-1).concat("inIdx.a"),b="max"===r?"greaterThan":"lessThan",g=e?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+p.join()+"),\n                             getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+x.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",w="vec4(\n            getAChannel("+p.join()+"),\n            hasNextCol ? getAChannel("+m.join()+") : 0.,\n            hasNextRow ? getAChannel("+x.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",C=e?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+d.join()+"),\n                                          vec2("+d.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+d.join()+"),\n                               vec2("+d.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+f[s-1]+" < "+(u[s-1]-1)+";\n        bool hasNextRow = "+f[s-2]+" < "+(u[s-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+h+", sourceLocG"+h+",\n          sourceLocB"+h+", sourceLocA"+h+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+w+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+g+"\n          vec4 candidate = "+w+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},To=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.effectiveFilterHeight,r=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+";\n            wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+r+";\n            wC+= "+n.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Io=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.effectiveFilterDepth,r=n.effectiveFilterHeight,e=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-n.padInfo.front)+", "+(r-1-n.padInfo.top)+", "+(e-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterDepth*n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+t+";\n            wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+r+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+e+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Mo=function(n,t,r,e,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ce(n,t),ce(n,r);var a="0.0";null!=e&&(ce(n,e),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var u="1.0";null!=i&&(ce(n,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+u+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},ko=function(n,t,r,e,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ce(n,t),ce(n,r);var a="vec4(0.0)";null!=e&&(ce(n,e),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(ce(n,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+u+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Do=function(n,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ce(t,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+n+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Fo="return a + b;",Vo="return a - b;",Po="return a * b;",Lo="return (a < 0.) ? b * a : a;",Bo=function(n,t,r){this.variableNames=["A","B"],this.outputShape=ce(t,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+n+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Wo="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",zo=function(n,t,r,e){void 0===e&&(e=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ce(t,r);var i=this.outputShape.length,o="";if(e)if(0===i||1===_(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+Ao(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=po("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+a[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+a[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},Go=function(){function n(n){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(e,i){null==r.minLoc&&(r.minLoc=e.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=e.getUniformLocationNoThrow(i,"maxVal")),e.gl.uniform1f(r.minLoc,n),e.gl.uniform1f(r.maxLoc,t)}},n}(),Uo=function(){function n(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(e,i){null==r.minLoc&&(r.minLoc=e.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=e.getUniformLocationNoThrow(i,"maxVal")),e.gl.uniform1f(r.minLoc,n),e.gl.uniform1f(r.maxLoc,t)}},n}(),qo=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},jo=function(n){this.outputShape=[],this.outputShape=ur(n,1),this.variableNames=n.map((function(n,t){return"T"+t}));var t=new Array(n.length-1);t[0]=n[0][1];for(var r=1;r<t.length;r++)t[r]=t[r-1]+n[r][1];var e=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(r=1;r<t.length;r++)e.push("else if (yC < "+t[r]+") setOutput(getT"+r+"(yR, yC-"+t[r-1]+"));");e.push("else setOutput(getT"+t.length+"(yR, yC-"+t[t.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+e.join("\n        ")+"\n      }\n    "},Ho=function(n,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ur(n,t);var r=this.outputShape,e=r.length,i=Ao(e),o=po("coords",e),a=["x","y","z","w","u","v"].slice(0,e);this.variableNames=n.map((function(n,t){return"T"+t}));var u=new Array(n.length-1);u[0]=n[0][t];for(var s=1;s<u.length;s++)u[s]=u[s-1]+n[s][t];var c=a[t],f=a.slice(-2),l=a.join(),d="if ("+c+" < "+u[0]+") {\n        return getChannel(\n            getT0("+l+"), vec2("+f.join()+"));\n        }";for(s=1;s<u.length;s++){var h=u[s-1];d+="\n        if ("+c+" < "+u[s]+"  && "+c+" >= "+u[s-1]+") {\n          return getChannel(\n            getT"+s+"("+Xo(a,c,h)+"),\n            vec2("+Xo(f,c,h)+"));\n        }"}var v=u[u.length-1];d+="\n        return getChannel(\n          getT"+u.length+"("+Xo(a,c,v)+"),\n          vec2("+Xo(f,c,v)+"));",this.userCode="\n      float getValue("+a.map((function(n){return"int "+n}))+") {\n        "+d+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[e-1]+" = "+o[e-1]+" + 1;\n        if ("+o[e-1]+" < "+r[e-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[e-2]+" = "+o[e-2]+" + 1;\n        if ("+o[e-2]+" < "+r[e-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[e-1]+" = "+o[e-1]+" - 1;\n        if ("+o[e-2]+" < "+r[e-2]+" &&\n            "+o[e-1]+" < "+r[e-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function Xo(n,t,r){var e=n.indexOf(t);return n.map((function(n,t){return t===e?n+" - "+r:n})).join()}var $o=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===n.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ko=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,r=n.filterWidth,e="channelsLast"===n.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(e?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(e?1:2)+"], coords["+(e?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+r+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+r+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n\n              if ("+e+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Yo=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+n.strideDepth+" - "+n.padInfo.front+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Jo=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,r=n.filterHeight,e=n.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-n.padInfo.front)+", "+(r-1-n.padInfo.top)+", "+(e-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+n.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+r+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+r+" - 1 - wR;\n\n            for (int wC = 0; wC < "+e+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+e+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Zo=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+n.outChannels/n.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Qo=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,r=n.filterWidth,e=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+r+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+r+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+e+"; dm++) {\n              int d2 = d1 * "+e+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},na=function(n,t,r,e){void 0===t&&(t=!1),void 0===r&&(r=null),void 0===e&&(e=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,a=n.strideHeight,u=n.strideWidth,s=n.dilationHeight,c=n.dilationWidth,f=n.filterHeight,l=n.filterWidth,d=4*Math.floor(n.inChannels/4),h=n.inChannels%4,v="channelsLast"===n.dataFormat,p=v?1:2,m=v?2:3,x=v?3:1,y="",b="";r&&(y=e?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+r+"\n        }":"\n          float activation(float x) {\n            "+r+"\n          }\n        ",b="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+u+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+x+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+p+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+l+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+v+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+v+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+v+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+v+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+b+"\n        setOutput(result);\n      }\n    "},ta=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,r=n.padInfo.top,e=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,u=n.dilationDepth,s=n.dilationHeight,c=n.dilationWidth,f=n.filterDepth,l=n.filterHeight,d=n.filterWidth,h=4*Math.floor(n.inChannels/4),v=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+t+", "+r+", "+e+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+f+"; wF++) {\n          int xF = xFCorner + wF * "+u+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+l+"; wR++) {\n            int xR = xRCorner + wR * "+s+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===v)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===v)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===v)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ra=function(n,t,r,e){void 0===t&&(t=!1),void 0===r&&(r=null),void 0===e&&(e=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,u=n.padInfo.left,s=n.strideHeight,c=n.strideWidth,f=n.dilationHeight,l=n.dilationWidth,d=n.filterHeight,h=n.filterWidth,v=n.outChannels/n.inChannels,p="",m="";r&&(p=e?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+r+"\n        }":"\n          float activation(float x) {\n            "+r+"\n          }\n        ",m="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const ivec2 strides = ivec2("+s+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+u+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+v+";\n        int q = d2 - d1 * "+v+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+f+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+m+"\n        setOutput(result);\n      }\n    "},ea=function(n,t,r,e){void 0===t&&(t=!1),void 0===r&&(r=null),void 0===e&&(e=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,u=n.padInfo.left,s=n.strideHeight,c=n.strideWidth,f=n.dilationHeight,l=n.dilationWidth,d=n.filterHeight,h=n.filterWidth,v=h,p="int xR; int xC; int xCOffset;",m=0;m<d;m++)for(var x=0;x<h;x++)p+="\n          vec4 xTexelR"+m+"C"+2*x+" = vec4(0.);\n          vec4 wR"+m+"C"+x+" = vec4(0.);\n          vec4 xR"+m+"C"+x+" = vec4(0.);";for(m=0;m<d;m++)for(var y=0;y<v;y++){if(p+="\n          xR = xRCorner + "+m*f+";\n          xC = xCCorner + "+(x=2*y)*l+";\n        ",1===c){if(x<h&&(p+=u%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+x+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+m+"C"+x+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+x+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+x+" = vec4(previous.zw, xTexelR"+m+"C"+x+".xy);\n                } else {\n                  xR"+m+"C"+x+" = vec4(0, 0, xTexelR"+m+"C"+x+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+x+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+x+" = vec4(0.);\n                }\n\n                xR"+m+"C"+x+" = xTexelR"+m+"C"+x+";\n              ",x+1<h)){var b=u%2==0?w(l):l;l%2==0&&u%2==1||l%2!=0&&u%2!=1?(p+="\n                  xCOffset = xC + "+u%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(x+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",l>1&&(p+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+m+"C"+x+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+x+" = vec4(0.);\n                    }\n                  "),p+="\n                  xR"+m+"C"+(x+1)+" = vec4(\n                    xTexelR"+m+"C"+x+".zw, xTexelR"+m+"C"+(x+2)+".xy);\n                "):p+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(x+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(x+1)+" = xTexelR"+m+"C"+(x+2)+";\n                "}}else x<h&&(p+="\n              if(xR >= 0 && xR < "+i+") {\n            ",u%2==1?(p+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+x+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+x+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+m+"C"+(x+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(x+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+x+" = vec4(\n                  xTexelR"+m+"C"+x+".zw, xTexelR"+m+"C"+(x+2)+".zw);\n              ",x+1<h&&(p+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(x+1)+" = vec4(xTexelR"+m+"C"+(x+2)+".xy, final.xy);\n                ")):(p+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+x+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+x+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+(x+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(x+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+x+" = vec4(\n                  xTexelR"+m+"C"+x+".xy, xTexelR"+m+"C"+(x+2)+".xy);\n              ",x+1<h&&(p+="\n                  xR"+m+"C"+(x+1)+" = vec4(\n                    xTexelR"+m+"C"+x+".zw, xTexelR"+m+"C"+(x+2)+".zw);\n                ")),p+="}");x<h&&(p+="\n            vec4 wTexelR"+m+"C"+x+" = getW("+m+", "+x+", d1, q);\n            wR"+m+"C"+x+" = vec4(wTexelR"+m+"C"+x+".xz, wTexelR"+m+"C"+x+".xz);\n          ",x+1<h&&(p+="\n              vec4 wTexelR"+m+"C"+(x+1)+" = getW("+m+", "+(x+1)+", d1, q);\n              wR"+m+"C"+(x+1)+" =\n                vec4(wTexelR"+m+"C"+(x+1)+".xz, wTexelR"+m+"C"+(x+1)+".xz);"))}for(m=0;m<d;m++)for(x=0;x<h;x++)p+="dotProd += xR"+m+"C"+x+" * wR"+m+"C"+x+";";var g="",C="";r&&(g=e?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+r+"\n        }":"vec4 activation(vec4 x) {\n          "+r+"\n        }",C="result = activation(result);");var N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+s+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+u+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+p+"\n\n        vec4 result = dotProd;\n        "+N+"\n        "+C+"\n        setOutput(result);\n      }\n    "},ia=function(n,t,r,e,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],a=n[1],u=n[2],s=r[0],c=r[1];this.outputShape=[t[0],s,c,n[3]];var f=[a-1+".0",u-1+".0"],l=f[0],d=f[1],h=s>1?[""+(a-1)/(s-1),"(y2-y1) * height_ratio","y1*"+l+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+l],v=c>1?[""+(u-1)/(c-1),"(x2-x1) * width_ratio","x1*"+d+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+d];this.userCode="\n      const float height_ratio = float("+h[0]+");\n      const float width_ratio = float("+v[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+h[1]+";\n        float width_scale = "+v[1]+";\n\n        float in_y = "+h[2]+";\n        if( in_y < 0.0 || in_y > "+l+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+v[2]+";\n        if( in_x < 0.0 || in_x > "+d+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===e?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},oa=function(n,t,r){this.variableNames=["x"],this.outputShape=n;var e=n.length,i=n[n.length-1],o=r?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(r?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Ao(e)+" coords = getOutputCoords();\n        int end = "+aa(e,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+aa(e,"coords")+" = idx;\n          val += getX("+function(n,t){if(1===n)return""+t;if(2===n)return t+".x, "+t+".y";if(3===n)return t+".x, "+t+".y, "+t+".z";if(4===n)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}(e,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function aa(n,t){if(1===n)return""+t;if(2===n)return t+".y";if(3===n)return t+".z";if(4===n)return t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var ua=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Bn.DENSE;var t=Xn(n),r=mo();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+xo(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+r.output+" = result;\n      }\n    "},sa=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Bn.DENSE;var t=Xn(n),r=mo();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+xo(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+r.output+" = result;\n      }\n    "},ca=function(){function n(n,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=t,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return n.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),fa=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},la=function(n){this.variableNames=["A"],this.outTexUsage=Wn.DOWNLOAD;var t=mo();this.outputShape=n,this.userCode="\n      "+bo+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},da=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Wn.DOWNLOAD;var t=mo();this.outputShape=n,this.userCode="\n      "+bo+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},ha=function(n,t,r){void 0===r&&(r=!1),this.variableNames=["A"];var e=mo(),i=t[0],o=t[1];this.outputShape=n;var a="result";r&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+yo(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+e.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+e.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},va=function(n,t,r){void 0===r&&(r=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=mo(),i=t[0],o=t[1];this.outputShape=n;var a="",u="result";r&&(u="floor(result * 255. + 0.5)");for(var s=0;s<=1;s++)for(var c=0;c<=1;c++){var f=2*s+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+n[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+s+" < "+n[1]+") {\n              localCoords[1] += "+s+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+e.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+f+"] = values[0];\n              } else if(offset == 1) {\n                result["+f+"] = values[1];\n              } else if(offset == 2) {\n                result["+f+"] = values[2];\n              } else {\n                result["+f+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+yo(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+e.output+" = "+u+";\n      }\n    "},pa=function(n,t,r){this.variableNames=["real","imag"];var e=t[1];this.outputShape=t;var i=r?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+n+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+e+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+e+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(r?e+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},ma=function(){function n(n){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,e){null==t.valueLoc&&(t.valueLoc=r.getUniformLocationNoThrow(e,"value")),r.gl.uniform1f(t.valueLoc,n)}},n}(),xa=function(n,t,r){this.variableNames=["A","indices"];var e=n.slice();e[r]=t,this.outputShape=e,this.rank=e.length;var i=Ao(this.rank),o=function(n,t){var r=n.length;if(r>4)throw Error("Gather for rank "+r+" is not yet supported");if(1===r)return"int(getIndices(resRC))";for(var e=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<n.length;o++)i.push(o===t?"int(getIndices("+e[o]+"))":""+e[o]);return i.join()}(n,r);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},ya=function(n,t,r){this.sliceDim=n,this.strides=t,this.variableNames=["x","indices"],this.outputShape=r;var e=Ao(t.length),i=Ao(r.length);this.userCode="\n        "+e+" strides = "+e+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function ba(n,t){var r=mo();return nt(n,t,r.version+"\n    precision highp float;\n    "+r.attribute+" vec3 clipSpacePos;\n    "+r.attribute+" vec2 uv;\n    "+r.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function ga(n,t){return st(n,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function wa(n,t){return ct(n,t,new Uint16Array([0,1,2,2,1,3]))}function Ca(n,t,r,e,i,o,a){lt(r,e);var u=ft(n,t),s=n.TEXTURE_2D;return Yn(n,t,(function(){return n.bindTexture(s,u)})),Yn(n,t,(function(){return n.texParameteri(s,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)})),Yn(n,t,(function(){return n.texParameteri(s,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)})),Yn(n,t,(function(){return n.texParameteri(s,n.TEXTURE_MIN_FILTER,n.NEAREST)})),Yn(n,t,(function(){return n.texParameteri(s,n.TEXTURE_MAG_FILTER,n.NEAREST)})),Yn(n,t,(function(){return n.texImage2D(s,0,i,r,e,0,o,a,null)})),Yn(n,t,(function(){return n.bindTexture(n.TEXTURE_2D,null)})),u}function Na(n,t,r,e,i){var o=Hn(r,e);return Ca(n,t,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function Ea(n,t,r,e,i){var o=Hn(r,e);return Ca(n,t,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Ra(n,t,r,e){var i=Hn(r,e);return Ca(n,t,i[0],i[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function Aa(n,t,r,e,i){var o=$n(r,e);return Ca(n,t,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function _a(n,t,r,e,i){var o=$n(r,e);return Ca(n,t,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function Oa(n,t,r,e){return Yn(n,t,(function(){return n.bindBuffer(n.ARRAY_BUFFER,e)})),ht(n,t,r,"clipSpacePos",e,3,20,0)&&ht(n,t,r,"uv",e,2,20,12)}function Sa(n,t,r,e,i,o,a){var u,s,c;Yn(n,t,(function(){return n.bindTexture(n.TEXTURE_2D,r)})),o instanceof Uint8Array?(u=new Uint8Array(e*i*4),s=n.UNSIGNED_BYTE,c=n.RGBA):(u=new Float32Array(e*i*4),s=n.FLOAT,c=a.internalFormatPackedFloat),u.set(o),Yn(n,t,(function(){return n.texImage2D(n.TEXTURE_2D,0,c,e,i,0,n.RGBA,s,u)})),Yn(n,t,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function Ta(n,t,r,e){Yn(n,t,(function(){return n.bindTexture(n.TEXTURE_2D,r)})),e.data instanceof Uint8Array?Yn(n,t,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)})):Yn(n,t,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)})),Yn(n,t,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function Ia(n,t,r,e){var i=n.createBuffer();Yn(n,t,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,i)}));var o=16*r*e;return Yn(n,t,(function(){return n.bufferData(n.PIXEL_PACK_BUFFER,o,n.STREAM_READ)})),Yn(n,t,(function(){return n.readPixels(0,0,e,r,n.RGBA,n.FLOAT,0)})),Yn(n,t,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)})),i}function Ma(n,t,r){var e=n,i=new Float32Array(r);return e.bindBuffer(e.PIXEL_PACK_BUFFER,t),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,i),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),i}function ka(n,t,r,e,i){var o=Hn(r,e),a=o[0],u=o[1],s=new Uint8Array(r*e*4);return Yn(n,t,(function(){return n.readPixels(0,0,a,u,i.downloadTextureFormat,n.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}function Da(n,t,r,e,i,o,a){var u=n,s=new Float32Array(function(n,t){var r=$n(n,t);return r[0]*r[1]*4}(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,s),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),s}function Fa(n,t,r,e){var i=new Float32Array(r*e*4);return Yn(n,t,(function(){return n.readPixels(0,0,e,r,n.RGBA,n.FLOAT,i)})),i}var Va=Object.freeze({createVertexShader:ba,createVertexBuffer:ga,createIndexBuffer:wa,createFloat32MatrixTexture:Na,createFloat16MatrixTexture:Ea,createUnsignedBytesMatrixTexture:Ra,createPackedMatrixTexture:Aa,createFloat16PackedMatrixTexture:_a,bindVertexProgramAttributeStreams:Oa,uploadDenseMatrixToTexture:Sa,uploadPixelDataToTexture:Ta,createBufferFromOutputTexture:Ia,downloadFloat32MatrixFromBuffer:Ma,downloadByteEncodedFloatMatrixFromOutputTexture:ka,downloadPackedMatrixFromBuffer:Da,downloadMatrixFromPackedOutputTexture:Fa}),Pa=function(){function n(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=c().getNumber("WEBGL_VERSION");null!=n?(this.gl=n,qn(t,n)):this.gl=jn(t);var r="WEBGL_color_buffer_float";if(1===c().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Qn(this.gl,this.debug,"OES_texture_float"),kt(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Qn(this.gl,this.debug,"OES_texture_half_float");else if(c().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),kt(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Qn(this.gl,this.debug,"EXT_color_buffer_half_float");else if(c().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(kt(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!kt(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=ga(this.gl,this.debug),this.indexBuffer=wa(this.gl,this.debug),this.framebuffer=dt(this.gl,this.debug),this.textureConfig=Kn(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return c().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var n=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Yn(t,this.debug,(function(){return t.finish()})),Yn(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Yn(t,this.debug,(function(){return t.deleteFramebuffer(n.framebuffer)})),Yn(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Yn(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Yn(t,this.debug,(function(){return t.deleteBuffer(n.indexBuffer)})),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(n,t){return this.throwIfDisposed(),Na(this.gl,this.debug,n,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(n,t){return this.throwIfDisposed(),Ea(this.gl,this.debug,n,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(n,t){return this.throwIfDisposed(),Ra(this.gl,this.debug,n,t)},n.prototype.uploadPixelDataToTexture=function(n,t){this.throwIfDisposed(),Ta(this.gl,this.debug,n,t)},n.prototype.uploadDenseMatrixToTexture=function(n,t,r,e){this.throwIfDisposed(),Sa(this.gl,this.debug,n,t,r,e,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(n,t){return this.throwIfDisposed(),_a(this.gl,this.debug,n,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(n,t){return this.throwIfDisposed(),Aa(this.gl,this.debug,n,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(n){var t=this;this.throwIfDisposed(),this.outputTexture===n&&(bt(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Yn(this.gl,this.debug,(function(){return t.gl.deleteTexture(n)}))},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,t,r){var e=this;return this.downloadMatrixDriver(n,(function(){return ka(e.gl,e.debug,t,r,e.textureConfig)}))},n.prototype.downloadPackedMatrixFromBuffer=function(n,t,r,e,i,o){return Da(this.gl,n,0,0,0,i,o)},n.prototype.downloadFloat32MatrixFromBuffer=function(n,t){return Ma(this.gl,n,t)},n.prototype.createBufferFromTexture=function(n,t,r){this.bindTextureToFrameBuffer(n);var e=Ia(this.gl,this.debug,t,r);return this.unbindTextureToFrameBuffer(),e},n.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},n.prototype.createFence=function(n){var t,r,e=this;if(c().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var n=i.clientWaitSync(o,0,0);return n===i.ALREADY_SIGNALED||n===i.CONDITION_SATISFIED},t=o}else c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return e.isQueryAvailable(t,c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(n,t,r){var e=this;return this.downloadMatrixDriver(n,(function(){return Fa(e.gl,e.debug,t,r)}))},n.prototype.createProgram=function(n){this.throwIfDisposed();var t=this.gl,r=tt(t,this.debug,n),e=ba(t,this.debug),i=ot(t,this.debug);return Yn(t,this.debug,(function(){return t.attachShader(i,e)})),Yn(t,this.debug,(function(){return t.attachShader(i,r)})),at(t,this.debug,i),this.debug&&ut(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Oa(t,this.debug,this.program,this.vertexBuffer)),i},n.prototype.deleteProgram=function(n){var t=this;this.throwIfDisposed(),n===this.program&&(this.program=null),null!=n&&Yn(this.gl,this.debug,(function(){return t.gl.deleteProgram(n)}))},n.prototype.setProgram=function(n){var t=this;this.throwIfDisposed(),this.program=n,null!=this.program&&this.debug&&ut(this.gl,this.debug,this.program),Yn(this.gl,this.debug,(function(){return t.gl.useProgram(n)}))},n.prototype.getUniformLocation=function(n,t,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?pt(this.gl,this.debug,n,t):mt(this.gl,n,t)},n.prototype.getAttributeLocation=function(n,t){var r=this;return this.throwIfDisposed(),Yn(this.gl,this.debug,(function(){return r.gl.getAttribLocation(n,t)}))},n.prototype.getUniformLocationNoThrow=function(n,t){return this.throwIfDisposed(),this.gl.getUniformLocation(n,t)},n.prototype.setInputMatrixTexture=function(n,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),xt(this.gl,this.debug,0,n,t,r)},n.prototype.setOutputMatrixTexture=function(n,t,r){this.setOutputMatrixTextureDriver(n,r,t)},n.prototype.setOutputPackedMatrixTexture=function(n,t,r){this.throwIfDisposed();var e=$n(t,r);this.setOutputMatrixTextureDriver(n,e[0],e[1])},n.prototype.setOutputMatrixWriteRegion=function(n,t,r,e){this.setOutputMatrixWriteRegionDriver(r,n,e,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){null!=this.program&&ut(this.gl,this.debug,this.program),gt(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),Yn(n,this.debug,(function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}))},n.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),Yn(this.gl,this.debug,(function(){return n.gl.finish()}))},n.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Qn(this.gl,this.debug,2===c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(2===c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(t.TIME_ELAPSED_EXT,r),r}var e=this.getQueryTimerExtensionWebGL1(),i=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(2!==c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(n){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return[4,k((function(){return t.disposed||t.isQueryAvailable(n,c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(n,c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},n.prototype.getQueryTime=function(n,t){if(0===t)return null;if(2===t){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(n,e.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(n,t){if(0===t)return!0;if(2===t){var r=this.gl,e=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(e=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,e.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),i&&!this.disjoint},n.prototype.pollFence=function(n){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return n.isFencePassed()}),(function(){return r()}))}))},n.prototype.pollItems=function(){for(var n=function(n){for(var t=0;t<n.length&&n[t]();++t);return t-1}(this.itemsToPoll.map((function(n){return n.isDoneFn}))),t=0;t<=n;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},n.prototype.addItemToPoll=function(n,t){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:t}),this.itemsToPoll.length>1||k((function(){return r.pollItems(),0===r.itemsToPoll.length}))},n.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),yt(this.gl,this.debug,n,this.framebuffer),this.debug&&gt(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(yt(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&gt(this.gl)):bt(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(n,t){this.bindTextureToFrameBuffer(n);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(n,t,r){this.throwIfDisposed();var e=this.gl;yt(e,this.debug,n,this.framebuffer),this.debug&&gt(e),this.outputTexture=n,Yn(e,this.debug,(function(){return e.viewport(0,0,t,r)})),Yn(e,this.debug,(function(){return e.scissor(0,0,t,r)}))},n.prototype.setOutputMatrixWriteRegionDriver=function(n,t,r,e){var i=this;this.throwIfDisposed(),Yn(this.gl,this.debug,(function(){return i.gl.scissor(n,t,r,e)}))},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},n}();function La(n,t){if(n.length!==t.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+t.length+" inputs");n.forEach((function(n,r){var e=n.logicalShape,i=t[r],o=i.shape;if(!O(e,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+e+" and "+o+" must match");if(!n.isUniform||!i.isUniform){var a=n.texShape,u=i.isUniform?null:i.texData.texShape;if(!O(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}}))}var Ba=function(n,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var e=r.inChannels,i=r.strideWidth,o=r.strideHeight,a=r.padInfo,u=r.outWidth,s=r.dilationWidth,c=r.dilationHeight,f=r.dataFormat,l=a.left,d=a.top,h=e*r.filterWidth,v=mo(),p="channelsLast"===f,m=p?0:1,x=p?1:2,y="",b=0;b<=1;b++)for(var g=0;g<=1;g++)y+="\n          blockIndex = rc.y + "+g+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+n[1]+" && pos < "+n[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+o+" - "+d+";\n            d0 = offsetY + "+c+" * (pos / "+h+");\n\n            if(d0 < "+t[m]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+l+".);\n              d1 = offsetX + "+s+" * (int(mod(float(pos), "+h+".) / "+e+".));\n\n              if(d1 < "+t[x]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+e+".));\n\n                if ("+p+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+g)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+g)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+v.output+" = result;\n      }\n    "},Wa=function(n,t,r,e,i){this.variableNames=["x"],this.outputShape=[];var o=t,a=n[3]-1;this.outputShape=n;var u="float("+r+") + float("+e+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(val);\n      }\n    "},za=function(n,t,r,e,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=r,this.alpha=e,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+e+") * norm + float("+r+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+e+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Ga=function(n,t,r,e,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,a=n[3]-1;this.outputShape=n;var u="float("+r+") + float("+e+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(result);\n      }\n    "},Ua=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.effectiveFilterHeight,r=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+";\n          wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+r+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(t*r-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+r+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qa=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.effectiveFilterDepth,r=n.effectiveFilterHeight,e=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-n.padInfo.front)+", "+(r-1-n.padInfo.top)+", "+(e-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+t+";\n           wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+r+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+e+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(t*r*e-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+r+" * "+e+" +\n                  wR * "+e+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ja=function(n,t,r,e,i,o,a){void 0===r&&(r=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var u=Math.ceil((r?n[1]:n[2])/2),s=r?"i * 2, rc.y":"rc.y, i * 2",c=e?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],l=e?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",h="";o&&(d=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",h="result = activation(result);");var v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+d+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+s+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+l[0]+");\n          result += ("+f[1]+" * "+l[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},Ha=function(){function n(n,t,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,e){null==t.seedLoc&&(t.seedLoc=r.getUniformLocation(e,"seed")),r.gl.uniform1f(t.seedLoc,n)}},n}(),Xa=function(n,t,r,e){this.variableNames=["indices"],this.outputShape=[n,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+e+"), float("+r+"),\n                      float(index == coords.y)));\n      }\n    "},$a=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var t=n.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=po("rc",t),e=Ao(t),i=function(n,t,r){if(1===n)return"rc > "+t[0];for(var e="",i=n-2;i<n;i++)e+=r[i]+" >= "+t[i],i<n-1&&(e+="||");return e}(t,n,r),o=function(n,t,r,e){if(1===n)return"";var i=e.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+r+";\n  "}(t,n[n.length-1],n[n.length-2],r),a=function(n,t){var r=n.length,e=function(n,t){for(var r=[],e=0;e<=1;e++)for(var i=0;i<=1;i++){for(var o=(0===e?"r":"rp1")+", "+(0===i?"c":"cp1"),a=2;a<n;a++)o=t[t.length-1-a]+","+o;r.push(o)}return r}(r,t);return 1===r?"getA(rc),\n            rc + 1 >= "+n[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+e[0]+"),\n          cEdge ? 0. : getA("+e[1]+"),\n          rEdge ? 0. : getA("+e[2]+"),\n          rEdge || cEdge ? 0. : getA("+e[3]+")"}(n,r);this.userCode="\n        void main() {\n          "+e+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},Ka=function(n,t,r){this.variableNames=["x"],this.outputShape=t.map((function(t,r){return t[0]+n[r]+t[1]}));var e=n.length,i=Ao(e),o=t.map((function(n){return n[0]})).join(","),a=t.map((function(t,r){return t[0]+n[r]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e);this.userCode=1!==e?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+r+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+u+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+r+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Ya=function(n,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,r){return t[0]+n[r]+t[1]}));for(var e=n.length,i=Ao(e),o=t.map((function(n){return n[0]})).join(","),a=t.map((function(t,r){return t[0]+n[r]})).join(","),u=po("rc",e),s=po("source",e),c=u[e-1]+" < "+this.outputShape[e-1],f=1===e?"source":"vec2("+s.slice(-2).join()+")",l=[i+" rc = outputLoc;",u[e-1]+" += 1;\n       if("+c+") {\n      ",1===e?"":"}\n       rc = outputLoc;\n       "+u[e-2]+" += 1;\n       if("+u[e-2]+" < "+this.outputShape[e-2]+") {",1===e?"":"  "+u[e-1]+" += 1;\n         if("+c+") {"],d=1===e?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",v=0,p=1===e?2:4;v<p;v++)h+="\n        "+l[v]+"\n        if ("+d+") {\n          result["+v+"] = float("+r+");\n        } else {\n          "+i+" source = rc - start;\n          result["+v+"] = getChannel(getX("+s.join()+"), "+f+");\n        }\n      ";this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===e?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Ja=function(n,t,r,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&r)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,a=n.strideHeight,u=n.strideWidth,s=n.dilationHeight,c=n.dilationWidth,f=n.effectiveFilterHeight,l=n.effectiveFilterWidth,d=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var v="avg"===t,p="0.0";if(v||(p="-1.0 / 1e-20"),r)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+u+");\n        const ivec2 pads = ivec2("+d+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+s+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+c+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(e?i?"((batch  * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + d":"(xR * "+n.inWidth+" + xC) * "+n.inChannels+" + d":"wR * "+l+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var m=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(m="avgValue / count");var x=4*Math.floor(o/4),y=o%4,b="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+u+");\n      const ivec2 pads = ivec2("+d+", "+h+");\n      const float initializationValue = "+p+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+p+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+f+";\n            wR += "+s+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+x+"; wC += 4) {\n            int xC = xCCorner + wC * "+c+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              getValue(batch, xR, xC + 3 * "+c+", d)\n            );\n\n            "+b+"\n          }\n\n          int xC = xCCorner + "+x+";\n          if ("+(1===y)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+b+"\n          } else if ("+(2===y)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+b+"\n          } else if ("+(3===y)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              initializationValue\n            );\n\n            "+b+"\n          }\n        }\n        setOutput("+m+");\n      }\n    "}},Za=function(n,t,r,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&r)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,a=n.strideDepth,u=n.strideHeight,s=n.strideWidth,c=n.dilationDepth,f=n.dilationHeight,l=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,v=n.effectiveFilterWidth,p=n.padInfo.front,m=n.padInfo.top,x=n.padInfo.left;this.outputShape=n.outShape;var y="avg"===t,b="0.0";if(y||(b="-1.0 / 1e-20"),r)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+u+", "+s+");\n        const ivec3 pads = ivec3("+p+", "+m+", "+x+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+c+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+f+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+v+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(e?i?"(((batch * "+n.inDepth+" + xD) * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"((xD * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"wD * "+h+" * "+v+" +\n                      wR * "+v+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var g=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(g="avgValue / count");var w=4*Math.floor(o/4),C=o%4,N="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+u+", "+s+");\n      const ivec3 pads = ivec3("+p+", "+m+", "+x+");\n      const float initializationValue = "+b+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+b+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+c+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+f+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+N+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+N+"\n            } else if ("+(2===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+N+"\n            } else if ("+(3===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+N+"\n            }\n          }\n          setOutput("+g+");\n        }\n      }\n    "}},Qa=function(n,t){this.variableNames=["x"];var r=n.windowSize,e=n.batchSize,i=n.inSize,o=Math.ceil(i/r);this.outputShape=[e,o];var a="0.0",u="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",u="min"):"max"===t&&(a="-1.0 / 1e-20",u="max");var s=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?s="sumValue":"prod"===t?s="prodValue":"all"===t?s="allValue":"any"===t&&(s="anyValue");var c=4*Math.floor(r/4),f=r%4,l="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+u+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(a="1.0",l="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(a="0.0",l="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===f)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(2===f)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(3===f)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+l+"\n        }\n        setOutput("+s+");\n      }\n    "},nu=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r="",e=0;e<4;e++){var i="thisRC = rc;";e%2==1&&(i+="thisRC.z += 1;"),e>1&&(i+="thisRC.y += 1;"),r+="\n        "+i+"\n        "+(e>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+e+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(e>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+xo(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+yo(n)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+n[1]+";\n        int cols = "+n[2]+";\n\n        "+r+"\n\n        setOutput(result);\n      }\n    "},tu=function(n,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var e=t.shape,i=e[1],o=e[2],a=n.shape,u=a[1],s=a[2],c=[r&&u>1?i-1:i,r&&s>1?o-1:o],f=[r&&u>1?u-1:u,r&&s>1?s-1:s],l=c[0]/f[0],d=c[1]/f[1],h=1/l,v=1/d,p=2*Math.ceil(h)+2,m=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+v+");\n\n        const int winHeight = int("+p+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+u+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ru=function(n,t,r,e){this.variableNames=["A"],this.outputShape=[];var i=n[1],o=n[2];this.outputShape=[n[0],t,r,n[3]];var a=[e&&t>1?i-1:i,e&&r>1?o-1:o],u=[e&&t>1?t-1:t,e&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/u[0]+",\n          "+a[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},eu=function(n,t,r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[1],o=n[2],a=n[3];this.outputShape=[n[0],t,r,a];var u=[e&&t>1?i-1:i,e&&r>1?o-1:o],s=[e&&t>1?t-1:t,e&&r>1?r-1:r];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/s[0]+",\n          "+u[1]/s[1]+",\n          "+u[1]/s[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+";\n        bool hasNextRow = coords.z < "+(r-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},iu=function(n,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var e=t.shape,i=e[1],o=e[2],a=n.shape,u=a[1],s=a[2],c=[r&&u>1?i-1:i,r&&s>1?o-1:o],f=[r&&u>1?u-1:u,r&&s>1?s-1:s],l=c[0]/f[0],d=c[1]/f[1],h=1/l,v=1/d,p=2*Math.ceil(h)+2,m=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+v+");\n\n        const int winHeight = int("+p+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+u+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+f[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+f[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+r+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+r+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ou=function(n,t,r,e){this.variableNames=["A"],this.outputShape=[];var i=n[1],o=n[2];this.outputShape=[n[0],t,r,n[3]];var a=[e&&t>1?i-1:i,e&&r>1?o-1:o],u=[e&&t>1?t-1:t,e&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/u[0]+",\n          "+a[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(e?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},au=function(n,t){this.variableNames=["x"];var r=n.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-"+r+" tensor is not yet supported");if(this.outputShape=n,1!==r){var e=n.map((function(r,e){return function(r){return-1!==t.indexOf(r)&&1!==n[r]?n[r]+" - coords["+r+"] - 1":"coords["+r+"]"}(e)})).join(","),i=Ao(r);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+e+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+n[0]+" - coord - 1));\n        }\n      "},uu=function(n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=n.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-"+r+" tensor is not yet supported");this.outputShape=n;var e=po("rc",r),i=e[r-1]+" + 1 < "+this.outputShape[r-1],o=e[r-2]+" + 1 < "+this.outputShape[r-2],a=Ao(r);function u(r){var e=n.map((function(e,i){return function(r,e){return-1!==t.indexOf(r)&&1!==n[r]?n[r]+" - "+e[r]+" - 1":""+e[r]}(i,r)}));return"getChannel(getX("+e.join(",")+"), vec2("+e.slice(-2).join(",")+"))"}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+n[0]+" - rc - 1),\n            "+n[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+n[0]+" - (rc  + 1) - 1),\n                "+n[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(n){return u(n)}(e.slice())+";\n          if("+i+"){\n            result.g = "+function(n){return n[r-1]="("+n[r-1]+" + 1)",u(n)}(e.slice())+";\n          }\n          if("+o+") {\n            result.b = "+function(n){return n[r-2]="("+n[r-2]+" + 1)",u(n)}(e.slice())+";\n            if("+i+") {\n              result.a = "+function(n){return n[r-1]="("+n[r-1]+" + 1)",n[r-2]="("+n[r-2]+" + 1)",u(n)}(e.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},su=function(n,t,r,e,i,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=Ao(i.length),u=Ao(o.length),s="";1===r?s="i":2===r&&(s="i, j");var c="";1===e?c="i":2===e&&(c="i, coords[1]"),this.userCode="\n        "+a+" strides = "+a+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+n+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round(getIndices("+s+"));\n              flattenedIndex += index * "+(t>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+c+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},cu=function(n){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,e=n.inSize,i=n.numSegments,o=i*Math.ceil(e/t);this.outputShape=[r,o];var a=4*Math.floor(t/4),u=t%4,s="\n        sumValue += dot(values, segFilter);\n    ",c="";e%t>0&&(c="\n        if (inIdx < 0 || inIdx >= "+e+") {\n          return initializationValue;\n        }\n      ");var f="";e%t>0&&(f="\n        if (inIdx < 0 || inIdx >= "+e+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+t+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+a+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+s+"\n        }\n\n        int inIdx = inOffset + "+a+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+s+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+s+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+s+"\n        }\n        setOutput(sumValue);\n      }\n    "},fu=function(n,t,r){var e,i;if(this.variableNames=["c","a","b"],this.outputShape=t,r>4)throw Error("Where for rank "+r+" is not yet supported");if(1===r)i="resRC",e="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],u=[],s=0;s<t.length;s++)u.push(""+o[s]),s<n&&a.push(""+o[s]);e=a.join(),i=u.join()}var c=Ao(r);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+e+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},lu=function(){function n(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var t,r=Ao(this.rank),e="uniform int start["+this.rank+"];",i=function(n){if(1===n)return"sourceLoc";if(n<=6)return du.slice(0,n).map((function(n){return"sourceLoc."+n})).join(",");throw Error("Slicing for rank "+n+" is not yet supported")}(this.rank);t="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+n.map((function(n,t){return"sourceLoc."+du[t]+" = start["+t+"] + coords."+du[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+e+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,e){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(e,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,n)}},n}(),du=["x","y","z","w","u","v"],hu=function(){function n(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var t=Ao(this.rank),r=po("coords",this.rank),e=po("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+e.slice(-2).join()+")",o="getChannel(getSource("+e.join()+"), "+i+")",a="\n      result.x = "+o+";\n      if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n        ++"+e[this.rank-1]+";\n        result.y = "+o+";\n        --"+e[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+n[this.rank-2]+") {\n        ++"+e[this.rank-2]+";\n        result.z = "+o+";\n        if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n          ++"+e[this.rank-1]+";\n          result.w = "+o+";\n        }\n      }\n    ",s=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+n.map((function(n,t){return"start["+t+"]"})).join()+");":n.map((function(n,t){return e[t]+" = "+r[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+s+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,e){null==t.startLoc&&(t.startLoc=r.getUniformLocationNoThrow(e,"start"),null==t.startLoc)||r.gl.uniform1iv(t.startLoc,n)}},n}(),vu=function(n,t,r){this.variableNames=["x"],this.outputShape=r;var e=r.length,i=Ao(r.length),o=Ao(r.length),a="";if(1===e)a="coords * strides + begin";else{var u=0;a=r.map((function(n,t){return u++,1===r.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(u-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+n+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},pu=function(){function n(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(n,t,r){var e,i=mu(t,r),o=xu(n,i,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[o].shift();return this.usedTextures[o].push(a),a}return this.numUsedTextures++,this.log(),i===zn.PACKED_2X2_FLOAT32?e=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===zn.PACKED_2X2_FLOAT16?e=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===zn.UNPACKED_FLOAT32?e=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===zn.UNPACKED_FLOAT16?e=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===zn.PACKED_4X1_UNSIGNED_BYTE&&(e=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[o].push(e),e},n.prototype.releaseTexture=function(n,t,r,e){if(null!=this.freeTextures){var i=xu(t,mu(r,e),e);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],a=o.indexOf(n);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},n.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var n=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){n.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){n.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function mu(n,t){if(n===Wn.UPLOAD)return zn.PACKED_2X2_FLOAT32;if(n===Wn.RENDER||null==n)return function(n){return c().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?zn.PACKED_2X2_FLOAT32:zn.UNPACKED_FLOAT32:n?zn.PACKED_2X2_FLOAT16:zn.UNPACKED_FLOAT16}(t);if(n===Wn.DOWNLOAD||n===Wn.PIXELS)return zn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function xu(n,t,r){return n[0]+"_"+n[1]+"_"+t+"_"+r}var yu=function(n,t){this.variableNames=["A"];for(var r=new Array(n.length),e=0;e<r.length;e++)r[e]=n[e]*t[e];this.outputShape=r,this.rank=r.length;var i=Ao(this.rank),o=function(n){var t=n.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+n[0]+")";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],e=[],i=0;i<n.length;i++)e.push("imod("+r[i]+", "+n[i]+")");return e.join()}(n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},bu=function(n,t){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},gu="if (isnan(x)) return x;",wu="return abs(x);",Cu=gu+"\n  return (x < 0.0) ? 0.0 : x;\n",Nu=gu+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Eu="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ru="return -x;",Au="return ceil(x);",_u="return floor(x);",Ou="return exp(x);",Su="return exp(x) - 1.0;",Tu="return x;",Iu="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Mu="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",ku="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Du=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Fu=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var t=n.length,r=po("rc",t),e=Ao(t),i=function(n,t){if(1===n)return"rc";for(var r="",e=0;e<n;e++)r+=t[e],e<n-1&&(r+=",");return r}(t,r),o=r.slice(-2),a=t<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+e+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},Vu={};function Pu(n,t){if(void 0===t&&(t=!1),"linear"===n)return"return x;";if("relu"===n)return t?Iu:Cu;if("elu"===n)return t?ku:Eu;if("relu6"===n)return t?Mu:Nu;if("prelu"===n)return t?Wo:Lo;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var Lu=function(n){function t(t){var r,e=n.call(this)||this;if(e.pendingRead=new WeakMap,e.pendingDisposal=new WeakSet,e.dataRefCount=new WeakMap,e.numBytesInGPU=0,e.uploadWaitMs=0,e.downloadWaitMs=0,e.warnedAboutMemory=!1,e.pendingDeletes=0,e.disposed=!1,!c().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=jn(c().getNumber("WEBGL_VERSION"));e.binaryCache=((r=c().getNumber("WEBGL_VERSION"))in Vu||(Vu[r]={}),Vu[r]),e.gpgpu=new Pa(i),e.canvas=i.canvas,e.gpgpuCreatedLocally=!0}else e.gpgpu=t,e.binaryCache={},e.gpgpuCreatedLocally=!1,e.canvas=t.gl.canvas;return e.textureManager=new pu(e.gpgpu),e.numMBBeforeWarning=null==c().global.screen?1024:c().global.screen.height*c().global.screen.width*window.devicePixelRatio*600/1024/1024,e.texData=new Si(e,Vn),e}return i(t,n),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(n,t,r){if(c().getBool("DEBUG")&&this.checkNumericalProblems(n),"complex64"===r&&null!=n)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var e={};return this.texData.set(e,{shape:t,dtype:r,values:n,usage:Wn.UPLOAD}),e},t.prototype.move=function(n,t,r,e){if(c().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:r,dtype:e,values:t,usage:Wn.UPLOAD})},t.prototype.readSync=function(n){var t=this.texData.get(n),r=t.values,e=t.dtype,i=t.complexTensors,o=t.shape;if(null!=t.slice){var a;a=t.isPacked?new Du(o,Tu):new bu(o,Tu);var u=this.runWebGLProgram(a,[{dataId:n,shape:o,dtype:e}],e),s=this.readSync(u.dataId);return this.disposeData(u.dataId),s}if(null!=r)return this.convertAndCacheOnCPU(n);if("string"===e)return r;var c,f,l=null!=this.activeTimers;return l&&(c=rn()),f="complex64"===e?$i(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(n),l&&(this.downloadWaitMs+=rn()-c),this.convertAndCacheOnCPU(n,f)},t.prototype.read=function(n){return o(this,void 0,void 0,(function(){var t,r,e,i,o,u,s,f,l,d,h,v,p,m,x,y,b,g,w;return a(this,(function(a){switch(a.label){case 0:if(this.pendingRead.has(n))return t=this.pendingRead.get(n),[2,new Promise((function(n){return t.push(n)}))];if(r=this.texData.get(n),e=r.values,i=r.shape,o=r.dtype,u=r.complexTensors,s=r.isPacked,null!=r.slice)return f=s?new Du(i,Tu):new bu(i,Tu),l=this.runWebGLProgram(f,[{dataId:n,shape:i,dtype:o}],o),d=this.read(l.dataId),this.disposeData(l.dataId),[2,d];if(null!=e)return[2,this.convertAndCacheOnCPU(n)];if(!c().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===c().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return h=null,"complex64"!==o&&c().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(n),p=this.texData.get(v.dataId),h=(w=this.gpgpu).createBufferFromTexture.apply(w,[p.texture].concat(Xn(i)))),this.pendingRead.set(n,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:a.sent(),a.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return x=a.sent(),m=$i(x[0],x[1]),[3,5];case 4:null==h?m=this.getValuesFromTexture(n):(y=_(i),m=this.gpgpu.downloadFloat32MatrixFromBuffer(h,y)),a.label=5;case 5:return null!=v&&this.disposeData(v.dataId),b=this.convertAndCacheOnCPU(n,m),g=this.pendingRead.get(n),this.pendingRead.delete(n),g.forEach((function(n){return n(b)})),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,b]}}))}))},t.prototype.checkNumericalProblems=function(n){if(null!=n)for(var t=0;t<n.length;t++){var r=n[t];if(!Jn(r)){if(c().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+r+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+r+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(n){var t,r=this.texData.get(n),e=r.shape,i=r.dtype,o=r.isPacked,a=_(e);if(c().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(n),s=this.texData.get(u.dataId),f=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[s.texture].concat(Xn(e))).subarray(0,a);return this.disposeData(u.dataId),f}var l=c().getBool("WEBGL_PACK")&&!0===o,d=l?At(e):e,h=l?new da(d):new la(d),v=this.runWebGLProgram(h,[{shape:d,dtype:i,dataId:n}],"float32"),p=this.texData.get(v.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,a);return this.disposeData(v.dataId),m},t.prototype.time=function(n){return o(this,void 0,void 0,(function(){var t,r,e,i,o,u,s;return a(this,(function(a){switch(a.label){case 0:return t=this.activeTimers,r=[],e=!1,null==this.programTimersStack?(this.programTimersStack=r,e=!0):this.activeTimers.push(r),this.activeTimers=r,n(),i=A(this.activeTimers.map((function(n){return n.query}))).filter((function(n){return null!=n})),o=A(this.activeTimers.map((function(n){return n.name}))).filter((function(n){return null!=n})),this.activeTimers=t,e&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return s=a.sent(),u.kernelMs=C(s),u.getExtraProfileInfo=function(){return s.map((function(n,t){return{name:o[t],ms:n}})).map((function(n){return n.name+": "+n.ms})).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},a.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:rn(),endMs:null}},t.prototype.endTimer=function(n){return c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=rn(),n)},t.prototype.getQueryTime=function(n){return o(this,void 0,void 0,(function(){var t;return a(this,(function(){return c().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(t=n).endMs-t.startMs]}))}))},t.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var t=this.texData.get(n).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(n)}}},t.prototype.releaseGPUData=function(n){var t=this.texData.get(n),r=t.texture,e=t.dtype,i=t.texShape,o=t.usage,a=t.isPacked,u=t.slice,s=u&&u.origDataId||n,c=this.dataRefCount.get(s);c>1?this.dataRefCount.set(s,c-1):(this.dataRefCount.delete(s),null!=r&&(this.numBytesInGPU-=this.computeBytes(i,e),this.textureManager.releaseTexture(r,i,o,a)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},t.prototype.getDataInfo=function(n){return this.texData.get(n)},t.prototype.getCPUBackend=function(){return c().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Vn.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(n,t){var r=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&n.every((function(n){return null==r.texData.get(n.dataId).texture&&_(n.shape)<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(n,t){var r=this.makeOutput(n.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:Vn.keep(n.clone()),imag:Vn.keep(t.clone())},r},t.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,t,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,t,r);if(0===_(r))return dr([],r,n.dtype);var e=this.texData.get(n.dataId).isPacked,i=gi(n.shape,t,r);if(e||!i){var o=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hu(r):new lu(r),a=o.getCustomSetupFunc(t);return this.compileAndRun(o,[n],null,a)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,t,r)},t.prototype.shallowSlice=function(n,t,r){var e=this.texData.get(n.dataId),i=this.makeOutput(r,n.dtype),o=this.texData.get(i.dataId);Object.assign(o,e),o.shape=r,o.dtype=n.dtype;var a=wi(t,n.strides);e.slice&&(a+=e.slice.flatOffset),o.slice={flatOffset:a,origDataId:e.slice&&e.slice.origDataId||n.dataId};var u=this.dataRefCount.get(o.slice.origDataId)||1;return this.dataRefCount.set(o.slice.origDataId,u+1),i},t.prototype.stridedSlice=function(n,t,r,e){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,t,r,e);var i=xi(t,r,e);if(i.some((function(n){return 0===n})))return dr([],i);var o=new vu(t,e,i);return this.compileAndRun(o,[n])},t.prototype.reverse=function(n,t){var r=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uu(n.shape,t):new au(n.shape,t);return this.compileAndRun(r,[n])},t.prototype.concat=function(n,t){if("complex64"===n[0].dtype){var r=n.map((function(n){return fr(n)})),e=n.map((function(n){return lr(n)}));return cr(this.concat(r,t),this.concat(e,t))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,t);if(1===n.length)return n[0];if(n.length>c().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(n.length/2),o=this.concat(n.slice(0,i),t),a=this.concat(n.slice(i),t);return this.concat([o,a],t)}if(c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var u=new Ho(n.map((function(n){return n.shape})),t);return this.compileAndRun(u,n)}var s=ur(n.map((function(n){return n.shape})),t),f=n.map((function(n){return n.as2D(-1,_(n.shape.slice(t)))})),l=new jo(f.map((function(n){return n.shape})));return this.compileAndRun(l,f).reshape(s)},t.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Ru,n.dtype);var t=new bu(n.shape,Ru);return this.compileAndRun(t,[n])},t.prototype.batchMatMul=function(n,t,r,e){var i=r?n.shape[2]:n.shape[1],o=e?t.shape[1]:t.shape[2],a=r?n.shape[1]:n.shape[2],u=n.shape[0];if((1===i||1===o)&&a>1e3){r&&(n=Oi(n,[0,2,1])),e&&(t=Oi(t,[0,2,1]));var s=1===o?n:n.as3D(u,a,1),c=1===o?2:1,f=1===o?t.as3D(u,1,a):t;return this.multiply(s,f).sum(c,!0)}var l=_n(n.dtype,t.dtype),d=new ja(n.shape,[u,i,o],r,e);return this.compileAndRun(d,[n,t],l)},t.prototype.fusedBatchMatMul=function(n){var t=n.a,r=n.b,e=n.transposeA,i=n.transposeB,o=n.bias,a=n.activation,u=n.preluActivationWeights,s=e?t.shape[2]:t.shape[1],c=i?r.shape[1]:r.shape[2],f=t.shape[0],l=_n(t.dtype,r.dtype),d=null!=o,h=null!=u,v=a?Pu(a,!0):null,p=new ja(t.shape,[f,s,c],e,i,d,v,h),m=[t,r];return o&&m.push(o),u&&m.push(u),this.compileAndRun(p,m,l)},t.prototype.multiply=function(n,t){if("complex64"===n.dtype){var r=this.texData.get(n.dataId),e=this.texData.get(t.dataId),i=new Do("return areal * breal - aimag * bimag;",n.shape,t.shape),o=new Do("return areal * bimag + aimag * breal;",n.shape,t.shape),a=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag),this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)],u=this.compileAndRun(i,a),s=this.compileAndRun(o,a),f=this.complex(u,s);return u.dispose(),s.dispose(),f}if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.multiply(n,t);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,Po,n.dtype);var l=new Bo(Po,n.shape,t.shape);return this.compileAndRun(l,[n,t],n.dtype)},t.prototype.batchNormalization=function(n,t,r,e,i,o){var a=[n,t,r],u=null;null!=o&&(u=o.shape,a.push(o));var s=null;if(null!=i&&(s=i.shape,a.push(i)),c().getBool("WEBGL_PACK_NORMALIZATION")){var f=new ko(n.shape,t.shape,r.shape,u,s,e);return this.compileAndRun(f,a)}var l=new Mo(n.shape,t.shape,r.shape,u,s,e);return this.compileAndRun(l,a)},t.prototype.localResponseNormalization4D=function(n,t,r,e,i){var o=c().getBool("WEBGL_PACK_NORMALIZATION")?new Ga(n.shape,t,r,e,i):new Wa(n.shape,t,r,e,i);return this.compileAndRun(o,[n])},t.prototype.LRNGrad=function(n,t,r,e,i,o,a){var u=new za(t.shape,e,i,o,a);return this.compileAndRun(u,[t,r,n])},t.prototype.tile=function(n,t){if("string"===n.dtype){var r=this.readSync(n.dataId).map((function(n){return an(n)}));return uo(Fr(n.shape,n.dtype,r),t)}var e=new yu(n.shape,t);return this.compileAndRun(e,[n])},t.prototype.pad=function(n,t,r){var e=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ya(n.shape,t,r):new Ka(n.shape,t,r);return this.compileAndRun(e,[n])},t.prototype.gather=function(n,t,r){if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.gather(n,t,r);var e=new xa(n.shape,t.size,r);return this.compileAndRun(e,[n,t])},t.prototype.batchToSpaceND=function(n,t,r){N(n.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var e=t.reduce((function(n,t){return n*t})),i=$r(n.shape,t,e),o=Kr(i.length,t.length),a=Yr(n.shape,t,e),u=Jr(r,t.length),s=Zr(a,r,t.length);return Oi(n.reshape(i),o).reshape(a).slice(u,s)},t.prototype.spaceToBatchND=function(n,t,r){N(n.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var e=t.reduce((function(n,t){return n*t})),i=[[0,0]];i.push.apply(i,r);for(var o=1+t.length;o<n.shape.length;++o)i.push([0,0]);var a=n.pad(i),u=$r(a.shape,t,e,!1),s=Kr(u.length,t.length,!1),c=Yr(a.shape,t,e,!1);return Oi(a.reshape(u),s).reshape(c)},t.prototype.reduce=function(n,t,r){var e=n.shape[0],i=n.shape[1],o=fi(i),a=new Qa({windowSize:o,inSize:i,batchSize:e},t),u=this.compileAndRun(a,[n],r);return 1===u.shape[1]?u:this.reduce(u,t,r)},t.prototype.argReduce=function(n,t,r){void 0===r&&(r=null);var e=n.shape[0],i=n.shape[1];null!=r&&(e=r.shape[0],i=r.shape[1]);var o=fi(i),a=new ho({windowSize:o,inSize:i,batchSize:e},t,null==r),u=[n];null!=r&&u.push(r);var s=this.compileAndRun(a,u,"int32");return 1===s.shape[1]?s:this.argReduce(n,t,s)},t.prototype.argReducePacked=function(n,t,r){void 0===r&&(r=null);var e=null!=r?r.shape:n.shape,i=fi(e[e.length-1]),o=new So(e,i,t,null==r),a=this.compileAndRun(o,null==r?[n]:[n,r],"int32");return a.rank===n.rank?this.argReducePacked(n,t,a):a},t.prototype.sum=function(n,t){rr("sum",t,n.rank);var r=nr(n.shape,t),e=r[0],i=_(r[1]),o=n.as2D(-1,i),a=On(n.dtype);return this.reduce(o,"sum",a).reshape(e)},t.prototype.prod=function(n,t){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,t);var r=nr(n.shape,t),e=r[0],i=_(r[1]),o=n.as2D(-1,i),a=On(n.dtype);return this.reduce(o,"prod",a).reshape(e)},t.prototype.unsortedSegmentSum=function(n,t,r){var e=0,i=er([e],n.rank),o=n;null!=i&&(o=Oi(n,i),e=or(1,n.rank)[0]);var a=function(n,t,r){for(var e=[],i=n.length,o=0;o<i;o++)e.push(o!==t?n[o]:r);return e}(o.shape,e,r),u=_([o.shape[e]]),s=o.as2D(-1,u),c=On(n.dtype),f=this.segOpCompute(s,"unsortedSegmentSum",t,c,r).reshape(a);return null!=i&&(f=Oi(f,ir(i))),f},t.prototype.segOpCompute=function(n,t,r,e,i){var o=n.shape[0],a=n.shape[1],u=function(n,t){var r,e=!1;for(n<=30?(r=n,e=!0):r=Y(n,Math.floor(Math.sqrt(n)));!e;)r>t||r===n?e=!0:r=Y(n,r+1);return r}(a,i),s=new cu({windowSize:u,inSize:a,batchSize:o,numSegments:i},t),c=this.compileAndRun(s,[n,r],e);return c.shape[1]===i?c:(r=Ar(0,i).tile([a/u]),this.segOpCompute(c,t,r,e,i))},t.prototype.argMinMaxReduce=function(n,t,r){var e=[t];if(rr("arg"+r.charAt(0).toUpperCase()+r.slice(1),e,n.rank),!c().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var i=nr(n.shape,e),o=i[0],a=_(i[1]),u=n.as2D(-1,a);return this.argReduce(u,r).reshape(o)}return this.argReducePacked(n,r)},t.prototype.argMin=function(n,t){return this.argMinMaxReduce(n,t,"min")},t.prototype.argMax=function(n,t){return this.argMinMaxReduce(n,t,"max")},t.prototype.cumsum=function(n,t,r,e){if(t!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+t);var i=new oa(n.shape,r,e);return this.compileAndRun(i,[n])},t.prototype.equal=function(n,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return vec4(equal(a, b));\n","bool");var r=new Bo("return float(a == b);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.notEqual=function(n,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return vec4(notEqual(a, b));\n","bool");var r=new Bo("return float(a != b);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.less=function(n,t){if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.less(n,t);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return vec4(lessThan(a, b));\n","bool");var r=new Bo("return float(a < b);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.lessEqual=function(n,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var r=new Bo("return float(a <= b);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.greater=function(n,t){if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.greater(n,t);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return vec4(greaterThan(a, b));\n","bool");var r=new Bo("return float(a > b);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.greaterEqual=function(n,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var r=new Bo("return float(a >= b);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.logicalNot=function(n){var t=new bu(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[n])},t.prototype.logicalAnd=function(n,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var r=new Bo("return float(a >= 1.0 && b >= 1.0);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.logicalOr=function(n,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var r=new Bo("return float(a >= 1.0 || b >= 1.0);",n.shape,t.shape);return this.compileAndRun(r,[n,t],"bool")},t.prototype.select=function(n,t,r){var e=new fu(n.rank,t.shape,t.rank);return this.compileAndRun(e,[n,t,r],_n(t.dtype,r.dtype))},t.prototype.where=function(n){Xt("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=n.dataSync();return co(n.shape,t)},t.prototype.topk=function(n,t){return so(n.dataSync(),n.shape,n.dtype,t)},t.prototype.min=function(n,t){rr("min",t,n.rank);var r=nr(n.shape,t),e=r[0],i=_(r[1]),o=n.as2D(-1,i);return this.reduce(o,"min",o.dtype).reshape(e)},t.prototype.minimum=function(n,t){if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.minimum(n,t);var r=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,t.shape):new Bo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",n.shape,t.shape);return this.compileAndRun(r,[n,t])},t.prototype.mod=function(n,t){var r=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,t.shape):new Bo("if (b == 0.0) return NAN;\n  return mod(a, b);",n.shape,t.shape);return this.compileAndRun(r,[n,t])},t.prototype.max=function(n,t){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,t);rr("max",t,n.rank);var r=nr(n.shape,t),e=r[0],i=_(r[1]),o=n.as2D(-1,i);return this.reduce(o,"max",o.dtype).reshape(e)},t.prototype.maximum=function(n,t){if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.maximum(n,t);var r=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,t.shape):new Bo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",n.shape,t.shape);return this.compileAndRun(r,[n,t])},t.prototype.all=function(n,t){rr("all",t,n.rank);var r=nr(n.shape,t),e=r[0],i=_(r[1]),o=n.as2D(-1,i);return this.reduce(o,"all",o.dtype).reshape(e)},t.prototype.any=function(n,t){rr("any",t,n.rank);var r=nr(n.shape,t),e=r[0],i=_(r[1]),o=n.as2D(-1,i);return this.reduce(o,"any",o.dtype).reshape(e)},t.prototype.floorDiv=function(n,t){if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var r=new Bo("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",n.shape,t.shape);return this.compileAndRun(r,[n,t],"int32")},t.prototype.add=function(n,t){if("complex64"===n.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(n,t,Fo);if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.add(n,t);var r=_n(n.dtype,t.dtype);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,Fo,r);var e=new Bo(Fo,n.shape,t.shape);return this.compileAndRun(e,[n,t],r)},t.prototype.packedUnaryOp=function(n,t,r){var e=new Du(n.shape,t);return this.compileAndRun(e,[n],r)},t.prototype.packedBinaryOp=function(n,t,r,e,i){void 0===i&&(i=!1);var o=new zo(r,n.shape,t.shape,i);return this.compileAndRun(o,[n,t],e)},t.prototype.complexSeparableBinaryOp=function(n,t,r){var e=this,i=this.texData.get(n.dataId),o=this.texData.get(t.dataId),a=[[i.complexTensors.real,o.complexTensors.real],[i.complexTensors.imag,o.complexTensors.imag]].map((function(i){var o=i[0],a=i[1],u=e.makeComplexComponentTensorInfo(n,o),s=e.makeComplexComponentTensorInfo(t,a),c=new Bo(r,n.shape,t.shape);return e.compileAndRun(c,[u,s],_n(o.dtype,a.dtype))})),u=a[0],s=a[1],c=this.complex(u,s);return u.dispose(),s.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}},t.prototype.addN=function(n){if(1===n.length)return n[0];if(n.length>c().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(n.length/2),r=this.addN(n.slice(0,t)),e=this.addN(n.slice(t));return this.addN([r,e])}var i=n.map((function(n){return n.dtype})).reduce((function(n,t){return _n(n,t)})),o=n.map((function(n){return n.shape})),a=c().getBool("WEBGL_PACK")?new lo(n[0].shape,o):new fo(n[0].shape,o);return this.compileAndRun(a,n,i)},t.prototype.subtract=function(n,t){if("complex64"===n.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(n,t,Vo);if(this.shouldExecuteOnCPU([n,t]))return this.cpuBackend.subtract(n,t);var r=_n(n.dtype,t.dtype);if(c().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,t,Vo,n.dtype);var e=new Bo(Vo,n.shape,t.shape);return this.compileAndRun(e,[n,t],r)},t.prototype.pow=function(n,t){var r=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,t.shape):new Bo("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",n.shape,t.shape),e=_n(n.dtype,t.dtype);return this.compileAndRun(r,[n,t],e)},t.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Au,n.dtype);var t=new bu(n.shape,Au);return this.compileAndRun(t,[n])},t.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,_u,n.dtype);var t=new bu(n.shape,_u);return this.compileAndRun(t,[n])},t.prototype.sign=function(n){var t=new bu(n.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[n])},t.prototype.isNaN=function(n){var t=new bu(n.shape,"return float(isnan(x));");return this.compileAndRun(t,[n],"bool")},t.prototype.isInf=function(n){var t=new bu(n.shape,"return float(isinf(x));");return this.compileAndRun(t,[n],"bool")},t.prototype.isFinite=function(n){var t=new bu(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[n],"bool")},t.prototype.round=function(n){var t=new bu(n.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[n])},t.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Ou,n.dtype);var t=new bu(n.shape,Ou);return this.compileAndRun(t,[n])},t.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Su,n.dtype);var t=new bu(n.shape,Su);return this.compileAndRun(t,[n])},t.prototype.softmax=function(n,t){var r=F([t],n.shape),e=this.max(n,r),i=tr(e.shape,r),o=this.subtract(n,e.reshape(i)),a=this.exp(o),u=this.sum(a,r).reshape(i);return ui(a,u)},t.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",n.dtype);var t=new bu(n.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[n])},t.prototype.log1p=function(n){var t=new bu(n.shape,"return log(1.0 + x);");return this.compileAndRun(t,[n])},t.prototype.sqrt=function(n){var t=new bu(n.shape,"return sqrt(x);");return this.compileAndRun(t,[n])},t.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var t=new bu(n.shape,"return inversesqrt(x);");return this.compileAndRun(t,[n])},t.prototype.reciprocal=function(n){var t=new bu(n.shape,"return 1.0 / x;");return this.compileAndRun(t,[n])},t.prototype.relu=function(n){var t;return t=c().getBool("WEBGL_PACK")?new Du(n.shape,Iu):new bu(n.shape,Cu),this.compileAndRun(t,[n])},t.prototype.relu6=function(n){var t;return t=c().getBool("WEBGL_PACK")?new Du(n.shape,Mu):new bu(n.shape,Nu),this.compileAndRun(t,[n])},t.prototype.prelu=function(n,t){var r=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo(Wo,n.shape,t.shape):new Bo(Lo,n.shape,t.shape);return this.compileAndRun(r,[n,t])},t.prototype.elu=function(n){if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,ku,n.dtype);var t=new bu(n.shape,Eu);return this.compileAndRun(t,[n])},t.prototype.eluDer=function(n,t){var r=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",n.shape,t.shape):new Bo("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,t.shape);return this.compileAndRun(r,[n,t])},t.prototype.selu=function(n){var t=new bu(n.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[n])},t.prototype.int=function(n){var t=new bu(n.shape,"return float(int(x));");return this.compileAndRun(t,[n],"int32")},t.prototype.clip=function(n,t,r){var e,i=(e=c().getBool("WEBGL_PACK_CLIP")?new Uo(n.shape):new Go(n.shape)).getCustomSetupFunc(t,r);return this.compileAndRun(e,[n],null,i)},t.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(c().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,wu,n.dtype);var t=new bu(n.shape,wu);return this.compileAndRun(t,[n])},t.prototype.complexAbs=function(n){var t=this.texData.get(n.dataId),r=new qo(n.shape),e=[this.makeComplexComponentTensorInfo(n,t.complexTensors.real),this.makeComplexComponentTensorInfo(n,t.complexTensors.imag)];return this.compileAndRun(r,e)},t.prototype.sigmoid=function(n){var t=new bu(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[n])},t.prototype.softplus=function(n){var t=new bu(n.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[n])},t.prototype.sin=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[n])},t.prototype.cos=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[n])},t.prototype.tan=function(n){var t=new bu(n.shape,"return tan(x);");return this.compileAndRun(t,[n])},t.prototype.asin=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[n])},t.prototype.acos=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[n])},t.prototype.atan=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[n])},t.prototype.atan2=function(n,t){var r=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,t.shape):new Bo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",n.shape,t.shape);return this.compileAndRun(r,[n,t])},t.prototype.sinh=function(n){var t=new bu(n.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[n])},t.prototype.cosh=function(n){var t=new bu(n.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[n])},t.prototype.tanh=function(n){var t=new bu(n.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[n])},t.prototype.asinh=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[n])},t.prototype.acosh=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[n])},t.prototype.atanh=function(n){var t=new bu(n.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[n])},t.prototype.erf=function(n){var t=new bu(n.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[n])},t.prototype.step=function(n,t){var r=new bu(n.shape,function(n){return void 0===n&&(n=0),gu+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "}(t));return this.compileAndRun(r,[n])},t.prototype.conv2dByMatMul=function(n,t,r,e,i,o){var a=n.shape,u=this.texData.get(n.dataId),s="channelsLast"===r.dataFormat,f=a[2]%2!=0&&!!u.isPacked;if((1==a[0]*a[1]*a[2]||1===r.outChannels)&&r.inChannels>1e3||!c().getBool("WEBGL_LAZILY_UNPACK")||!c().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!f){var l=this.reshape(n,[1,s?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],r.inChannels]),d=this.reshape(t,[1,r.inChannels,r.outChannels]);return this.reshape(this.fusedBatchMatMul({a:l,b:d,transposeA:!1,transposeB:!1,bias:e,activation:i,preluActivationWeights:o}),r.outShape)}var h={dataId:n.dataId,shape:[1,s?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),r.inChannels],dtype:n.dtype},v=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,N(St(u.shape,h.shape),(function(){return"packed reshape "+u.shape+" to "+h.shape+" isn't free"}));var p=this.reshape(t,[1,r.inChannels,r.outChannels]),m=this.fusedBatchMatMul({a:h,b:p,transposeA:!1,transposeB:!1,bias:e,activation:i,preluActivationWeights:o}),x=this.texData.get(m.dataId);return N(x.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=v,x.shape=r.outShape,Vn.makeTensorFromDataId(m.dataId,r.outShape,m.dtype)},t.prototype.conv2dWithIm2Row=function(n,t,r,e,i,o){var a=r.outWidth,u=r.outHeight,s="channelsLast"===r.dataFormat,c=r.filterWidth*r.filterHeight*r.inChannels,f=u*a,l=[c,f],d=n.squeeze([0]),h=t.reshape([1,c,-1]),v=new Ba(l,d.shape,r),p=this.compileAndRun(v,[d]).reshape([1,l[0],l[1]]),m=null!=e,x=null!=o,y=i?Pu(i,!0):null,b=new ja(p.shape,[1,f,r.outChannels],!0,!1,m,y,x),g=[p,h];return e&&g.push(e),x&&g.push(o),this.compileAndRun(b,g).reshape(s?[1,u,a,r.outChannels]:[1,r.outChannels,u,a])},t.prototype.fusedConv2d=function(n){var t=n.input,r=n.filter,e=n.convInfo,i=n.bias,o=n.activation,a=n.preluActivationWeights;if(1===e.filterHeight&&1===e.filterWidth&&1===e.dilationHeight&&1===e.dilationWidth&&1===e.strideHeight&&1===e.strideWidth&&("SAME"===e.padInfo.type||"VALID"===e.padInfo.type))return this.conv2dByMatMul(t,r,e,i,o,a);if(c().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,r,e,i,o,a);var u=null!=i,s=null!=a,f=o?Pu(o,!1):null,l=new na(e,u,f,s),d=[t,r];return i&&d.push(i),a&&d.push(a),this.compileAndRun(l,d)},t.prototype.conv2d=function(n,t,r){if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(n,t,r);if(c().getBool("WEBGL_CONV_IM2COL")&&1===n.shape[0])return this.conv2dWithIm2Row(n,t,r);var e=new na(r);return this.compileAndRun(e,[n,t])},t.prototype.conv2dDerInput=function(n,t,r){var e=new Ko(r);return this.compileAndRun(e,[n,t])},t.prototype.conv2dDerFilter=function(n,t,r){var e=new $o(r);return this.compileAndRun(e,[n,t])},t.prototype.fusedDepthwiseConv2D=function(n){var t,r=n.input,e=n.filter,i=n.convInfo,o=n.bias,a=n.activation,u=n.preluActivationWeights,s=c().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,f=a?Pu(a,s):null,l=[r,e],d=null!=o,h=null!=u;return d&&l.push(o),h&&l.push(u),s?(t=new ea(i,d,f,h),this.compileAndRun(t,l)):(t=new ra(i,d,f,h),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(n,t,r){var e;return c().getBool("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(e=new ea(r),this.compileAndRun(e,[n,t])):(e=new ra(r),this.compileAndRun(e,[n,t]))},t.prototype.depthwiseConv2DDerInput=function(n,t,r){var e=new Qo(r);return this.compileAndRun(e,[n,t])},t.prototype.depthwiseConv2DDerFilter=function(n,t,r){var e=new Zo(r);return this.compileAndRun(e,[n,t])},t.prototype.conv3d=function(n,t,r){var e=new ta(r);return this.compileAndRun(e,[n,t])},t.prototype.conv3dDerInput=function(n,t,r){var e=new Jo(r);return this.compileAndRun(e,[n,t])},t.prototype.conv3dDerFilter=function(n,t,r){var e=new Yo(r);return this.compileAndRun(e,[n,t])},t.prototype.maxPool=function(n,t){var r=new Ja(t,"max",!1);return this.compileAndRun(r,[n])},t.prototype.avgPool=function(n,t){var r=new Ja(t,"avg",!1);return this.compileAndRun(r,[n],"float32")},t.prototype.maxPoolBackprop=function(n,t,r,e){var i=new Ja(e,"max",!0),o=this.compileAndRun(i,[t]),a=new Ua(e),u=this.compileAndRun(a,[n,o],t.dtype);return o.dispose(),u},t.prototype.avgPoolBackprop=function(n,t,r){var e=new To(r);return this.compileAndRun(e,[n],t.dtype)},t.prototype.cast=function(n,t){return qi(n,t,this)},t.prototype.unstack=function(n,t){for(var r=n.shape[t],e=new Array(n.rank-1),i=0,o=0;o<n.rank;o++)o!==t&&(e[i++]=n.shape[o]);var a=new Array(n.rank).fill(0),u=n.shape.slice();u[t]=1;var s=new Array(r);for(o=0;o<s.length;o++)a[t]=o,s[o]=this.slice(n,a,u).reshape(e);return s},t.prototype.avgPool3d=function(n,t){var r=new Za(t,"avg",!1);return this.compileAndRun(r,[n],"float32")},t.prototype.avgPool3dBackprop=function(n,t,r){var e=new Io(r);return this.compileAndRun(e,[n],t.dtype)},t.prototype.maxPool3d=function(n,t){var r=new Za(t,"max",!1);return this.compileAndRun(r,[n],"float32")},t.prototype.maxPool3dBackprop=function(n,t,r,e){var i=new Za(e,"max",!0),o=this.compileAndRun(i,[t]),a=new qa(e),u=this.compileAndRun(a,[n,o],t.dtype);return o.dispose(),u},t.prototype.reshape=function(n,t){var r=this.texData.get(n.dataId);if(r.isPacked&&!St(n.shape,t)&&(null===r.texture||!St(r.shape,t))){var e=this.packedReshape(n,t);return Vn.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}return ji(n,t)},t.prototype.resizeBilinear=function(n,t,r,e){var i=c().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new eu(n.shape,t,r,e):new ru(n.shape,t,r,e);return this.compileAndRun(i,[n],"float32")},t.prototype.resizeBilinearBackprop=function(n,t,r){var e=new tu(n,t,r);return this.compileAndRun(e,[n])},t.prototype.resizeNearestNeighbor=function(n,t,r,e){var i=new ou(n.shape,t,r,e);return this.compileAndRun(i,[n])},t.prototype.resizeNearestNeighborBackprop=function(n,t,r){var e=new iu(n,t,r);return this.compileAndRun(e,[n])},t.prototype.multinomial=function(n,t,r,e){var i=t?n:Ai(n),o=new Ha(i.shape[0],i.shape[1],r),a=o.getCustomSetupFunc(e);return this.compileAndRun(o,[i],"int32",a)},t.prototype.oneHot=function(n,t,r,e){var i=new Xa(n.size,t,r,e);return this.compileAndRun(i,[n])},t.prototype.diag=function(n){var t=new fa(n.size);return this.compileAndRun(t,[n])},t.prototype.nonMaxSuppression=function(n,t,r,e,i){return Xt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),no(n.dataSync(),t.dataSync(),r,e,i)},t.prototype.cropAndResize=function(n,t,r,e,i,o){var a=new ia(n.shape,t.shape,e,i,o);return this.compileAndRun(a,[n,t,r],"float32")},t.prototype.depthToSpace=function(n,t,r){N(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var e=n.shape[0],i=("NHWC"===r?n.shape[1]:n.shape[2])*t,o=("NHWC"===r?n.shape[2]:n.shape[3])*t,a=("NHWC"===r?n.shape[3]:n.shape[1])/(t*t),u=new ca("NHWC"===r?[e,i,o,a]:[e,a,i,o],t,r);return this.compileAndRun(u,[n])},t.prototype.split=function(n,t,r){return ao(n,t,r)},t.prototype.scatterND=function(n,t,r){var e=hi(0,n,r),i=e.sliceRank,o=e.numUpdates,a=e.sliceSize,u=e.strides,s=e.outputSize,c=[s/a,a],f=n.reshape([o,i]),l=t.reshape([o,a]);if(0===s)return ji(dr([]),r);var d=vr(0),h=new su(o,i,f.rank,l.rank,u,c);return this.compileAndRun(h,[l,f,d]).reshape(r)},t.prototype.sparseToDense=function(n,t,r,e){var i=hi(0,n,r),o=new su(i.numUpdates,i.sliceRank,n.rank,t.rank,i.strides,[i.outputSize,1],!1);return this.compileAndRun(o,[t,n,e]).reshape(r)},t.prototype.fft=function(n){return this.fftImpl(n,!1)},t.prototype.ifft=function(n){return this.fftImpl(n,!0)},t.prototype.fftImpl=function(n,t){var r=this.texData.get(n.dataId),e=new pa("return real * expR - imag * expI;",n.shape,t),i=new pa("return real * expI + imag * expR;",n.shape,t),o=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)],a=this.compileAndRun(e,o),u=this.compileAndRun(i,o),s=this.complex(a,u).as2D(n.shape[0],n.shape[1]);return a.dispose(),u.dispose(),s},t.prototype.gatherND=function(n,t){var r=t.shape,e=r[r.length-1],i=si(n,t),o=i[0],a=i[1],u=i[2],s=i[3],c=t.reshape([a,e]),f=n.reshape([n.size/u,u]),l=new ya(e,s,[a,u]);return this.compileAndRun(l,[f,c]).reshape(o)},t.prototype.fill=function(n,t,r){if("string"===(r=r||$(t))){var e=L(r,_(n));return e.fill(t),Vn.makeTensor(e,n,r,this)}var i=new ma(n,t),o=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],r,o)},t.prototype.onesLike=function(n){if("string"===n.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){return this.fill(n.shape,"string"===n.dtype?"":0,n.dtype)},t.prototype.linspace=function(n,t,r){return Hi(n,t,r)},t.prototype.makeTensorInfo=function(n,t){var r=this.write(null,n,t);return this.texData.get(r).usage=null,{dataId:r,shape:n,dtype:t}},t.prototype.makeOutput=function(n,t){var r=this.makeTensorInfo(n,t).dataId;return Vn.makeTensorFromDataId(r,n,t,this)},t.prototype.unpackTensor=function(n){var t=new Fu(n.shape);return this.runWebGLProgram(t,[n],n.dtype)},t.prototype.packTensor=function(n){var t=new $a(n.shape);return this.runWebGLProgram(t,[n],n.dtype,null,!0)},t.prototype.packedReshape=function(n,t){var r=[Et(n.shape)].concat(Rt(n.shape)),e={dtype:n.dtype,shape:r,dataId:n.dataId},i=[Et(t)].concat(Rt(t)),o=new nu(i,r),a=this.runWebGLProgram(o,[e],n.dtype,null,!0);return{dataId:a.dataId,shape:t,dtype:a.dtype}},t.prototype.decode=function(n){var t,r=this.texData.get(n),e=r.isPacked,i=r.shape,o=r.dtype,a=At(i);return t=e?new sa(a):new ua(a),{dtype:o,shape:i,dataId:this.runWebGLProgram(t,[{shape:a,dtype:o,dataId:n}],o,null,!0).dataId}},t.prototype.runWebGLProgram=function(n,t,r,e,i){var o=this;void 0===i&&(i=!1);var a=this.makeTensorInfo(n.outputShape,r),u=this.texData.get(a.dataId);if(n.packedOutput&&(u.isPacked=!0),n.outPackingScheme===Bn.DENSE){var s=Xn(n.outputShape);u.texShape=s.map((function(n){return 2*n}))}if(null!=n.outTexUsage&&(u.usage=n.outTexUsage),0===_(a.shape))return u.values=P(a.dtype,0),a;var f=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var r=o.texData.get(t.dataId);if(null==r.texture){if(!n.packedInputs&&_(t.shape)<=c().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:r.values};n.packedInputs&&(r.isPacked=!0,r.shape=t.shape)}else if(!!r.isPacked!=!!n.packedInputs)t=r.isPacked?o.unpackTensor(t):o.packTensor(t),f.push(t),r=o.texData.get(t.dataId);else if(r.isPacked&&!St(r.shape,t.shape)){var e=t,i=t.shape;t.shape=r.shape,t=o.packedReshape(t,i),f.push(t),r=o.texData.get(t.dataId),e.shape=i}return o.uploadToGPU(t.dataId),{shape:t.shape,texData:r,isUniform:!1}}));this.uploadToGPU(a.dataId);var d,h={shape:a.shape,texData:u,isUniform:!1},v=function(n,t,r){var e="";return t.concat(r).forEach((function(n){e+=n.shape+"_"+(n.isUniform?"uniform":n.texData.texShape)+"_"+(null!=n.texData&&null!=n.texData.slice&&n.texData.slice.flatOffset>0)})),n.constructor.name+"_"+e+"_"+n.userCode}(n,l,h),p=this.getAndSaveBinary(v,(function(){return function(n,t,r,e){var i=t.userCode,o=r.map((function(n,r){var e={logicalShape:n.shape,texShape:n.isUniform?null:n.texData.texShape,isUniform:n.isUniform,isPacked:!n.isUniform&&n.texData.isPacked,flatOffset:null};return null!=n.texData&&null!=n.texData.slice&&n.texData.slice.flatOffset>0&&(e.flatOffset=n.texData.slice.flatOffset),{name:t.variableNames[r],shapeInfo:e}})),a=o.map((function(n){return n.shapeInfo})),u={logicalShape:e.shape,texShape:e.texData.texShape,isUniform:!1,isPacked:e.texData.isPacked,flatOffset:null},s=function(n,t,r,e){var i=[];n.forEach((function(n){var t=_(n.shapeInfo.logicalShape);n.shapeInfo.isUniform?i.push("uniform float "+n.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+n.name+";"),i.push("uniform int offset"+n.name+";"))}));var o,a,u=i.join("\n"),s=n.map((function(n){return function(n,t,r){void 0===r&&(r=!1);var e="";return e+=r?function n(t){var r;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(r=t.name).charAt(0).toUpperCase()+r.slice(1))+"() {\n      return "+mo().texture2D+"("+r+", halfCR);\n    }\n  ";case 1:return function(n){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),e=n.shapeInfo.texShape,i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=mo();return"\n    vec4 "+r+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+o.texture2D+"("+t+", uv);\n    }\n  "}(t);case 2:return function(n){var t=n.shapeInfo.logicalShape,r=n.name,e="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],u=mo();if(null!=i&&O(t,i))return"\n      vec4 "+e+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n\n        return "+u.texture2D+"("+r+", uv);\n      }\n    ";var s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+e+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+s[0]+", "+s[1]+", row, col);\n      return "+u.texture2D+"("+r+", uv);\n    }\n  "}(t);case 3:return function(t){var r=t.shapeInfo.logicalShape,e=t.name,i="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===r[0]){var u=_o(t,r.slice(1));return"\n        "+n(u)+"\n        vec4 "+i+"(int b, int row, int col) {\n          return "+i+"("+Oo(["b","row","col"],[1,2])+");\n        }\n      "}var s=a[0],c=a[1],f=Math.ceil(r[2]/2);return"\n    vec4 "+i+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+s+", "+c+", "+f*Math.ceil(r[1]/2)+", "+f+", b, row, col);\n      return "+mo().texture2D+"("+e+", uv);\n    }\n  "}(t);default:return function(n){for(var t=n.shapeInfo.logicalShape,r=t.length,e=n.name,i="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=a[0],s=a[1],c=Math.ceil(t[r-1]/2),f=c*Math.ceil(t[r-2]/2),l="int b, int row, int col",d="b * "+f+" + (row / 2) * "+c+" + (col / 2)",h=2;h<r-1;h++)l="int b"+h+", "+l,d="b"+h+" * "+(f*=t[r-h-1])+" + "+d;return"\n    vec4 "+i+"("+l+") {\n      int index = "+d+";\n      int texR = index / "+s+";\n      int texC = index - texR * "+s+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+s+", "+u+");\n      return "+mo().texture2D+"("+e+", uv);\n    }\n  "}(t)}}(n):function n(t){var r=t.shapeInfo.logicalShape;switch(r.length){case 0:return function(n){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return"float "+r+"() {return "+t+";}";var e=n.shapeInfo.texShape;if(1===e[0]&&1===e[1])return"\n      float "+r+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=n.shapeInfo.texShape;return"\n    float "+r+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+Eo(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 1:return function(n){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return"\n      float "+r+"(int index) {\n        "+Ro(n)+"\n      }\n    ";var e=n.shapeInfo.texShape,i=e[0],o=e[1];if(1===o&&1===i)return"\n      float "+r+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var a=Eo(t);return 1===o?"\n      float "+r+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+r+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+o+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+r+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+o+", index + "+a+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 2:return function(t){var r=t.shapeInfo.logicalShape,e=t.name,i="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape;if(null!=o&&O(r,o))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+o[0]+".0);\n      return sampleTexture("+e+", uv);\n    }\n  ";var a=V(r),u=a.newShape,s=a.keptDims;if(u.length<r.length){var c=_o(t,u);return"\n      "+n(c)+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+Oo(["row","col"],s)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+Ro(t)+"\n      }\n    ";var f=o[0],l=o[1],d=Eo(e);return 1===l?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+f+".0);\n      return sampleTexture("+e+", uv);\n    }\n  ":1===f?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+l+".0, 0.5);\n      return sampleTexture("+e+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+f+", "+l+", index);\n    return sampleTexture("+e+", uv);\n  }\n"}(t);case 3:return function(t){var r=t.shapeInfo.logicalShape,e=t.name,i="get"+e.charAt(0).toUpperCase()+e.slice(1),o=r[1]*r[2],a=r[2],u=V(r),s=u.newShape,c=u.keptDims;if(s.length<r.length){var f=_o(t,s);return"\n        "+n(f)+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+Oo(["row","col","depth"],c)+");\n        }\n      "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+Ro(t)+"\n      }\n    ";var l=t.shapeInfo.texShape,d=l[0],h=l[1],v=t.shapeInfo.flatOffset;return h===o&&null==v?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+h+".0, "+d+".0);\n          return sampleTexture("+e+", uv);\n        }\n      ":h===a&&null==v?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+h+".0, "+d+".0);\n      return sampleTexture("+e+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+Eo(e)+";\n        vec2 uv = uvFromFlat("+d+", "+h+", index);\n        return sampleTexture("+e+", uv);\n      }\n  "}(t);case 4:return function(t){var r=t.shapeInfo.logicalShape,e=t.name,i="get"+e.charAt(0).toUpperCase()+e.slice(1),o=r[3],a=r[2]*o,u=r[1]*a,s=V(r),c=s.newShape,f=s.keptDims;if(c.length<r.length){var l=_o(t,c);return"\n      "+n(l)+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+Oo(["row","col","depth","depth2"],f)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+a+", "+o+", 1)));\n        "+Ro(t)+"\n      }\n    ";var d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,v=h[0],p=h[1];return p===u&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+v+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":p===o&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+v+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+v+", "+p+", index + "+Eo(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);case 5:return function(t){var r=t.shapeInfo.logicalShape,e=t.name,i="get"+e.charAt(0).toUpperCase()+e.slice(1),o=r[4],a=r[3]*o,u=r[2]*a,s=r[1]*u,c=V(r),f=c.newShape,l=c.keptDims;if(f.length<r.length){var d=_o(t,f);return"\n      "+n(d)+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+Oo(["row","col","depth","depth2","depth3"],l)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+u+", "+a+", "+o+")) +\n          depth3;\n        "+Ro(t)+"\n      }\n    ";var h=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,p=v[0],m=v[1];return m===s&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":m===o&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+u+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+Eo(e)+";\n      vec2 uv = uvFromFlat("+p+", "+m+", index);\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);case 6:return function(t){var r=t.shapeInfo.logicalShape,e=t.name,i="get"+e.charAt(0).toUpperCase()+e.slice(1),o=V(r),a=o.newShape,u=o.keptDims;if(a.length<r.length){var s=_o(t,a);return"\n      "+n(s)+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+Oo(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    "}var c=r[5],f=r[4]*c,l=r[3]*f,d=r[2]*l,h=r[1]*d;if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+d+", "+l+", "+f+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+c+", 1)));\n        "+Ro(t)+"\n      }\n    ";var v=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],x=p[1];return x===h&&null==v?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+d+", "+l+", "+f+", "+c+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+x+".0, "+m+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":x===c&&null==v?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+x+".0, "+m+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+d+" + depth * "+l+" +\n          depth2 * "+f+" + depth3 * "+c+" + depth4 + "+Eo(e)+";\n      vec2 uv = uvFromFlat("+m+", "+x+", index);\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);default:throw new Error(r.length+"-D input sampling is not yet supported")}}(n),n.shapeInfo.logicalShape.length<=t.logicalShape.length&&(e+=r?function(n,t){var r,e,i=n.name,o=i.charAt(0).toUpperCase()+i.slice(1),a="get"+o+"AtOutCoords",u=n.shapeInfo.logicalShape.length,s=t.logicalShape.length,c=ue(n.shapeInfo.logicalShape,t.logicalShape),f=Ao(s),l=s-u,d=["x","y","z","w","u","v"];r=0===u?"":s<2&&c.length>=1?"coords = 0;":c.map((function(n){return"coords."+d[n+l]+" = 0;"})).join("\n"),e=s<2&&u>0?"coords":n.shapeInfo.logicalShape.map((function(n,t){return"coords."+d[t+l]})).join(", ");var h="return outputValue;",v=1===_(n.shapeInfo.logicalShape),p=1===_(t.logicalShape);if(1!==u||v||p){if(v&&!p)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var m=u-2,x=u-1;c.indexOf(m)>-1&&c.indexOf(x)>-1?h="return vec4(outputValue.x);":c.indexOf(m)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(x)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+f+" coords = getOutputCoords();\n      "+r+"\n      vec4 outputValue = get"+o+"("+e+");\n      "+h+"\n    }\n  "}(n,t):function(n,t){var r=n.name,e=r.charAt(0).toUpperCase()+r.slice(1),i="get"+e+"AtOutCoords",o=n.shapeInfo.logicalShape.length,a=t.logicalShape.length;if(!n.shapeInfo.isUniform&&o===a&&null==n.shapeInfo.flatOffset&&O(n.shapeInfo.texShape,t.texShape))return"\n      float "+i+"() {\n        return sampleTexture("+r+", resultUV);\n      }\n    ";var u=Ao(a),s=ue(n.shapeInfo.logicalShape,t.logicalShape),c=a-o,f=["x","y","z","w","u","v"];return"\n    float "+i+"() {\n      "+u+" coords = getOutputCoords();\n      "+(0===o?"":a<2&&s.length>=1?"coords = 0;":s.map((function(n){return"coords."+f[n+c]+" = 0;"})).join("\n"))+"\n      return get"+e+"("+(a<2&&o>0?"coords":n.shapeInfo.logicalShape.map((function(n,t){return"coords."+f[t+c]})).join(", "))+");\n    }\n  "}(n,t)),e}(n,t,e)})).join("\n"),c=t.texShape,f=mo(),l=function(n){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+n.texture2D+"(textureSampler, uv).r;\n    }\n  "}(f),d=function(n){return n.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+n.varyingFs+" vec2 resultUV;\n    "+n.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+n.defineSpecialNaN+"\n    "+n.defineSpecialInf+"\n    "+n.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+go+"\n    "+wo+"\n    "+Co+"\n  "}(f);return t.isPacked?(o=function(n,t){switch(n.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(n,t){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+r[1]+".0);\n      }\n    ":1===r[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+r[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      return 2 * (resTexRC.x * "+r[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(n,t){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(O(n,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+r[0]+", "+r[1]+"));\n      }\n    ";var e=Math.ceil(n[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      int r = 2 * (index / "+e+");\n      int c = imod(index, "+e+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(n,t);case 3:return r=n,e=t,i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=(o=Math.ceil(r[2]/2))*Math.ceil(r[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+o+");\n      int c = imod(index, "+o+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(n,t){for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],e=Math.ceil(n[n.length-1]/2),i=e*Math.ceil(n[n.length-2]/2),o=i,a="",u="b, r, c",s=2;s<n.length-1;s++)a="\n      int b"+s+" = index / "+(o*=n[n.length-s-1])+";\n      index -= b"+s+" * "+o+";\n    "+a,u="b"+s+", "+u;return"\n    ivec"+n.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+e+");\n      int c = imod(index, "+e+") * 2;\n\n      return ivec"+n.length+"("+u+");\n    }\n  "}(n,t)}var r,e,i,o,a}(t.logicalShape,c),a=function(n){return"\n    void setOutput(vec4 val) {\n      "+n.output+" = val;\n    }\n  "}(f)):(o=function(n,t){switch(n.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(n,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(n,t){return O(n,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===n[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===n[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+n[1]+";\n      int c = index - r * "+n[1]+";\n      return ivec2(r, c);\n    }\n  "}(n,t);case 3:return r=t,e=xo(["r","c","d"],n),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      "+e+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(n,t){var r=xo(["r","c","d","d2"],n);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+r+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(n,t);case 5:return function(n,t){var r=xo(["r","c","d","d2","d3"],n);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+r+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(n,t);case 6:return function(n,t){var r=xo(["r","c","d","d2","d3","d4"],n);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+r+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(n,t);default:throw new Error(n.length+"-D output sampling is not yet supported")}var r,e}(t.logicalShape,c),a=function(n){return"\n    void setOutput(float val) {\n      "+n.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(f)),e&&(d+=No),[d,l,a,u,o,s,r].join("\n")}(o,u,i,t.packedInputs),f=n.createProgram(s),l=null,d=n.getUniformLocation(f,"NAN",!1);1===c().getNumber("WEBGL_VERSION")&&(l=n.getUniformLocation(f,"INFINITY",!1));for(var h={},v=0;v<t.variableNames.length;v++){var p=t.variableNames[v];h[p]=n.getUniformLocation(f,p,!1),h["offset"+p]=n.getUniformLocation(f,"offset"+p,!1)}return{program:t,source:s,webGLProgram:f,uniformLocations:h,inShapeInfos:a,outShapeInfo:u,infLoc:l,nanLoc:d}}(o.gpgpu,n,l,h)})),m=null!=this.activeTimers;if(m&&(d=this.startTimer()),function(n,t,r,e,i){La(t.inShapeInfos,r),La([t.outShapeInfo],[e]);var o=e.texData.texture,a=e.texData.texShape;e.texData.isPacked?n.setOutputPackedMatrixTexture(o,a[0],a[1]):n.setOutputMatrixTexture(o,a[0],a[1]),n.setProgram(t.webGLProgram),1===c().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&n.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&n.gl.uniform1f(t.nanLoc,NaN),r.forEach((function(r,e){var i=t.program.variableNames[e],o=t.uniformLocations[i],a=t.uniformLocations["offset"+i];if(null!=o)if(r.isUniform)if(_(r.shape)<2)n.gl.uniform1f(o,r.uniformValues[0]);else{var u=r.uniformValues;u instanceof Float32Array||(u=new Float32Array(u)),n.gl.uniform1fv(o,u)}else null!=r.texData.slice&&null!=a&&n.gl.uniform1i(a,r.texData.slice.flatOffset),n.setInputMatrixTexture(r.texData.texture,o,e)})),null!=i&&i(n,t.webGLProgram),n.executeProgram()}(this.gpgpu,p,l,h,e),f.forEach((function(n){return o.disposeData(n.dataId)})),m&&(d=this.endTimer(d),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(d)})),!c().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var x=this.unpackTensor(a);return this.disposeData(a.dataId),x}return a},t.prototype.compileAndRun=function(n,t,r,e,i){void 0===i&&(i=!1);var o=this.runWebGLProgram(n,t,r=r||t[0].dtype,e,i);return Vn.makeTensorFromDataId(o.dataId,o.shape,o.dtype)},t.prototype.getAndSaveBinary=function(n,t){return n in this.binaryCache||(this.binaryCache[n]=t()),this.binaryCache[n]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var n=this;this.disposed||(c().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){n.gpgpu.deleteProgram(n.binaryCache[t].webGLProgram),delete n.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var n=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Gt((function(){if(!c().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=c().getBool("DEBUG");c().set("DEBUG",!1);var r=n.abs(vr(1e-8)).dataSync()[0];if(c().set("DEBUG",t),r>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(n){var t,r=this.texData.get(n),e=r.shape,i=r.dtype,o=r.values,a=r.usage,u=r.isPacked;if(null==r.texture){var s,c=null!=this.activeTimers;c&&(s=rn());var f=r.texShape;if(null==f&&(f=_t(e,u),r.texShape=f),null!=o){var l=At(e),d=void 0,h=f[1],v=f[0],p=o instanceof Uint8Array;u?(h=(t=$n(f[0],f[1]))[0],d=new va(l,[v=t[1],h],p)):d=new ha(l,[v,h],p);var m=this.makeTensorInfo([v,h],i);this.texData.get(m.dataId).usage=p?Wn.PIXELS:Wn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(m.dataId),h,v,o);var x=this.runWebGLProgram(d,[m],i,null,!0),y=this.texData.get(x.dataId);r.texture=y.texture,r.texShape=y.texShape,r.isPacked=y.isPacked,r.usage=y.usage,this.disposeData(m.dataId),this.texData.delete(x.dataId),r.values=null,c&&(this.uploadWaitMs+=rn()-s)}else{var b=this.acquireTexture(f,a,i,u);r.texture=b}}},t.prototype.convertAndCacheOnCPU=function(n,t){var r=this.texData.get(n),e=r.dtype;return this.releaseGPUData(n),null!=t&&(r.values=function(n,t){if("float32"===t||"complex64"===t)return n;if("int32"===t||"bool"===t){for(var r="int32"===t?new Int32Array(n.length):new Uint8Array(n.length),e=0;e<r.length;++e)r[e]=Math.round(n[e]);return r}throw new Error("Unknown dtype "+t)}(t,e)),r.values},t.prototype.acquireTexture=function(n,t,r,e){if(this.numBytesInGPU+=this.computeBytes(n,r),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,t,e)},t.prototype.computeBytes=function(n,t){return n[0]*n[1]*U(t)},t}(Ti);function Bu(n,t){return n(t={exports:{}},t.exports),t.exports}Pn()&&Vn.registerBackend("webgl",(function(){return new Lu}),2);var Wu=Bu((function(n){!function(n,t){function r(n){var t,r=this,e=(t=4022871197,function(n){n=n.toString();for(var r=0;r<n.length;r++){var e=.02519603282416938*(t+=n.charCodeAt(r));e-=t=e>>>0,t=(e*=t)>>>0,t+=4294967296*(e-=t)}return 2.3283064365386963e-10*(t>>>0)});r.next=function(){var n=2091639*r.s0+2.3283064365386963e-10*r.c;return r.s0=r.s1,r.s1=r.s2,r.s2=n-(r.c=0|n)},r.c=1,r.s0=e(" "),r.s1=e(" "),r.s2=e(" "),r.s0-=e(n),r.s0<0&&(r.s0+=1),r.s1-=e(n),r.s1<0&&(r.s1+=1),r.s2-=e(n),r.s2<0&&(r.s2+=1),e=null}function e(n,t){return t.c=n.c,t.s0=n.s0,t.s1=n.s1,t.s2=n.s2,t}function i(n,t){var i=new r(n),o=t&&t.state,a=i.next;return a.int32=function(){return 4294967296*i.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&e(o,i),a.state=function(){return e(i,{})}),a}t&&t.exports?t.exports=i:this.alea=i}(0,n)})),zu=Bu((function(n){!function(n,t){function r(n){var t=this,r="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var n=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^n^n>>>8},n===(0|n)?t.x=n:r+=n;for(var e=0;e<r.length+64;e++)t.x^=0|r.charCodeAt(e),t.next()}function e(n,t){return t.x=n.x,t.y=n.y,t.z=n.z,t.w=n.w,t}function i(n,t){var i=new r(n),o=t&&t.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var n=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},a.int32=i.next,a.quick=a,o&&("object"==typeof o&&e(o,i),a.state=function(){return e(i,{})}),a}t&&t.exports?t.exports=i:this.xor128=i}(0,n)})),Gu=Bu((function(n){!function(n,t){function r(n){var t=this,r="";t.next=function(){var n=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^n^n<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,n===(0|n)?t.x=n:r+=n;for(var e=0;e<r.length+64;e++)t.x^=0|r.charCodeAt(e),e==r.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function e(n,t){return t.x=n.x,t.y=n.y,t.z=n.z,t.w=n.w,t.v=n.v,t.d=n.d,t}function i(n,t){var i=new r(n),o=t&&t.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var n=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},a.int32=i.next,a.quick=a,o&&("object"==typeof o&&e(o,i),a.state=function(){return e(i,{})}),a}t&&t.exports?t.exports=i:this.xorwow=i}(0,n)})),Uu=Bu((function(n){!function(n,t){function r(n){var t=this;t.next=function(){var n,r,e=t.x,i=t.i;return n=e[i],r=(n^=n>>>7)^n<<24,r^=(n=e[i+1&7])^n>>>10,r^=(n=e[i+3&7])^n>>>3,r^=(n=e[i+4&7])^n<<7,n=e[i+7&7],r^=(n^=n<<13)^n<<9,e[i]=r,t.i=i+1&7,r},function(n,t){var r,e=[];if(t===(0|t))e[0]=t;else for(t=""+t,r=0;r<t.length;++r)e[7&r]=e[7&r]<<15^t.charCodeAt(r)+e[r+1&7]<<13;for(;e.length<8;)e.push(0);for(r=0;r<8&&0===e[r];++r);for(8==r&&(e[7]=-1),n.x=e,n.i=0,r=256;r>0;--r)n.next()}(t,n)}function e(n,t){return t.x=n.x.slice(),t.i=n.i,t}function i(n,t){null==n&&(n=+new Date);var i=new r(n),o=t&&t.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var n=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},a.int32=i.next,a.quick=a,o&&(o.x&&e(o,i),a.state=function(){return e(i,{})}),a}t&&t.exports?t.exports=i:this.xorshift7=i}(0,n)})),qu=Bu((function(n){!function(n,t){function r(n){var t=this;t.next=function(){var n,r,e=t.w,i=t.X,o=t.i;return t.w=e=e+1640531527|0,r=i[o+34&127],n=i[o=o+1&127],r^=r<<13,n^=n<<17,r=i[o]=(r^=r>>>15)^(n^=n>>>12),t.i=o,r+(e^e>>>16)|0},function(n,t){var r,e,i,o,a,u=[],s=128;for(t===(0|t)?(e=t,t=null):(t+="\0",e=0,s=Math.max(s,t.length)),i=0,o=-32;o<s;++o)t&&(e^=t.charCodeAt((o+32)%t.length)),0===o&&(a=e),e^=e<<10,e^=e>>>15,e^=e<<4,e^=e>>>13,o>=0&&(i=0==(r=u[127&o]^=e+(a=a+1640531527|0))?i+1:0);for(i>=128&&(u[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)e=u[i+34&127],r=u[i=i+1&127],e^=e<<13,r^=r<<17,u[i]=(e^=e>>>15)^(r^=r>>>12);n.w=a,n.X=u,n.i=i}(t,n)}function e(n,t){return t.i=n.i,t.w=n.w,t.X=n.X.slice(),t}function i(n,t){null==n&&(n=+new Date);var i=new r(n),o=t&&t.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var n=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},a.int32=i.next,a.quick=a,o&&(o.X&&e(o,i),a.state=function(){return e(i,{})}),a}t&&t.exports?t.exports=i:this.xor4096=i}(0,n)})),ju=Bu((function(n){!function(n,t){function r(n){var t=this,r="";t.next=function(){var n=t.b,r=t.c,e=t.d,i=t.a;return n=n<<25^n>>>7^r,r=r-e|0,e=e<<24^e>>>8^i,i=i-n|0,t.b=n=n<<20^n>>>12^r,t.c=r=r-e|0,t.d=e<<16^r>>>16^i,t.a=i-n|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,n===Math.floor(n)?(t.a=n/4294967296|0,t.b=0|n):r+=n;for(var e=0;e<r.length+20;e++)t.b^=0|r.charCodeAt(e),t.next()}function e(n,t){return t.a=n.a,t.b=n.b,t.c=n.c,t.d=n.d,t}function i(n,t){var i=new r(n),o=t&&t.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var n=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},a.int32=i.next,a.quick=a,o&&("object"==typeof o&&e(o,i),a.state=function(){return e(i,{})}),a}t&&t.exports?t.exports=i:this.tychei=i}(0,n)})),Hu=Bu((function(n){!function(t,r){var e,i=this,o=256,a=r.pow(o,6),u=r.pow(2,52),s=2*u,c=255;function f(n,c,f){var p=[],m=h(function n(t,r){var e,i=[],o=typeof t;if(r&&"object"==o)for(e in t)try{i.push(n(t[e],r-1))}catch(n){}return i.length?i:"string"==o?t:t+"\0"}((c=1==c?{entropy:!0}:c||{}).entropy?[n,v(t)]:null==n?function(){try{var n;return e&&(n=e.randomBytes)?n=n(o):(n=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(n)),v(n)}catch(n){var r=i.navigator,a=r&&r.plugins;return[+new Date,i,a,i.screen,v(t)]}}():n,3),p),x=new l(p),y=function(){for(var n=x.g(6),t=a,r=0;n<u;)n=(n+r)*o,t*=o,r=x.g(1);for(;n>=s;)n/=2,t/=2,r>>>=1;return(n+r)/t};return y.int32=function(){return 0|x.g(4)},y.quick=function(){return x.g(4)/4294967296},y.double=y,h(v(x.S),t),(c.pass||f||function(n,t,e,i){return i&&(i.S&&d(i,x),n.state=function(){return d(x,{})}),e?(r.random=n,t):n})(y,m,"global"in c?c.global:this==r,c.state)}function l(n){var t,r=n.length,e=this,i=0,a=e.i=e.j=0,u=e.S=[];for(r||(n=[r++]);i<o;)u[i]=i++;for(i=0;i<o;i++)u[i]=u[a=c&a+n[i%r]+(t=u[i])],u[a]=t;(e.g=function(n){for(var t,r=0,i=e.i,a=e.j,u=e.S;n--;)t=u[i=c&i+1],r=r*o+u[c&(u[i]=u[a=c&a+t])+(u[a]=t)];return e.i=i,e.j=a,r})(o)}function d(n,t){return t.i=n.i,t.j=n.j,t.S=n.S.slice(),t}function h(n,t){for(var r,e=n+"",i=0;i<e.length;)t[c&i]=c&(r^=19*t[c&i])+e.charCodeAt(i++);return v(t)}function v(n){return String.fromCharCode.apply(0,n)}if(r.seedrandom=f,h(r.random(),t),n.exports){n.exports=f;try{e=require("crypto")}catch(n){}}}([],Math)}));Hu.alea=Wu,Hu.xor128=zu,Hu.xorwow=Gu,Hu.xorshift7=Uu,Hu.xor4096=qu,Hu.tychei=ju;var Xu=Hu.alea,$u=sr({addN_:function(n){N(Array.isArray(n),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),N(n.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length}));var t=n.map((function(n,t){return Yt(n,"tensors"+t,"addN")})),r=t[0];return t.forEach((function(n){if(n.dtype!==r.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(n){if(!O(n.shape,r.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")})),Vn.runKernelFunc((function(n){return n.addN(t)}),t,null,"AddN")}});function Ku(){zt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Yu(n){return 0===n.rank||1===n.rank?n.as4D(1,1,1,n.size):2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Ju(n,t,r,e,i,o){null==o&&(o=.001);var a,u,s=Yt(n,"x","batchNorm"),c=Yt(t,"mean","batchNorm"),f=Yt(r,"variance","batchNorm");return null!=i&&(a=Yt(i,"scale","batchNorm")),null!=e&&(u=Yt(e,"offset","batchNorm")),N(c.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),N(null==u||c.rank===u.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),N(null==a||c.rank===a.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),Vn.runKernelFunc((function(n,t){var r=Yu(s),e=n.batchNormalization(r,Zu(c),Zu(f),o,Zu(a),Zu(u));return t([s,c,f,a]),e}),{x:s,scale:a,offset:u,mean:c,variance:f},null,"FusedBatchNorm",{varianceEpsilon:o}).reshape(s.shape)}function Zu(n){return null==n?null:0===n.rank?n.as1D():1===n.rank?n:2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}var Qu=sr({batchNormalization_:function(n,t,r,e,i,o){return void 0===e&&(e=.001),Ku(),Ju(n,t,r,o,i,e)}}),ns=sr({batchNorm_:Ju});function ts(n,t,r,e,i,o){var a,u,s=Yt(n,"x","batchNorm"),c=Yt(t,"mean","batchNorm"),f=Yt(r,"variance","batchNorm");return null!=i&&(a=Yt(i,"scale","batchNorm")),null!=e&&(u=Yt(e,"offset","batchNorm")),N(2===s.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+s.rank+"."})),N(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),N(2===f.rank||1===f.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+f.rank+"."})),null!=a&&N(2===a.rank||1===a.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."})),null!=u&&N(2===u.rank||1===u.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."})),ns(s,c,f,u,a,o)}var rs=sr({batchNormalization2d_:function(n,t,r,e,i,o){return void 0===e&&(e=.001),Ku(),ts(n,t,r,o,i,e)}}),es=sr({batchNorm2d_:ts});function is(n,t,r,e,i,o){var a,u,s=Yt(n,"x","batchNorm"),c=Yt(t,"mean","batchNorm"),f=Yt(r,"variance","batchNorm");return null!=i&&(a=Yt(i,"scale","batchNorm")),null!=e&&(u=Yt(e,"offset","batchNorm")),N(3===s.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+s.rank+"."})),N(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),N(3===f.rank||1===f.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+f.rank+"."})),null!=a&&N(3===a.rank||1===a.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."})),null!=u&&N(3===u.rank||1===u.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."})),ns(s,c,f,u,a,o)}var os=sr({batchNormalization3d_:function(n,t,r,e,i,o){return void 0===e&&(e=.001),Ku(),is(n,t,r,o,i,e)}}),as=sr({batchNorm3d_:is});function us(n,t,r,e,i,o){var a,u,s=Yt(n,"x","batchNorm"),c=Yt(t,"mean","batchNorm"),f=Yt(r,"variance","batchNorm");return null!=i&&(a=Yt(i,"scale","batchNorm")),null!=e&&(u=Yt(e,"offset","batchNorm")),N(4===s.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+s.rank+"."})),N(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),N(4===f.rank||1===f.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+f.rank+"."})),null!=a&&N(4===a.rank||1===a.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."})),null!=u&&N(4===u.rank||1===u.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."})),ns(s,c,f,u,a,o)}var ss=sr({batchNormalization4d_:function(n,t,r,e,i,o){return void 0===e&&(e=.001),Ku(),us(n,t,r,o,i,e)}}),cs=sr({batchNorm4d_:us}),fs=sr({broadcastTo_:function(n,t){var r=Yt(n,"broadcastTo","x"),e=r.shape;if(t.some((function(n){return!(n>0)||n%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<r.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+r.rank+".");if(t.length>r.rank){for(var i=r.shape.slice();i.length<t.length;)i.unshift(1);r=r.reshape(i)}for(var o=r.shape,a=Array.from(t),u=t.length-1;u>=0;u--)if(o[u]===t[u])a[u]=1;else if(1!==r.shape[u])throw new Error("broadcastTo(): ["+e+"] cannot be broadcast to ["+t+"].");var s=a.map((function(n,t){return n>1?t:-1})).filter((function(n){return n>=0}));return 0===s.length?r.clone():Vn.runKernelFunc((function(n){return n.tile(r,a)}),{x:r},(function(n){return{x:function(){return n.sum(s,!0)}}}),te,{shape:t,inputShape:o})}}),ls=sr({clone_:function(n){var t=Yt(n,"x","clone",null);return Vn.runKernelFunc((function(){return Vn.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,ee)}}),ds=sr({logicalAnd_:function(n,t){var r=Yt(n,"a","logicalAnd","bool"),e=Yt(t,"b","logicalAnd","bool");return ce(r.shape,e.shape),Vn.runKernelFunc((function(n){return n.logicalAnd(r,e)}),{a:r,b:e},null,"LogicalAnd")}}),hs=sr({logicalNot_:function(n){var t=Yt(n,"x","logicalNot","bool");return Vn.runKernelFunc((function(n){return n.logicalNot(t)}),{$x:t})}}),vs=sr({logicalOr_:function(n,t){var r=Yt(n,"a","logicalOr","bool"),e=Yt(t,"b","logicalOr","bool");return ce(r.shape,e.shape),Vn.runKernelFunc((function(n){return n.logicalOr(r,e)}),{$a:r,$b:e})}}),ps=sr({logicalXor_:function(n,t){var r=Yt(n,"a","logicalXor","bool"),e=Yt(t,"b","logicalXor","bool");return ce(r.shape,e.shape),vs(n,t).logicalAnd(ds(n,t).logicalNot())}}),ms=sr({where_:function(n,t,r){var e=Yt(t,"a","where"),i=Yt(r,"b","where"),o=Yt(n,"condition","where","bool");return E(e.shape,i.shape,"Error in where: "),1===o.rank?N(o.shape[0]===e.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):E(o.shape,i.shape,"Error in where: "),Vn.runKernelFunc((function(n,t){var r=n.select(o,e,i);return t([o]),r}),{$condition:o,$a:e,$b:i},(function(n,t){var r=t[0];return{$condition:function(){return Or(r).toFloat()},$a:function(){return n.mul(r.cast(n.dtype))},$b:function(){return n.mul(r.logicalNot().cast(n.dtype))}}}))}}),xs=function(n){return o(this,void 0,void 0,(function(){var t,r,e;return a(this,(function(i){switch(i.label){case 0:return[4,(t=Yt(n,"condition","whereAsync","bool")).data()];case 1:return r=i.sent(),e=co(t.shape,r),n!==t&&t.dispose(),[2,e]}}))}))},ys=sr({divNoNan_:function(n,t){var r,e=Yt(n,"a","div"),i=Yt(t,"b","div");e=(r=Sn(e,i))[0];var o=ui(e,i=r[1]),a=Or(o),u=i.equal(a);return ms(u,a,o)}}),bs=sr({tile_:function(n,t){var r=Yt(n,"x","tile",null);return N(r.rank===t.length,(function(){return"Error in transpose: rank of input "+r.rank+" must match length of reps "+t+"."})),Vn.runKernelFunc((function(n,e){var i=n.tile(r,t);return e([r]),i}),{x:r},null,ie,{reps:t},[r])}}),gs=sr({eye_:function(n,t,r,e){void 0===e&&(e="float32"),null==t&&(t=n);for(var i=Fr([n,t],e),o=n<=t?n:t,a=0;a<o;++a)i.set(1,a,a);var u=i.toTensor().as2D(n,t);if(null==r)return u;if(1===r.length)return bs(zr(u,0),[r[0],1,1]);if(2===r.length)return bs(zr(zr(u,0),0),[r[0],r[1],1,1]);if(3===r.length)return bs(zr(zr(zr(u,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+r.length+"D.")}}),ws=sr({multinomial_:function(n,t,r,e){void 0===e&&(e=!1);var i=Yt(n,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);r=r||Math.random();var u=1===a?i.as2D(1,-1):i,s=Vn.runKernelFunc((function(n){return n.multinomial(u,e,t,r)}),{logits2D:u});return 1===a?s.as1D():s}}),Cs=sr({oneHot_:function(n,t,r,e){if(void 0===r&&(r=1),void 0===e&&(e=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=Yt(n,"indices","oneHot","int32"),o=i.shape.concat([t]),a={indices:i=i.flatten()};return Vn.runKernelFunc((function(n,o){return o([i]),n.oneHot(i,t,r,e)}),a,null,re,{depth:t,onValue:r,offValue:e}).reshape(o)}}),Ns=sr({pad_:function(n,t,r){void 0===r&&(r=0);var e=Yt(n,"x","pad");if(0===e.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Vn.runKernelFunc((function(n,i){return i([e]),n.pad(e,t,r)}),{x:e},null,oe,{paddings:t,constantValue:r})}}),Es=sr({pad1d_:function(n,t,r){return void 0===r&&(r=0),N(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Ns(n,[t],r)}}),Rs=sr({pad2d_:function(n,t,r){return void 0===r&&(r=0),N(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Ns(n,t,r)}}),As=sr({pad3d_:function(n,t,r){return void 0===r&&(r=0),N(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Ns(n,t,r)}}),_s=sr({pad4d_:function(n,t,r){return void 0===r&&(r=0),N(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Ns(n,t,r)}}),Os=sr({rand_:function(n,t,r){var e=_(n),i=null;if(null==r||"float32"===r)i=new Float32Array(e);else if("int32"===r)i=new Int32Array(e);else{if("bool"!==r)throw new Error("Unknown data type "+r);i=new Uint8Array(e)}for(var o=0;o<e;o++)i[o]=t();return Vn.makeTensor(i,n,r)}});function Ss(){return 32===Vn.backend.floatPrecision()?.001:.1}function Ts(n,t,r){var e=!0;if((G(n)||G(t))&&(e=!1),G(n)&&G(t)&&(e=!0),e){var i=n.constructor.name,o=t.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(n)&&Array.isArray(t)){var a=$t(n),u=$t(t);if(!O(a,u))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+u+"]")}var s=G(n)?n:A(n),c=G(t)?t:A(t);if(s.length!==c.length)throw new Error("Arrays have different lengths actual: "+s.length+" vs expected: "+c.length+".\nActual:   "+s+".\nExpected: "+c+".");for(var f=0;f<c.length;++f){var l=s[f],d=c[f];if(!r(l,d))throw new Error("Arrays differ: actual["+f+"] = "+l+", expected["+f+"] = "+d+".\nActual:   "+s+".\nExpected: "+c+".")}}function Is(n,t,r){return!isFinite(n)&&!isFinite(t)||!(isNaN(n)||isNaN(t)||Math.abs(n-t)>r)}var Ms=Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(n,t,r){return null==r&&(r=Ss()),Ts(n,t,(function(n,t){return Is(n,t,r)}))},testEpsilon:Ss,expectPromiseToFail:function(n,t){n().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(n,t){var r="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return j(n)||j(n[0])||j(t)||j(t[0])?Ts(n,r,(function(n,t){return n==t})):Ts(n,t,(function(n,t){return Is(n,t,0)}))},expectNumbersClose:function(n,t,r){if(null==r&&(r=Ss()),!Is(n,t,r))throw new Error("Numbers differ: actual === "+n+", expected === "+t)},expectValuesInRange:function(n,t,r){for(var e=0;e<n.length;e++)if(n[e]<t||n[e]>r)throw new Error("Value out of range:"+n[e]+" low: "+t+", high: "+r)},expectArrayBuffersEqual:function(n,t){expect(new Float32Array(n)).toEqual(new Float32Array(t))}}),ks=function(){function n(n,t,r,e,i){this.mean=n,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=e,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Xu(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var t,r,e=!1;!e;){var i=void 0,o=void 0,a=void 0;do{a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o}while(a>=1||0===a);var u=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*o*u,this.truncated&&!this.isValidTruncated(t)||(e=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(n){return null==this.dtype||"float32"===this.dtype?n:Math.round(n)},n.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},n}(),Ds=function(){function n(n,t,r,e){this.alpha=n,this.beta=1/t,this.dtype=r;var i=e||Math.random();this.randu=Xu(i.toString()),this.randn=new ks(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var n,t,r,e,i,o;;){do{e=this.randn.nextValue(),o=1+this.c*e}while(o<=0);if(t=1-.331*(n=e*e)*n,r=.5*n+this.d*(1-(o*=o*o)+Math.log(o)),(i=this.randu())<t||Math.log(i)<r)break}return o*=1/this.beta*this.d,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(n){return"float32"===this.dtype?n:Math.round(n)},n}(),Fs=function(){function n(n,t,r,e){var i=this;if(void 0===n&&(n=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=n,this.range=t-n,this.dtype=r,null==e&&(e=Math.random()),"number"==typeof e&&(e=e.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+t+" <= 1 and dtype is not float");this.random=Xu(e)}return n.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}(),Vs=sr({randomGamma_:function(n,t,r,e,i){if(void 0===r&&(r=1),void 0===e&&(e="float32"),null==r&&(r=1),null==e&&(e="float32"),"float32"!==e&&"int32"!==e)throw new Error("Unsupported data type "+e);for(var o=new Ds(t,r,e,i),a=Fr(n,e),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),Ps=sr({randomNormal_:function(n,t,r,e,i){if(void 0===t&&(t=0),void 0===r&&(r=1),null!=e&&"bool"===e)throw new Error("Unsupported data type "+e);for(var o=new ks(t,r,e,!1,i),a=Fr(n,e),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),Ls=sr({randomUniform_:function(n,t,r,e,i){void 0===t&&(t=0),void 0===r&&(r=1),void 0===e&&(e="float32");for(var o=Fr(n,e),a=new Fs(t,r,null,i),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),Bs=sr({square_:function(n){var t=Yt(n,"x","square");return Vn.runKernelFunc((function(n,r){return r([t]),n.square(t)}),{x:t},null,"Square",{},[t],[])}}),Ws=sr({squaredDifference_:function(n,t){var r,e=Yt(n,"a","squaredDifference"),i=Yt(t,"b","squaredDifference");return r=Sn(e,i),ce((e=r[0]).shape,(i=r[1]).shape),Vn.runKernelFunc((function(n,t){var r=n.squaredDifference(e,i);return t([e,i]),r}),{a:e,b:i},(function(n,t){var r=t[0],e=t[1],i=vr(2);return{a:function(){return n.mul(r.sub(e).mul(i))},b:function(){return n.mul(e.sub(r).mul(i))}}}),ne,{},[e,i],[])}}),zs=sr({truncatedNormal_:function(n,t,r,e,i){if(void 0===t&&(t=0),void 0===r&&(r=1),null!=e&&"bool"===e)throw new Error("Unsupported data type $ { dtype }");for(var o=new ks(t,r,e,!0,i),a=Fr(n,e),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),Gs=sr({equal_:function(n,t){var r,e=Yt(n,"a","equal"),i=Yt(t,"b","equal");return r=Sn(e,i),ce((e=r[0]).shape,(i=r[1]).shape),Vn.runKernelFunc((function(n){return n.equal(e,i)}),{$a:e,$b:i})}}),Us=sr({equalStrict_:function(n,t){var r=Yt(n,"a","equalStrict"),e=Yt(t,"b","equalStrict");return E(r.shape,e.shape,"Error in equalStrict: "),r.equal(e)}}),qs=sr({greater_:function(n,t){var r,e=Yt(n,"a","greater"),i=Yt(t,"b","greater");return r=Sn(e,i),ce((e=r[0]).shape,(i=r[1]).shape),Vn.runKernelFunc((function(n){return n.greater(e,i)}),{a:e,b:i},null,"Greater")}}),js=sr({greaterEqual_:function(n,t){var r,e=Yt(n,"a","greaterEqual"),i=Yt(t,"b","greaterEqual");return r=Sn(e,i),ce((e=r[0]).shape,(i=r[1]).shape),Vn.runKernelFunc((function(n,t){var r=n.greaterEqual(e,i);return t([e,i]),r}),{a:e,b:i},(function(n,t){var r=t[0],e=t[1];return{a:function(){return Or(r)},b:function(){return Or(e)}}}),"GreaterEqual")}}),Hs=sr({greaterEqualStrict_:function(n,t){var r=Yt(n,"a","greaterEqualStrict"),e=Yt(t,"b","greaterEqualStrict");return E(r.shape,e.shape,"Error in greaterEqualStrict: "),r.greaterEqual(e)}}),Xs=sr({greaterStrict_:function(n,t){var r=Yt(n,"a","greaterStrict"),e=Yt(t,"b","greaterStrict");return E(r.shape,e.shape,"Error in greaterStrict: "),r.greater(e)}}),$s=sr({less_:function(n,t){var r,e=Yt(n,"a","less"),i=Yt(t,"b","less");return r=Sn(e,i),ce((e=r[0]).shape,(i=r[1]).shape),Vn.runKernelFunc((function(n){return n.less(e,i)}),{a:e,b:i},null,"Less")}}),Ks=sr({lessEqual_:function(n,t){var r,e=Yt(n,"a","lessEqual"),i=Yt(t,"b","lessEqual");return r=Sn(e,i),ce((e=r[0]).shape,(i=r[1]).shape),Vn.runKernelFunc((function(n,t){var r=n.lessEqual(e,i);return t([e,i]),r}),{a:e,b:i},null,"LessEqual")}}),Ys=sr({lessEqualStrict_:function(n,t){var r=Yt(n,"a","lessEqualStrict"),e=Yt(t,"b","lessEqualStrict");return E(r.shape,e.shape,"Error in lessEqualStrict: "),r.lessEqual(e)}}),Js=sr({lessStrict_:function(n,t){var r=Yt(n,"a","lessStrict"),e=Yt(t,"b","lessStrict");return E(r.shape,e.shape,"Error in lessStrict: "),r.less(e)}}),Zs=sr({notEqual_:function(n,t){var r,e=Yt(n,"a","notEqual"),i=Yt(t,"b","notEqual");return r=Sn(e,i),ce((e=r[0]).shape,(i=r[1]).shape),Vn.runKernelFunc((function(n){return n.notEqual(e,i)}),{a:e,b:i},null,"NotEqual")}}),Qs=sr({notEqualStrict_:function(n,t){var r=Yt(n,"a","notEqualStrict"),e=Yt(t,"b","notEqualStrict");return E(r.shape,e.shape,"Error in notEqualStrict: "),r.notEqual(e)}});function nc(n,t){for(var r=[],e=n;e<t;++e)r.push(e);return r}function tc(n){for(var t=[],r=0;r<n.length;++r)for(var e=0;e<n[r].length;++e)t.push(n[r][e]);return t}var rc=sr({gather_:function(n,t,r){void 0===r&&(r=0);var e=Yt(n,"x","gather"),i=Yt(t,"indices","gather","int32");r=F(r,e.shape)[0];var o=function(n,t,r){for(var e=n.shape[r],i=[],o=1,a=1,u=0;u<r;u++)i.push(n.shape[u]),o*=n.shape[u];for(u=0;u<t.rank;u++)i.push(t.shape[u]);for(u=r+1;u<n.rank;u++)i.push(n.shape[u]),a*=n.shape[u];return{batchSize:o,sliceSize:a,dimSize:e,outputShape:i}}(e,i,r);return Vn.runKernelFunc((function(n,t){var o=n.gather(e,i.flatten(),r);return t([i]),o}),{x:e,indices:i},(function(n,t){var i=t[0];return{x:function(){var t=e.shape,o=i.size,a=t.slice(0,r),u=a.length,s=t.slice(r,t.length).slice(1),c=s.length,f=nc(0,u),l=nc(u+1,u+1+c),d=tc([a,[o],s]),h=n.reshape(d),v=i.reshape([o]),p=tc([[u],f,l]),m=h.transpose(p),x=ec(m,v,e.shape[r]),y=ir(p);return x.transpose(y)},indices:function(){return i}}}),"Gather",{axis:r}).reshape(o.outputShape)}}),ec=sr({unsortedSegmentSum_:function(n,t,r){var e=Yt(n,"x","unsortedSegmentSum"),i=Yt(t,"segmentIds","unsortedSegmentSum","int32");return N(S(r),(function(){return"numSegments must be of dtype int"})),Vn.runKernelFunc((function(n,t){var o=n.unsortedSegmentSum(e,i,r);return t([i]),o}),{$x:e},(function(n,t){var r=t[0];return{$x:function(){return function(n,t){for(var r=$e(t,Or(t)),e=rc(n,r),i=js(t,vr(0,"int32")),o=e.rank-i.rank,a=0;a<o;++a)i=zr(i,a+1);i=ds(i,Cr(e.shape,"bool"));var u=Or(e);return ms(i,e,u)}(n,r)}}}))}}),ic=function(n,t,r){return o(this,void 0,void 0,(function(){var e,i,o,u,s,c,f,l,d,h,v,p,m;return a(this,(function(a){switch(a.label){case 0:for(e=Yt(n,"tensor","boolMask"),i=Yt(t,"mask","boolMask","bool"),o=null==r?0:r,s=e.shape,N((u=i.rank)>0,(function(){return"mask cannot be scalar"})),E(s.slice(o,o+u),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,f=o;f<o+u;f++)c*=s[f];return l=s.slice(0,o).concat([c],s.slice(o+u)),d=e.reshape(l),h=i.reshape([-1]),[4,xs(h)];case 1:return v=a.sent(),p=v.squeeze([1]),m=rc(d,p,o),n!==e&&e.dispose(),t!==i&&i.dispose(),p.dispose(),d.dispose(),h.dispose(),v.dispose(),[2,m]}}))}))};function oc(n,t,r,e,i,o,a){void 0===o&&(o="NHWC"),N(n.length===t.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"}));var u=n,s=t,c=!1;3===t.rank&&(c=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),u=[1,n[0],n[1],n[2]]),N(4===u.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."})),N(4===s.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank})),N(4===r.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+r.rank}));var f="NHWC"===o?u[3]:u[1],l="NHWC"===o?s.shape[3]:s.shape[1];N(f===r.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+f+") must match input depth for filter "+r.shape[2]+"."})),N(l===r.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+l+") must match output depth for filter "+r.shape[3]+"."})),null!=a&&N(S(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var d=Ui(o),h=Di(u,r.shape,e,1,i,a,!1,d),v=Vn.runKernelFunc((function(n,t){var e=n.conv2dDerInput(s,r,h);return t([r,s]),e}),{dy4D:s,filter:r},(function(n,t){var r=t[0],u=t[1];return{dy4D:function(){return cc(n,r,e,i,o,1,a)},filter:function(){return lc(n,u,r.shape,e,i,o,a)}}}));return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function ac(n){var t=function(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}(n);return 1===t[0]&&1===t[1]&&1===t[2]}function uc(n,t,r,e,i){N(n.length===t.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"}));var o=n,a=t,u=!1;4===t.rank&&(u=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var s=o[4],c=a.shape[4];N(5===o.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."})),N(5===a.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank})),N(5===r.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+r.rank})),N(s===r.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+s+") must match input depth for filter "+r.shape[3]+"."})),N(c===r.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+r.shape[4]+"."}));var f=Fi(o,r.shape,e,1,i),l=Vn.runKernelFunc((function(n){return n.conv3dDerInput(a,r,f)}),{dy5D:a});return u?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}var sc=sr({conv1d_:function(n,t,r,e,i,o,a){void 0===i&&(i="NWC"),void 0===o&&(o=1);var u=Yt(n,"x","conv1d"),s=Yt(t,"filter","conv1d"),c=u,f=!1;2===u.rank&&(f=!0,c=u.as3D(1,u.shape[0],u.shape[1])),N(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),N(3===s.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+s.rank+"."})),null!=a&&N(S(e),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."})),N(c.shape[2]===s.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+s.shape[1]+"."})),N(Gi(r,o),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+r+" and dilation '"+o+"'"})),N("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=cc(d,l,[1,r],e,"NHWC",[1,o],a);return f?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),cc=sr({conv2d_:function(n,t,r,e,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var u=Yt(n,"x","conv2d"),s=Yt(t,"filter","conv2d"),c=u,f=!1;3===u.rank&&(f=!0,c=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),N(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),N(4===s.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+s.rank+"."})),null!=a&&N(S(e),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."}));var l="NHWC"===i?c.shape[3]:c.shape[1];N(l===s.shape[2],(function(){return"Error in conv2d: depth of input ("+l+") must match input depth for filter "+s.shape[2]+"."})),N(Gi(r,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}));var d=Ui(i),h=Di(c.shape,s.shape,r,o,e,a,!1,d),v=Vn.runKernelFunc((function(n,t){var r=n.conv2d(c,s,h);return t([s,c]),r}),{x:c,filter:s},(function(n,t){var a=t[0],u=t[1];return N(zi(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return dc(u.shape,n,a,r,e,i)},filter:function(){return lc(u,n,a.shape,r,e,i)}}}),"Conv2D",h,[s,c]);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),fc=sr({conv3d_:function(n,t,r,e,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var a=Yt(n,"x","conv3d"),u=Yt(t,"filter","conv3d"),s=a,c=!1;4===a.rank&&(c=!0,s=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),N(5===s.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+s.rank+"."})),N(5===u.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."})),N(s.shape[4]===u.shape[3],(function(){return"Error in conv3d: depth of input ("+s.shape[4]+") must match input depth for filter "+u.shape[3]+"."})),N(function(n,t){return ac(n)||ac(t)}(r,o),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"})),N("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var f=Fi(s.shape,u.shape,r,o,e),l=Vn.runKernelFunc((function(n,t){var r=n.conv3d(s,u,f);return t([s,u]),r}),{x:s,$filter:u},(function(n,t){N(ac(o),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}));var i=t[0],a=t[1];return{x:function(){return uc(i.shape,n,a,r,e)},$filter:function(){return function(n,t,r,e,i){var o=n;4===n.rank&&(o=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]));var a=t;4===a.rank&&(a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),N(5===o.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+o.shape+"."})),N(5===a.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."})),N(5===r.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+r+"."})),N(o.shape[4]===r[3],(function(){return"Error in conv3dDerFilter: depth of input "+o.shape[4]+") must match input depth in filter ("+r[3]+"."})),N(a.shape[4]===r[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+r[4]+")."}));var u=Fi(o.shape,r,e,1,i);return Vn.runKernelFunc((function(n){return n.conv3dDerFilter(o,a,u)}),{x5D:o,dy5D:a})}(i,n,a.shape,r,e)}}}));return c?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),lc=sr({conv2dDerFilter_:function(n,t,r,e,i,o,a){void 0===o&&(o="NHWC");var u=n;3===n.rank&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=t;3===s.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),N(4===u.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."})),N(4===s.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."})),N(4===r.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+r+"."}));var c="NHWC"===o?u.shape[3]:u.shape[1],f="NHWC"===o?s.shape[3]:s.shape[1];N(c===r[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+r[2]+"."})),N(f===r[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+f+") must match output depth for filter ("+r[3]+")."})),null!=a&&N(S(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var l=Ui(o),d=Di(u.shape,r,e,1,i,a,!1,l);return Vn.runKernelFunc((function(n){return n.conv2dDerFilter(u,s,d)}),{x4D:u,dy4D:s})}}),dc=sr({conv2dDerInput_:oc}),hc=sr({depthwiseConv2d_:function(n,t,r,e,i,o,a){void 0===o&&(o=[1,1]);var u=Yt(n,"x","depthwiseConv2d"),s=Yt(t,"filter","depthwiseConv2d"),c=u,f=!1;3===u.rank&&(f=!0,c=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),N(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),N(4===s.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+s.rank+"."})),N(c.shape[3]===s.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+s.shape[2]+"."})),null==o&&(o=[1,1]),N(Gi(r,o),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"})),null!=a&&N(S(e),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."}));var l=Di(c.shape,s.shape,r,o,e,a,!0),d=Vn.runKernelFunc((function(n,t){var r=n.depthwiseConv2D(c,s,l);return t([c,s]),r}),{x:c,filter:s},(function(n,t){N(zi(o),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"}));var r=t[0],e=t[1];return{x:function(){return vc(r.shape,n,e,l)},filter:function(){return pc(r,n,e.shape,l)}}}),"DepthwiseConv2dNative",l,[c,s]);return f?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),vc=sr({depthwiseConv2dDerInput_:function(n,t,r,e){var i=t,o=!1;3===t.rank&&(o=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=Vn.runKernelFunc((function(n){return n.depthwiseConv2DDerInput(i,r,e)}),{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),pc=sr({depthwiseConv2dDerFilter_:function(n,t,r,e){var i=n;3===n.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=t;return 3===o.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Vn.runKernelFunc((function(n){return n.depthwiseConv2DDerFilter(i,o,e)}),{x4D:i,dy4D:o})}}),mc=sr({separableConv2d_:function(n,t,r,e,i,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var u=Yt(n,"x","separableConv2d"),s=Yt(t,"depthwiseFilter","separableConv2d"),c=Yt(r,"pointwiseFilter","separableConv2d"),f=u,l=!1;if(3===u.rank&&(l=!0,f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");N(4===f.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+f.rank+"."})),N(4===s.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+s.rank+"."})),N(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+s.rank+"."})),N(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),N(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var d=s.shape[2],h=s.shape[3];N(c.shape[2]===d*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+c.shape[2]+"."}));var v=hc(f,s,e,i,a,o),p=cc(v,c,1,"valid",a);return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),xc=sr({conv2dTranspose_:function(n,t,r,e,i,o){return oc(r,Yt(n,"x","conv2dTranspose"),Yt(t,"filter","conv2dTranspose"),e,i,"NHWC",o)}}),yc=sr({conv3dTranspose_:function(n,t,r,e,i){return uc(r,Yt(n,"x","conv3dTranspose"),Yt(t,"filter","conv3dTranspose"),e,i)}}),bc=sr({matMul_:function(n,t,r,e){var i;void 0===r&&(r=!1),void 0===e&&(e=!1);var o=Yt(n,"a","matMul"),a=Yt(t,"b","matMul");i=Sn(o,a),o=i[0],a=i[1];var u=r?o.shape[o.rank-2]:o.shape[o.rank-1],s=e?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],f=e?a.shape[a.rank-2]:a.shape[a.rank-1],l=o.shape.slice(0,-2),d=a.shape.slice(0,-2),h=_(l),v=_(d);N(o.rank>=2&&a.rank>=2&&o.rank===a.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."})),N(O(l,d),(function(){return"Error in matMul: outer dimensions ("+l+") and ("+d+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."})),N(u===s,(function(){return"Error in matMul: inner shapes ("+u+") and ("+s+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+r+" and transposeB="+e+" must match."}));var p=o.shape.slice(0,-2).concat([c,f]),m=r?o.as3D(h,u,c):o.as3D(h,c,u),x=e?a.as3D(v,f,s):a.as3D(v,s,f);return Vn.runKernelFunc((function(n,t){var i=n.batchMatMul(m,x,r,e);return t([m,x]),i}),{a:m,b:x},(function(n,t){var i=t[0],o=t[1];return r||e?!r&&e?{a:function(){return n.matMul(o,!1,!1)},b:function(){return n.matMul(i,!0,!1)}}:r&&!e?{a:function(){return o.matMul(n,!1,!0)},b:function(){return i.matMul(n,!1,!1)}}:{a:function(){return o.matMul(n,!0,!0)},b:function(){return n.matMul(i,!0,!0)}}:{a:function(){return n.matMul(o,!1,!0)},b:function(){return i.matMul(n,!0,!1)}}}),"BatchMatMul",{transposeA:r,transposeB:e}).reshape(p)}}),gc=sr({dot_:function(n,t){var r=Yt(n,"t1","dot"),e=Yt(t,"t2","dot");N(!(1!==r.rank&&2!==r.rank||1!==e.rank&&2!==e.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+r.rank+" and "+e.rank+"."}));var i=1===r.rank?r.size:r.shape[1],o=1===e.rank?e.size:e.shape[0];return N(i===o,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."})),1===r.rank&&1===e.rank?r.as2D(1,-1).matMul(e.as2D(-1,1)).asScalar():1===r.rank&&2===e.rank?r.as2D(1,-1).matMul(e.as2D(e.shape[0],e.shape[1])).as1D():2===r.rank&&1===e.rank?r.matMul(e.as2D(-1,1)).as1D():r.matMul(e.as2D(e.shape[0],e.shape[1]))}}),wc=sr({outerProduct_:function(n,t){var r=Yt(n,"v1","outerProduct"),e=Yt(t,"v2","outerProduct");return N(1===r.rank&&1===e.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+r.rank+" and "+e.rank+"."})),r.as2D(-1,1).matMul(e.as2D(1,-1))}}),Cc=sr({reverse_:function(n,t){var r=Yt(n,"x","reverse");if(0===r.rank)return r.clone();var e=F(t,r.shape);return Vn.runKernelFunc((function(n){return n.reverse(r,e)}),{$x:r},(function(n){return{$x:function(){return n.reverse(e)}}})).reshapeAs(r)}}),Nc=sr({reverse1d_:function(n){var t=Yt(n,"x","reverse");return N(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),Cc(t,0)}}),Ec=sr({reverse2d_:function(n,t){var r=Yt(n,"x","reverse");return N(2===r.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+r.rank+"."})),Cc(r,t)}}),Rc=sr({reverse3d_:function(n,t){var r=Yt(n,"x","reverse");return N(3===r.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+r.rank+"."})),Cc(r,t)}}),Ac=sr({reverse4d_:function(n,t){var r=Yt(n,"x","reverse");return N(4===r.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+r.rank+"."})),Cc(r,t)}});function _c(n,t,r,e,i,o){var a=Yt(n,"x","maxPool"),u=a,s=!1;3===a.rank&&(s=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==e&&(e=[1,1]),N(4===u.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."})),N(Gi(r,e),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+e+"'"})),null!=o&&N(S(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var c=Mi(u.shape,t,r,e,i,o);if(1===c.filterWidth&&1===c.filterHeight&&O(c.inShape,c.outShape))return a.clone();var f=Vn.runKernelFunc((function(n,t){var r=n.maxPool(u,c);return t([u,r]),r}),{x:u},(function(n,o){var a=o[0],u=o[1];return{x:function(){return function(n,t,r,e,i,o,a){var u=Yt(n,"dy","maxPoolBackprop"),s=Yt(t,"input","maxPoolBackprop"),c=Yt(r,"output","maxPoolBackprop");N(s.rank===u.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+u.rank+")"})),null==o&&(o=[1,1]),N(Gi(i,o),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"})),N(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),N(4===s.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+s.rank+"."}));var f=Mi(s.shape,e,i,o,a,void 0);return Vn.runKernelFunc((function(n){return n.maxPoolBackprop(u,s,c,f)}),{$dy:u,$input:s})}(n,a,u,t,r,e,i)}}}),"MaxPool",c,[u]);return s?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function Oc(n,t,r,e,i,o){var a=Yt(n,"x","avgPool","float32");null==e&&(e=[1,1]),N(Gi(r,e),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+e+"'"}));var u=a,s=!1;3===a.rank&&(s=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),N(4===u.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."})),null!=o&&N(S(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var c=Mi(u.shape,t,r,e,i,o);if(1===c.filterWidth&&1===c.filterHeight&&O(c.inShape,c.outShape))return a.clone();var f=Vn.runKernelFunc((function(n){return n.avgPool(u,c)}),{x:u},(function(n){return{x:function(){return function(n,t,r,e,i,o){var a=Yt(n,"dy","avgPoolBackprop"),u=Yt(t,"input","avgPoolBackprop");N(u.rank===a.rank,(function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+a.rank+")"})),null==i&&(i=[1,1]),N(Gi(e,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}));var s=u,c=a,f=!1;3===u.rank&&(f=!0,s=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),N(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),N(4===s.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+"."}));var l=Mi(s.shape,r,e,i,o),d=Vn.runKernelFunc((function(n){return n.avgPoolBackprop(c,s,l)}),{dy4D:c,input4D:s});return f?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(n,u,t,r,e,i)}}}),"AvgPool",c);return f=f.cast(a.dtype),s?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}var Sc=sr({maxPool_:function(n,t,r,e,i){return _c(n,t,r,1,e,i)}}),Tc=sr({avgPool_:function(n,t,r,e,i){return Oc(n,t,r,1,e,i)}}),Ic=sr({pool_:function(n,t,r,e,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===e&&(e="valid");var a=Yt(n,"x","maxPool"),u=a,s=!1;3===a.rank&&(s=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),N(Gi(o,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}));var c,f=Mi(u.shape,t,o,i,e),l=[f.dilationHeight,f.dilationWidth];c="same"===e?function(n,t){var r=n.map((function(n,r){return n+(n-1)*(t[r]-1)})).map((function(n){return n-1})),e=r.map((function(n){return Math.floor(n/2)})),i=r.map((function(n,t){return n-e[t]}));return r.map((function(n,t){return[e[t],i[t]]}))}([f.filterHeight,f.filterWidth],l):[[0,0],[0,0]];var d=1===l[0]&&1===l[1],h=function(n,t,r){var e=r.map((function(n){return n[0]})),i=r.map((function(n){return n[1]})),o=n.concat(e,i),a=t.map((function(n,t){return(n-o[t]%n)%n})),u=i.map((function(n,t){return n+a[t]}));return[t.map((function(n,t){return[e[t],u[t]]})),t.map((function(n,t){return[0,a[t]]}))]}([f.inHeight,f.inWidth],l,c),v=h[1],p=d?e:"valid",m=d?u:Ur(u,l,h[0]),x=("avg"===r?function(){return Oc(m,t,o,1,p)}:function(){return _c(m,t,o,1,p)})(),y=d?x:Pr(x,l,v);return s?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),Mc=sr({maxPool3d_:function(n,t,r,e,i,o,a){void 0===o&&(o="NDHWC");var u=Yt(n,"x","maxPool3d"),s=u,c=!1;4===u.rank&&(c=!0,s=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),null==a&&(a=[1,1,1]),N(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."})),N("NDHWC"===o,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),N(Gi(r,a),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"})),null!=i&&N(S(e),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+e+"."}));var f=ki(s.shape,t,r,a,e,i,o),l=Vn.runKernelFunc((function(n,t){var r=n.maxPool3d(s,f);return t([s,r]),r}),{x:s},(function(n,o){var u=o[0],s=o[1];return{x:function(){return function(n,t,r,e,i,o,a,u){var s=Yt(n,"dy","maxPool3dBackprop"),c=Yt(t,"input","maxPool3dBackprop"),f=Yt(r,"output","maxPool3dBackprop"),l=s,d=c,h=f,v=!1;4===c.rank&&(v=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),h=f.as5D(1,f.shape[0],f.shape[1],f.shape[2],f.shape[3])),N(5===l.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."})),N(5===d.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."})),N(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==o&&(o=[1,1,1]),N(Gi(i,o),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"})),null!=u&&N(S(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."}));var p=ki(d.shape,e,i,o,a,u),m=Vn.runKernelFunc((function(n){return n.maxPool3dBackprop(l,d,h,p)}),{dy5D:l,input5D:d});return v?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(n,u,s,t,r,a,e,i)}}}));return c?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),kc=sr({avgPool3d_:function(n,t,r,e,i,o,a){void 0===o&&(o="NDHWC");var u=Yt(n,"x","avgPool3d","float32"),s=u,c=!1;4===u.rank&&(c=!0,s=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),null==a&&(a=[1,1,1]),N(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."})),N("NDHWC"===o,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),N(Gi(r,a),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"})),null!=i&&N(S(e),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+e+"."}));var f=ki(s.shape,t,r,a,e,i,o),l=Vn.runKernelFunc((function(n){return n.avgPool3d(s,f)}),{x:s},(function(n){return{x:function(){return function(n,t,r,e,i,o,a){var u=Yt(n,"dy","avgPool3dBackprop"),s=Yt(t,"input","avgPool3dBackprop"),c=u,f=s,l=!1;4===s.rank&&(l=!0,c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),f=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),N(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),N(5===f.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+f.rank+"."})),null==i&&(i=[1,1,1]),N(Gi(e,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"})),null!=a&&N(S(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var d=ki(f.shape,r,e,i,o,a),h=Vn.runKernelFunc((function(n){return n.avgPool3dBackprop(c,f,d)}),{dy5D:c,input5D:f});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(n,s,t,r,a,e,i)}}}));return l=l.cast(s.dtype),c?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),Dc=sr({maxPoolWithArgmax_:function(n,t,r,e,i){void 0===i&&(i=!1);var o=Yt(n,"x","maxPoolWithArgmax"),a=Vn.runKernel("MaxPoolWithArgmax",{x:o},{filterSize:t,strides:r,pad:e,includeBatchInIndex:i});return{result:a[0],indexes:a[1]}}}),Fc=sr({slice_:function(n,t,r){var e,i,o=Yt(n,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(e="number"==typeof t?[t].concat(new Array(o.rank-1).fill(0)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(0)):t.slice()).forEach((function(n){N(-1!==n,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==r?new Array(o.rank).fill(-1):"number"==typeof r?[r].concat(new Array(o.rank-1).fill(-1)):r.length<o.rank?r.concat(new Array(o.rank-r.length).fill(-1)):r).map((function(n,t){return n>=0?n:(N(-1===n,(function(){return"Negative size values should be exactly -1 but got "+n+" for the slice() size at index "+t+"."})),o.shape[t]-e[t])})),pi(o,e,i);var a=o.shape;return Vn.runKernelFunc((function(n){return n.slice(o,e,i)}),{x:o},(function(n){for(var t=[],r=0;r<n.rank;r++)t.push([e[r],a[r]-e[r]-i[r]]);return{x:function(){return Ns(n,t)}}}),"Slice",{begin:e,size:i})}}),Vc=sr({slice1d_:function(n,t,r){var e=Yt(n,"x","slice1d");return N(1===e.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+e.rank+" tensor"})),Fc(e,[t],[r])}}),Pc=sr({slice2d_:function(n,t,r){var e=Yt(n,"x","slice2d");return N(2===e.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+e.rank+" tensor"})),Fc(e,t,r)}}),Lc=sr({slice3d_:function(n,t,r){var e=Yt(n,"x","slice3d");return N(3===e.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+e.rank+" tensor"})),Fc(e,t,r)}}),Bc=sr({slice4d_:function(n,t,r){var e=Yt(n,"x","slice4d");return N(4===e.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+e.rank+" tensor"})),Fc(e,t,r)}});function Wc(n,t,r,e,i){return t.rank<r.rank&&(t=t.reshape(tr(t.shape,e))),n.rank<r.rank&&(n=n.reshape(tr(n.shape,e))),{x:function(){var e=n.mul(r.equal(t).cast(n.dtype));return null==i?e:e.transpose(i)}}}var zc=sr({all_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","all","bool"),i=F(t,e.shape),o=i,a=er(o,e.rank);null!=a&&(e=e.transpose(a),o=or(o.length,e.rank));var u=Vn.runKernelFunc((function(n){return n.all(e,o)}),{$x:e});if(r){var s=tr(u.shape,i);return u.reshape(s)}return u}}),Gc=sr({any_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","any","bool"),i=F(t,e.shape),o=i,a=er(o,e.rank);null!=a&&(e=e.transpose(a),o=or(o.length,e.rank));var u=Vn.runKernelFunc((function(n){return n.any(e,o)}),{$x:e});if(r){var s=tr(u.shape,i);return u.reshape(s)}return u}}),Uc=sr({argMax_:function(n,t){void 0===t&&(t=0);var r=Yt(n,"x","argMax");null==t&&(t=0);var e=F(t,r.shape),i=er(e,r.rank);return null!=i&&(r=r.transpose(i),e=or(e.length,r.rank)),Vn.runKernelFunc((function(n,t){var i=n.argMax(r,e[0]);return t([r]),i}),{x:r},(function(n,t){var r=t[0];return{x:function(){return Or(r)}}}),"ArgMax",{axis:e[0]},[r])}}),qc=sr({argMin_:function(n,t){void 0===t&&(t=0);var r=Yt(n,"x","argMin");null==t&&(t=0);var e=F(t,r.shape),i=er(e,r.rank);return null!=i&&(r=r.transpose(i),e=or(e.length,r.rank)),Vn.runKernelFunc((function(n,t){var i=n.argMin(r,e[0]);return t([r]),i}),{$x:r},(function(n,t){var r=t[0];return{$x:function(){return Or(r)}}}))}}),jc=sr({logSumExp_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","logSumExp"),i=F(t,e.shape),o=e.max(i,!0),a=e.sub(o).exp().sum(i).log(),u=o.reshape(a.shape).add(a);if(r){var s=tr(u.shape,i);return u.reshape(s)}return u}}),Hc=sr({max_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","max"),i=e,o=F(t,e.shape),a=o,u=er(a,e.rank);null!=u&&(e=e.transpose(u),a=or(a.length,e.rank));var s=Vn.runKernelFunc((function(n,t){var r=n.max(e,a);return t([i,r]),r}),{x:e},(function(n,t){return Wc(n,t[1],t[0],o,u)}),"Max",{axes:a},[e],[!0]);if(r){var c=tr(s.shape,o);s=s.reshape(c)}return s}}),Xc=sr({mean_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","mean"),i=F(t,e.shape),o=_(nr(e.shape,i)[1]);return Ei((function(n){var e=vr(o);return{value:(e.dtype===n.dtype?n:n.cast(e.dtype)).div(e).sum(t,r),gradFunc:function(t){var r=n.shape.slice();return i.forEach((function(n){r[n]=1})),t.reshape(r).mul(Cr(n.shape,"float32")).div(o)}}}))(e)}}),$c=sr({min_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","min"),i=e,o=F(t,e.shape),a=o,u=er(a,e.rank);null!=u&&(e=e.transpose(u),a=or(a.length,e.rank));var s=Vn.runKernelFunc((function(n,t){var r=n.min(e,a);return t([i,r]),r}),{x:e},(function(n,t){return Wc(n,t[1],t[0],o,u)}),"Min",{axes:a},[e],[!0]);if(r){var c=tr(s.shape,o);s=s.reshape(c)}return s}}),Kc=sr({moments_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=F(t,(n=Yt(n,"x","moments")).shape),i=n.mean(e,r),o=i.shape;r||(o=tr(i.shape,e));var a=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(e,r)}}}),Yc=sr({sum_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","sum");"bool"===e.dtype&&(e=e.toInt());var i=F(t,e.shape);return Ei((function(n){var t=er(i,n.rank),e=i,o=n;null!=t&&(o=n.transpose(t),e=or(e.length,n.rank));var a=function(t){var r=n.shape.slice();return i.forEach((function(n){r[n]=1})),t.reshape(r).mul(Cr(n.shape,"float32"))},u=Vn.runKernelFunc((function(n){return n.sum(o,e)}),{x:o},(function(n){return{x:function(){return a(n)}}}),"Sum",{axes:e});if(r){var s=tr(u.shape,i);u=u.reshape(s)}return{value:u,gradFunc:a}}))(e)}}),Jc=sr({prod_:function(n,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var e=Yt(n,"x","prod");"bool"===e.dtype&&(e=e.toInt());var i=F(t,e.shape),o=er(i,e.rank),a=i,u=e;null!=o&&(u=e.transpose(o),a=or(a.length,e.rank));var s=Vn.runKernelFunc((function(n){return n.prod(u,a)}),{permutedX:u});if(r){var c=tr(s.shape,i);s=s.reshape(c)}return s}}),Zc=sr({elu_:function(n){var t=Yt(n,"x","elu");return Vn.runKernelFunc((function(n,r){var e=n.elu(t);return r([e]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){return Vn.runKernelFunc((function(t){return t.eluDer(n,r)}),{dy:n,y:r})}}}))}}),Qc=sr({leakyRelu_:function(n,t){void 0===t&&(t=.2);var r=Yt(n,"x","leakyRelu");return $e(vr(t).mul(r),r)}}),nf=sr({prelu_:function(n,t){var r=Yt(n,"x","prelu"),e=Yt(t,"alpha","prelu");return Vn.runKernelFunc((function(n,t){var i=n.prelu(r,e);return t([r,e]),i}),{x:r,alpha:e},(function(n,t){var r=t[0],e=t[1],i=r.greater(0);return{x:function(){return ms(i,n,n.mul(e))},alpha:function(){var t=ms(i,Or(n),n.mul(r)),o=se(e.shape,n.shape);return o.length>0&&(t=t.sum(o)),t.reshape(e.shape)}}}),"Prelu")}}),tf=sr({relu_:function(n){var t=Yt(n,"x","relu");return"bool"===t.dtype?t.toInt():Vn.runKernelFunc((function(n,r){var e=n.relu(t);return r([t]),e}),{x:t},(function(n,t){var r=t[0];return{x:function(){return n.mulStrict(r.step().toFloat())}}}),"Relu")}}),rf=sr({relu6_:function(n){var t=Yt(n,"x","relu6");return"bool"===t.dtype?t.toInt():Vn.runKernelFunc((function(n,r){var e=n.relu6(t);return r([t]),e}),{x:t},(function(n,t){var r=t[0],e=r.lessEqual(6).mul(r.step());return{x:function(){return n.mulStrict(e.toFloat())}}}),"Relu6")}}),ef=sr({selu_:function(n){var t=Yt(n,"x","selu");return Vn.runKernelFunc((function(n,r){var e=n.selu(t);return r([t]),e}),{$x:t},(function(n,t){var r=t[0];return{$x:function(){var t=r.greater(vr(0)),e=vr(1.7580993408473768),i=vr(1.0507009873554805),o=n.mul(i),a=n.mul(e).mul(r.toFloat().exp());return ms(t,o,a)}}}))}}),of=sr({localResponseNormalization_:function(n,t,r,e,i){void 0===t&&(t=5),void 0===r&&(r=1),void 0===e&&(e=1),void 0===i&&(i=.5);var o=Yt(n,"x","localResponseNormalization");N(4===o.rank||3===o.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."})),N(S(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var a=o,u=!1;3===o.rank&&(u=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var s=Vn.runKernelFunc((function(n,o){var u=n.localResponseNormalization4D(a,t,r,e,i);return o([a,u]),u}),{x4D:a},(function(n,o){var a=o[0],u=o[1];return{x4D:function(){return Vn.runKernelFunc((function(o){return o.LRNGrad(n,a,u,t,r,e,i)}),{})}}}));return u?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),af=sr({norm_:function(n,t,r,e){void 0===t&&(t="euclidean"),void 0===r&&(r=null),void 0===e&&(e=!1);var i=function n(t,r,e){if(void 0===e&&(e=null),0===t.rank)return t.abs();if(1!==t.rank&&null===e)return n(t.reshape([-1]),r,e);if(1===t.rank||"number"==typeof e||Array.isArray(e)&&1===e.length){if(1===r)return t.abs().sum(e);if(r===1/0)return t.abs().max(e);if(r===-1/0)return t.abs().min(e);if("euclidean"===r||2===r)return t.abs().pow(vr(2,"int32")).sum(e).sqrt();throw new Error("Error in norm: invalid ord value: "+r)}if(Array.isArray(e)&&2===e.length){if(1===r)return t.abs().sum(e[0]).max(e[1]-1);if(r===1/0)return t.abs().sum(e[1]).max(e[0]);if(r===-1/0)return t.abs().sum(e[1]).min(e[0]);if("fro"===r||"euclidean"===r)return t.square().sum(e).sqrt();throw new Error("Error in norm: invalid ord value: "+r)}throw new Error("Error in norm: invalid axis: "+e)}(n=Yt(n,"x","norm"),t,r),o=i.shape;if(e){var a=F(r,n.shape);o=tr(i.shape,a)}return i.reshape(o)}}),uf=sr({basicLSTMCell_:function(n,t,r,e,i,o){var a=Yt(n,"forgetBias","basicLSTMCell"),u=Yt(t,"lstmKernel","basicLSTMCell"),s=Yt(r,"lstmBias","basicLSTMCell"),c=Yt(e,"data","basicLSTMCell"),f=Yt(i,"c","basicLSTMCell"),l=Yt(o,"h","basicLSTMCell"),d=c.concat(l,1).matMul(u).add(s),h=d.shape[1]/4,v=[d.shape[0],h],p=d.slice([0,0],v),m=d.slice([0,h],v),x=d.slice([0,2*h],v),y=d.slice([0,3*h],v),b=p.sigmoid().mulStrict(m.tanh()).addStrict(f.mulStrict(a.add(x).sigmoid())),g=b.tanh().mulStrict(y.sigmoid());return[b,g]}}),sf=sr({multiRNNCell_:function(n,t,r,e){for(var i=Yt(t,"data","multiRNNCell"),o=Jt(r,"c","multiRNNCell"),a=Jt(e,"h","multiRNNCell"),u=i,s=[],c=0;c<n.length;c++){var f=n[c](u,o[c],a[c]);s.push(f[0]),s.push(f[1]),u=f[1]}var l=[],d=[];for(c=0;c<s.length;c+=2)l.push(s[c]),d.push(s[c+1]);return[l,d]}}),cf=sr({movingAverage_:function(n,t,r,e,i){void 0===i&&(i=!0);var o=Yt(n,"v","movingAverage"),a=Yt(t,"x","movingAverage"),u=Yt(r,"decay","movingAverage");Tn(o,a),N(O(o.shape,a.shape),(function(){return"Shape mismatch in v and x"}));var s=vr(1),c=s.sub(u),f=a.sub(o).mul(c);if(i){N(null!=e,(function(){return"When using zeroDebias: true, step is required."}));var l=Yt(e,"step","movingAverage");f=f.div(s.sub(ri(u,l)))}return o.add(f)}}),ff=sr({stridedSlice_:function(n,t,r,e,i,o,a,u,s){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=0),void 0===s&&(s=0),null==e&&(e=new Array(t.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=Yt(n,"x","stridedSlice"),f=mi(u),l=c.shape.slice();f.forEach((function(n){t[n]=0,r[n]=1,l.splice(n,0,1)})),c=c.reshape(l);for(var d=0;d<c.rank;d++)t[d]=yi(i,t,e,c.shape,d),r[d]=bi(o,r,e,c.shape,d),e[d]=e[d]||1;var h=mi(s);h.forEach((function(n){r[n]=t[n]+1,e[n]=1}));var v=xi(t,r,e),p=v.filter((function(n,t){return-1===h.indexOf(t)}));return e.every((function(n){return 1===n}))?Fc(c,t,v).reshape(p):Vn.runKernelFunc((function(n){return n.stridedSlice(c,t,r,e)}),{$x:c}).reshape(p)}}),lf=sr({topk_:function(n,t,r){void 0===t&&(t=1),void 0===r&&(r=!0);var e=Yt(n,"x","topk");if(0===e.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=e.shape[e.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var o=Vn.runKernelFunc((function(n){return n.topk(e,t,r)}),{$x:e});return{values:o[0],indices:o[1]}}}),df=sr({scatterND_:function(n,t,r){var e=Yt(n,"indices","scatterND","int32"),i=Yt(t,"updates","scatterND");return di(i,e,r),Vn.runKernelFunc((function(n){return n.scatterND(e,i,r)}),{indices:e,updates:i},null,"ScatterNd",{shape:r})}}),hf=sr({fft_:function(n){N("complex64"===n.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."}));var t=n.shape[n.shape.length-1],r=n.as2D(n.size/t,t);return Vn.runKernelFunc((function(n){return n.fft(r)}),{input:n}).reshape(n.shape)}}),vf=sr({ifft_:function(n){N("complex64"===n.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."}));var t=n.shape[n.shape.length-1],r=n.as2D(n.size/t,t);return Vn.runKernelFunc((function(n){return n.ifft(r)}),{input:n}).reshape(n.shape)}}),pf=sr({rfft_:function(n,t){N("float32"===n.dtype,(function(){return"The dtype for rfft() must be real value but got "+n.dtype}));var r,e=n.shape[n.shape.length-1],i=n.size/e;if(null!=t&&t<e){var o=n.shape.map((function(){return 0})),a=n.shape.map((function(n){return n}));a[n.shape.length-1]=t,r=n.slice(o,a),e=t}else if(null!=t&&t>e){var u=n.shape.map((function(n){return n}));u[n.shape.length-1]=t-e,r=n.concat(Nr(u),n.shape.length-1),e=t}else r=n;var s=r.zerosLike(),c=cr(r,s).as2D(i,e),f=hf(c),l=Math.floor(e/2)+1,d=fr(f),h=lr(f),v=d.split([l,e-l],d.shape.length-1),p=h.split([l,e-l],h.shape.length-1),m=r.shape.slice();return m[r.shape.length-1]=l,cr(v[0],p[0]).reshape(m)}}),mf=sr({irfft_:function(n){var t=n.shape[n.shape.length-1],r=n.size/t;if(t<=2){var e=n.as2D(r,t),i=vf(e);return fr(i)}var o=[r,2*(t-1)],a=fr(n).as2D(r,t),u=lr(n).as2D(r,t),s=a.slice([0,1],[r,t-2]).reverse(1),c=u.slice([0,1],[r,t-2]).reverse(1).mul(vr(-1)),f=a.concat(s,1),l=u.concat(c,1);return e=cr(f,l).as2D(o[0],o[1]),i=vf(e),fr(i)}}),xf=Object.freeze({fft:hf,ifft:vf,rfft:pf,irfft:mf}),yf=sr({sparseToDense_:function(n,t,r,e){void 0===e&&(e=0);var i=Yt(n,"sparseIndices","sparseToDense","int32"),o=Yt(t,"sparseValues","sparseToDense"),a=Yt(e,"defaultValue","sparseToDense",o.dtype);return function(n,t,r,e){if("int32"!==n.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+n.shape+".");var i=n.rank>0?n.shape[0]:1,o=n.rank>1?n.shape[1]:1;if(r.length!==o)throw new Error("outputShape has incorrect number of elements:, "+r.length+", should be: "+o+".");if(0!==t.rank&&(1!==t.rank||t.size!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==e.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,r,a),Vn.runKernelFunc((function(n){return n.sparseToDense(i,o,r,a)}),{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),bf=sr({gatherND_:function(n,t){var r=Yt(t,"indices","gatherND","int32"),e=Yt(n,"x","gatherND");return Vn.runKernelFunc((function(n){return n.gatherND(e,r)}),{x:e,indices:r},null,"GatherNd")}}),gf=sr({diag_:function(n){var t=Yt(n,"x","diag").flatten(),r=n.shape.concat(n.shape);return Vn.runKernelFunc((function(n){return n.diag(t)}),{$x:t}).reshape(r)}}),wf=sr({dropout_:function(n,t,r,e){var i=Yt(n,"x","dropout");if(N("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),N(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return n instanceof bn?i.clone():i;var o=function(n,t){if(null==t)return n.shape.slice();if(O(n.shape,t))return t;if(n.shape.length===t.length){for(var r=[],e=0;e<n.shape.length;e++)r.push(null==t[e]&&null!=n.shape[e]?n.shape[e]:t[e]);return r}return t}(i,r),a=1-t,u=Ls(o,0,1,"float32",e).add(a).floor().div(a);return i.mul(u)}});function Cf(n,t,r){for(var e=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var a=2*Math.PI*o/(n+e-1);i[o]=t-r*Math.cos(a)}return pr(i,"float32")}var Nf,Ef=sr({hannWindow_:function(n){return Cf(n,.5,.5)}}),Rf=sr({hammingWindow_:function(n){return Cf(n,.54,.46)}}),Af=sr({frame_:function(n,t,r,e,i){void 0===e&&(e=!1),void 0===i&&(i=0);for(var o=0,a=[];o+t<=n.size;)a.push(Fc(n,o,t)),o+=r;if(e)for(;o<n.size;){var u=o+t-n.size,s=Sr([Fc(n,o,t-u),Er([u],i)]);a.push(s),o+=r}return 0===a.length?mr([],[0,t]):Sr(a).as2D(a.length,t)}}),_f=sr({stft_:function(n,t,r,e,i){void 0===i&&(i=Ef),null==e&&(e=Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))));for(var o=Af(n,t,r),a=ni(o,i(t)),u=[],s=0;s<o.shape[0];s++)u.push(pf(a.slice([s,0],[1,t]),e));return Sr(u)}}),Of=Object.freeze({hannWindow:Ef,hammingWindow:Rf,frame:Af,stft:_f}),Sf=function(n,t,r){return void 0===r&&(r=1),o(this,void 0,void 0,(function(){var e,i,o,u,s,c,f,l,d,h,v,p,m,x;return a(this,(function(a){switch(a.label){case 0:return e=Yt(n,"predictions","inTopK"),i=Yt(t,"targets","inTopK"),N(e.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+e.rank})),N(e.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+e.rank+" and targets rank "+i.rank})),E(e.shape.slice(0,e.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=e.shape[e.shape.length-1],N(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+r})),[4,e.data()];case 1:return u=a.sent(),[4,i.data()];case 2:for(s=a.sent(),l=(c=[u.length/o,o])[1],d=P("bool",f=c[0]),h=0;h<f;h++){for(p=u.subarray(v=h*l,v+l),m=[],x=0;x<p.length;x++)m.push({value:p[x],index:x});for(m.sort((function(n,t){return t.value-n.value})),d[h]=0,x=0;x<r;x++)if(m[x].index===s[h]){d[h]=1;break}}return n!==e&&e.dispose(),t!==i&&i.dispose(),[2,dr(d,i.shape,"bool")]}}))}))};!function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Nf||(Nf={}));var Tf=sr({absoluteDifference_:function(n,t,r,e){void 0===e&&(e=Nf.SUM_BY_NONZERO_WEIGHTS);var i=Yt(n,"labels","absoluteDifference"),o=Yt(t,"predictions","absoluteDifference"),a=null;null!=r&&(a=Yt(r,"weights","absoluteDifference")),E(i.shape,o.shape,"Error in absoluteDifference: ");var u=i.sub(o).abs();return If(u,a,e)}}),If=sr({computeWeightedLoss_:function(n,t,r){void 0===r&&(r=Nf.SUM_BY_NONZERO_WEIGHTS);var e=Yt(n,"losses","computeWeightedLoss"),i=null;null!=t&&(i=Yt(t,"weights","computeWeightedLoss"));var o=null==i?e:e.mul(i);if(r===Nf.NONE)return o;if(r===Nf.SUM)return o.sum();if(r===Nf.MEAN){if(null==i)return o.mean();var a=e.size/i.size,u=o.sum().div(i.sum());return a>1?u.div(vr(a)):u}if(r===Nf.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(vr(e.size));var s=i.mul(Cr(e.shape)).notEqual(vr(0)).sum().toFloat();return o.sum().div(s)}throw Error("Unknown reduction: "+r)}}),Mf=sr({cosineDistance_:function(n,t,r,e,i){void 0===i&&(i=Nf.SUM_BY_NONZERO_WEIGHTS);var o=Yt(n,"labels","cosineDistance"),a=Yt(t,"predictions","cosineDistance"),u=null;null!=e&&(u=Yt(e,"weights","cosineDistance")),E(o.shape,a.shape,"Error in cosineDistance: ");var s=vr(1).sub(o.mul(a).sum(r,!0));return If(s,u,i)}}),kf=sr({hingeLoss_:function(n,t,r,e){void 0===e&&(e=Nf.SUM_BY_NONZERO_WEIGHTS);var i=Yt(n,"labels","hingeLoss"),o=Yt(t,"predictions","hingeLoss"),a=null;null!=r&&(a=Yt(r,"weights","hingeLoss")),E(i.shape,o.shape,"Error in hingeLoss: ");var u=vr(1);i=vr(2).mul(i).sub(u);var s=u.sub(i.mul(o)).relu();return If(s,a,e)}}),Df=sr({huberLoss_:function(n,t,r,e,i){void 0===e&&(e=1),void 0===i&&(i=Nf.SUM_BY_NONZERO_WEIGHTS);var o=Yt(n,"labels","huberLoss"),a=Yt(t,"predictions","huberLoss"),u=null;null!=r&&(u=Yt(r,"weights","huberLoss")),E(o.shape,a.shape,"Error in huberLoss: ");var s=vr(e),c=a.sub(o).abs(),f=Ye(c,s),l=c.sub(f),d=vr(.5).mul(f.square()).add(s.mul(l));return If(d,u,i)}}),Ff=sr({logLoss_:function(n,t,r,e,i){void 0===e&&(e=1e-7),void 0===i&&(i=Nf.SUM_BY_NONZERO_WEIGHTS);var o=Yt(n,"labels","logLoss"),a=Yt(t,"predictions","logLoss"),u=null;null!=r&&(u=Yt(r,"weights","logLoss")),E(o.shape,a.shape,"Error in logLoss: ");var s=vr(1),c=vr(e),f=o.mul(a.add(c).log()).neg().sub(s.sub(o).mul(s.sub(a).add(c).log()));return If(f,u,i)}}),Vf=sr({meanSquaredError_:function(n,t,r,e){void 0===e&&(e=Nf.SUM_BY_NONZERO_WEIGHTS);var i=Yt(n,"labels","meanSquaredError"),o=Yt(t,"predictions","meanSquaredError"),a=null;null!=r&&(a=Yt(r,"weights","meanSquaredError")),E(i.shape,o.shape,"Error in meanSquaredError: ");var u=i.squaredDifference(o);return If(u,a,e)}}),Pf=sr({sigmoidCrossEntropy_:function(n,t,r,e,i){void 0===e&&(e=0),void 0===i&&(i=Nf.SUM_BY_NONZERO_WEIGHTS);var o=Yt(n,"multiClassLabels","sigmoidCrossEntropy"),a=Yt(t,"logits","sigmoidCrossEntropy"),u=null;if(null!=r&&(u=Yt(r,"weights","sigmoidCrossEntropy")),E(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),e>0){var s=vr(e),c=vr(1),f=vr(.5);o=o.mul(c.sub(s)).add(f.mul(s))}var l=function(n,t){var r=Yt(n,"labels","sigmoidCrossEntropyWithLogits"),e=Yt(t,"logits","sigmoidCrossEntropyWithLogits");E(r.shape,e.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=e.relu(),o=e.mul(r),a=e.abs().neg().exp().log1p();return i.sub(o).add(a)}(o,a);return If(l,u,i)}}),Lf=sr({softmaxCrossEntropy_:function(n,t,r,e,i){void 0===e&&(e=0),void 0===i&&(i=Nf.SUM_BY_NONZERO_WEIGHTS);var o=Yt(n,"onehotLabels","softmaxCrossEntropy"),a=Yt(t,"logits","softmaxCrossEntropy"),u=null;if(null!=r&&(u=Yt(r,"weights","softmaxCrossEntropy")),E(o.shape,a.shape,"Error in softmaxCrossEntropy: "),e>0){var s=vr(e),c=vr(1),f=vr(o.shape[1]);o=o.mul(c.sub(s)).add(s.div(f))}var l=function(n,t,r){if(void 0===r&&(r=-1),-1===r&&(r=t.rank-1),r!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+r);return Ei((function(n,t,e){var i=t.logSumExp([r],!0),o=t.toFloat().sub(i);return e([n,o]),{value:o.mul(n).neg().sum([r]),gradFunc:function(n,t){var e=t[0],i=t[1],o=tr(n.shape,[r]);return[n.reshape(o).mul(e.toFloat().sub(i.exp())),n.reshape(o).mul(i.exp().sub(e.toFloat()))]}}}))(n,t)}(o,a);return If(l,u,i)}}),Bf=Object.freeze({get Reduction(){return Nf},absoluteDifference:Tf,computeWeightedLoss:If,cosineDistance:Mf,hingeLoss:kf,huberLoss:Df,logLoss:Ff,meanSquaredError:Vf,sigmoidCrossEntropy:Pf,softmaxCrossEntropy:Lf});function Wf(n,t){return void 0===t&&(t=!1),Vn.tidy((function(){if(2!==n.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var r=n.shape[0],e=n.shape[1],i=gs(r),o=n.clone(),a=mr([[1]],[1,1]),u=a.clone(),s=r>=e?e:r,c=function(n){var t,s=o,c=u,f=i;t=Vn.tidy((function(){var t=o.slice([n,n],[r-n,1]),s=t.norm(),c=o.slice([n,n],[1,1]),f=mr([[-1]]).where(c.greater(0),mr([[1]])),l=c.sub(f.mul(s)),d=t.div(l);u=1===d.shape[0]?a.clone():a.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var h=f.matMul(l).div(s).neg(),v=o.slice([n,0],[r-n,e]),p=h.mul(u),m=u.transpose();if(0===n)o=v.sub(p.matMul(m.matMul(v)));else{var x=v.sub(p.matMul(m.matMul(v)));o=o.slice([0,0],[n,e]).concat(x,0)}var y=p.transpose(),b=i.slice([0,n],[r,i.shape[1]-n]);if(0===n)i=b.sub(b.matMul(u).matMul(y));else{var g=b.sub(b.matMul(u).matMul(y));i=i.slice([0,0],[r,n]).concat(g,1)}return[u,o,i]})),u=t[0],o=t[1],i=t[2],Ut([s,c,f])},f=0;f<s;++f)c(f);return!t&&r>e&&(i=i.slice([0,0],[r,e]),o=o.slice([0,0],[e,e])),[i,o]}))}var zf=sr({bandPart_:function(n,t,r){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(r%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+r+".");var e=Yt(n,"a","bandPart");if(e.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+e.rank+".");var i=e.shape,o=e.shape.slice(-2),a=o[0],u=o[1];if(!(t<=a))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+a+").");if(!(r<=u))throw new Error("bandPart(): numUpper ("+r+") must not be greater than the number of columns ("+u+").");t<0&&(t=a),r<0&&(r=u);var s=Ar(0,a,1,"int32").reshape([-1,1]),c=Ar(0,u,1,"int32"),f=oi(s,c),l=ds(f.lessEqual(vr(+t,"int32")),f.greaterEqual(vr(-r,"int32"))),d=Nr([a,u],e.dtype);return jr(Hr(e.reshape([-1,a,u])).map((function(n){return ms(l,n,d)}))).reshape(i)}}),Gf=sr({gramSchmidt_:function(n){var t;if(Array.isArray(n)){t=!1,N(null!=n&&n.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var r=n[0].shape[0],e=function(t){N(n[t].shape[0]===r,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[t].shape[0]+" vs. "+r+")"}))},i=1;i<n.length;++i)e(i)}else t=!0,n=Dr(n,n.shape[0],0).map((function(n){return qr(n,[0])}));N(n.length<=n[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."}));var o=[],a=n,u=function(n){o.push(Vn.tidy((function(){var t=a[n];if(n>0)for(var r=0;r<n;++r){var e=Yc(o[r].mulStrict(t)).mul(o[r]);t=t.sub(e)}return t.div(af(t,"euclidean"))})))};for(i=0;i<n.length;++i)u(i);return t?jr(o,0):o}}),Uf=sr({qr_:function(n,t){if(void 0===t&&(t=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(2===n.rank)return Wf(n,t);var r=n.shape.slice(0,n.shape.length-2).reduce((function(n,t){return n*t})),e=Hr(n.reshape([r,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return e.forEach((function(n){var r=Wf(n,t),e=r[1];i.push(r[0]),o.push(e)})),[jr(i,0).reshape(n.shape),jr(o,0).reshape(n.shape)]}}),qf=Object.freeze({bandPart:zf,gramSchmidt:Gf,qr:Uf});function jf(n,t,r,e,i,o){null==e&&(e=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var a=n.shape[0];return r=Math.min(r,a),N(0<=e&&e<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+e+"'"})),N(2===n.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"})),N(4===n.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]})),N(1===t.rank,(function(){return"scores must be a 1D tensor"})),N(t.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]})),N(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"})),{maxOutputSize:r,iouThreshold:e,scoreThreshold:i,softNmsSigma:o}}var Hf=sr({resizeBilinear_:function(n,t,r){void 0===r&&(r=!1);var e=Yt(n,"images","resizeBilinear");N(3===e.rank||4===e.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+e.rank+"."})),N(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t[0],u=t[1],s=Vn.runKernelFunc((function(n,t){return t([i]),n.resizeBilinear(i,a,u,r)}),{x:i},(function(n,t){return{x:function(){return Vn.runKernelFunc((function(e){return e.resizeBilinearBackprop(n,t[0],r)}),{})}}}),"ResizeBilinear",{alignCorners:r,newHeight:a,newWidth:u});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),Xf=sr({resizeNearestNeighbor_:function(n,t,r){void 0===r&&(r=!1);var e=Yt(n,"images","resizeNearestNeighbor");N(3===e.rank||4===e.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+e.rank+"."})),N(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),N("float32"===e.dtype||"int32"===e.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t[0],u=t[1],s=Vn.runKernelFunc((function(n,t){return t([i]),n.resizeNearestNeighbor(i,a,u,r)}),{batchImages:i},(function(n,t){return{batchImages:function(){return Vn.runKernelFunc((function(e){return e.resizeNearestNeighborBackprop(n,t[0],r)}),{})}}}));return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),$f=sr({nonMaxSuppression_:function(n,t,r,e,i){void 0===e&&(e=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=Yt(n,"boxes","nonMaxSuppression"),a=Yt(t,"scores","nonMaxSuppression"),u=jf(o,a,r,e,i);return Vn.runKernelFunc((function(n){return n.nonMaxSuppression(o,a,r,e,i)}),{boxes:o,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:r=u.maxOutputSize,iouThreshold:e=u.iouThreshold,scoreThreshold:i=u.scoreThreshold})}}),Kf=sr({nonMaxSuppressionWithScore_:function(n,t,r,e,i,o){void 0===e&&(e=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var a=Yt(n,"boxes","nonMaxSuppression"),u=Yt(t,"scores","nonMaxSuppression"),s=jf(a,u,r,e,i,o),c={maxOutputSize:r=s.maxOutputSize,iouThreshold:e=s.iouThreshold,scoreThreshold:i=s.scoreThreshold,softNmsSigma:o=s.softNmsSigma},f=Vn.runKernel("NonMaxSuppressionV5",{boxes:a,scores:u},c);return{selectedIndices:f[0],selectedScores:f[1]}}}),Yf=sr({cropAndResize_:function(n,t,r,e,i,o){var a=Yt(n,"image","cropAndResize"),u=Yt(t,"boxes","cropAndResize","float32"),s=Yt(r,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=u.shape[0];return N(4===a.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."})),N(2===u.rank&&4===u.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+u.shape+"."})),N(1===s.rank&&s.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+u.shape+"."})),N(2===e.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+e.length+"."})),N(e[0]>=1&&e[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+e})),N("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),Vn.runKernelFunc((function(n){return n.cropAndResize(a,u,s,e,i,o)}),{images:a,boxes:u,boxInd:s},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:e})}}),Jf=Object.freeze({resizeBilinear:Hf,resizeNearestNeighbor:Xf,nonMaxSuppression:$f,nonMaxSuppressionAsync:function(n,t,r,e,i){return void 0===e&&(e=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),o(this,void 0,void 0,(function(){var o,u,s,c,f;return a(this,(function(a){switch(a.label){case 0:return o=Yt(n,"boxes","nonMaxSuppressionAsync"),u=Yt(t,"scores","nonMaxSuppressionAsync"),s=jf(o,u,r,e,i),r=s.maxOutputSize,e=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),u.data()])];case 1:return c=a.sent(),f=no(c[0],c[1],r,e,i),o!==n&&o.dispose(),u!==t&&u.dispose(),[2,f]}}))}))},nonMaxSuppressionWithScore:Kf,nonMaxSuppressionWithScoreAsync:function(n,t,r,e,i,u){return void 0===e&&(e=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===u&&(u=0),o(this,void 0,void 0,(function(){var o,s,c,f,l;return a(this,(function(a){switch(a.label){case 0:return o=Yt(n,"boxes","nonMaxSuppressionAsync"),s=Yt(t,"scores","nonMaxSuppressionAsync"),c=jf(o,s,r,e,i,u),r=c.maxOutputSize,e=c.iouThreshold,i=c.scoreThreshold,u=c.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return f=a.sent(),l=to(f[0],f[1],r,e,i,u),o!==n&&o.dispose(),s!==t&&s.dispose(),[2,l]}}))}))},cropAndResize:Yf}),Zf=function(n,t){return!(n>0)||"linear"===t},Qf=function(n,t,r){if(null==r||"linear"===r)return n;if("relu"===r)return n.mul(t.step());throw new Error("Gradient for activation "+r+" has not been implemented yet.")},nl=function(n,t){var r=t,e=se(n.shape,t.shape);return e.length>0&&(r=r.sum(e)),r.reshape(n.shape)},tl=function(n,t,r){if("linear"===t)return n;if("relu"===t)return tf(n);if("elu"===t)return Zc(n);if("relu6"===t)return rf(n);if("prelu"===t)return nf(n,r);throw new Error("Unknown fused activation "+t+".")},rl=sr({fusedMatMul_:function(n){var t,r=n.a,e=n.b,i=n.transposeA,o=void 0!==i&&i,a=n.transposeB,u=void 0!==a&&a,s=n.bias,c=n.activation,f=void 0===c?"linear":c,l=n.preluActivationWeights;if(!1===Zf(Vn.state.gradientDepth,f)){var d=bc(r,e,o,u);return null!=s&&(d=ae(d,s)),tl(d,f,l)}var h=Yt(r,"a","fused matMul"),v=Yt(e,"b","fused matMul");t=Sn(h,v),h=t[0],v=t[1];var p=o?h.shape[h.rank-2]:h.shape[h.rank-1],m=u?v.shape[v.rank-1]:v.shape[v.rank-2],x=o?h.shape[h.rank-1]:h.shape[h.rank-2],y=u?v.shape[v.rank-2]:v.shape[v.rank-1],b=h.shape.slice(0,-2),g=v.shape.slice(0,-2),w=_(b),C=_(g);N(h.rank>=2&&v.rank>=2&&h.rank===v.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+v.rank+"."})),N(O(b,g),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+g+") of Tensors with shapes "+h.shape+" and "+v.shape+" must match."})),N(p===m,(function(){return"Error in fused matMul: inner shapes ("+p+") and ("+m+") of Tensors with shapes "+h.shape+" and "+v.shape+" and transposeA="+o+" and transposeB="+u+" must match."}));var E,R,A=h.shape.slice(0,-2).concat([x,y]),S=o?h.as3D(w,p,x):h.as3D(w,x,p),T=u?v.as3D(C,y,m):v.as3D(C,m,y);null!=s&&ce(A,(E=Sn(E=Yt(s,"bias","fused matMul"),h)[0]).shape),null!=l&&(R=Yt(l,"prelu weights","fused matMul"));var I={a:S,b:T};return null!=s&&(I.bias=E),null!=l&&(I.preluActivationWeights=R),Vn.runKernelFunc((function(n,t){var r=n.fusedBatchMatMul({a:S,b:T,transposeA:o,transposeB:u,bias:E,activation:f,preluActivationWeights:R});return t([S,T,r]),r}),I,(function(n,t){var r=t[0],e=t[1],i=Qf(n,t[2],f),a={};return null!=s&&(a={bias:function(){return nl(E,i)}}),Object.assign(o||u?!o&&u?{a:function(){return i.matMul(e,!1,!1)},b:function(){return i.matMul(r,!0,!1)}}:o&&!u?{a:function(){return e.matMul(i,!1,!0)},b:function(){return r.matMul(i,!1,!1)}}:{a:function(){return e.matMul(i,!0,!0)},b:function(){return i.matMul(r,!0,!0)}}:{a:function(){return i.matMul(e,!1,!0)},b:function(){return r.matMul(i,!0,!1)}},a)}),"_FusedMatMul",{transposeA:o,transposeB:u,activation:f},[S,T],[!0]).reshape(A)}}),el=sr({fusedConv2d_:function(n){var t=n.x,r=n.filter,e=n.strides,i=n.pad,o=n.dataFormat,a=void 0===o?"NHWC":o,u=n.dilations,s=void 0===u?[1,1]:u,c=n.dimRoundingMode,f=n.bias,l=n.activation,d=void 0===l?"linear":l,h=n.preluActivationWeights;if(!1===Zf(Vn.state.gradientDepth,d=d||"linear")){var v=cc(t,r,e,i,a,s,c);return null!=f&&(v=ae(v,f)),tl(v,d,h)}var p=Yt(t,"x","conv2d"),m=Yt(r,"filter","conv2d"),x=p,y=!1;3===p.rank&&(y=!0,x=p.as4D(1,p.shape[0],p.shape[1],p.shape[2])),N(4===x.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+x.rank+"."})),N(4===m.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),null!=c&&N(S(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."})),N(x.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+x.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),N(Gi(e,s),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"})),N("NHWC"===a,(function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."}));var b,g,w=Di(x.shape,m.shape,e,s,i,c);null!=f&&(b=Sn(b=Yt(f,"bias","fused conv2d"),p)[0],ce(w.outShape,b.shape)),null!=h&&(g=Yt(h,"prelu weights","fused conv2d"));var C={x,filter:m};null!=f&&(C.bias=b),null!=h&&(C.preluActivationWeights=g);var E=Vn.runKernelFunc((function(n,t){var r=n.fusedConv2d({input:x,filter:m,convInfo:w,bias:b,activation:d,preluActivationWeights:g});return t([m,x,r]),r}),C,(function(n,t){var r=t[0],o=t[1],a=Qf(n,t[2],d);N(zi(s),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"}));var u={};return null!=f&&(u={bias:function(){return nl(b,a)}}),Object.assign({x:function(){return dc(o.shape,a,r,e,i)},filter:function(){return lc(o,a,r.shape,e,i)}},u)}),"FusedConv2D",{convInfo:w,activation:d},[m,x],[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),il=sr({fusedDepthwiseConv2d_:function(n){var t=n.x,r=n.filter,e=n.strides,i=n.pad,o=n.dataFormat,a=void 0===o?"NHWC":o,u=n.dilations,s=void 0===u?[1,1]:u,c=n.dimRoundingMode,f=n.bias,l=n.activation,d=void 0===l?"linear":l,h=n.preluActivationWeights;if(!1===Zf(Vn.state.gradientDepth,d)){var v=hc(t,r,e,i,a,s,c);return null!=f&&(v=ae(v,f)),tl(v,d,h)}var p=Yt(t,"x","depthwiseConv2d"),m=Yt(r,"filter","depthwiseConv2d"),x=p,y=!1;3===p.rank&&(y=!0,x=p.as4D(1,p.shape[0],p.shape[1],p.shape[2])),N(4===x.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+x.rank+"."})),N(4===m.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),N(x.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+x.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),null==s&&(s=[1,1]),N(Gi(e,s),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"})),null!=c&&N(S(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."}));var b,g,w=Di(x.shape,m.shape,e,s,i,c,!0);null!=f&&(b=Sn(b=Yt(f,"bias","fused conv2d"),p)[0],ce(w.outShape,b.shape)),null!=h&&(g=Yt(h,"prelu weights","fused depthwiseConv2d"));var C={x,filter:m};null!=f&&(C.bias=b),null!=h&&(C.preluActivationWeights=g);var E=Vn.runKernelFunc((function(n,t){var r=n.fusedDepthwiseConv2D({input:x,filter:m,convInfo:w,bias:b,activation:d,preluActivationWeights:g});return t([m,x,r]),r}),C,(function(n,t){N(zi(s),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"}));var r=t[0],e=t[1],i=Qf(n,t[2],d),o={};return null!=f&&(o={bias:function(){return nl(b,i)}}),Object.assign({x:function(){return vc(e.shape,i,r,w)},filter:function(){return pc(e,i,r.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:d},[m,x],[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),ol=Object.freeze({matMul:rl,conv2d:el,depthwiseConv2d:il}),al=Object.freeze({image:Jf,linalg:qf,losses:Bf,spectral:xf,fused:ol,signal:Of,add:ae,addN:$u,batchNorm:ns,batchNormalization:Qu,batchNorm2d:es,batchNormalization2d:rs,batchNorm3d:as,batchNormalization3d:os,batchNorm4d:cs,batchNormalization4d:ss,broadcastTo:fs,clone:ls,div:ui,divNoNan:ys,eye:gs,multinomial:ws,oneHot:Cs,pad:Ns,pad1d:Es,pad2d:Rs,pad3d:As,pad4d:_s,rand:Os,randomGamma:Vs,randomNormal:Ps,randomUniform:Ls,square:Bs,squaredDifference:Ws,tile:bs,truncatedNormal:zs,conv1d:sc,conv2d:cc,conv3d:fc,depthwiseConv2d:hc,separableConv2d:mc,conv2dTranspose:xc,conv3dTranspose:yc,op:sr,booleanMaskAsync:ic,complex:cr,real:fr,imag:lr,concat:Sr,concat1d:Tr,concat2d:Ir,concat3d:Mr,concat4d:kr,split:Dr,matMul:bc,dot:gc,outerProduct:wc,reverse:Cc,reverse1d:Nc,reverse2d:Ec,reverse3d:Rc,reverse4d:Ac,maxPool:Sc,avgPool:Tc,pool:Ic,maxPool3d:Mc,avgPool3d:kc,maxPoolWithArgmax:Dc,slice:Fc,slice1d:Vc,slice2d:Pc,slice3d:Lc,slice4d:Bc,abs:fe,acos:le,acosh:de,asin:he,asinh:ve,atan:pe,atanh:me,ceil:xe,clipByValue:ye,cos:be,cosh:ge,erf:we,exp:Ce,expm1:Ne,floor:Ee,log:Re,log1p:Ae,logSigmoid:_e,neg:Oe,reciprocal:Se,round:Te,rsqrt:Ie,sigmoid:Me,sign:ke,isNaN:De,isInf:Fe,isFinite:Ve,sin:Pe,sinh:Le,softplus:Be,sqrt:We,step:ze,tan:Ge,tanh:Ue,all:zc,any:Gc,argMax:Uc,argMin:qc,logSumExp:jc,max:Hc,mean:Xc,min:$c,moments:Kc,sum:Yc,prod:Jc,equal:Gs,equalStrict:Us,greater:qs,greaterEqual:js,greaterEqualStrict:Hs,greaterStrict:Xs,less:$s,lessEqual:Ks,lessEqualStrict:Ys,lessStrict:Js,notEqual:Zs,notEqualStrict:Qs,addStrict:qe,atan2:je,divStrict:He,floorDiv:Xe,maximum:$e,maximumStrict:Ke,minimum:Ye,minimumStrict:Je,mod:Ze,modStrict:Qe,mul:ni,mulStrict:ti,pow:ri,powStrict:ei,squaredDifferenceStrict:ii,sub:oi,subStrict:ai,elu:Zc,leakyRelu:Qc,prelu:nf,relu:tf,relu6:rf,selu:ef,logicalAnd:ds,logicalNot:hs,logicalOr:vs,logicalXor:ps,where:ms,whereAsync:xs,buffer:Fr,print:Vr,batchToSpaceND:Pr,cast:Lr,cumsum:Br,depthToSpace:Wr,expandDims:zr,reshape:Gr,spaceToBatchND:Ur,squeeze:qr,stack:jr,unstack:Hr,setdiff1dAsync:Xr,fill:Er,linspace:Rr,ones:Cr,range:Ar,scalar:vr,tensor:dr,tensor1d:pr,tensor2d:mr,tensor3d:xr,tensor4d:yr,tensor5d:br,tensor6d:gr,variable:wr,zeros:Nr,onesLike:_r,zerosLike:Or,transpose:Oi,softmax:Ai,logSoftmax:_i,localResponseNormalization:of,norm:af,gather:rc,unsortedSegmentSum:ec,basicLSTMCell:uf,multiRNNCell:sf,movingAverage:cf,stridedSlice:ff,topk:lf,scatterND:df,fft:hf,ifft:vf,rfft:pf,irfft:mf,sparseToDense:yf,gatherND:bf,diag:gf,dropout:wf,hannWindow:Ef,hammingWindow:Rf,frame:Af,stft:_f,inTopKAsync:Sf});function ul(n,t){Array.isArray(n)||(n=[n]),n.forEach((function(n){null!=n&&N("complex64"!==n.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function sl(n,t,r,e,i,o){for(var a=i.strideHeight,u=i.strideWidth,s=i.dilationHeight,c=i.dilationWidth,f=i.effectiveFilterHeight,l=i.effectiveFilterWidth,d=i.padInfo.top,h=i.padInfo.left,v="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=Fr(i.outShape,r),m=p.values,x=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],b=i.outShape[3],g=0;g<i.batchSize;++g)for(var w=g*x,C=g*e[0],N=0;N<i.inChannels;++N)for(var E=0;E<i.outHeight;++E)for(var R=E*a-d,A=Math.max(0,R),_=Math.min(i.inHeight,f+R),O=w+E*y,S=0;S<i.outWidth;++S){for(var T=S*u-h,I=Math.max(0,T),M=Math.min(i.inWidth,l+T),k=v,D=0,F=0,V=A;V<_;V+=s){for(var P=C+V*e[1],L=I;L<M;L+=c){var B=n[P+L*e[2]+N];"max"===o&&B>k?k=B:"avg"===o&&(D+=B,F++)}if(isNaN(k))break}m[O+S*b+N]="avg"===o?D/F:k}return p}function cl(n,t,r,e,i,o){void 0===i&&(i=!1),void 0===o&&(o=!1);for(var a=Fr(e.outShape,"int32"),u=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,l=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.top,v=e.padInfo.left,p=Fr(t,r,n),m=0;m<e.batchSize;++m)for(var x=0;x<e.inChannels;++x)for(var y=0;y<e.outHeight;++y){for(var b=y*u-h,g=b;g<0;)g+=c;for(var w=Math.min(e.inHeight,l+b),C=0;C<e.outWidth;++C){for(var N=C*s-v,E=N;E<0;)E+=f;for(var R=Math.min(e.inWidth,d+N),A=Number.NEGATIVE_INFINITY,_=-1,O=g;O<w;O+=c)for(var S=O-b,T=E;T<R;T+=f){var I=T-N,M=p.get(m,O,T,x);M>A&&(A=M,_=i?o?((m*e.inHeight+O)*e.inWidth+T)*e.inChannels+x:(O*e.inWidth+T)*e.inChannels+x:S*d+I)}a.set(_,m,y,C,x)}}return a}function fl(n,t,r,e){if("linear"===r)return n.linear(t);if("relu"===r)return n.relu(t);if("elu"===r)return n.elu(t);if("relu6"===r)return n.relu6(t);if("prelu"===r)return n.prelu(t,e);throw new Error("Activation "+r+" has not been implemented for the CPU backend.")}var ll=function(n){function t(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Si(t,Vn),t}return i(t,n),t.prototype.write=function(n,t,r){this.firstUse&&(this.firstUse=!1,c().get("IS_NODE")&&Xt("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var e={};return this.data.set(e,{values:n,dtype:r}),e},t.prototype.move=function(n,t,r,e){this.data.set(n,{values:t,dtype:e})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(n){return o(this,void 0,void 0,(function(){return a(this,(function(){return[2,this.readSync(n)]}))}))},t.prototype.readSync=function(n){var t=this.data.get(n),r=t.complexTensors;return"complex64"===t.dtype?$i(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(n).values},t.prototype.bufferSync=function(n){var t=this.readSync(n.dataId),r=t;if("string"===n.dtype)try{r=t.map((function(n){return an(n)}))}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return Fr(n.shape,n.dtype,r)},t.prototype.makeOutput=function(n,t,r){var e=this.write(n,t,r);return Vn.makeTensorFromDataId(e,t,r,this)},t.prototype.disposeData=function(n){if(this.data.has(n)){var t=this.data.get(n).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(n)}},t.prototype.time=function(n){return o(this,void 0,void 0,(function(){var t;return a(this,(function(){return t=rn(),n(),[2,{kernelMs:rn()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(n,t){var r=this.makeOutput(null,n.shape,"complex64");return this.data.get(r.dataId).complexTensors={real:Vn.keep(n.clone()),imag:Vn.keep(t.clone())},r},t.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,t,r){if(ul(n,"slice"),gi(n.shape,t,r)){var e=wi(t,n.strides),i=_(r);return dr(this.readSync(n.dataId).subarray(e,e+i),r,n.dtype)}for(var o=Fr(r,n.dtype),a=this.bufferSync(n),u=0;u<o.size;++u){var s=o.indexToLoc(u).map((function(n,r){return n+t[r]}));o.values[u]=a.get.apply(a,s)}return o.toTensor()},t.prototype.stridedSlice=function(n,t,r,e){ul(n,"stridedSlice");var i=xi(t,r,e);if(i.some((function(n){return 0===n})))return dr([],i);for(var o=Fr(i,n.dtype),a=this.bufferSync(n),u=0;u<o.size;u++){for(var s=o.indexToLoc(u),c=new Array(s.length),f=0;f<c.length;f++)c[f]=s[f]*e[f]+t[f];o.set.apply(o,[a.get.apply(a,c)].concat(s))}return o.toTensor()},t.prototype.diag=function(n){for(var t=this.readSync(n.dataId),r=Fr([n.size,n.size],n.dtype),e=r.values,i=0;i<t.length;i++)e[i*n.size+i]=t[i];return r.toTensor()},t.prototype.unstack=function(n,t){for(var r=n.shape[t],e=new Array(n.rank-1),i=0,o=0;o<n.rank;o++)o!==t&&(e[i++]=n.shape[o]);var a=new Array(n.rank).fill(0),u=n.shape.slice();u[t]=1;var s=new Array(r);for(o=0;o<s.length;o++)a[t]=o,s[o]=this.slice(n,a,u).reshape(e);return s},t.prototype.reverse=function(n,t){ul(n,"reverse");for(var r=Fr(n.shape,n.dtype),e=this.bufferSync(n),i=function(i){var o=r.indexToLoc(i),a=o.slice();t.forEach((function(t){return a[t]=n.shape[t]-1-a[t]})),r.set.apply(r,[e.get.apply(e,a)].concat(o))},o=0;o<r.size;o++)i(o);return r.toTensor()},t.prototype.concat=function(n,t){var r=this;if("complex64"===n[0].dtype){var e=n.map((function(n){return fr(n)})),i=n.map((function(n){return lr(n)}));return cr(this.concat(e,t),this.concat(i,t))}var o=n.map((function(n){var r=_(n.shape.slice(t));return n.as2D(-1,r)})),a=ur(o.map((function(n){return n.shape})),1),u=Fr(a,n[0].dtype).values;if(1===o[0].shape[0]){var s=0;o.forEach((function(n){u.set(r.readSync(n.dataId),s),s+=n.size}))}else{var c=0;o.forEach((function(n){for(var t=r.readSync(n.dataId),e=0,i=0;i<n.shape[0];++i)for(var o=i*a[1]+c,s=0;s<n.shape[1];++s)u[o+s]=t[e++];c+=n.shape[1]}))}var f=ur(n.map((function(n){return n.shape})),t);return dr(u,f,n[0].dtype)},t.prototype.neg=function(n){return ul(n,"neg"),this.multiply(vr(-1),n)},t.prototype.add=function(n,t){return"complex64"===n.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(n.cast("complex64"),t.cast("complex64"),(function(n,t,r,e){return{real:n+r,imag:t+e}})):this.broadcastedBinaryOp(n,t,_n(n.dtype,t.dtype),(function(n,t){return n+t}))},t.prototype.addN=function(n){var t=this;ul(n,"addN");for(var r=n.map((function(n){return t.readSync(n.dataId)})),e=Fr(n[0].shape,n[0].dtype),i=e.values,o=0;o<n.length;o++)for(var a=r[o],u=0;u<i.length;u++)i[u]+=a[u];return e.toTensor()},t.prototype.softmax=function(n,t){var r=F([t],n.shape),e=this.max(n,r),i=tr(e.shape,r),o=this.subtract(n,e.reshape(i)),a=this.exp(o),u=this.sum(a,r).reshape(i);return ui(a,u)},t.prototype.subtract=function(n,t){return"complex64"===n.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(n.cast("complex64"),t.cast("complex64"),(function(n,t,r,e){return{real:n-r,imag:t-e}})):this.broadcastedBinaryOp(n,t,_n(n.dtype,t.dtype),(function(n,t){return n-t}))},t.prototype.pow=function(n,t){return ul([n,t],"pow"),this.broadcastedBinaryOp(n,t,n.dtype,(function(n,t){return Math.pow(n,t)}))},t.prototype.batchMatMul=function(n,t,r,e){ul([n,t],"matMul");for(var i=r?n.shape[1]:n.shape[2],o=r?n.shape[2]:n.shape[1],a=e?t.shape[1]:t.shape[2],u=n.shape[0],s=this.readSync(n.dataId),c=this.readSync(t.dataId),f=r?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],l=f[0],d=f[1],h=f[2],v=e?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],p=v[0],m=v[1],x=v[2],y=o*a,b=Fr([u,o,a],n.dtype),g=b.values,w=this.blockSize,C=0;C<u;C++)for(var N=0;N<o;N+=w)for(var E=0;E<a;E+=w)for(var R=0;R<i;R+=w)for(var A=Math.min(N+w,o),_=Math.min(E+w,a),O=Math.min(R+w,i),S=N;S<A;S++)for(var T=E;T<_;T++){for(var I=0,M=R;M<O;M++)I+=s[C*l+S*d+M*h]*c[M*p+T*m+C*x];g[C*y+(S*a+T)]+=I}return b.toTensor()},t.prototype.fusedBatchMatMul=function(n){var t=n.bias,r=n.activation,e=n.preluActivationWeights,i=this.batchMatMul(n.a,n.b,n.transposeA,n.transposeB);return t&&(i=this.add(i,t)),r&&(i=fl(this,i,r,e)),i},t.prototype.multiply=function(n,t){return"complex64"===n.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(n.cast("complex64"),t.cast("complex64"),(function(n,t,r,e){return{real:n*r-t*e,imag:n*e+t*r}})):this.broadcastedBinaryOp(n,t,_n(n.dtype,t.dtype),(function(n,t){return n*t}))},t.prototype.floorDiv=function(n,t){return ul([n,t],"floorDiv"),this.broadcastedBinaryOp(n,t,"int32",(function(n,t){return Math.floor(n/t)}))},t.prototype.sum=function(n,t){ul(n,"sum"),rr("sum",t,n.rank);for(var r=nr(n.shape,t),e=r[1],i=Nr(r[0],_n(n.dtype,"int32")),o=_(e),a=this.readSync(i.dataId),u=this.readSync(n.dataId),s=0;s<a.length;++s){for(var c=s*o,f=0,l=0;l<o;++l)f+=u[c+l];a[s]=f}return i},t.prototype.prod=function(n,t){ul(n,"sum");for(var r=nr(n.shape,t),e=r[1],i=Nr(r[0],_n(n.dtype,"int32")),o=_(e),a=this.readSync(i.dataId),u=this.readSync(n.dataId),s=0;s<a.length;++s){for(var c=s*o,f=1,l=0;l<o;++l)f*=u[c+l];a[s]=f}return i},t.prototype.unsortedSegmentSum=function(n,t,r){ul(n,"unsortedSegmentSum");for(var e=[],i=n.rank-t.rank,o=0;o<i;++o)t=t.expandDims(o+1);for(o=0;o<r;++o){var a=vr(o,"int32"),u=Gs(a,t).asType("float32").mul(n).sum(0);e.push(u)}return jr(e)},t.prototype.argMin=function(n,t){ul(n,"argMin");var r=[t];rr("argMin",r,n.rank);for(var e=nr(n.shape,r),i=e[1],o=Nr(e[0],"int32"),a=_(i),u=this.readSync(o.dataId),s=this.readSync(n.dataId),c=0;c<u.length;++c){for(var f=c*a,l=s[f],d=0,h=0;h<a;++h){var v=s[f+h];v<l&&(l=v,d=h)}u[c]=d}return o},t.prototype.argMax=function(n,t){ul(n,"argMax");var r=[t];rr("argMax",r,n.rank);for(var e=nr(n.shape,r),i=e[1],o=Nr(e[0],"int32"),a=_(i),u=this.readSync(o.dataId),s=this.readSync(n.dataId),c=0;c<u.length;++c){for(var f=c*a,l=s[f],d=0,h=0;h<a;++h){var v=s[f+h];v>l&&(l=v,d=h)}u[c]=d}return o},t.prototype.cumsum=function(n,t,r,e){if(ul(n,"cumsum"),t!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+t);for(var i=_n(n.dtype,"int32"),o=Nr(n.shape,i),a=this.readSync(o.dataId),u=this.readSync(n.dataId),s=n.shape[n.rank-1],c=e?function(n,t){return n+s-t-1}:function(n,t){return n+t},f=0;f<u.length;f+=s)for(var l=0;l<s;l++){var d=c(f,l);if(0===l)a[d]=r?0:u[d];else{var h=c(f,l-1);a[d]=r?u[h]+a[h]:u[d]+a[h]}}return o},t.prototype.equal=function(n,t){return ul([n,t],"equal"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n===t?1:0}))},t.prototype.notEqual=function(n,t){return ul([n,t],"notEqual"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n!==t?1:0}))},t.prototype.less=function(n,t){return ul([n,t],"less"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n<t?1:0}))},t.prototype.lessEqual=function(n,t){return ul([n,t],"lessEqual"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n<=t?1:0}))},t.prototype.greater=function(n,t){return ul([n,t],"greater"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n>t?1:0}))},t.prototype.greaterEqual=function(n,t){return ul([n,t],"greaterEqual"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n>=t?1:0}))},t.prototype.logicalNot=function(n){ul(n,"logicalNot");for(var t=this.readSync(n.dataId),r=new Uint8Array(t.length),e=0;e<t.length;++e)r[e]=t[e]?0:1;return this.makeOutput(r,n.shape,"bool")},t.prototype.logicalAnd=function(n,t){return ul([n,t],"logicalAnd"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n&&t}))},t.prototype.logicalOr=function(n,t){return ul([n,t],"logicalOr"),this.broadcastedBinaryOp(n,t,"bool",(function(n,t){return n||t}))},t.prototype.select=function(n,t,r){ul([n,t,r],"select");for(var e=this.readSync(n.dataId),i=this.readSync(t.dataId),o=this.readSync(r.dataId),a=Nr(t.shape,_n(t.dtype,r.dtype)),u=this.readSync(a.dataId),s=0,c=0===n.rank||n.rank>1||1===t.rank?1:_(t.shape.slice(1)),f=0;f<e.length;f++)for(var l=0;l<c;l++)u[s++]=1===e[f]?i[f]:o[f];return a},t.prototype.where=function(n){ul([n],"where");var t=this.readSync(n.dataId);return co(n.shape,t)},t.prototype.topk=function(n,t){return ul(n,"topk"),so(this.readSync(n.dataId),n.shape,n.dtype,t)},t.prototype.min=function(n,t){ul(n,"min"),rr("min",t,n.rank);for(var r=nr(n.shape,t),e=r[1],i=Nr(r[0],n.dtype),o=_(e),a=this.readSync(i.dataId),u=this.readSync(n.dataId),s=0;s<a.length;++s){for(var c=s*o,f=u[c],l=0;l<o;++l){var d=u[c+l];d<f&&(f=d)}a[s]=f}return i},t.prototype.minimum=function(n,t){return ul([n,t],"minimum"),this.broadcastedBinaryOp(n,t,n.dtype,(function(n,t){return Math.min(n,t)}))},t.prototype.mod=function(n,t){return ul([n,t],"mod"),this.broadcastedBinaryOp(n,t,n.dtype,(function(n,t){var r=n%t;return n<0&&t<0||n>=0&&t>=0?r:(r+t)%t}))},t.prototype.max=function(n,t){ul(n,"max"),rr("max",t,n.rank);for(var r=nr(n.shape,t),e=r[1],i=Nr(r[0],n.dtype),o=_(e),a=this.readSync(i.dataId),u=this.readSync(n.dataId),s=0;s<a.length;++s){for(var c=s*o,f=u[c],l=0;l<o;++l){var d=u[c+l];d>f&&(f=d)}a[s]=f}return i},t.prototype.maximum=function(n,t){return ul([n,t],"maximum"),this.broadcastedBinaryOp(n,t,n.dtype,(function(n,t){return Math.max(n,t)}))},t.prototype.all=function(n,t){ul(n,"all"),rr("all",t,n.rank);for(var r=nr(n.shape,t),e=r[1],i=Nr(r[0],n.dtype),o=_(e),a=this.readSync(i.dataId),u=this.readSync(n.dataId),s=0;s<a.length;++s){for(var c=s*o,f=u[c],l=0;l<o;++l)f=f&&u[c+l];a[s]=f}return i},t.prototype.any=function(n,t){ul(n,"any"),rr("any",t,n.rank);for(var r=nr(n.shape,t),e=r[1],i=Nr(r[0],n.dtype),o=_(e),a=this.readSync(i.dataId),u=this.readSync(n.dataId),s=0;s<a.length;++s){for(var c=s*o,f=u[c],l=0;l<o;++l)f=f||u[c+l];a[s]=f}return i},t.prototype.squaredDifference=function(n,t){return ul([n,t],"squaredDifference"),this.broadcastedBinaryOp(n,t,n.dtype,(function(n,t){var r=n-t;return r*r}))},t.prototype.ceil=function(n){ul(n,"ceil");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=Math.ceil(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.floor=function(n){ul(n,"floor");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=Math.floor(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.sign=function(n){ul(n,"x");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=t[e]<0?-1:t[e]>0?1:0;return this.makeOutput(r,n.shape,"float32")},t.prototype.isNaN=function(n){ul(n,"x");for(var t=this.readSync(n.dataId),r=new Uint8Array(t.length),e=0;e<t.length;++e)Number.isNaN(t[e])&&(r[e]=1);return this.makeOutput(r,n.shape,"bool")},t.prototype.isInf=function(n){ul(n,"x");for(var t=this.readSync(n.dataId),r=new Uint8Array(t.length),e=0;e<t.length;++e)Math.abs(t[e])===1/0&&(r[e]=1);return this.makeOutput(r,n.shape,"bool")},t.prototype.isFinite=function(n){ul(n,"x");for(var t=this.readSync(n.dataId),r=new Uint8Array(t.length),e=0;e<t.length;++e)Number.isFinite(t[e])&&(r[e]=1);return this.makeOutput(r,n.shape,"bool")},t.prototype.round=function(n){ul(n,"round");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e){var i=Math.floor(t[e]);r[e]=t[e]-i<.5?Math.floor(t[e]):t[e]-i>.5?Math.ceil(t[e]):i%2==0?i:i+1}return this.makeOutput(r,n.shape,"float32")},t.prototype.exp=function(n){ul(n,"exp");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=Math.exp(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.expm1=function(n){ul(n,"expm1");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=Math.expm1(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.log=function(n){ul(n,"log");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=Math.log(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.log1p=function(n){ul(n,"log1p");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=Math.log1p(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.sqrt=function(n){ul(n,"sqrt");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=Math.sqrt(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.rsqrt=function(n){ul(n,"rsqrt");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=1/Math.sqrt(t[e]);return this.makeOutput(r,n.shape,"float32")},t.prototype.reciprocal=function(n){ul(n,"reciprocal");for(var t=this.readSync(n.dataId),r=new Float32Array(t.length),e=0;e<t.length;++e)r[e]=1/t[e];return this.makeOutput(r,n.shape,"float32")},t.prototype.linear=function(n){return n},t.prototype.relu=function(n){ul(n,"relu");for(var t=Nr(n.shape,n.dtype),r=this.readSync(t.dataId),e=this.readSync(n.dataId),i=0;i<e.length;++i)r[i]=Math.max(0,e[i]);return t},t.prototype.relu6=function(n){ul(n,"relu");for(var t=Nr(n.shape,n.dtype),r=this.readSync(t.dataId),e=this.readSync(n.dataId),i=0;i<e.length;++i)r[i]=Math.min(Math.max(0,e[i]),6);return t},t.prototype.prelu=function(n,t){return ul([n,t],"prelu"),this.broadcastedBinaryOp(n,t,n.dtype,(function(n,t){return n<0?t*n:n}))},t.prototype.elu=function(n){ul(n,"elu");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e){var i=r[e];t[e]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,n.shape,"float32")},t.prototype.eluDer=function(n,t){ul([n,t],"eluDer");for(var r=new Float32Array(t.size),e=this.readSync(t.dataId),i=this.readSync(n.dataId),o=0;o<e.length;++o){var a=e[o];r[o]=a>=1?i[o]:i[o]*(a+1)}return this.makeOutput(r,t.shape,"float32")},t.prototype.selu=function(n){ul(n,"selu");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e){var i=r[e];t[e]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(t,n.shape,"float32")},t.prototype.clip=function(n,t,r){ul(n,"clip");for(var e=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o){var a=i[o];e[o]=a>r?r:a<t?t:a}return this.makeOutput(e,n.shape,"float32")},t.prototype.abs=function(n){for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.abs(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.complexAbs=function(n){for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<n.size;++e)t[e]=Math.hypot(r[2*e],r[2*e+1]);return this.makeOutput(t,n.shape,"float32")},t.prototype.int=function(n){ul(n,"int");for(var t=new Int32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=r[e];return this.makeOutput(t,n.shape,"int32")},t.prototype.sigmoid=function(n){ul(n,"sigmoid");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=1/(1+Math.exp(-r[e]));return this.makeOutput(t,n.shape,"float32")},t.prototype.softplus=function(n){ul(n,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,r=new Float32Array(n.size),e=this.readSync(n.dataId),i=0;i<e.length;++i){var o,a=e[i]>-t,u=e[i]<t,s=Math.exp(e[i]);o=u?s:a?e[i]:Math.log(1+s),r[i]=o}return this.makeOutput(r,n.shape,"float32")},t.prototype.sin=function(n){ul(n,"sin");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.sin(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.cos=function(n){ul(n,"cos");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.cos(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.tan=function(n){ul(n,"tan");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.tan(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.asin=function(n){ul(n,"asin");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.asin(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.acos=function(n){ul(n,"acos");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.acos(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.atan=function(n){ul(n,"atan");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.atan(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.atan2=function(n,t){return ul([n,t],"atan2"),this.broadcastedBinaryOp(n,t,n.dtype,(function(n,t){return Math.atan2(n,t)}))},t.prototype.sinh=function(n){ul(n,"sinh");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.sinh(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.cosh=function(n){ul(n,"cosh");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.cosh(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.tanh=function(n){ul(n,"tanh");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=T(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.asinh=function(n){ul(n,"asinh");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.asinh(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.acosh=function(n){ul(n,"acosh");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.acosh(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.atanh=function(n){ul(n,"atanh");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e)t[e]=Math.atanh(r[e]);return this.makeOutput(t,n.shape,"float32")},t.prototype.erf=function(n){ul(n,"erf");for(var t=new Float32Array(n.size),r=this.readSync(n.dataId),e=0;e<r.length;++e){var i=Math.sign(r[e]),o=Math.abs(r[e]),a=1/(1+.3275911*o);t[e]=i*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-o*o))}return this.makeOutput(t,n.shape,"float32")},t.prototype.step=function(n,t){void 0===t&&(t=0),ul(n,"step");for(var r=new Float32Array(n.size),e=this.readSync(n.dataId),i=0;i<e.length;++i){var o=e[i];r[i]=isNaN(o)?NaN:o>0?1:t}return this.makeOutput(r,n.shape,"float32")},t.prototype.fusedConv2d=function(n){var t=n.bias,r=n.activation,e=n.preluActivationWeights,i=this.conv2d(n.input,n.filter,n.convInfo);return t&&(i=this.add(i,t)),r&&(i=fl(this,i,r,e)),i},t.prototype.conv2d=function(n,t,r){ul([n,t],"conv2d");for(var e=r.filterHeight,i=r.filterWidth,o=r.dilationHeight,a=r.dilationWidth,u=r.padInfo.left,s=r.padInfo.top,c="channelsLast"===r.dataFormat,f=Fr(r.outShape,n.dtype),l=n.strides[0],d=c?n.strides[1]:n.strides[2],h=c?n.strides[2]:1,v=c?1:n.strides[1],p=f.strides[0],m=c?f.strides[1]:f.strides[2],x=c?f.strides[2]:1,y=c?1:f.strides[1],b=this.readSync(n.dataId),g=this.readSync(t.dataId),w=f.values,C=0;C<r.batchSize;++C)for(var N=C*l,E=C*p,R=0;R<r.outHeight;++R)for(var A=E+R*m,_=R*r.strideHeight-s,O=0;O<e;O++){var S=_+O*o;if(!(S<0||S>=r.inHeight))for(var T=O*t.strides[0],I=N+S*d,M=0;M<r.outWidth;++M)for(var k=A+M*x,D=M*r.strideWidth-u,F=0;F<i;F++){var V=D+F*a;if(!(V<0||V>=r.inWidth))for(var P=I+V*h,L=T+F*t.strides[1],B=0;B<r.inChannels;++B){for(var W=b[P+B*v],z=0;z<r.outChannels;++z)w[k+z*y]+=W*g[L+z];L+=r.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(n,t,r){for(var e=r.filterDepth,i=r.filterHeight,o=r.filterWidth,a=r.dilationDepth,u=r.dilationHeight,s=r.dilationWidth,c=r.padInfo.front,f=r.padInfo.left,l=r.padInfo.top,d=Fr(r.outShape,n.dtype),h=this.readSync(n.dataId),v=this.readSync(t.dataId),p=d.values,m=0;m<r.batchSize;++m)for(var x=m*n.strides[0],y=m*d.strides[0],b=0;b<r.outDepth;++b)for(var g=y+b*d.strides[1],w=b*r.strideDepth-c,C=0;C<e;C++){var N=w+C*a;if(!(N<0||N>=r.inDepth))for(var E=C*t.strides[0],R=x+N*n.strides[1],A=0;A<r.outHeight;++A)for(var _=g+A*d.strides[2],O=A*r.strideHeight-l,S=0;S<i;S++){var T=O+S*u;if(!(T<0||T>=r.inHeight))for(var I=E+S*t.strides[1],M=R+T*n.strides[2],k=0;k<r.outWidth;++k)for(var D=_+k*r.outChannels,F=k*r.strideWidth-f,V=0;V<o;V++){var P=F+V*s;if(!(P<0||P>=r.inWidth))for(var L=M+P*r.inChannels,B=I+V*t.strides[2],W=0;W<r.inChannels;++W){for(var z=h[L+W],G=0;G<r.outChannels;++G)p[D+G]+=z*v[B+G];B+=r.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(n,t,r){ul([n,t],"conv2dDerInput");for(var e=Fr(r.inShape,"float32"),i=e.values,o=this.readSync(n.dataId),a=this.readSync(t.dataId),u=t.strides,s=u[0],c=u[1],f=u[2],l=r.batchSize,d=r.filterHeight,h=r.filterWidth,v=r.inChannels,p=r.inHeight,m=r.inWidth,x=r.outChannels,y=r.outHeight,b=r.outWidth,g=r.strideHeight,w=r.strideWidth,C=d-1-r.padInfo.top,N=h-1-r.padInfo.left,E="channelsLast"===r.dataFormat,R=e.strides[0],A=E?e.strides[1]:e.strides[2],_=E?e.strides[2]:1,O=E?1:e.strides[1],S=n.strides[0],T=E?n.strides[1]:n.strides[2],I=E?n.strides[2]:1,M=E?1:n.strides[1],k=0;k<l;++k)for(var D=0;D<v;++D)for(var F=0;F<p;++F)for(var V=F-C,P=Math.max(0,Math.ceil(V/g)),L=Math.min(y,(d+V)/g),B=0;B<m;++B){for(var W=B-N,z=Math.max(0,Math.ceil(W/w)),G=Math.min(b,(h+W)/w),U=0,q=P;q<L;++q)for(var j=q*g-V,H=z;H<G;++H)for(var X=S*k+T*q+I*H,$=s*(d-1-j)+c*(h-1-(H*w-W))+f*D,K=0;K<x;++K)U+=o[X+M*K]*a[$+K];i[R*k+A*F+_*B+O*D]=U}return e.toTensor()},t.prototype.conv3dDerInput=function(n,t,r){for(var e=Fr(r.inShape,"float32"),i=e.values,o=e.strides,a=o[0],u=o[1],s=o[2],c=o[3],f=this.readSync(n.dataId),l=n.strides,d=l[0],h=l[1],v=l[2],p=l[3],m=this.readSync(t.dataId),x=t.strides,y=x[0],b=x[1],g=x[2],w=x[3],C=r.batchSize,N=r.filterDepth,E=r.filterHeight,R=r.filterWidth,A=r.inChannels,_=r.inDepth,O=r.inHeight,S=r.inWidth,T=r.outChannels,I=r.outDepth,M=r.outHeight,k=r.outWidth,D=r.strideDepth,F=r.strideHeight,V=r.strideWidth,P=N-1-r.padInfo.front,L=E-1-r.padInfo.top,B=R-1-r.padInfo.left,W=0;W<C;++W)for(var z=0;z<A;++z)for(var G=0;G<_;++G)for(var U=G-P,q=Math.max(0,Math.ceil(U/D)),j=Math.min(I,(N+U)/D),H=0;H<O;++H)for(var X=H-L,$=Math.max(0,Math.ceil(X/F)),K=Math.min(M,(E+X)/F),Y=0;Y<S;++Y){for(var J=Y-B,Z=Math.max(0,Math.ceil(J/V)),Q=Math.min(k,(R+J)/V),nn=0,tn=q;tn<j;++tn)for(var rn=tn*D-U,en=$;en<K;++en)for(var on=en*F-X,an=Z;an<Q;++an)for(var un=d*W+h*tn+v*en+p*an,sn=y*(N-1-rn)+b*(E-1-on)+g*(R-1-(an*V-J))+w*z,cn=0;cn<T;++cn)nn+=f[un+cn]*m[sn+cn];i[a*W+u*G+s*H+c*Y+z]=nn}return e.toTensor()},t.prototype.conv2dDerFilter=function(n,t,r){ul([n,t],"conv2dDerFilter");for(var e=r.strideHeight,i=r.strideWidth,o=r.filterHeight,a=r.filterWidth,u="channelsLast"===r.dataFormat,s=Fr(r.filterShape,"float32"),c=r.padInfo.left,f=r.padInfo.top,l=this.bufferSync(n),d=this.bufferSync(t),h=0;h<o;++h)for(var v=Math.max(0,Math.ceil((f-h)/e)),p=Math.min(r.outHeight,(r.inHeight+f-h)/e),m=0;m<a;++m)for(var x=Math.max(0,Math.ceil((c-m)/i)),y=Math.min(r.outWidth,(r.inWidth+c-m)/i),b=0;b<r.inChannels;++b)for(var g=0;g<r.outChannels;++g){for(var w=0,C=0;C<r.batchSize;++C)for(var N=v;N<p;++N)for(var E=h+N*e-f,R=x;R<y;++R){var A=m+R*i-c;w+=u?l.get(C,E,A,b)*d.get(C,N,R,g):l.get(C,b,E,A)*d.get(C,g,N,R)}s.set(w,h,m,b,g)}return s.toTensor()},t.prototype.conv3dDerFilter=function(n,t,r){for(var e=r.strideDepth,i=r.strideHeight,o=r.strideWidth,a=r.filterDepth,u=r.filterHeight,s=r.filterWidth,c=Fr(r.filterShape,"float32"),f=c.values,l=c.strides,d=l[0],h=l[1],v=l[2],p=l[3],m=this.readSync(t.dataId),x=t.strides,y=x[0],b=x[1],g=x[2],w=x[3],C=this.readSync(n.dataId),N=n.strides,E=N[0],R=N[1],A=N[2],_=N[3],O=r.padInfo.front,S=r.padInfo.left,T=r.padInfo.top,I=0;I<a;++I)for(var M=Math.max(0,Math.ceil((O-I)/e)),k=Math.min(r.outDepth,(r.inDepth+O-I)/e),D=I*d,F=0;F<u;++F)for(var V=Math.max(0,Math.ceil((T-F)/i)),P=Math.min(r.outHeight,(r.inHeight+T-F)/i),L=F*h+D,B=0;B<s;++B)for(var W=Math.max(0,Math.ceil((S-B)/o)),z=Math.min(r.outWidth,(r.inWidth+S-B)/o),G=B*v+L,U=0;U<r.inChannels;++U)for(var q=U*p+G,j=0;j<r.outChannels;++j){for(var H=0,X=0;X<r.batchSize;++X)for(var $=X*E,K=X*y,Y=M;Y<k;++Y)for(var J=(I+Y*e-O)*R+$,Z=Y*b+K,Q=V;Q<P;++Q)for(var nn=(F+Q*i-T)*A+J,tn=Q*g+Z,rn=W;rn<z;++rn)H+=C[(B+rn*o-S)*_+nn+U]*m[rn*w+tn+j];f[q+j]=H}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(n){var t=n.bias,r=n.activation,e=n.preluActivationWeights,i=this.depthwiseConv2D(n.input,n.filter,n.convInfo);return t&&(i=this.add(i,t)),r&&(i=fl(this,i,r,e)),i},t.prototype.depthwiseConv2D=function(n,t,r){ul([n,t],"depthwiseConv2D");for(var e=r.filterHeight,i=r.filterWidth,o=r.dilationHeight,a=r.dilationWidth,u=r.padInfo.left,s=r.padInfo.top,c=r.outChannels/r.inChannels,f=Fr(r.outShape,n.dtype),l=this.readSync(n.dataId),d=this.readSync(t.dataId),h=f.values,v=0;v<r.batchSize;++v)for(var p=v*n.strides[0],m=v*f.strides[0],x=0;x<r.outHeight;++x)for(var y=m+x*f.strides[1],b=x*r.strideHeight-u,g=0;g<e;++g){var w=b+g*o;if(!(w<0||w>=r.inHeight))for(var C=g*t.strides[0],N=p+w*n.strides[1],E=0;E<r.outWidth;++E)for(var R=y+E*f.strides[2],A=E*r.strideWidth-s,_=0;_<i;++_){var O=A+_*a;if(!(O<0||O>=r.inWidth))for(var S=N+O*r.inChannels,T=R,I=C+_*t.strides[1],M=0;M<r.inChannels;++M){for(var k=l[S+M],D=0;D<c;++D)h[T+D]+=k*d[I+D];T+=c,I+=c}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(n,t,r){ul([n,t],"depthwiseConv2DDerInput");for(var e=Fr(r.inShape,"float32"),i=e.values,o=e.strides,a=o[0],u=o[1],s=o[2],c=this.readSync(n.dataId),f=n.strides,l=f[0],d=f[1],h=f[2],v=this.readSync(t.dataId),p=t.strides,m=p[0],x=p[1],y=p[2],b=r.batchSize,g=r.filterHeight,w=r.filterWidth,C=r.inChannels,N=r.inHeight,E=r.inWidth,R=r.outHeight,A=r.outWidth,_=r.strideHeight,O=r.strideWidth,S=g-1-r.padInfo.top,T=w-1-r.padInfo.left,I=r.outChannels/C,M=0;M<b;++M)for(var k=0;k<C;++k)for(var D=0;D<N;++D)for(var F=D-S,V=Math.max(0,Math.ceil(F/_)),P=Math.min(R,(g+F)/_),L=0;L<E;++L){for(var B=L-T,W=Math.max(0,Math.ceil(B/O)),z=Math.min(A,(w+B)/O),G=0,U=V;U<P;++U)for(var q=U*_-F,j=W;j<z;++j)for(var H=l*M+d*U+h*j,X=m*(g-1-q)+x*(w-1-(j*O-B))+y*k,$=0;$<I;++$)G+=c[H+(k*I+$)]*v[X+$];i[a*M+u*D+s*L+k]=G}return e.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(n,t,r){ul([n,t],"depthwiseConv2DDerFilter");for(var e=r.strideHeight,i=r.strideWidth,o=r.filterHeight,a=r.filterWidth,u=Fr(r.filterShape,"float32"),s=r.padInfo.left,c=r.padInfo.top,f=r.outChannels/r.inChannels,l=this.bufferSync(n),d=this.bufferSync(t),h=0;h<o;++h)for(var v=Math.max(0,Math.ceil((c-h)/e)),p=Math.min(r.outHeight,(r.inHeight+c-h)/e),m=0;m<a;++m)for(var x=Math.max(0,Math.ceil((s-m)/i)),y=Math.min(r.outWidth,(r.inWidth+s-m)/i),b=0;b<r.outChannels;++b){for(var g=Math.trunc(b/f),w=b%f,C=0,N=0;N<r.batchSize;++N)for(var E=v;E<p;++E)for(var R=h+E*e-c,A=x;A<y;++A)C+=l.get(N,R,m+A*i-s,g)*d.get(N,E,A,b);u.set(C,h,m,g,w)}return u.toTensor()},t.prototype.tile=function(n,t){return ul(n,"tile"),uo(this.bufferSync(n),t)},t.prototype.pad=function(n,t,r){ul(n,"pad");var e=t.map((function(t,r){return t[0]+n.shape[r]+t[1]})),i=t.map((function(n){return n[0]})),o=this.bufferSync(n),a=Fr(e,n.dtype);0!==r&&a.values.fill(r);for(var u=0;u<n.size;u++){var s=o.indexToLoc(u),c=s.map((function(n,t){return n+i[t]}));a.set.apply(a,[o.get.apply(o,s)].concat(c))}return a.toTensor()},t.prototype.gather=function(n,t,r){ul([n,t],"gather");var e=n.shape.slice(),i=this.readSync(t.dataId);e[r]=i.length;for(var o=Fr(e,n.dtype),a=this.bufferSync(n),u=0;u<o.size;++u){var s=o.indexToLoc(u),c=s.slice();c[r]=i[s[r]];var f=a.locToIndex(c);o.values[u]=a.values[f]}return o.toTensor()},t.prototype.batchToSpaceND=function(n,t,r){ul([n],"batchToSpaceND");var e=t.reduce((function(n,t){return n*t})),i=$r(n.shape,t,e),o=Kr(i.length,t.length),a=Yr(n.shape,t,e),u=Jr(r,t.length),s=Zr(a,r,t.length);return Oi(n.reshape(i),o).reshape(a).slice(u,s)},t.prototype.spaceToBatchND=function(n,t,r){ul([n],"spaceToBatchND");var e=t.reduce((function(n,t){return n*t})),i=[[0,0]];i.push.apply(i,r);for(var o=1+t.length;o<n.shape.length;++o)i.push([0,0]);var a=n.pad(i),u=$r(a.shape,t,e,!1),s=Kr(u.length,t.length,!1),c=Yr(a.shape,t,e,!1);return Oi(a.reshape(u),s).reshape(c)},t.prototype.maxPool=function(n,t){return ul(n,"maxPool"),sl(this.readSync(n.dataId),0,n.dtype,n.strides,t,"max").toTensor()},t.prototype.maxPoolBackprop=function(n,t,r,e){ul([t,r],"maxPoolBackprop");for(var i=this.readSync(t.dataId),o=Fr(e.outShape,t.dtype,cl(i,t.shape,t.dtype,e).values),a=e.strideHeight,u=e.strideWidth,s=e.dilationHeight,c=e.dilationWidth,f=e.effectiveFilterHeight,l=e.effectiveFilterWidth,d=l-1-e.padInfo.left,h=f-1-e.padInfo.top,v=Fr(t.shape,"float32"),p=this.bufferSync(n),m=0;m<e.batchSize;++m)for(var x=0;x<e.inChannels;++x)for(var y=0;y<e.inHeight;++y)for(var b=0;b<e.inWidth;++b){for(var g=y-h,w=b-d,C=0,N=0;N<f;N+=s){var E=(g+N)/a;if(!(E<0||E>=e.outHeight||Math.floor(E)!==E))for(var R=0;R<l;R+=c){var A=(w+R)/u;if(!(A<0||A>=e.outWidth||Math.floor(A)!==A)){var _=f*l-1-o.get(m,E,A,x)===N*l+R?1:0;0!==_&&(C+=p.get(m,E,A,x)*_)}}}v.set(C,m,y,b,x)}return v.toTensor()},t.prototype.avgPoolBackprop=function(n,t,r){ul([n,t],"avgPoolBackprop");for(var e=r.strideHeight,i=r.strideWidth,o=r.filterHeight,a=r.filterWidth,u=r.dilationHeight,s=r.dilationWidth,c=r.effectiveFilterHeight,f=r.effectiveFilterWidth,l=f-1-r.padInfo.left,d=c-1-r.padInfo.top,h=Fr(t.shape,"float32"),v=1/(o*a),p=this.bufferSync(n),m=0;m<r.batchSize;++m)for(var x=0;x<r.inChannels;++x)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var g=y-d,w=b-l,C=0,N=0;N<c;N+=u){var E=(g+N)/e;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var R=0;R<f;R+=s){var A=(w+R)/i;A<0||A>=r.outWidth||Math.floor(A)!==A||(C+=p.get(m,E,A,x))}}h.set(C*v,m,y,b,x)}return h.toTensor()},t.prototype.pool3d=function(n,t,r){ul(n,"pool3d");for(var e=t.strideDepth,i=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,s=t.dilationWidth,c=t.effectiveFilterDepth,f=t.effectiveFilterHeight,l=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,v=t.padInfo.left,p="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(n.dataId),x=Fr(t.outShape,n.dtype),y=x.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],g=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],C=t.outShape[4],N=0;N<t.batchSize;++N)for(var E=N*b,R=N*n.strides[0],A=0;A<t.inChannels;++A)for(var _=0;_<t.outDepth;++_){for(var O=_*e-d,S=O;S<0;)S+=a;for(var T=Math.min(t.inDepth,c+O),I=E+_*g,M=0;M<t.outHeight;++M){for(var k=M*i-h,D=k;D<0;)D+=u;for(var F=Math.min(t.inHeight,f+k),V=I+M*w,P=0;P<t.outWidth;++P){for(var L=P*o-v,B=L;B<0;)B+=s;for(var W=Math.min(t.inWidth,l+L),z=V+P*C,G=p,U=0,q=0,j=S;j<T;j+=a){for(var H=R+j*n.strides[1],X=D;X<F;X+=u){for(var $=H+X*n.strides[2],K=B;K<W;K+=s){var Y=m[$+K*n.strides[3]+A];if("max"===r&&Y>G?G=Y:"avg"===r&&(U+=Y,q++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}y[z+A]="avg"===r?U/q:G}}}return x.toTensor()},t.prototype.avgPool3d=function(n,t){return ul(n,"avgPool3d"),this.pool3d(n,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(n,t,r){ul([n,t],"avgPool3dBackprop");for(var e=r.strideDepth,i=r.strideHeight,o=r.strideWidth,a=r.filterDepth,u=r.filterHeight,s=r.filterWidth,c=r.dilationDepth,f=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,v=r.effectiveFilterWidth,p=d-1-r.padInfo.front,m=v-1-r.padInfo.left,x=h-1-r.padInfo.top,y=Fr(t.shape,"float32"),b=1/(a*u*s),g=this.bufferSync(n),w=0;w<r.batchSize;++w)for(var C=0;C<r.inChannels;++C)for(var N=0;N<r.inDepth;++N)for(var E=0;E<r.inHeight;++E)for(var R=0;R<r.inWidth;++R){for(var A=N-p,_=E-x,O=R-m,S=0,T=0;T<d;T+=c){var I=(A+T)/e;if(!(I<0||I>=r.outDepth||Math.floor(I)!==I))for(var M=0;M<h;M+=f){var k=(_+M)/i;if(!(k<0||k>=r.outHeight||Math.floor(k)!==k))for(var D=0;D<v;D+=l){var F=(O+D)/o;F<0||F>=r.outWidth||Math.floor(F)!==F||(S+=g.get(w,I,k,F,C))}}}y.set(S*b,w,N,E,R,C)}return y.toTensor()},t.prototype.maxPool3d=function(n,t){return ul(n,"maxPool3d"),this.pool3d(n,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(n,t){for(var r=Fr(t.outShape,"int32"),e=t.strideDepth,i=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,s=t.dilationWidth,c=t.effectiveFilterDepth,f=t.effectiveFilterHeight,l=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,v=t.padInfo.left,p=this.bufferSync(n),m=0;m<t.batchSize;++m)for(var x=0;x<t.inChannels;++x)for(var y=0;y<t.outDepth;++y){for(var b=y*e-d,g=b;g<0;)g+=a;for(var w=Math.min(t.inDepth,c+b),C=0;C<t.outHeight;++C){for(var N=C*i-h,E=N;E<0;)E+=u;for(var R=Math.min(t.inHeight,f+N),A=0;A<t.outWidth;++A){for(var _=A*o-v,O=_;O<0;)O+=s;for(var S=Math.min(t.inWidth,l+_),T=Number.NEGATIVE_INFINITY,I=-1,M=g;M<w;M+=a)for(var k=M-b,D=E;D<R;D+=u)for(var F=D-N,V=O;V<S;V+=s){var P=V-_,L=p.get(m,M,D,V,x);L>=T&&(T=L,I=k*f*l+F*f+P)}r.set(I,m,y,C,A,x)}}}return r.toTensor()},t.prototype.maxPool3dBackprop=function(n,t,r,e){ul([t,r],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,e),o=e.strideDepth,a=e.strideHeight,u=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,f=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,v=l-1-e.padInfo.front,p=h-1-e.padInfo.left,m=d-1-e.padInfo.top,x=Fr(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(n),g=0;g<e.batchSize;++g)for(var w=0;w<e.inChannels;++w)for(var C=0;C<e.inDepth;++C)for(var N=0;N<e.inHeight;++N)for(var E=0;E<e.inWidth;++E){for(var R=C-v,A=N-m,_=E-p,O=0,S=0;S<l;S+=s){var T=(R+S)/o;if(!(T<0||T>=e.outDepth||Math.floor(T)!==T))for(var I=0;I<d;I+=c){var M=(A+I)/a;if(!(M<0||M>=e.outHeight||Math.floor(M)!==M))for(var k=0;k<h;k+=f){var D=(_+k)/u;if(!(D<0||D>=e.outWidth||Math.floor(D)!==D)){var F=l*d*h-1-y.get(g,T,M,D,w)===S*d*h+I*h+k?1:0;0!==F&&(O+=b.get(g,T,M,D,w)*F)}}}}x.set(O,g,C,N,E,w)}return x.toTensor()},t.prototype.cast=function(n,t){return qi(n,t,this)},t.prototype.reshape=function(n,t){return ji(n,t)},t.prototype.avgPool=function(n,t){return ul(n,"avgPool"),ul(n,"maxPool"),sl(this.readSync(n.dataId),0,n.dtype,n.strides,t,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(n,t,r,e){ul(n,"resizeBilinear");for(var i=n.shape,o=i[0],a=i[1],u=i[2],s=i[3],c=this.readSync(n.dataId),f=new Float32Array(_([o,t,r,s])),l=[e&&t>1?a-1:a,e&&r>1?u-1:u],d=[e&&t>1?t-1:t,e&&r>1?r-1:r],h=0,v=l[0]/d[0],p=l[1]/d[1],m=0;m<o;m++)for(var x=0;x<t;x++)for(var y=v*x,b=Math.floor(y),g=y-b,w=Math.min(a-1,Math.ceil(y)),C=m*n.strides[0]+b*n.strides[1],N=m*n.strides[0]+w*n.strides[1],E=0;E<r;E++)for(var R=p*E,A=Math.floor(R),O=R-A,S=Math.min(u-1,Math.ceil(R)),T=C+A*n.strides[2],I=N+A*n.strides[2],M=C+S*n.strides[2],k=N+S*n.strides[2],D=0;D<s;D++){var F=c[T+D],V=c[I+D],P=F+(c[M+D]-F)*O;f[h++]=P+(V+(c[k+D]-V)*O-P)*g}return dr(f,[o,t,r,s])},t.prototype.resizeBilinearBackprop=function(n,t,r){ul([n,t],"resizeBilinearBackprop");for(var e=t.shape,i=e[0],o=e[1],a=e[2],u=e[3],s=n.shape,c=s[1],f=s[2],l=new Float32Array(i*o*a*u),d=[r&&c>1?o-1:o,r&&f>1?a-1:a],h=[r&&c>1?c-1:c,r&&f>1?f-1:f],v=d[0]/h[0],p=d[1]/h[1],m=this.readSync(n.dataId),x=0,y=0;y<i;y++)for(var b=y*t.strides[0],g=0;g<c;g++)for(var w=g*v,C=Math.floor(w),N=Math.min(Math.ceil(w),o-1),E=b+C*t.strides[1],R=b+N*t.strides[1],A=w-C,_=1-A,O=0;O<f;O++)for(var S=O*p,T=Math.floor(S),I=Math.min(Math.ceil(S),a-1),M=S-T,k=1-M,D=E+T*t.strides[2],F=E+I*t.strides[2],V=R+T*t.strides[2],P=R+I*t.strides[2],L=_*k,B=_*M,W=A*k,z=A*M,G=0;G<u;G++){var U=m[x++];l[D+G]+=U*L,l[F+G]+=U*B,l[V+G]+=U*W,l[P+G]+=U*z}return yr(l,[i,a,o,u],t.dtype)},t.prototype.resizeNearestNeighbor=function(n,t,r,e){ul(n,"resizeNearestNeighbor");for(var i=n.shape,o=i[0],a=i[1],u=i[2],s=i[3],c=this.readSync(n.dataId),f=new Float32Array(o*t*r*s),l=[e&&t>1?a-1:a,e&&r>1?u-1:u],d=[e&&t>1?t-1:t,e&&r>1?r-1:r],h=l[0]/d[0],v=l[1]/d[1],p=0,m=0;m<o;m++)for(var x=m*n.strides[0],y=0;y<t;y++)for(var b=h*y,g=x+Math.min(a-1,e?Math.round(b):Math.floor(b))*n.strides[1],w=0;w<r;w++)for(var C=v*w,N=g+Math.min(u-1,e?Math.round(C):Math.floor(C))*n.strides[2],E=0;E<s;E++)f[p++]=c[N+E];return dr(f,[o,t,r,s],n.dtype)},t.prototype.resizeNearestNeighborBackprop=function(n,t,r){ul([n,t],"resizeNearestNeighborBackprop");for(var e=t.shape,i=e[0],o=e[1],a=e[2],u=e[3],s=n.shape,c=s[1],f=s[2],l=new Float32Array(i*o*a*u),d=this.readSync(n.dataId),h=[r&&c>1?o-1:o,r&&f>1?a-1:a],v=[r&&c>1?c-1:c,r&&f>1?f-1:f],p=h[0]/v[0],m=h[1]/v[1],x=1/p,y=1/m,b=2*Math.ceil(x)+2,g=2*Math.ceil(y)+2,w=0;w<i;w++)for(var C=w*t.strides[0],N=0;N<o;N++)for(var E=C+N*t.strides[1],R=Math.floor(N*x),A=Math.floor(R-b/2),_=0;_<a;_++)for(var O=E+_*t.strides[2],S=Math.floor(_*y),T=Math.floor(S-g/2),I=0;I<u;I++){for(var M=0,k=0;k<b;k++){var D=k+A;if(!(D<0||D>=c)){var F=C+D*n.strides[1],V=D*p;if(N===Math.min(o-1,r?Math.round(V):Math.floor(V)))for(var P=0;P<g;P++){var L=P+T;if(!(L<0||L>=f)){var B=F+L*n.strides[2],W=L*m;_===Math.min(a-1,r?Math.round(W):Math.floor(W))&&(M+=d[B+I])}}}}l[O+I]=M}return yr(l,t.shape,t.dtype)},t.prototype.batchNormalization=function(n,t,r,e,i,o){ul([n,t,r,i,o],"batchNorm");for(var a=this.readSync(n.dataId),u=this.readSync(t.dataId),s=this.readSync(r.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),f=o?this.readSync(o.dataId):new Float32Array([0]),l=new Float32Array(a.length),d=f.length,h=c.length,v=s.length,p=u.length,m=0,x=0,y=0,b=0,g=0;g<a.length;++g)l[g]=f[m++]+(a[g]-u[x++])*c[y++]/Math.sqrt(s[b++]+e),m>=d&&(m=0),x>=p&&(x=0),y>=h&&(y=0),b>=v&&(b=0);return yr(l,n.shape)},t.prototype.localResponseNormalization4D=function(n,t,r,e,i){ul(n,"localResponseNormalization4D");var o=n.shape[3],a=o-1,u=this.readSync(n.dataId),s=n.size,c=new Float32Array(s);function f(n){for(var r=n%o,e=n-r+Math.max(0,r-t),i=n-r+Math.min(r+t,a),s=0;e<=i;e++){var c=u[e];s+=c*c}return s}for(var l=0;l<s;l++){var d=f(l),h=u[l]*Math.pow(r+e*d,-i);c[l]=h}return yr(c,n.shape)},t.prototype.LRNGrad=function(n,t,r,e,i,o,a){ul(n,"LRNGrad");for(var u=n.shape[3],s=this.readSync(n.dataId),c=this.readSync(t.dataId),f=this.readSync(r.dataId),l=new Float32Array(n.size),d=n.size,h=0;h<d;h++){for(var v=h%u,p=h-v+Math.max(0,v-e),m=h-v+Math.min(u,v+e+1),x=0,y=p;y<m;y++)x+=Math.pow(c[y],2);for(x=o*x+i,y=p;y<m;y++){var b=-2*o*a*c[y]*f[h]/x;h===y&&(b+=Math.pow(x,-a)),l[y]+=b*=s[h]}}return yr(l,n.shape)},t.prototype.multinomial=function(n,t,r,e){ul(n,"multinomial");for(var i=t?n:Ai(n),o=i.shape[0],a=i.shape[1],u=Nr([o,r],"int32"),s=this.readSync(u.dataId),c=this.readSync(i.dataId),f=0;f<o;++f){var l=f*a,d=new Float32Array(a-1);d[0]=c[l];for(var h=1;h<d.length;++h)d[h]=d[h-1]+c[l+h];for(var v=Xu(e.toString()),p=f*r,m=0;m<r;++m){var x=v();s[p+m]=d.length;for(var y=0;y<d.length;y++)if(x<d[y]){s[p+m]=y;break}}}return u},t.prototype.oneHot=function(n,t,r,e){ul(n,"oneHot");var i=new Float32Array(n.size*t);i.fill(e);for(var o=this.readSync(n.dataId),a=0;a<n.size;++a)o[a]>=0&&o[a]<t&&(i[a*t+o[a]]=r);return mr(i,[n.size,t],"int32")},t.prototype.nonMaxSuppression=function(n,t,r,e,i){return ul(n,"nonMaxSuppression"),no(this.readSync(n.dataId),this.readSync(t.dataId),r,e,i)},t.prototype.fft=function(n){return this.fftBatch(n,!1)},t.prototype.ifft=function(n){return this.fftBatch(n,!0)},t.prototype.fftBatch=function(n,t){for(var r=n.shape[0],e=n.shape[1],i=Fr(n.shape,"float32"),o=Fr(n.shape,"float32"),a=fr(n).as2D(r,e),u=lr(n).as2D(r,e),s=0;s<r;s++)for(var c=a.slice([s,0],[1,e]),f=u.slice([s,0],[1,e]),l=cr(c,f),d=this.readSync(this.fftImpl(l,t).dataId),h=0;h<e;h++){var v=Ki(d,h);i.values[s*e+h]=v.real,o.values[s*e+h]=v.imag}return cr(i.toTensor(),o.toTensor()).as2D(r,e)},t.prototype.fftImpl=function(n,t){var r=n.as1D(),e=r.size;if(this.isExponentOf2(e)){var i=this.fftRadix2(r,e,t).as2D(n.shape[0],n.shape[1]);return t&&(i=cr(fr(i).div(vr(e)),lr(i).div(vr(e)))),i}var o=this.readSync(n.dataId),a=function(n){for(var t=new Float32Array(n.length/2),r=new Float32Array(n.length/2),e=0;e<n.length;e+=2)t[e/2]=n[e],r[e/2]=n[e+1];return{real:t,imag:r}}(this.fourierTransformByMatmul(o,e,t));return cr(a.real,a.imag).as2D(n.shape[0],n.shape[1])},t.prototype.isExponentOf2=function(n){return 0==(n&n-1)},t.prototype.fftRadix2=function(n,t,r){if(1===t)return n;var e=this.readSync(n.dataId),i=t/2,o=function(n){for(var t=Math.ceil(n.length/4),r=new Float32Array(t),e=new Float32Array(t),i=0;i<n.length;i+=4)r[Math.floor(i/4)]=n[i],e[Math.floor(i/4)]=n[i+1];return{real:r,imag:e}}(e),a=cr(o.real,o.imag).as1D(),u=function(n){for(var t=Math.floor(n.length/4),r=new Float32Array(t),e=new Float32Array(t),i=2;i<n.length;i+=4)r[Math.floor(i/4)]=n[i],e[Math.floor(i/4)]=n[i+1];return{real:r,imag:e}}(e),s=cr(u.real,u.imag).as1D();a=this.fftRadix2(a,i,r),s=this.fftRadix2(s,i,r);var c=function(n,t){for(var r=new Float32Array(n/2),e=new Float32Array(n/2),i=0;i<Math.ceil(n/2);i++){var o=(t?2:-2)*Math.PI*(i/n);r[i]=Math.cos(o),e[i]=Math.sin(o)}return{real:r,imag:e}}(t,r),f=cr(c.real,c.imag).mul(s),l=a.add(f),d=a.sub(f),h=fr(l).concat(fr(d)),v=lr(l).concat(lr(d));return cr(h,v).as1D()},t.prototype.fourierTransformByMatmul=function(n,t,r){for(var e=new Float32Array(2*t),i=0;i<t;i++){for(var o=0,a=0,u=0;u<t;u++){var s=Ji(i*u,t,r),c=Ki(n,u);o+=c.real*s.real-c.imag*s.imag,a+=c.real*s.imag+c.imag*s.real}r&&(o/=t,a/=t),Yi(e,o,a,i)}return e},t.prototype.depthToSpace=function(n,t,r){N("NHWC"===r,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r})),N(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var e=n.shape[0],i=n.shape[1],o=n.shape[2],a=n.shape[3],u=i*t,s=o*t,c=a/(t*t),f=this.readSync(n.dataId),l=new Float32Array(e*u*s*c),d=0,h=0;h<e;++h)for(var v=0;v<u;++v)for(var p=Math.floor(v/t),m=v%t,x=0;x<s;++x)for(var y=Math.floor(x/t),b=(m*t+x%t)*c,g=0;g<c;++g)l[d++]=f[g+b+a*(y+o*(p+i*h))];return yr(l,[e,u,s,c])},t.prototype.broadcastedBinaryOp=function(n,t,r,e){var i=ce(n.shape,t.shape),o=Fr(i,r),a=this.readSync(n.dataId),u=this.readSync(t.dataId),s=ue(n.shape,i),c=ue(t.shape,i),f=o.values;if(s.length+c.length===0)for(var l=0;l<f.length;++l)f[l]=e(a[l%a.length],u[l%u.length]);else{var d=this.bufferSync(n),h=this.bufferSync(t),v=function(r){var i=o.indexToLoc(r),l=i.slice(-n.rank);s.forEach((function(n){return l[n]=0}));var v=d.locToIndex(l),p=i.slice(-t.rank);c.forEach((function(n){return p[n]=0}));var m=h.locToIndex(p);f[r]=e(a[v],u[m])};for(l=0;l<f.length;++l)v(l)}return o.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(n,t,r){var e=ce(n.shape,t.shape),i=Fr(e,"float32"),o=Fr(e,"float32"),a=this.readSync(n.dataId),u=this.readSync(t.dataId),s=ue(n.shape,e),c=ue(t.shape,e),f=i.values,l=o.values;if(s.length+c.length===0)for(var d=0;d<f.length;d++){var h=d%a.length,v=d%u.length,p=r(a[2*h],a[2*h+1],u[2*v],u[2*v+1]);f[d]=p.real,l[d]=p.imag}else{var m=this.bufferSync(this.data.get(n.dataId).complexTensors.real),x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(e){var o=i.indexToLoc(e),d=o.slice(-n.rank);s.forEach((function(n){return d[n]=0}));var h=m.locToIndex(d),v=o.slice(-t.rank);c.forEach((function(n){return v[n]=0}));var p=x.locToIndex(v),y=r(a[2*h],a[2*h+1],u[2*p],u[2*p+1]);f[e]=y.real,l[e]=y.imag};for(d=0;d<f.length;d++)y(d)}return this.complex(i.toTensor(),o.toTensor())},t.prototype.split=function(n,t,r){return ao(n,t,r)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(n,t,r,e,i,o){for(var a=n.shape,u=a[0],s=a[1],c=a[2],f=a[3],l=t.shape[0],d=e[0],h=e[1],v=Fr([l,d,h,f],"float32"),p=this.readSync(t.dataId),m=this.readSync(r.dataId),x=this.readSync(n.dataId),y=n.strides,b=v.strides,g=0;g<l;g++){var w=4*g,C=p[w],N=p[w+1],E=p[w+2],R=p[w+3],A=m[g];if(!(A>=u))for(var _=d>1?(E-C)*(s-1)/(d-1):0,O=h>1?(R-N)*(c-1)/(h-1):0,S=0;S<d;S++){var T=d>1?C*(s-1)+S*_:.5*(C+E)*(s-1);if(T<0||T>s-1)for(var I=0;I<h;I++)for(var M=0;M<f;M++){var k=M+I*b[2]+S*b[1]+g*b[0];v.values[k]=o}else if("bilinear"===i){var D=Math.floor(T),F=Math.ceil(T),V=T-D;for(I=0;I<h;I++)if((j=h>1?N*(c-1)+I*O:.5*(N+R)*(c-1))<0||j>c-1)for(M=0;M<f;M++)v.values[k=M+I*b[2]+S*b[1]+g*b[0]]=o;else{var P=Math.floor(j),L=Math.ceil(j),B=j-P;for(M=0;M<f;M++){var W=x[k=M+P*y[2]+D*y[1]+A*y[0]],z=x[k=M+L*y[2]+D*y[1]+A*y[0]],G=x[k=M+P*y[2]+F*y[1]+A*y[0]],U=W+(z-W)*B,q=G+(x[k=M+L*y[2]+F*y[1]+A*y[0]]-G)*B;v.values[k=M+I*b[2]+S*b[1]+g*b[0]]=U+(q-U)*V}}}else for(I=0;I<h;++I){var j;if((j=h>1?N*(c-1)+I*O:.5*(N+R)*(c-1))<0||j>c-1)for(M=0;M<f;M++)v.values[k=M+I*b[2]+S*b[1]+g*b[0]]=o;else{var H=Math.round(j),X=Math.round(T);for(M=0;M<f;M++)v.values[M+I*b[2]+S*b[1]+g*b[0]]=x[M+H*y[2]+X*y[1]+A*y[0]]}}}}return v.toTensor()},t.prototype.sparseToDense=function(n,t,r,e){var i=hi(0,n,r);return this.scatter(n,t,r,i.outputSize,i.sliceSize,i.numUpdates,i.sliceRank,i.strides,e,!1)},t.prototype.gatherND=function(n,t){var r=t.shape,e=r[r.length-1],i=si(n,t),o=i[0],a=i[1],u=i[2],s=i[3];if(0===a)return dr([],o,n.dtype);for(var c=new pn([a,u],n.dtype),f=this.readSync(t.dataId),l=this.readSync(n.dataId),d=0;d<a;d++){for(var h=[],v=0,p=0;p<e;p++){var m=f[d*e+p];v+=m*s[p],h.push(m)}if(v<0||v>=n.size/u)throw new Error("Invalid indices: "+h+" does not index into "+n.shape);for(var x=0;x<u;x++)c.values[d*u+x]=l[v*u+x]}return c.toTensor().reshape(o)},t.prototype.scatterND=function(n,t,r){var e=hi(0,n,r),i=e.sliceRank,o=e.numUpdates,a=e.sliceSize,u=e.strides,s=e.outputSize,c=vr(0);return this.scatter(n,t,r,s,a,o,i,u,c,!0)},t.prototype.fill=function(n,t,r){var e=L(r=r||$(t),_(n));return e.fill(t),Vn.makeTensor(e,n,r,this)},t.prototype.onesLike=function(n){if("string"===n.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){var t=L(n.dtype,_(n.shape));return this.makeOutput(t,n.shape,n.dtype)},t.prototype.linspace=function(n,t,r){return Hi(n,t,r)},t.prototype.scatter=function(n,t,r,e,i,o,a,u,s,c){var f=[e/i,i],l=this.readSync(n.dataId),d=this.readSync(t.dataId);if(0===e)return dr([],r,t.dtype);var h=new pn(f,t.dtype);h.values.fill(this.readSync(s.dataId)[0]);for(var v=0;v<o;v++){for(var p=[],m=0,x=0;x<a;x++){var y=l[v*a+x];p.push(y),m+=y*u[x]}if(m<0||m>=e/i)throw new Error("Invalid indices: "+p+" does not index into "+r);for(var b=0;b<i;b++)c?h.values[m*i+b]+=d[v*i+b]:h.values[m*i+b]=0===t.rank?d[0]:d[v*i+b]}return h.toTensor().reshape(r)},t}(Ti);function dl(n,t){return{kernelName:n,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,i=e.a,o=e.b,a=r.backend;ul([i,o],n);var u=a.data.get(i.dataId).values,s=a.data.get(o.dataId).values,c=t(i.shape,o.shape,u,s,i.dtype),f=c[1];return{dataId:a.write(c[0],f,i.dtype),shape:f,dtype:i.dtype}}}}function hl(n){return function(t,r,e,i,o){var a=ce(t,r),u=a.length,s=J(a),c=P(o,_(a)),f=t.length,l=r.length,d=J(t),h=J(r),v=ue(t,a),p=ue(r,a);if(v.length+p.length===0)for(var m=0;m<c.length;++m)c[m]=n(e[m%e.length],i[m%i.length]);else{var x=function(t){var r=sn(t,u,s),o=r.slice(-f);v.forEach((function(n){return o[n]=0}));var a=un(o,f,d),m=r.slice(-l);p.forEach((function(n){return m[n]=0}));var x=un(m,l,h);c[t]=n(e[a],i[x])};for(m=0;m<c.length;++m)x(m)}return[c,a]}}Vn.registerBackend("cpu",(function(){return new ll}),1);var vl=hl((function(n,t){return n/t})),pl=dl(Qr,vl),ml={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(n){var t=n.attrs,r=n.inputs.x,e=t.filterSize,i=t.strides,o=t.pad,a=t.includeBatchInIndex,u=n.backend;ul(r,"MaxPoolWithArgmax");var s=u.data.get(r.dataId).values,c=Mi(r.shape,e,i,[1,1],o),f=function(n,t,r,e,i){var o=sl(n,0,r,J(t),i,"max"),a=cl(n,t,r,i,!0,e);return[o.values,a.values]}(s,r.shape,r.dtype,a,c),l=f[1],d=u.write(f[0],c.outShape,r.dtype),h=u.write(l,c.outShape,r.dtype);return[{dataId:d,shape:c.outShape,dtype:r.dtype},{dataId:h,shape:c.outShape,dtype:"int32"}]}},xl={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,r=n.attrs,e=t.boxes,i=t.scores,o=r.maxOutputSize,a=r.iouThreshold,u=r.scoreThreshold,s=r.softNmsSigma,c=n.backend;ul(e,"NonMaxSuppressionWithScore");var f=to(c.data.get(e.dataId).values,c.data.get(i.dataId).values,o,a,u,s);return[f.selectedIndices,f.selectedScores]}},yl={kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var t=n.inputs.x,r=n.backend;ul(t,"square");for(var e=r.data.get(t.dataId).values,i=new Float32Array(e.length),o=0;o<e.length;++o){var a=e[o];i[o]=a*a}return{dataId:r.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}},bl=hl((function(n,t){var r=n-t;return r*r}));function gl(n,t,r,e,i){for(var o=_(t),a=t.length,u=J(t),s=J(i),c=P(r,_(i)),f=0;f<o;++f){for(var l=sn(f,a,u),d=new Array(l.length),h=0;h<d.length;h++)d[h]=l[e[h]];c[un(d,a,s)]=n[f]}return c}for(var wl=0,Cl=[xl,yl,dl(ne,bl),pl,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(n){var t=n.inputs.x,r=n.attrs.perm,e=n.backend;ul(t,"transpose");for(var i=new Array(t.shape.length),o=0;o<i.length;o++)i[o]=t.shape[r[o]];var a=gl(e.data.get(t.dataId).values,t.shape,t.dtype,r,i);return{dataId:e.write(a,i,t.dtype),shape:i,dtype:t.dtype}}},ml];wl<Cl.length;wl++)m(Cl[wl]);for(var Nl,El=function(n){this.variableNames=["A"];var t=mo(),r=n[0],e=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+e+".0, "+r+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Rl=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=mo(),r=n[0],e=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+e+".0, "+r+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},Al=function(n,t){this.variableNames=["A"];for(var r=new Array(n.length),e=0;e<r.length;e++)r[e]=n[t[e]];this.outputShape=r,this.rank=r.length;var i=Ao(this.rank),o=function(n){var t=n.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],e=new Array(t),i=0;i<n.length;i++)e[n[i]]=r[i];return e.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},_l=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(n.length),e=0;e<r.length;e++)r[e]=n[t[e]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Ao(this.rank),o=vo("rc",this.rank),a=new Array(this.rank);for(e=0;e<t.length;e++)a[t[e]]=o[e];var u="vec2("+a.slice(-2).join()+")",s="++"+o[this.rank-1]+" < "+r[this.rank-1],c="getChannel(getA("+a.join()+"), "+u+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+s+") {\n        result[1] = "+c+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+r[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+s+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Ol=0,Sl=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var t=n.backend,r=n.inputs.pixels,e="undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement,o=e?[r.videoWidth,r.videoHeight]:[r.width,r.height],a=o[0],u=o[1],s=[u,a],f=[u,a,n.attrs.numChannels];(i||e)&&(null==Nl&&(Nl=document.createElement("canvas").getContext("2d")),Nl.canvas.width=a,Nl.canvas.height=u,Nl.drawImage(r,0,0,a,u),r=Nl.canvas);var l=t.makeTensorInfo(s,"int32");t.texData.get(l.dataId).usage=Wn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(l.dataId),r);var d=c().getBool("WEBGL_PACK")?new Rl(f):new El(f),h=t.runWebGLProgram(d,[l],"int32");return t.disposeData(l.dataId),h}},{kernelName:Qr,backendName:"webgl",kernelFunc:function(n){var t=n.inputs;return function(n,t,r){var e=new Bo("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",n.shape,t.shape);return c().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(e=new zo("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",n.shape,t.shape,!0)),r.runWebGLProgram(e,[n,t],"float32")}(t.a,t.b,n.backend)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,r=n.backend,e=n.attrs;Xt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t.scores,o=e.maxOutputSize,a=e.iouThreshold,u=e.scoreThreshold,s=e.softNmsSigma,c=r,f=to(c.readSync(t.boxes.dataId),c.readSync(i.dataId),o,a,u,s);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var t=n.inputs.x,r=n.backend,e=new bu(t.shape,"return x * x;");return r.runWebGLProgram(e,[t],t.dtype)}},{kernelName:ne,backendName:"webgl",kernelFunc:function(n){var t=n.inputs,r=t.a,e=t.b,i=n.backend,o=c().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zo("return (a - b) * (a - b);",r.shape,e.shape):new Bo("return (a - b) * (a - b);",r.shape,e.shape);return i.compileAndRun(o,[r,e])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(n){for(var t,r=n.inputs.x,e=n.attrs.perm,i=n.backend,o=new Array(r.shape.length),a=0;a<o.length;a++)o[a]=r.shape[e[a]];if(i.shouldExecuteOnCPU([r])){var u=gl(i.texData.get(r.dataId).values,r.shape,r.dtype,e,o);t=i.makeTensorInfo(o,r.dtype),i.texData.get(t.dataId).values=u}else t=function(n,t,r){var e=c().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _l(n.shape,t):new Al(n.shape,t);return r.runWebGLProgram(e,[n],n.dtype)}(r,e,i);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(n){var t=n.attrs,r=n.inputs.x,e=t.filterSize,i=t.strides,o=t.pad,a=t.includeBatchInIndex,u=n.backend;N(4===r.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank "+r.shape.length+"."}));var s=[1,1];N(Gi(i,s),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+s+"'"}));var c=Mi(r.shape,e,i,s,o),f=function(n,t,r,e){var i=new Ja(r,"max",!1),o=e.runWebGLProgram(i,[n],"float32");return i=new Ja(r,"max",!0,!0,t),[o,e.runWebGLProgram(i,[n],"float32")]}(r,a,c,u);return[f[0],f[1]]}}];Ol<Sl.length;Ol++)m(Sl[Ol]);for(var Tl=0,Il=[{kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(n,t){var r=t[0],e=t[1],i=ce(r.shape,e.shape);return{a:function(){var t=n,e=se(r.shape,i);return e.length>0&&(t=t.sum(e)),t.reshape(r.shape)},b:function(){var t=n,r=se(e.shape,i);return r.length>0&&(t=t.sum(r)),t.reshape(e.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(n,t){var r={};return t.forEach((function(t,e){r[e]=function(){return n.clone()}})),r}},{kernelName:te,gradFunc:function(n,t,r){for(var e=r.inputShape,i=r.shape,o=Array.from(i),a=e.length-1;a>=0;a--)if(e[a]===i[a])o[a]=1;else if(1!==e[a])throw new Error("broadcastTo(): ["+e+"] cannot be broadcast to ["+i+"].");var u=[];for(a=0;a<o.length;a++)o[a]>1&&u.push(a);return{x:function(){return n.sum(u,!0)}}}},{kernelName:Qr,inputsToSave:["a","b"],gradFunc:function(n,t){var r=t[0],e=t[1],i=ce(r.shape,e.shape);return{a:function(){var t=ui(n,e.toFloat()),o=se(r.shape,i);return o.length>0?Yc(t,o).reshape(r.shape):t},b:function(){var t=n.mul(r.toFloat()),o=se(e.shape,i);o.length>0&&(t=Yc(t,o).reshape(e.shape));var a=Bs(e);return Oe(ui(t,a.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,t,r){var e=r.varianceEpsilon,i=t[0],o=t[1],a=t[2],u=t[3],s=Yu(i),c=null==u?vr(1):u,f=se(o.shape,s.shape),l=[];if(1===o.rank){for(var d=0;d<s.shape.length-1;++d)l.push(s.shape[d]);l.push(1)}var h=oi(i,o),v=ni(n,c),p=Ie(ae(a,vr(e))),m=ni(ni(ni(p,p),p),vr(-.5));return{x:function(){return Gr(ni(ni(n,1===o.rank?bs(p.as4D(1,1,1,o.shape[0]),l):p),c),i.shape)},mean:function(){var n=ni(ni(p,vr(-1)),v);return 1===o.rank&&(n=Yc(n,f)),Gr(n,o.shape)},variance:function(){var n=ni(ni(m,h),v);return 1===o.rank&&(n=Yc(n,f)),Gr(n,o.shape)},scale:function(){var t=ni(h,p),r=ni(n,t);return 1===o.rank&&(r=Yc(r,f)),Gr(r,o.shape)},offset:function(){var t=n;return 1===o.rank&&(t=Yc(t,f)),Gr(t,o.shape)}}}},{kernelName:ee,gradFunc:function(n){return{x:function(){return n.toFloat()}}}},{kernelName:re,inputsToSave:["indices"],gradFunc:function(n,t){var r=t[0];return{indices:function(){return Nr(r.shape,"float32")}}}},{kernelName:oe,inputsToSave:["x"],gradFunc:function(n,t,r){var e=t[0],i=r.paddings.map((function(n){return n[0]}));return{x:function(){return n.slice(i,e.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(n,t){var r=t[0];return{x:function(){return n.mul(r.toFloat().mul(2))}}}},{kernelName:ne,inputsToSave:["a","b"],gradFunc:function(n,t){var r=t[0],e=t[1],i=vr(2);return{a:function(){return ni(n,ni(i,oi(r,e)))},b:function(){return ni(n,ni(i,oi(e,r)))}}}},{kernelName:ie,inputsToSave:["x"],gradFunc:function(n,t,r){var e=t[0],i=r.reps;return{x:function(){var t=Or(e);if(1===e.rank)for(var r=0;r<i[0];++r)t=t.add(n.slice([r*e.shape[0]],[e.shape[0]]));else if(2===e.rank)for(r=0;r<i[0];++r)for(var o=0;o<i[1];++o)t=t.add(n.slice([r*e.shape[0],o*e.shape[1]],[e.shape[0],e.shape[1]]));else if(3===e.rank)for(r=0;r<i[0];++r)for(o=0;o<i[1];++o)for(var a=0;a<i[2];++a)t=t.add(n.slice([r*e.shape[0],o*e.shape[1],a*e.shape[2]],[e.shape[0],e.shape[1],e.shape[2]]));else{if(4!==e.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+e.rank+" tensors yet.");for(r=0;r<i[0];++r)for(o=0;o<i[1];++o)for(a=0;a<i[2];++a)for(var u=0;u<i[3];++u)t=t.add(n.slice([r*e.shape[0],o*e.shape[1],a*e.shape[2],u*e.shape[3]],[e.shape[0],e.shape[1],e.shape[2],e.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(n,t,r){var e=ir(r.perm);return{x:function(){return Oi(n,e)}}}}];Tl<Il.length;Tl++)x(Il[Tl]);var Ml=function(){function n(){}return n.prototype.fetch=function(n,t){return fetch(n,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(n,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},n.prototype.decode=function(n,t){return new TextDecoder(t).decode(n)},n}();c().get("IS_BROWSER")&&c().setPlatform("browser",new Ml);var kl,Dl=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(n,t){return null!=c().global.fetch?c().global.fetch(n,t):(null==kl&&(kl=require("node-fetch")),kl(n,t))},n.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},n.prototype.encode=function(n,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(n)},n.prototype.decode=function(n,t){return 0===n.length?"":new this.util.TextDecoder(t).decode(n)},n}();c().get("IS_NODE")&&c().setPlatform("node",new Dl);var Fl={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Vl(n,t){for(var r={},e=0,i=function(t){var i=t.name,o=t.dtype,a=t.shape,u=_(a),s=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var f=Fl[c.dtype],l=n.slice(e,e+u*f),d="uint8"===c.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===o)s=Float32Array.from(d,(function(n){return n*c.scale+c.min}));else{if("int32"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);s=Int32Array.from(d,(function(n){return Math.round(n*c.scale+c.min)}))}e+=u*f}else if("string"===o){var h=_(t.shape);s=[];for(var v=0;v<h;v++){var p=new Uint32Array(n.slice(e,e+4))[0];e+=4;var m=new Uint8Array(n.slice(e,e+p));s.push(m),e+=p}}else{var x=Fl[o];if(l=n.slice(e,e+u*x),"float32"===o)s=new Float32Array(l);else if("int32"===o)s=new Int32Array(l);else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);s=new Uint8Array(l)}e+=u*x}r[i]=dr(s,a,o)},o=0,a=t;o<a.length;o++)i(a[o]);return r}function Pl(n){if(null===n)throw new Error("Invalid input value: "+JSON.stringify(n));var t=0,r=[];n.forEach((function(n){if(t+=n.byteLength,r.push(n.byteLength===n.buffer.byteLength?n:new n.constructor(n)),!(n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+n.constructor.name)}));var e=new Uint8Array(t),i=0;return r.forEach((function(n){e.set(new Uint8Array(n.buffer),i),i+=n.byteLength})),e.buffer}var Ll="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Bl(n){return Ll?Buffer.byteLength(n):new Blob([n]).size}function Wl(n){var t=0;n.forEach((function(n){t+=n.byteLength}));var r=new Uint8Array(t),e=0;return n.forEach((function(n){r.set(new Uint8Array(n),e),e+=n.byteLength})),r.buffer}function zl(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var t=n.split("/");return t[t.length-1]}function Gl(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==n.modelTopology?0:Bl(JSON.stringify(n.modelTopology)),weightSpecsBytes:null==n.weightSpecs?0:Bl(JSON.stringify(n.weightSpecs)),weightDataBytes:null==n.weightData?0:n.weightData.byteLength}}var Ul=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerSaveRouter=function(t){n.getInstance().saveRouters.push(t)},n.registerLoadRouter=function(t){n.getInstance().loadRouters.push(t)},n.getSaveHandlers=function(t){return n.getHandlers(t,"save")},n.getLoadHandlers=function(t,r){return n.getHandlers(t,"load",r)},n.getHandlers=function(t,r,e){var i=[];return("load"===r?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach((function(n){var r=n(t,e);null!==r&&i.push(r)})),i},n}(),ql="://",jl=function(){function n(){this.managers={}}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerManager=function(t,r){N(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(ql)&&(t=t.slice(0,t.indexOf(ql))),N(t.length>0,(function(){return"scheme must not be an empty string."}));var e=n.getInstance();N(null==e.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),e.managers[t]=r},n.getManager=function(n){var t=this.getInstance().managers[n];if(null==t)throw new Error("Cannot find model manager for scheme '"+n+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function Hl(n){if(-1===n.indexOf(ql))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+jl.getSchemes().join(","));return{scheme:n.split(ql)[0],path:n.split(ql)[1]}}function Xl(n,t,r){return void 0===r&&(r=!1),o(this,void 0,void 0,(function(){var e,i,o,u,s,c,f,l,d;return a(this,(function(a){switch(a.label){case 0:return N(n!==t,(function(){return"Old path and new path are the same: '"+n+"'"})),N((e=Ul.getLoadHandlers(n)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+n+"."})),N(e.length<2,(function(){return"Copying failed because more than one ("+e.length+") load handlers for source URL "+n+"."})),i=e[0],N((o=Ul.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),N(o.length<2,(function(){return"Copying failed because more than one ("+e.length+") save handlers for destination URL "+t+"."})),u=o[0],s=Hl(n).scheme,c=Hl(n).path,f=s===Hl(n).scheme,[4,i.load()];case 1:return l=a.sent(),r&&f?[4,jl.getManager(s).removeModel(c)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[4,u.save(l)];case 4:return d=a.sent(),!r||f?[3,6]:[4,jl.getManager(s).removeModel(c)];case 5:a.sent(),a.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var $l="models_store",Kl="model_info_store";function Yl(){if(!c().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Jl(n){var t=n.result;t.createObjectStore($l,{keyPath:"modelPath"}),t.createObjectStore(Kl,{keyPath:"modelPath"})}var Zl=function(){function n(n){if(this.indexedDB=Yl(),null==n||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return n.prototype.save=function(n){return o(this,void 0,void 0,(function(){return a(this,(function(){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]}))}))},n.prototype.load=function(){return o(this,void 0,void 0,(function(){return a(this,(function(){return[2,this.databaseAction(this.modelPath)]}))}))},n.prototype.databaseAction=function(n,t){var r=this;return new Promise((function(n,e){var i=r.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Jl(i)},i.onsuccess=function(){var o=i.result;if(null==t){var a=o.transaction($l,"readonly"),u=a.objectStore($l).get(r.modelPath);u.onsuccess=function(){if(null==u.result)return o.close(),e(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));n(u.result.modelArtifacts)},u.onerror=function(){return o.close(),e(u.error)},a.oncomplete=function(){return o.close()}}else{var s,c=Gl(t),f=o.transaction(Kl,"readwrite"),l=f.objectStore(Kl),d=l.put({modelPath:r.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var i=(s=o.transaction($l,"readwrite")).objectStore($l).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:c});i.onsuccess=function(){return n({modelArtifactsInfo:c})},i.onerror=function(){var n=(l=f.objectStore(Kl)).delete(r.modelPath);n.onsuccess=function(){return o.close(),e(i.error)},n.onerror=function(){return o.close(),e(i.error)}}},d.onerror=function(){return o.close(),e(d.error)},f.oncomplete=function(){null==s?o.close():s.oncomplete=function(){return o.close()}}}},i.onerror=function(){return e(i.error)}}))},n.URL_SCHEME="indexeddb://",n}(),Ql=function(n){return c().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Zl.URL_SCHEME)?(t=n.slice(Zl.URL_SCHEME.length),new Zl(t)):null;var t};Ul.registerSaveRouter(Ql),Ul.registerLoadRouter(Ql);var nd=function(){function n(){this.indexedDB=Yl()}return n.prototype.listModels=function(){return o(this,void 0,void 0,(function(){var n=this;return a(this,(function(){return[2,new Promise((function(t,r){var e=n.indexedDB.open("tensorflowjs",1);e.onupgradeneeded=function(){return Jl(e)},e.onsuccess=function(){var n=e.result,i=n.transaction(Kl,"readonly"),o=i.objectStore(Kl).getAll();o.onsuccess=function(){for(var n={},r=0,e=o.result;r<e.length;r++){var i=e[r];n[i.modelPath]=i.modelArtifactsInfo}t(n)},o.onerror=function(){return n.close(),r(o.error)},i.oncomplete=function(){return n.close()}},e.onerror=function(){return r(e.error)}}))]}))}))},n.prototype.removeModel=function(n){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(){var r;return n=(r=n).startsWith(Zl.URL_SCHEME)?r.slice(Zl.URL_SCHEME.length):r,[2,new Promise((function(r,e){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Jl(i)},i.onsuccess=function(){var t,o=i.result,a=o.transaction(Kl,"readwrite"),u=a.objectStore(Kl),s=u.get(n);s.onsuccess=function(){if(null==s.result)return o.close(),e(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var i=u.delete(n),a=function(){var i=(t=o.transaction($l,"readwrite")).objectStore($l).delete(n);i.onsuccess=function(){return r(s.result.modelArtifactsInfo)},i.onerror=function(){return e(s.error)}};i.onsuccess=a,i.onerror=function(){return a(),o.close(),e(s.error)}},s.onerror=function(){return o.close(),e(s.error)},a.oncomplete=function(){null==t?o.close():t.oncomplete=function(){return o.close()}}},i.onerror=function(){return e(i.error)}}))]}))}))},n}();if(c().getBool("IS_BROWSER"))try{jl.registerManager(Zl.URL_SCHEME,new nd)}catch(e){}var td="/",rd="tensorflowjs_models",ed="info",id="model_topology",od="weight_specs",ad="weight_data",ud="model_metadata";function sd(n){return{info:[rd,n,ed].join(td),topology:[rd,n,id].join(td),weightSpecs:[rd,n,od].join(td),weightData:[rd,n,ad].join(td),modelMetadata:[rd,n,ud].join(td)}}function cd(n){var t=n.split(td);if(t.length<3)throw new Error("Invalid key format: "+n);return t.slice(1,t.length-1).join(td)}var fd=function(){function n(n){if(!c().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==n||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=sd(this.modelPath)}return n.prototype.save=function(n){return o(this,void 0,void 0,(function(){var t,r,e;return a(this,(function(){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),e=Gl(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(e)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(n){if(Ll)return Buffer.from(n).toString("base64");for(var t=new Uint8Array(n),r="",e=0,i=t.length;e<i;e++)r+=String.fromCharCode(t[e]);return btoa(r)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:e}]}catch(n){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+e.modelTopologyBytes+", weightSpecsBytes="+e.weightSpecsBytes+", weightDataBytes="+e.weightDataBytes+".")}return[2]}))}))},n.prototype.load=function(){return o(this,void 0,void 0,(function(){var n,t,r,e,i,o,u;return a(this,(function(){if(null==(n=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==n.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,null==(e=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=e,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),null==(u=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(n){if(Ll){var t=Buffer.from(n,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var r=atob(n),e=new Uint8Array(r.length),i=0;i<r.length;++i)e.set([r.charCodeAt(i)],i);return e.buffer}(u),[2,t]}))}))},n.URL_SCHEME="localstorage://",n}(),ld=function(n){return c().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(fd.URL_SCHEME)?(t=n.slice(fd.URL_SCHEME.length),new fd(t)):null;var t};Ul.registerSaveRouter(ld),Ul.registerLoadRouter(ld);var dd=function(){function n(){N(c().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),N("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return n.prototype.listModels=function(){return o(this,void 0,void 0,(function(){var n,t,r,e,i,o;return a(this,(function(){for(n={},t=rd+td,r=td+ed,e=0;e<this.LS.length;++e)(i=this.LS.key(e)).startsWith(t)&&i.endsWith(r)&&(o=cd(i),n[o]=JSON.parse(this.LS.getItem(i)));return[2,n]}))}))},n.prototype.removeModel=function(n){return o(this,void 0,void 0,(function(){var t,r;return a(this,(function(){var e;if(n=(e=n).startsWith(fd.URL_SCHEME)?e.slice(fd.URL_SCHEME.length):e,t=sd(n),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},n}();if(c().getBool("IS_BROWSER"))try{jl.registerManager(fd.URL_SCHEME,new dd)}catch(e){}function hd(n){return new Promise((function(n){return setTimeout(n)})).then(n)}var vd=function(){function n(t){if(!c().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(n.URL_SCHEME)&&(t=t.slice(n.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return n.prototype.save=function(n){return o(this,void 0,void 0,(function(){var t,r,e,i;return a(this,(function(o){switch(o.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}]})],{type:"application/json"})),(e=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,e.href=r,[4,hd((function(){return e.dispatchEvent(new MouseEvent("click"))}))];case 2:return o.sent(),null==n.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,hd((function(){return i.dispatchEvent(new MouseEvent("click"))}))]);case 3:o.sent(),o.label=4;case 4:return[2,{modelArtifactsInfo:Gl(n)}]}}))}))},n.URL_SCHEME="downloads://",n}(),pd=function(){function n(n){if(null==n||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return n.prototype.load=function(){return o(this,void 0,void 0,(function(){var n,t,r=this;return a(this,(function(){return n=this.files[0],t=this.files.slice(1),[2,new Promise((function(e,i){var o=new FileReader;o.onload=function(o){var a=JSON.parse(o.target.result),u=a.modelTopology;if(null!=u){0===t.length&&e({modelTopology:u});var s=a.weightsManifest;if(null!=s){var c;try{c=r.checkManifestAndWeightFiles(s,t)}catch(n){return void i(n)}var f=[],l=[],d=[];s.forEach((function(n){n.paths.forEach((function(n){l.push(n),d.push(null)})),f.push.apply(f,n.weights)})),s.forEach((function(n){n.paths.forEach((function(n){var t=new FileReader;t.onload=function(t){var r=t.target.result,i=l.indexOf(n);d[i]=r,-1===d.indexOf(null)&&e({modelTopology:u,weightSpecs:f,weightData:Wl(d),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},t.onerror=function(){return i("Failed to weights data from file of path '"+n+"'.")},t.readAsArrayBuffer(c[n])}))}))}else i(new Error("weightManifest field is missing from file "+n.name))}else i(new Error("modelTopology field is missing from file "+n.name))},o.onerror=function(){return i("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(n)}))]}))}))},n.prototype.checkManifestAndWeightFiles=function(n,t){for(var r=[],e=t.map((function(n){return zl(n.name)})),i={},o=0,a=n;o<a.length;o++)a[o].paths.forEach((function(n){var o=zl(n);if(-1!==r.indexOf(o))throw new Error("Duplicate file basename found in weights manifest: '"+o+"'");if(r.push(o),-1===e.indexOf(o))throw new Error("Weight file with basename '"+o+"' is not provided.");i[n]=t[e.indexOf(o)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return i},n}();function md(n,t,r,e){!function(n){N(null!=n&&Array.isArray(n)&&n.length>0,(function(){return"promises must be a none empty array"}))}(n),function(n,t){N(n>=0&&n<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+n})),N(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),N(t>=n,(function(){return"startFraction must be no more than endFraction, but got startFraction "+n+" and endFraction "+t}))}(r=null==r?0:r,e=null==e?1:e);var i=0;return Promise.all(n.map((function(o){return o.then((function(o){var a=r+ ++i/n.length*(e-r);return t(a),o})),o})))}function xd(n,t){return o(this,void 0,void 0,(function(){var r,e,i,o,u,s,f,l,d;return a(this,(function(a){switch(a.label){case 0:return null==t&&(t={}),r=null==t.fetchFunc?c().platform.fetch:t.fetchFunc,e=n.map((function(n){return r(n,t.requestInit,{isBinary:!0})})),i=0,o=.5,null!=t.onProgress?[3,2]:[4,Promise.all(e)];case 1:return u=a.sent(),[3,4];case 2:return[4,md(e,t.onProgress,i,o)];case 3:u=a.sent(),a.label=4;case 4:return s=u.map((function(n){return n.arrayBuffer()})),f=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return d=a.sent(),[3,8];case 6:return[4,md(s,t.onProgress,f,l)];case 7:d=a.sent(),a.label=8;case 8:return[2,d]}}))}))}function yd(n){var t=this;return function(r,e,i){return void 0===e&&(e=""),o(t,void 0,void 0,(function(){var t,o,u,s,c,f,l,d,h,v;return a(this,(function(a){switch(a.label){case 0:if(t=r.map((function(){return!1})),o={},u=null!=i?i.map((function(){return!1})):[],s=[],r.forEach((function(n,r){var e=0;n.weights.forEach((function(n){var a=Fl["quantization"in n?n.quantization.dtype:n.dtype]*_(n.shape),c=function(){t[r]=!0,null==o[r]&&(o[r]=[]),o[r].push({manifestEntry:n,groupOffset:e,sizeBytes:a})};null!=i?i.forEach((function(t,r){t===n.name&&(c(),u[r]=!0)})):c(),s.push(n.name),e+=a}))})),!u.every((function(n){return n})))throw c=i.filter((function(n,t){return!u[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return f=t.reduce((function(n,t,r){return t&&n.push(r),n}),[]),l=[],f.forEach((function(n){r[n].paths.forEach((function(n){var t=e+(e.endsWith("/")?"":"/")+n;l.push(t)}))})),[4,n(l)];case 1:return d=a.sent(),h={},v=0,f.forEach((function(n){for(var t=r[n].paths.length,e=0,i=0;i<t;i++)e+=d[v+i].byteLength;for(var a=new ArrayBuffer(e),u=new Uint8Array(a),s=0,c=0;c<t;c++){var f=new Uint8Array(d[v+c]);u.set(f,s),s+=f.byteLength}o[n].forEach((function(n){var t=Vl(a.slice(n.groupOffset,n.groupOffset+n.sizeBytes),[n.manifestEntry]);for(var r in t)h[r]=t[r]})),v+=t})),[2,h]}}))}))}}Ul.registerSaveRouter((function(n){return c().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(vd.URL_SCHEME)?function(n){return void 0===n&&(n="model"),new vd(n)}(n.slice(vd.URL_SCHEME.length)):null}));var bd=function(){function n(n,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(N("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=c().platform.fetch,N(null!=n&&n.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(n)&&N(2===n.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."})),this.path=n,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(n){return o(this,void 0,void 0,(function(){var t,r;return a(this,(function(e){switch(e.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:n.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=n.weightData&&t.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((r=e.sent()).ok)return[2,{modelArtifactsInfo:Gl(n),responses:[r]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+r.status+".")}}))}))},n.prototype.load=function(){return o(this,void 0,void 0,(function(){var n,t,r,e,i,o,u,s,c,f,l,d;return a(this,(function(a){switch(a.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=a.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");a.label=2;case 2:return a.trys.push([2,4,,5]),[4,n.json()];case 3:return t=a.sent(),[3,5];case 4:throw a.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.weightsManifest,o=t.generatedBy,u=t.convertedBy,s=t.format,c=t.userDefinedMetadata,null==(e=t.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:d=a.sent(),f=d[0],l=d[1],a.label=7;case 7:return[2,{modelTopology:e,weightSpecs:f,weightData:l,userDefinedMetadata:c,generatedBy:o,convertedBy:u,format:s}]}}))}))},n.prototype.loadWeights=function(n){return o(this,void 0,void 0,(function(){var t,r,e,i,o,u,s,c,f,l;return a(this,(function(a){switch(a.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(n){var t=n.lastIndexOf("/"),r=n.lastIndexOf("?");return[n.substring(0,t)+"/",r>t?n.substring(r):""]}(t),e=r[0],i=r[1],o=this.weightPathPrefix||e,u=[],s=0,c=n;s<c.length;s++)u.push.apply(u,c[s].weights);return f=[],n.forEach((function(n){n.paths.forEach((function(n){f.push(o+n+i)}))})),[4,xd(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return l=a.sent(),[2,[u,Wl(l)]]}}))}))},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function gd(n){return null!=n.match(bd.URL_SCHEME_REGEX)}var wd=function(n,t){return"undefined"==typeof fetch?null:(Array.isArray(n)?n.every((function(n){return gd(n)})):gd(n))?Cd(n,{onProgress:t}):null};function Cd(n,t){return new bd(n,t)}Ul.registerSaveRouter(wd),Ul.registerLoadRouter(wd);var Nd,Ed=function(){function n(n){this.modelArtifacts=n}return n.prototype.load=function(){return o(this,void 0,void 0,(function(){return a(this,(function(){return[2,this.modelArtifacts]}))}))},n}(),Rd=function(){function n(n){this.saveHandler=n}return n.prototype.save=function(n){return o(this,void 0,void 0,(function(){return a(this,(function(){return[2,this.saveHandler(n)]}))}))},n}(),Ad=Object.freeze({browserFiles:function(n){return new pd(n)},browserHTTPRequest:function(n,t){return Cd(n,t)},concatenateArrayBuffers:Wl,decodeWeights:Vl,encodeWeights:function(n,t){return o(this,void 0,void 0,(function(){var r,e,i,u,s,c=this;return a(this,(function(f){switch(f.label){case 0:for(r=[],e=[],i=Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n),u=function(u){var s=i[u],f=Array.isArray(n)?n[u].tensor:n[s];if("float32"!==f.dtype&&"int32"!==f.dtype&&"bool"!==f.dtype&&"string"!==f.dtype)throw new Error("Unsupported dtype in weight '"+s+"': "+f.dtype);var l={name:s,shape:f.shape,dtype:f.dtype};if("string"===f.dtype){var d=new Promise((function(n){return o(c,void 0,void 0,(function(){var t,r,e,i,o,u,s;return a(this,(function(a){switch(a.label){case 0:return[4,f.bytes()];case 1:for(t=a.sent(),r=t.reduce((function(n,t){return n+t.length}),0)+4*t.length,e=new Uint8Array(r),i=0,o=0;o<t.length;o++)u=t[o],s=new Uint8Array(new Uint32Array([u.length]).buffer),e.set(s,i),e.set(u,i+=4),i+=u.length;return n(e),[2]}}))}))}));e.push(d)}else e.push(f.data());null!=t&&(l.group=t),r.push(l)},s=0;s<i.length;++s)u(s);return[4,Promise.all(e)];case 1:return[2,{data:Pl(f.sent()),specs:r}]}}))}))},fromMemory:function(n,t,r,e){return 1===arguments.length?null!=n.modelTopology||null!=n.weightSpecs?new Ed(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ed({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ed({modelTopology:n,weightSpecs:t,weightData:r,trainingConfig:e}))},getLoadHandlers:function(n,t){return Ul.getLoadHandlers(n,t)},getModelArtifactsInfoForJSON:Gl,getSaveHandlers:function(n){return Ul.getSaveHandlers(n)},http:Cd,isHTTPScheme:gd,loadWeights:function(n,t,r,e){return void 0===t&&(t=""),o(this,void 0,void 0,(function(){return a(this,(function(){return[2,yd((function(n){return xd(n,{requestInit:e})}))(n,t,r)]}))}))},registerLoadRouter:function(n){return Ul.registerLoadRouter(n)},registerSaveRouter:function(n){return Ul.registerSaveRouter(n)},weightsLoaderFactory:yd,withSaveHandler:function(n){return new Rd(n)},copyModel:function(n,t){return o(this,void 0,void 0,(function(){return a(this,(function(){return[2,Xl(n,t,!1)]}))}))},listModels:function(){return o(this,void 0,void 0,(function(){var n,t,r,e,i,o,u;return a(this,(function(a){switch(a.label){case 0:n=jl.getSchemes(),t={},r=0,e=n,a.label=1;case 1:return r<e.length?[4,jl.getManager(i=e[r]).listModels()]:[3,4];case 2:for(u in o=a.sent())t[i+ql+u]=o[u];a.label=3;case 3:return r++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(n,t){return o(this,void 0,void 0,(function(){return a(this,(function(){return[2,Xl(n,t,!0)]}))}))},removeModel:function(n){return o(this,void 0,void 0,(function(){var t;return a(this,(function(){return t=Hl(n),[2,jl.getManager(t.scheme).removeModel(t.path)]}))}))}}),_d=sr({confusionMatrix_:function(n,t,r){var e=Yt(n,"labels","confusionMatrix"),i=Yt(t,"predictions","confusionMatrix");N(null==r||r>0&&Number.isInteger(r),(function(){return"If provided, numClasses must be a positive integer, but got "+r})),N(1===e.rank,(function(){return"Expected the rank of labels to be 1, but got "+e.rank})),N(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),N(e.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+e.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),N(r>0&&Number.isInteger(r),(function(){return"numClasses is required to be a positive integer, but got "+r}));var o=Cs(e.asType("int32"),r),a=Cs(i.asType("int32"),r);return o.transpose().matMul(a).asType("int32")}}),Od=Object.freeze({confusionMatrix:_d}),Sd=sr({fromPixels_:function(n,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==n)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=!1,e=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)r=!0;else if("undefined"!=typeof ImageData&&n instanceof ImageData)e=!0;else if("undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement)o=!0;else{if(null==n.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);a=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=h("FromPixels",Vn.backendName))return Vn.runKernel("FromPixels",{pixels:n},{numChannels:t});var u,s,c=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],f=c[0],l=c[1];if(a?u=n.getContext("2d").getImageData(0,0,f,l).data:e||r?u=n.data:(o||i)&&(null==Nd&&(Nd=document.createElement("canvas").getContext("2d")),Nd.canvas.width=f,Nd.canvas.height=l,Nd.drawImage(n,0,0,f,l),u=Nd.getImageData(0,0,f,l).data),4===t)s=new Int32Array(u);else{var d=f*l;s=new Int32Array(d*t);for(var v=0;v<d;v++)for(var p=0;p<t;++p)s[v*t+p]=u[4*v+p]}return xr(s,[l,f,t],"int32")}}),Td=Object.freeze({toPixels:function(n,t){return o(this,void 0,void 0,(function(){var r,e,i,o,u,s,c,f,l,d,h,v,p,m,x,y,b,g,w,C,N;return a(this,(function(a){switch(a.label){case 0:if(r=Yt(n,"img","toPixels"),n instanceof bn||(r=r.toInt()),2!==r.rank&&3!==r.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+r.rank+".");if(e=r.shape.slice(0,2),i=e[0],o=e[1],(u=2===r.rank?1:r.shape[2])>4||2===u)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+u);return[4,r.data()];case 1:return s=a.sent(),c=r.min(),f=r.max(),[4,Promise.all([c.data(),f.data()])];case 2:if(l=a.sent(),d=l[0][0],h=l[1][0],c.dispose(),f.dispose(),"float32"===r.dtype){if(d<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+h+"].")}else{if("int32"!==r.dtype)throw new Error("Unsupported type for toPixels: "+r.dtype+". Please use float32 or int32 tensors.");if(d<0||h>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+h+"].")}for(v="float32"===r.dtype?255:1,p=new Uint8ClampedArray(o*i*4),m=0;m<i*o;++m)x=void 0,y=void 0,b=void 0,g=void 0,1===u?(x=s[m]*v,y=s[m]*v,b=s[m]*v,g=255):3===u?(x=s[3*m]*v,y=s[3*m+1]*v,b=s[3*m+2]*v,g=255):4===u&&(x=s[4*m]*v,y=s[4*m+1]*v,b=s[4*m+2]*v,g=s[4*m+3]*v),p[0+(w=4*m)]=Math.round(x),p[w+1]=Math.round(y),p[w+2]=Math.round(b),p[w+3]=Math.round(g);return null!=t&&(t.width=o,t.height=i,C=t.getContext("2d"),N=new ImageData(p,o,i),C.putImageData(N,0,0)),r!==n&&r.dispose(),[2,p]}}))}))},fromPixels:Sd}),Id=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(n,t){return new n(t)},n}(),Md=function(){function n(){this.classNameMap={}}return n.getMap=function(){return null==n.instance&&(n.instance=new n),n.instance},n.register=function(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]},n}();function kd(n){N(null!=n.className,(function(){return"Class being registered does not have the static className property defined."})),N("string"==typeof n.className,(function(){return"className is required to be a string, but got type "+typeof n.className})),N(n.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Md.register(n)}var Dd=Object.freeze({Serializable:Id,SerializationMap:Md,registerClass:kd}),Fd=Object.freeze({gpgpu_util:Va,webgl_util:Bt,forceHalfFloat:function(){c().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Lu,setWebGLContext:qn,GPGPUContext:Pa}),Vd=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return i(t,n),t.prototype.minimize=function(n,t,r){void 0===t&&(t=!1);var e=this.computeGradients(n,r),i=e.value,o=e.grads;if(null!=r){var a=r.map((function(n){return{name:n.name,tensor:o[n.name]}}));this.applyGradients(a)}else this.applyGradients(o);return Ut(o),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(n,t){return Ni(n,t)},t.prototype.dispose=function(){null!=this.iterations_&&Ut(this.iterations_)},t.prototype.saveIterations=function(){return o(this,void 0,void 0,(function(){return a(this,(function(){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:vr(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){return a(this,(function(){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(){return o(this,void 0,void 0,(function(){return a(this,(function(){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(n){return o(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return t=this,[4,n[0].tensor.data()];case 1:return t.iterations_=r.sent()[0],[2,n.slice(1)]}}))}))},t}(Id);Object.defineProperty(Vd,Symbol.hasInstance,{value:function(n){return null!=n.minimize&&null!=n.computeGradients&&null!=n.applyGradients}});var Pd=function(n){function t(t,r,e){void 0===e&&(e=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=e,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==e&&(i.epsilon=Vn.backend.epsilon()),i}return i(t,n),t.prototype.applyGradients=function(n){var t=this;(Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n)).forEach((function(r,e){var i=Vn.registeredVariables[r];null==t.accumulatedGrads[e]&&(t.accumulatedGrads[e]={originalName:r+"/accum_grad",variable:Gt((function(){return Or(i).variable(!1)}))}),null==t.accumulatedUpdates[e]&&(t.accumulatedUpdates[e]={originalName:r+"/accum_var",variable:Gt((function(){return Or(i).variable(!1)}))});var o=Array.isArray(n)?n[e].tensor:n[r];if(null!=o){var a=t.accumulatedGrads[e].variable,u=t.accumulatedUpdates[e].variable;Gt((function(){var n=a.mul(t.rho).add(o.square().mul(1-t.rho)),r=u.add(t.epsilon).sqrt().div(a.add(t.epsilon).sqrt()).mul(o),e=u.mul(t.rho).add(r.square().mul(1-t.rho));a.assign(n),u.assign(e);var s=r.mul(-t.learningRate).add(i);i.assign(s)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Ut(this.accumulatedGrads.map((function(n){return n.variable}))),Ut(this.accumulatedUpdates.map((function(n){return n.variable}))))},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(n.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},t.prototype.setWeights=function(n){return o(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.slice(0,t=n.length/2).map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),this.accumulatedUpdates=n.slice(t,2*t).map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,t){return new n(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(Vd);kd(Pd);var Ld=function(n){function t(t,r){void 0===r&&(r=.1);var e=n.call(this)||this;return e.learningRate=t,e.initialAccumulatorValue=r,e.accumulatedGrads=[],e}return i(t,n),t.prototype.applyGradients=function(n){var t=this;(Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n)).forEach((function(r,e){var i=Vn.registeredVariables[r];null==t.accumulatedGrads[e]&&(t.accumulatedGrads[e]={originalName:r+"/accumulator",variable:Gt((function(){return Er(i.shape,t.initialAccumulatorValue).variable(!1)}))});var o=Array.isArray(n)?n[e].tensor:n[r];if(null!=o){var a=t.accumulatedGrads[e].variable;Gt((function(){var n=a.add(o.square());a.assign(n);var r=o.div(n.add(Vn.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(r)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Ut(this.accumulatedGrads.map((function(n){return n.variable})))},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},t.prototype.setWeights=function(n){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(n)];case 1:return n=t.sent(),this.accumulatedGrads=n.map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,t){return new n(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(Vd);kd(Ld);var Bd=function(n){function t(t,r,e,i){void 0===i&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=e,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Gt((function(){o.accBeta1=vr(r).variable(),o.accBeta2=vr(e).variable()})),null==i&&(o.epsilon=Vn.backend.epsilon()),o}return i(t,n),t.prototype.applyGradients=function(n){var t=this,r=Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n);Gt((function(){var e=oi(1,t.accBeta1),i=oi(1,t.accBeta2);r.forEach((function(r,o){var a=Vn.registeredVariables[r];null==t.accumulatedFirstMoment[o]&&(t.accumulatedFirstMoment[o]={originalName:r+"/m",variable:Gt((function(){return Or(a).variable(!1)}))}),null==t.accumulatedSecondMoment[o]&&(t.accumulatedSecondMoment[o]={originalName:r+"/v",variable:Gt((function(){return Or(a).variable(!1)}))});var u=Array.isArray(n)?n[o].tensor:n[r];if(null!=u){var s=t.accumulatedFirstMoment[o].variable,c=t.accumulatedSecondMoment[o].variable,f=s.mul(t.beta1).add(u.mul(1-t.beta1)),l=c.mul(t.beta2).add(u.square().mul(1-t.beta2)),d=f.div(e),h=l.div(i);s.assign(f),c.assign(l);var v=d.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(a);a.assign(v)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ut(this.accumulatedFirstMoment.map((function(n){return n.variable}))),null!=this.accumulatedSecondMoment&&Ut(this.accumulatedSecondMoment.map((function(n){return n.variable})))},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(n.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},t.prototype.setWeights=function(n){return o(this,void 0,void 0,(function(){var t,r=this;return a(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(n)];case 1:return n=e.sent(),Gt((function(){r.accBeta1.assign(ri(r.beta1,r.iterations_+1)),r.accBeta2.assign(ri(r.beta2,r.iterations_+1))})),this.accumulatedFirstMoment=n.slice(0,t=n.length/2).map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),this.accumulatedSecondMoment=n.slice(t,2*t).map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,t){return new n(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(Vd);kd(Bd);var Wd=function(n){function t(t,r,e,i,o){void 0===i&&(i=null),void 0===o&&(o=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=e,a.epsilon=i,a.decay=o,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Gt((function(){a.iteration=vr(0).variable(),a.accBeta1=vr(r).variable()})),null==i&&(a.epsilon=Vn.backend.epsilon()),a}return i(t,n),t.prototype.applyGradients=function(n){var t=this,r=Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n);Gt((function(){var e=oi(1,t.accBeta1),i=ui(-t.learningRate,t.iteration.mul(t.decay).add(1));r.forEach((function(r,o){var a=Vn.registeredVariables[r];null==t.accumulatedFirstMoment[o]&&(t.accumulatedFirstMoment[o]={originalName:r+"/m",variable:Or(a).variable(!1)}),null==t.accumulatedWeightedInfNorm[o]&&(t.accumulatedWeightedInfNorm[o]={originalName:r+"/v",variable:Or(a).variable(!1)});var u=Array.isArray(n)?n[o].tensor:n[r];if(null!=u){var s=t.accumulatedFirstMoment[o].variable,c=t.accumulatedWeightedInfNorm[o].variable,f=s.mul(t.beta1).add(u.mul(1-t.beta1)),l=c.mul(t.beta2),d=u.abs(),h=l.maximum(d);s.assign(f),c.assign(h);var v=i.div(e).mul(f.div(h.add(t.epsilon))).add(a);a.assign(v)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ut(this.accumulatedFirstMoment.map((function(n){return n.variable}))),null!=this.accumulatedWeightedInfNorm&&Ut(this.accumulatedWeightedInfNorm.map((function(n){return n.variable})))},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){return a(this,(function(){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(){return o(this,void 0,void 0,(function(){return a(this,(function(){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,t){return new n(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(Vd);kd(Wd);var zd=function(n){function t(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return i(t,n),t.prototype.applyGradients=function(n){var t=this;(Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n)).forEach((function(r,e){var i=Array.isArray(n)?n[e].tensor:n[r];if(null!=i){var o=Vn.registeredVariables[r];Gt((function(){var n=t.c.mul(i).add(o);o.assign(n)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(n){this.learningRate=n,null!=this.c&&this.c.dispose(),this.c=qt(vr(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}}))}))},t.prototype.setWeights=function(n){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(n)];case 1:if(0!==(n=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,t){return new n(t.learningRate)},t.className="SGD",t}(Vd);kd(zd);var Gd=function(n){function t(t,r,e){void 0===e&&(e=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=e,i.accumulations=[],i.m=vr(i.momentum),i}return i(t,n),t.prototype.applyGradients=function(n){var t=this;(Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n)).forEach((function(r,e){var i=Vn.registeredVariables[r];null==t.accumulations[e]&&(t.accumulations[e]={originalName:r+"/momentum",variable:Gt((function(){return Or(i).variable(!1)}))});var o=t.accumulations[e].variable,a=Array.isArray(n)?n[e].tensor:n[r];null!=a&&Gt((function(){var n,r=t.m.mul(o).add(a);n=t.useNesterov?t.c.mul(a.add(r.mul(t.m))).add(i):t.c.mul(r).add(i),o.assign(r),i.assign(n)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Ut(this.accumulations.map((function(n){return n.variable})))},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},t.prototype.setWeights=function(n){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(n)];case 1:return n=t.sent(),this.accumulations=n.map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,t){return new n(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(zd);kd(Gd);var Ud=function(n){function t(t,r,e,i,o){void 0===r&&(r=.9),void 0===e&&(e=0),void 0===i&&(i=null),void 0===o&&(o=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=e,a.epsilon=i,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=o,null==i&&(a.epsilon=Vn.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return i(t,n),t.prototype.applyGradients=function(n){var t=this;(Array.isArray(n)?n.map((function(n){return n.name})):Object.keys(n)).forEach((function(r,e){var i=Vn.registeredVariables[r];null==t.accumulatedMeanSquares[e]&&(t.accumulatedMeanSquares[e]={originalName:r+"/rms",variable:Gt((function(){return Or(i).variable(!1)}))}),null==t.accumulatedMoments[e]&&(t.accumulatedMoments[e]={originalName:r+"/momentum",variable:Gt((function(){return Or(i).variable(!1)}))}),null==t.accumulatedMeanGrads[e]&&t.centered&&(t.accumulatedMeanGrads[e]={originalName:r+"/mg",variable:Gt((function(){return Or(i).variable(!1)}))});var o=Array.isArray(n)?n[e].tensor:n[r];if(null!=o){var a=t.accumulatedMeanSquares[e].variable,u=t.accumulatedMoments[e].variable;Gt((function(){var n=a.mul(t.decay).add(o.square().mul(1-t.decay));if(t.centered){var r=t.accumulatedMeanGrads[e].variable,s=r.mul(t.decay).add(o.mul(1-t.decay)),c=u.mul(t.momentum).add(o.mul(t.learningRate).div(n.sub(s.square().add(t.epsilon)).sqrt()));a.assign(n),r.assign(s),u.assign(c);var f=i.sub(c);i.assign(f)}else{var l=a.mul(t.decay).add(o.square().mul(1-t.decay));c=u.mul(t.momentum).add(o.mul(t.learningRate).div(l.add(t.epsilon).sqrt())),a.assign(l),u.assign(c),f=i.sub(c),i.assign(f)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Ut(this.accumulatedMeanSquares.map((function(n){return n.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Ut(this.accumulatedMeanGrads.map((function(n){return n.variable}))),null!=this.accumulatedMoments&&Ut(this.accumulatedMoments.map((function(n){return n.variable})))},t.prototype.getWeights=function(){return o(this,void 0,void 0,(function(){var n;return a(this,(function(t){switch(t.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(n.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},t.prototype.setWeights=function(n){return o(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedMeanSquares=n.slice(0,t=this.centered?n.length/3:n.length/2).map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),this.accumulatedMoments=n.slice(t,2*t).map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=n.slice(2*t,3*t).map((function(n){return{originalName:n.name,variable:n.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,t){return new n(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(Vd);kd(Ud);var qd=function(){function n(){}return n.sgd=function(n){return new zd(n)},n.momentum=function(n,t,r){return void 0===r&&(r=!1),new Gd(n,t,r)},n.rmsprop=function(n,t,r,e,i){return void 0===t&&(t=.9),void 0===r&&(r=0),void 0===e&&(e=null),void 0===i&&(i=!1),new Ud(n,t,r,e,i)},n.adam=function(n,t,r,e){return void 0===n&&(n=.001),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===e&&(e=null),new Bd(n,t,r,e)},n.adadelta=function(n,t,r){return void 0===n&&(n=.001),void 0===t&&(t=.95),void 0===r&&(r=null),new Pd(n,t,r)},n.adamax=function(n,t,r,e,i){return void 0===n&&(n=.002),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===e&&(e=null),void 0===i&&(i=0),new Wd(n,t,r,e,i)},n.adagrad=function(n,t){return void 0===t&&(t=.1),new Ld(n,t)},n}(),jd={sgd:qd.sgd,momentum:qd.momentum,adadelta:qd.adadelta,adagrad:qd.adagrad,rmsprop:qd.rmsprop,adamax:qd.adamax,adam:qd.adam},Hd="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(n){return n()};bn.prototype.add=function(n){return ae(this,n)},bn.prototype.broadcastTo=function(n){return fs(this,n)},bn.prototype.div=function(n){return ui(this,n)},bn.prototype.divNoNan=function(n){return ys(this,n)},bn.prototype.squaredDifference=function(n){return Ws(this,n)},bn.prototype.tile=function(n){return bs(this,n)},bn.prototype.oneHot=function(n,t,r){return void 0===t&&(t=1),void 0===r&&(r=0),Cs(this,n,t,r)},bn.prototype.transpose=function(n){return Oi(this,n)},bn.prototype.pad=function(n,t){return Ns(this,n,t)},bn.prototype.batchNorm=function(n,t,r,e,i){return ns(this,n,t,r,e,i)},xn=al;const Xd=Object.freeze({__proto__:null,AdadeltaOptimizer:Pd,AdagradOptimizer:Ld,AdamOptimizer:Bd,AdamaxOptimizer:Wd,Add:"Add",AddN:"AddN",BroadcastTo:te,DataStorage:Si,Div:Qr,get ENV(){return f},Environment:u,FromPixels:"FromPixels",FusedBatchNorm:"FusedBatchNorm",Identity:ee,KernelBackend:Ti,MaxPoolWithArgmax:"MaxPoolWithArgmax",MomentumOptimizer:Gd,NonMaxSuppressionV5:"NonMaxSuppressionV5",OneHot:re,Optimizer:Vd,PadV2:oe,RMSPropOptimizer:Ud,get Rank(){return gn},get Reduction(){return Nf},SGDOptimizer:zd,Square:"Square",SquaredDifference:ne,Tensor:bn,TensorBuffer:pn,Tile:ie,Transpose:"Transpose",Variable:Rn,abs:fe,acos:le,acosh:de,add:ae,addN:$u,addStrict:qe,all:zc,any:Gc,argMax:Uc,argMin:qc,asin:he,asinh:ve,atan:pe,atan2:je,atanh:me,avgPool:Tc,avgPool3d:kc,backend:function(){return Vn.backend},backend_util:Xi,basicLSTMCell:uf,batchNorm:ns,batchNorm2d:es,batchNorm3d:as,batchNorm4d:cs,batchNormalization:Qu,batchNormalization2d:rs,batchNormalization3d:os,batchNormalization4d:ss,batchToSpaceND:Pr,booleanMaskAsync:ic,broadcastTo:fs,browser:Td,buffer:Fr,cast:Lr,ceil:xe,clipByValue:ye,clone:ls,complex:cr,concat:Sr,concat1d:Tr,concat2d:Ir,concat3d:Mr,concat4d:kr,conv1d:sc,conv2d:cc,conv2dTranspose:xc,conv3d:fc,conv3dTranspose:yc,cos:be,cosh:ge,cumsum:Br,customGrad:Ei,deprecationWarn:zt,depthToSpace:Wr,depthwiseConv2d:hc,diag:gf,disableDeprecationWarnings:function(){c().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},dispose:Ut,disposeVariables:function(){Vn.disposeVariables()},div:ui,divNoNan:ys,divStrict:He,dot:gc,dropout:wf,elu:Zc,enableDebugMode:function(){c().set("DEBUG",!0)},enableProdMode:function(){c().set("PROD",!0)},engine:function(){return Vn},env:c,equal:Gs,equalStrict:Us,erf:we,exp:Ce,expandDims:zr,expm1:Ne,eye:gs,fft:hf,fill:Er,findBackend:function(n){return Vn.findBackend(n)},findBackendFactory:function(n){return Vn.findBackendFactory(n)},floor:Ee,floorDiv:Xe,frame:Af,fused:ol,gather:rc,gatherND:bf,gather_util:ci,getBackend:Ht,getGradient:v,getKernel:h,getKernelsForBackend:p,grad:function(n){return N(K(n),(function(){return"The f passed in grad(f) must be a function"})),function(t,r){var e=Yt(t,"x","tf.grad",null),i=null!=r?Yt(r,"dy","tf.grad"):null;return Vn.tidy((function(){var t=Vn.gradients((function(){return n(e)}),[e],i),r=t.grads;return null!=i&&E(t.value.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Ri(r),r[0]}))}},grads:function(n){return N(K(n),(function(){return"The f passed in grads(f) must be a function"})),function(t,r){N(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var e=Jt(t,"args","tf.grads",null),i=null!=r?Yt(r,"dy","tf.grads"):null;return Vn.tidy((function(){var t=Vn.gradients((function(){return n.apply(void 0,e)}),e,i),r=t.grads;return null!=i&&E(t.value.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ri(r),r}))}},greater:qs,greaterEqual:js,greaterEqualStrict:Hs,greaterStrict:Xs,hammingWindow:Rf,hannWindow:Ef,ifft:vf,imag:lr,image:Jf,inTopKAsync:Sf,io:Ad,irfft:mf,isFinite:Ve,isInf:Fe,isNaN:De,keep:qt,leakyRelu:Qc,less:$s,lessEqual:Ks,lessEqualStrict:Ys,lessStrict:Js,linalg:qf,linspace:Rr,localResponseNormalization:of,log:Re,log1p:Ae,logSigmoid:_e,logSoftmax:_i,logSumExp:jc,logicalAnd:ds,logicalNot:hs,logicalOr:vs,logicalXor:ps,losses:Bf,matMul:bc,math:Od,max:Hc,maxPool:Sc,maxPool3d:Mc,maxPoolWithArgmax:Dc,maximum:$e,maximumStrict:Ke,mean:Xc,memory:function(){return Vn.memory()},min:$c,minimum:Ye,minimumStrict:Je,mod:Ze,modStrict:Qe,moments:Kc,movingAverage:cf,mul:ni,mulStrict:ti,multiRNNCell:sf,multinomial:ws,neg:Oe,nextFrame:function(){return new Promise((function(n){return Hd((function(){return n()}))}))},norm:af,notEqual:Zs,notEqualStrict:Qs,oneHot:Cs,ones:Cr,onesLike:_r,op:sr,outerProduct:wc,pad:Ns,pad1d:Es,pad2d:Rs,pad3d:As,pad4d:_s,pool:Ic,pow:ri,powStrict:ei,prelu:nf,print:Vr,prod:Jc,profile:function(n){return Vn.profile(n)},rand:Os,randomGamma:Vs,randomNormal:Ps,randomUniform:Ls,range:Ar,ready:function(){return Vn.ready()},real:fr,reciprocal:Se,registerBackend:function(n,t,r){return void 0===r&&(r=1),Vn.registerBackend(n,t,r)},registerGradient:x,registerKernel:m,relu:tf,relu6:rf,removeBackend:function(n){Vn.removeBackend(n)},reshape:Gr,reverse:Cc,reverse1d:Nc,reverse2d:Ec,reverse3d:Rc,reverse4d:Ac,rfft:pf,round:Te,rsqrt:Ie,scalar:vr,scatterND:df,scatter_util:vi,selu:ef,separableConv2d:mc,serialization:Dd,setBackend:jt,setPlatform:function(n,t){c().setPlatform(n,t)},setdiff1dAsync:Xr,sigmoid:Me,sign:ke,signal:Of,sin:Pe,sinh:Le,slice:Fc,slice1d:Vc,slice2d:Pc,slice3d:Lc,slice4d:Bc,slice_util:Ci,softmax:Ai,softplus:Be,spaceToBatchND:Ur,sparseToDense:yf,spectral:xf,split:Dr,sqrt:We,square:Bs,squaredDifference:Ws,squaredDifferenceStrict:ii,squeeze:qr,stack:jr,step:ze,stft:_f,stridedSlice:ff,sub:oi,subStrict:ai,sum:Yc,sumOutType:On,tan:Ge,tanh:Ue,tensor:dr,tensor1d:pr,tensor2d:mr,tensor3d:xr,tensor4d:yr,tensor5d:br,tensor6d:gr,tensor_util:kn,test_util:Ms,tidy:Gt,tile:bs,time:function(n){return Vn.time(n)},topk:lf,train:jd,transpose:Oi,truncatedNormal:zs,unregisterGradient:function(n){if(!d.has(n))throw new Error("The gradient '"+n+"' for backend is not registered");d.delete(n)},unregisterKernel:function(n,t){var r=y(n,t);if(!l.has(r))throw new Error("The kernel '"+n+"' for backend '"+t+"' is not registered");l.delete(r)},unsortedSegmentSum:ec,unstack:Hr,util:cn,valueAndGrad:function(n){return N(K(n),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,r){N(t instanceof bn,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),N(null==r||r instanceof bn,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var e=Vn.gradients((function(){return n(t)}),[t],r),i=e.grads,o=e.value;return Ri(i),{grad:i[0],value:o}}},valueAndGrads:function(n){return N(K(n),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,r){N(Array.isArray(t)&&t.every((function(n){return n instanceof bn})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),N(null==r||r instanceof bn,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var e=Vn.gradients((function(){return n.apply(void 0,t)}),t,r);return null!=r&&E(e.value.shape,r.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ri(e.grads),e}},variable:wr,variableGrads:Ni,version_core:"1.7.3",webgl:Fd,where:ms,whereAsync:xs,zeros:Nr,zerosLike:Or});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $d,Kd,Yd=function(){return(Yd=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)};function Jd(n,t,r,e){return new(r||(r=Promise))((function(i,o){function a(n){try{s(e.next(n))}catch(n){o(n)}}function u(n){try{s(e.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new r((function(t){t(n.value)})).then(a,u)}s((e=e.apply(n,t||[])).next())}))}function Zd(n,t){var r,e,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,e&&(i=2&o[0]?e.return:o[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,o[1])).done)return i;switch(e=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,e=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(n,a)}catch(n){o=[6,n],e=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}!function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}($d||($d={})),function(n){!function(n){n[n.LEGACY=0]="LEGACY",n[n.V1=1]="V1",n[n.V2=2]="V2"}(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))}(Kd||(Kd={}));var Qd={};function nh(n){return Qd[n]}function th(n,t,r,e){var i=t.inputParams[n];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,a=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return rh(t.inputNames[i.inputIndexStart],r,e);if("tensors"===i.type)return t.inputNames.slice(o,a).map((function(n){return rh(n,r,e)}));var u=Array.prototype.slice.call(rh(t.inputNames.slice(o)[0],r,e).dataSync());return"number"===i.type?u[0]:u}var s=t.attrParams[n];return s&&s.value}function rh(n,t,r){var e=oh(n),i=e[0],o=e[1],a=r.currentContextIds.find((function(n){return!!t[ih(i,n)]}));return void 0!==a?t[ih(i,a)][o]:void 0}function eh(n,t){var r=oh(n),e=r[1];return[ih(r[0],t&&t.currentContextId),e]}function ih(n,t){return t?n+"-"+t:n}function oh(n){var t=n.lastIndexOf(":");return-1===t?[n,0]:[n.substring(0,t),Number(n.substring(t+1))]}function ah(n,t){for(var r=[],e=0;e<n.length;e+=t)r.push(n.slice(e,e+t));return r}var uh=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),sh=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),ch=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),fh=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),lh=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),dh=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),hh=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),vh=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),ph=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),mh=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),xh=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),yh=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),bh=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),gh=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),wh=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Ch=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),Nh=function(){function n(){var n=[].concat.apply([],[uh,sh,ch,fh,lh,dh,hh,mh,ph,vh,xh,yh,bh,gh,wh,Ch].map((function(n){return n.json})));this.opMappers=n.reduce((function(n,t){return n[t.tfOpName]=t,n}),{})}return Object.defineProperty(n,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),n.prototype.transformGraph=function(n,t){var r=this;void 0===t&&(t={});var e=[],i=[],o=n.node.reduce((function(n,t){return n[t.name]=r.mapNode(t),t.op.startsWith("Placeholder")&&e.push(n[t.name]),"Const"===t.op&&i.push(n[t.name]),n}),{}),a=[],u=[],s={},c={};null!=t&&(s=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));var f=Object.keys(o);return f.forEach((function(n){var t=o[n];t.inputNames.forEach((function(n){var r=eh(n)[0];t.inputs.push(o[r]),o[r].children.push(t)}))})),0===Object.keys(c).length?f.forEach((function(n){var t=o[n];0===t.children.length&&u.push(t)})):Object.keys(c).forEach((function(n){var t=eh(n)[0],r=o[t];null!=r&&(r.signatureKey=c[n],u.push(r))})),Object.keys(s).length>0?Object.keys(s).forEach((function(n){var t=eh(n)[0],r=o[t];r&&(r.signatureKey=s[n],a.push(r))})):a=e,{nodes:o,inputs:a,outputs:u,weights:i,placeholders:e,signature:t}},n.prototype.mapSignatureEntries=function(n){return Object.keys(n||{}).reduce((function(t,r){return t[n[r].name]=r,t}),{})},n.prototype.mapNode=function(n){var t=nh(n.op)||this.opMappers[n.op]||{};null==n.attr&&(n.attr={});var r={name:n.name,op:n.op,category:t.category,inputNames:(n.input||[]).map((function(n){return n.startsWith("^")?n.substr(1):n})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:n.attr};return null!=t.inputs&&(r.inputParams=t.inputs.reduce((function(n,t){return n[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},n}),{})),null!=t.attrs&&(r.attrParams=t.attrs.reduce((function(t,r){var e=r.type,i=void 0;switch(r.type){case"string":void 0===(i=Rh(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Rh(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"string[]":void 0===(i=Dh(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Dh(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"number":void 0===(i=_h(n.attr,r.tfName,r.defaultValue||0))&&r.tfDeprecatedName&&(i=_h(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"number[]":void 0===(i=kh(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=kh(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool":void 0===(i=Ah(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Ah(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool[]":void 0===(i=Vh(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Vh(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape":void 0===(i=Mh(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Mh(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape[]":void 0===(i=Fh(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Fh(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype":void 0===(i=Sh(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Sh(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype[]":void 0===(i=Th(n.attr,r.tfName,r.defaultValue))&&r.tfDeprecatedName&&(i=Th(n.attr,r.tfDeprecatedName,r.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+r.type+" for op: "+n.op)}return t[r.name]={value:i,type:e},t}),{})),r},n}();function Eh(n,t){var r=Array.isArray(n)?String.fromCharCode.apply(null,n):function(n){var t=c().global;if(void 0!==t.atob)return t.atob(n);if("undefined"!=typeof Buffer)return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(n);return t?r:r.toLowerCase()}function Rh(n,t,r,e){void 0===e&&(e=!1);var i=n[t];return null!=i?Eh(i.s,e):r}function Ah(n,t,r){var e=n[t];return e?e.b:r}function _h(n,t,r){var e=n[t]||{},i=null!=e.i?e.i:null!=e.f?e.f:r;return"number"==typeof i?i:parseInt(i,10)}function Oh(n){switch("string"==typeof n&&(n=$d[n]),n){case $d.DT_FLOAT:return"float32";case $d.DT_INT32:case $d.DT_INT64:case $d.DT_INT8:case $d.DT_UINT8:return"int32";case $d.DT_BOOL:return"bool";case $d.DT_DOUBLE:return"float32";case $d.DT_STRING:return"string";default:return null}}function Sh(n,t,r){var e=n[t];return e&&e.type?Oh(e.type):r}function Th(n,t,r){var e=n[t];return e&&e.list&&e.list.type?e.list.type.map((function(n){return Oh(n)})):r}function Ih(n){if(!n.unknownRank)return null!=n.dim?n.dim.map((function(n){return"number"==typeof n.size?n.size:parseInt(n.size,10)})):[]}function Mh(n,t,r){var e=n[t];return e&&e.shape?Ih(e.shape):r}function kh(n,t,r){var e=n[t];return e?((e.list.f&&e.list.f.length?e.list.f:e.list.i)||[]).map((function(n){return"number"==typeof n?n:parseInt(n,10)})):r}function Dh(n,t,r,e){void 0===e&&(e=!1);var i=n[t];return i&&i.list&&i.list.s?i.list.s.map((function(n){return Eh(n,e)})):r}function Fh(n,t,r){var e=n[t];return e&&e.list&&e.list.shape?e.list.shape.map((function(n){return Ih(n)})):r}function Vh(n,t,r){var e=n[t];return e&&e.list&&e.list.b?e.list.b:r}var Ph=function(){function n(n,t,r){var e=this;this.node=n,this.tensorMap=t,this.context=r,this.inputs=[],this.attrs={},this.inputs=n.inputNames.map((function(n){return e.getInput(n)})),null!=n.rawAttrs&&(this.attrs=Object.keys(n.rawAttrs).reduce((function(n,t){return n[t]=e.getAttr(t),n}),{}))}return n.prototype.getInput=function(n){return rh(n,this.tensorMap,this.context)},n.prototype.getAttr=function(n,t){var r=this.node.rawAttrs[n];if(null!=r.tensor)return rh(n,this.tensorMap,this.context);if(null!=r.i||null!=r.f)return _h(this.node.rawAttrs,n,t);if(null!=r.s)return Rh(this.node.rawAttrs,n,t);if(null!=r.b)return Ah(this.node.rawAttrs,n,t);if(null!=r.shape)return Mh(this.node.rawAttrs,n,t);if(null!=r.type)return Sh(this.node.rawAttrs,n,t);if(null!=r.list){if(null!=r.list.i||null!=r.list.f)return kh(this.node.rawAttrs,n,t);if(null!=r.list.s)return Dh(this.node.rawAttrs,n,t);if(null!=r.list.shape)return Fh(this.node.rawAttrs,n,t);if(null!=r.list.b)return Vh(this.node.rawAttrs,n,t);if(null!=r.list.type)return Th(this.node.rawAttrs,n,t)}return t},n}(),Lh=function(){function n(t,r,e,i,o,a,u){this.name=t,this.dtype=r,this.maxSize=e,this.elementShape=i,this.identicalElementShapes=o,this.dynamicSize=a,this.clearAfterRead=u,this.tensors=[],this.closed_=!1,this.id=n.nextId++}return Object.defineProperty(n.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),n.prototype.clearAndClose=function(){this.tensors.forEach((function(n){return n.tensor.dispose()})),this.tensors=[],this.closed_=!0},n.prototype.size=function(){return this.tensors.length},n.prototype.read=function(n){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(n<0||n>=this.tensors.length)throw new Error("Tried to read from index "+n+", but array size is: "+this.tensors.length);var t=this.tensors[n];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+n+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},n.prototype.readMany=function(n){var t=this;return n.map((function(n){return t.read(n)}))},n.prototype.write=function(n,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(n<0||!this.dynamicSize&&n>=this.maxSize)throw new Error("Tried to write to index "+n+", but array is not resizeable and size is: "+this.maxSize);var r=this.tensors[n]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+n+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+n+"."),r&&r.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+n+", because it has already been read.");if(r&&r.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+n+", because it has already been written.");r.tensor=t,r.written=!0,this.tensors[n]=r},n.prototype.writeMany=function(n,t){var r=this;if(n.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+n.length+" is not the same as tensors size: "+t.length+".");n.forEach((function(n,e){return r.write(n,t[e])}))},n.prototype.gather=function(n,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!n){n=[];for(var r=0;r<this.size();r++)n.push(r)}if(0===n.length)return dr([],[0].concat(this.elementShape));var e=this.readMany(n);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,e[0].shape,"TensorArray shape mismatch: "),jr(e,0)},n.prototype.concat=function(n){if(n&&n!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+n);if(0===this.size())return dr([],[0].concat(this.elementShape));for(var t=[],r=0;r<this.size();r++)t.push(r);var e=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,e[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+e[0].shape+")"),Sr(e,0)},n.prototype.scatter=function(n,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(n.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+n.length+" vs. "+t.shape[0]);var r=Math.max.apply(Math,n);if(!this.dynamicSize&&r>=this.maxSize)throw new Error("Max index must be < array size ("+r+"  vs. "+this.maxSize+")");this.writeMany(n,Hr(t,0))},n.prototype.split=function(n,t){var r=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var e=0,i=n.map((function(n){return e+=n}));if(e!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+e+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&n.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+n.length+"), and the TensorArray is not marked as dynamically resizeable");var o=0===e?0:t.size/e,a=[];Gt((function(){t=t.reshape([1,e,o]);for(var u=0;u<n.length;++u)a[u]=Fc(t,[0,0===u?0:i[u-1],0],[1,n[u],o]).reshape(r.elementShape);return a}));for(var u=[],s=0;s<n.length;s++)u[s]=s;this.writeMany(u,a)},n.prototype.assertShapesMatchAllowUndefinedSize=function(n,t,r){void 0===r&&(r=""),cn.assert(this.shapesEqualAllowUndefinedSize(n,t),(function(){return r+" Shapes "+n+" and "+t+" must match"}))},n.prototype.shapesEqualAllowUndefinedSize=function(n,t){if(n.length!==t.length)return!1;for(var r=0;r<n.length;r++)if(-1!==n[r]&&-1!==t[r]&&n[r]!==t[r])return!1;return!0},n.nextId=0,n}();function Bh(n,t,r){var e=function(n,t,r){switch(n.category){case"arithmetic":return Gt((function(){return function(n,t,r){switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[ae(th("a",n,t,r),th("b",n,t,r))];case"AddN":return[$u(th("tensors",n,t,r))];case"FloorMod":case"Mod":return[Ze(th("a",n,t,r),th("b",n,t,r))];case"Mul":return[ni(th("a",n,t,r),th("b",n,t,r))];case"RealDiv":case"Div":return[ui(th("a",n,t,r),th("b",n,t,r))];case"DivNoNan":return[ys(th("a",n,t,r),th("b",n,t,r))];case"FloorDiv":return[Xe(th("a",n,t,r),th("b",n,t,r))];case"Sub":return[oi(th("a",n,t,r),th("b",n,t,r))];case"Minimum":return[Ye(th("a",n,t,r),th("b",n,t,r))];case"Maximum":return[$e(th("a",n,t,r),th("b",n,t,r))];case"Pow":return[ri(th("a",n,t,r),th("b",n,t,r))];case"SquaredDifference":return[Ws(th("a",n,t,r),th("b",n,t,r))];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"basic_math":return Gt((function(){return function(n,t,r){switch(n.op){case"Abs":case"ComplexAbs":return[fe(th("x",n,t,r))];case"Acos":return[le(th("x",n,t,r))];case"Acosh":return[de(th("x",n,t,r))];case"Asin":return[he(th("x",n,t,r))];case"Asinh":return[ve(th("x",n,t,r))];case"Atan":return[pe(th("x",n,t,r))];case"Atan2":return[je(th("x",n,t,r),th("y",n,t,r))];case"Atanh":return[me(th("x",n,t,r))];case"Ceil":return[xe(th("x",n,t,r))];case"Complex":return[cr(th("real",n,t,r),th("imag",n,t,r))];case"Cos":return[be(th("x",n,t,r))];case"Cosh":return[ge(th("x",n,t,r))];case"Elu":return[Zc(th("x",n,t,r))];case"Erf":return[we(th("x",n,t,r))];case"Exp":return[Ce(th("x",n,t,r))];case"Expm1":return[Ne(th("x",n,t,r))];case"Floor":return[Ee(th("x",n,t,r))];case"Log":return[Re(th("x",n,t,r))];case"Log1p":return[Ae(th("x",n,t,r))];case"Imag":return[lr(th("x",n,t,r))];case"Neg":return[Oe(th("x",n,t,r))];case"Reciprocal":return[Se(th("x",n,t,r))];case"Real":return[fr(th("x",n,t,r))];case"Relu":return[tf(th("x",n,t,r))];case"Round":return[Te(th("x",n,t,r))];case"Selu":return[ef(th("x",n,t,r))];case"Sigmoid":return[Me(th("x",n,t,r))];case"Sin":return[Pe(th("x",n,t,r))];case"Sign":return[ke(th("x",n,t,r))];case"Sinh":return[Le(th("x",n,t,r))];case"Softplus":return[Be(th("x",n,t,r))];case"Sqrt":return[We(th("x",n,t,r))];case"Square":return[Bs(th("x",n,t,r))];case"Tanh":return[Ue(th("x",n,t,r))];case"Tan":return[Ge(th("x",n,t,r))];case"Relu6":case"ClipByValue":return[ye(th("x",n,t,r),th("clipValueMin",n,t,r),th("clipValueMax",n,t,r))];case"Rsqrt":return[Ie(rh(n.inputNames[0],t,r))];case"Prod":return[Jc(th("x",n,t,r),th("axes",n,t,r))];case"LeakyRelu":return[Qc(th("x",n,t,r),th("alpha",n,t,r))];case"Prelu":return[nf(th("x",n,t,r),th("alpha",n,t,r))];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"control":return function(n,t,r){return Jd(void 0,void 0,void 0,(function(){var e,i,o,a,u,s,c,f,l,d,h,v,p,m,x,y,b,g,w,C,N,E,R,A,_,O,S,T,I,M,k,D,F,V;return Zd(this,(function(P){switch(P.label){case 0:switch(n.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[th("pred",n,t,r).clone()]];case 2:return e=th("pred",n,t,r),i=th("data",n,t,r),[4,e.data()];case 3:return[2,P.sent()[0]?[void 0,i.clone()]:[i.clone(),void 0]];case 4:return[2,(o=n.inputNames.find((function(n){return void 0!==rh(n,t,r)})))?[rh(o,t,r).clone()]:void 0];case 5:return a=th("frameName",n,t,r),u=th("tensor",n,t,r),r.enterFrame(a),[2,[u.clone()]];case 6:return s=th("tensor",n,t,r),r.exitFrame(),[2,[s.clone()]];case 7:return c=th("tensor",n,t,r),r.nextIteration(),[2,[c.clone()]];case 8:return f=th("size",n,t,r),l=th("dtype",n,t,r),d=th("elementShape",n,t,r),h=th("dynamicSize",n,t,r),v=th("clearAfterRead",n,t,r),p=th("identicalElementShapes",n,t,r),m=th("name",n,t,r),x=new Lh(m,l,f,d,p,h,v),r.addTensorArray(x),[2,[vr(x.id),vr(1)]];case 9:return y=th("tensorArrayId",n,t,r),b=th("index",n,t,r),g=th("tensor",n,t,r),r.getTensorArray(y).write(b,g),[2,[vr(1)]];case 10:return w=th("tensorArrayId",n,t,r),C=th("index",n,t,r),[2,[r.getTensorArray(w).read(C)]];case 11:return N=th("tensorArrayId",n,t,r),E=th("indices",n,t,r),R=th("dtype",n,t,r),[2,[r.getTensorArray(N).gather(E,R)]];case 12:return A=th("tensorArrayId",n,t,r),_=th("indices",n,t,r),O=th("tensor",n,t,r),r.getTensorArray(A).scatter(_,O),[2,[vr(1)]];case 13:return S=th("tensorArrayId",n,t,r),T=r.getTensorArray(S),I=th("dtype",n,t,r),[2,[T.concat(I)]];case 14:return M=th("tensorArrayId",n,t,r),k=th("tensor",n,t,r),D=th("lengths",n,t,r),r.getTensorArray(M).split(D,k),[2,[vr(1)]];case 15:return F=th("tensorArrayId",n,t,r),[2,[vr(r.getTensorArray(F).size(),"int32")]];case 16:return V=th("tensorArrayId",n,t,r),r.getTensorArray(V).clearAndClose(),[2,[vr(0)]];case 17:throw TypeError("Node type "+n.op+" is not implemented")}}))}))}(n,t,r);case"convolution":return Gt((function(){return function(n,t,r){switch(n.op){case"Conv1D":var e=th("stride",n,t,r),i=th("pad",n,t,r),o=th("dataFormat",n,t,r).toUpperCase(),a=th("dilation",n,t,r);return[sc(th("x",n,t,r),th("filter",n,t,r),e,i,o,a)];case"Conv2D":e=th("strides",n,t,r),i=th("pad",n,t,r),o=th("dataFormat",n,t,r).toUpperCase();var u=th("dilations",n,t,r);return[cc(th("x",n,t,r),th("filter",n,t,r),[e[1],e[2]],i,o,[u[1],u[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var s=th("fusedOps",n,t,r),c=s[0],f=s[1],l="biasadd"===c,d="prelu"===f,h="fusedbatchnorm"===c,v=th("numArgs",n,t,r);if(l){if(d&&2!==v)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!d&&1!==v)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(h)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");e=th("strides",n,t,r),i=th("pad",n,t,r),o=th("dataFormat",n,t,r).toUpperCase(),u=th("dilations",n,t,r);var p=th("args",n,t,r),m=p[0],x=p[1];return[("_FusedConv2D"===n.op?ol.conv2d:ol.depthwiseConv2d)({x:th("x",n,t,r),filter:th("filter",n,t,r),strides:[e[1],e[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:m,activation:f,preluActivationWeights:x})];case"Conv2DBackpropInput":case"Conv2dTranspose":var y=th("outputShape",n,t,r);return e=th("strides",n,t,r),i=th("pad",n,t,r),[xc(th("x",n,t,r),th("filter",n,t,r),y,[e[1],e[2]],i)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return e=th("strides",n,t,r),i=th("pad",n,t,r),u=th("dilations",n,t,r),o=th("dataFormat",n,t,r).toUpperCase(),[hc(th("input",n,t,r),th("filter",n,t,r),[e[1],e[2]],i,o,[u[1],u[2]])];case"Conv3D":return e=th("strides",n,t,r),i=th("pad",n,t,r),o=th("dataFormat",n,t,r).toUpperCase(),u=th("dilations",n,t,r),[fc(th("x",n,t,r),th("filter",n,t,r),[e[1],e[2],e[3]],i,o,[u[1],u[2],u[3]])];case"AvgPool":e=th("strides",n,t,r),i=th("pad",n,t,r);var b=th("kernelSize",n,t,r);return[Tc(th("x",n,t,r),[b[1],b[2]],[e[1],e[2]],i)];case"MaxPool":return e=th("strides",n,t,r),i=th("pad",n,t,r),b=th("kernelSize",n,t,r),[Sc(th("x",n,t,r),[b[1],b[2]],[e[1],e[2]],i)];case"MaxPoolWithArgmax":e=th("strides",n,t,r),i=th("pad",n,t,r),b=th("kernelSize",n,t,r);var g=th("includeBatchInIndex",n,t,r),w=Dc(th("x",n,t,r),[b[1],b[2]],[e[1],e[2]],i,g);return[w.result,w.indexes];case"AvgPool3D":return e=th("strides",n,t,r),i=th("pad",n,t,r),b=th("kernelSize",n,t,r),[kc(th("x",n,t,r),[b[1],b[2],b[3]],[e[1],e[2],e[3]],i)];case"MaxPool3D":return e=th("strides",n,t,r),i=th("pad",n,t,r),b=th("kernelSize",n,t,r),[Mc(th("x",n,t,r),[b[1],b[2],b[3]],[e[1],e[2],e[3]],i)];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"creation":return Gt((function(){return function(n,t,r){switch(n.op){case"Fill":var e=th("shape",n,t,r),i=th("dtype",n,t,r);return[Er(e,th("value",n,t,r),i)];case"LinSpace":var o=th("start",n,t,r);return[Rr(o,th("stop",n,t,r),th("num",n,t,r))];case"Multinomial":var a=th("logits",n,t,r),u=th("numSamples",n,t,r),s=th("seed",n,t,r);return[ws(a,u,s)];case"OneHot":var c=th("indices",n,t,r),f=th("depth",n,t,r),l=th("onValue",n,t,r),d=th("offValue",n,t,r);return[Cs(c,f,l,d)];case"Ones":return[Cr(th("shape",n,t,r),th("dtype",n,t,r))];case"OnesLike":return[_r(th("x",n,t,r))];case"RandomUniform":return[Ls(th("shape",n,t,r),th("minval",n,t,r),th("maxval",n,t,r),th("dtype",n,t,r))];case"Range":return[Ar(o=th("start",n,t,r),th("stop",n,t,r),th("step",n,t,r),th("dtype",n,t,r))];case"TruncatedNormal":e=th("shape",n,t,r);var h=th("mean",n,t,r),v=th("stdDev",n,t,r);return s=th("seed",n,t,r),[zs(e,h,v,th("dtype",n,t,r),s)];case"Zeros":return[Nr(th("shape",n,t,r),th("dtype",n,t,r))];case"ZerosLike":return[Or(th("x",n,t,r))];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"dynamic":return function(n,t,r){return Jd(void 0,void 0,void 0,(function(){var e,i,o,a,u,s,c,f;return Zd(this,(function(l){switch(l.label){case 0:switch(n.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return e=th("boxes",n,t,r),i=th("scores",n,t,r),o=th("maxOutputSize",n,t,r),a=th("iouThreshold",n,t,r),u=th("scoreThreshold",n,t,r),"NonMaxSuppressionV5"!==n.op?[3,3]:(s=th("softNmsSigma",n,t,r),[4,Jf.nonMaxSuppressionWithScoreAsync(e,i,o,a,u,s)]);case 2:return[2,[(f=l.sent()).selectedIndices,f.selectedScores]];case 3:return[4,Jf.nonMaxSuppressionAsync(e,i,o,a,u)];case 4:return[2,[l.sent()]];case 5:return c=th("condition",n,t,r).asType("bool"),[4,xs(c)];case 6:return f=[l.sent()],c.dispose(),[2,f];case 7:return[2,Xr(th("x",n,t,r),th("y",n,t,r))];case 8:throw TypeError("Node type "+n.op+" is not implemented")}}))}))}(n,t,r);case"evaluation":return Gt((function(){return function(n,t,r){switch(n.op){case"TopKV2":var e=th("x",n,t,r),i=th("k",n,t,r),o=th("sorted",n,t,r),a=lf(e,i,o);return[a.values,a.indices];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"image":return Gt((function(){return function(n,t,r){switch(n.op){case"ResizeBilinear":var e=th("images",n,t,r),i=th("size",n,t,r),o=th("alignCorners",n,t,r);return[Jf.resizeBilinear(e,[i[0],i[1]],o)];case"ResizeNearestNeighbor":return e=th("images",n,t,r),i=th("size",n,t,r),o=th("alignCorners",n,t,r),[Jf.resizeNearestNeighbor(e,[i[0],i[1]],o)];case"CropAndResize":var a=th("image",n,t,r),u=th("boxes",n,t,r),s=th("boxInd",n,t,r),c=th("cropSize",n,t,r),f=th("method",n,t,r),l=th("extrapolationValue",n,t,r);return[Jf.cropAndResize(a,u,s,c,f,l)];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"graph":return Gt((function(){return function(n,t,r){switch(n.op){case"Const":return t[n.name];case"PlaceholderWithDefault":var e=th("default",n,t,r);return[rh(n.name,t,r)||e];case"Placeholder":return[rh(n.name,t,r)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[th("x",n,t,r).clone()];case"IdentityN":return th("x",n,t,r).map((function(n){return n.clone()}));case"Snapshot":return[th("x",n,t,r).clone()];case"Shape":return[pr(th("x",n,t,r).shape,"int32")];case"ShapeN":return th("x",n,t,r).map((function(n){return pr(n.shape)}));case"Size":return[vr(th("x",n,t,r).size,"int32")];case"Rank":return[vr(th("x",n,t,r).rank,"int32")];case"NoOp":return[vr(1)];case"Print":var i=th("x",n,t,r),o=th("data",n,t,r),a=th("message",n,t,r),u=th("summarize",n,t,r);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(var s=0;s<o.length;s++)console.log(Array.prototype.slice.call(o[s].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"logical":return Gt((function(){return function(n,t,r){switch(n.op){case"Equal":return[Gs(th("a",n,t,r),th("b",n,t,r))];case"NotEqual":return[Zs(th("a",n,t,r),th("b",n,t,r))];case"Greater":return[qs(th("a",n,t,r),th("b",n,t,r))];case"GreaterEqual":return[js(th("a",n,t,r),th("b",n,t,r))];case"Less":return[$s(th("a",n,t,r),th("b",n,t,r))];case"LessEqual":return[Ks(th("a",n,t,r),th("b",n,t,r))];case"LogicalAnd":return[ds(th("a",n,t,r),th("b",n,t,r))];case"LogicalNot":return[hs(th("a",n,t,r))];case"LogicalOr":return[vs(th("a",n,t,r),th("b",n,t,r))];case"Select":return[ms(th("condition",n,t,r),th("a",n,t,r),th("b",n,t,r))];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"matrices":return Gt((function(){return function(n,t,r){switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[bc(th("a",n,t,r),th("b",n,t,r),th("transposeA",n,t,r),th("transposeB",n,t,r))];case"Transpose":return[Oi(th("x",n,t,r),th("perm",n,t,r))];case"_FusedMatMul":var e=th("fusedOps",n,t,r),i=e[1],o="biasadd"===e[0],a="prelu"===i,u=th("numArgs",n,t,r);if(o){if(a&&2!==u)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&1!==u)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var s=th("args",n,t,r),c=s[0],f=s[1];return[ol.matMul({a:th("a",n,t,r),b:th("b",n,t,r),transposeA:th("transposeA",n,t,r),transposeB:th("transposeB",n,t,r),bias:c,activation:i,preluActivationWeights:f})];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"normalization":return Gt((function(){return function(n,t,r){switch(n.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[ns(th("x",n,t,r),th("mean",n,t,r),th("variance",n,t,r),th("offset",n,t,r),th("scale",n,t,r),th("epsilon",n,t,r))];case"LRN":return[of(th("x",n,t,r),th("radius",n,t,r),th("bias",n,t,r),th("alpha",n,t,r),th("beta",n,t,r))];case"Softmax":return[Ai(th("x",n,t,r))];case"LogSoftmax":return[_i(th("x",n,t,r))];case"SparseToDense":return[yf(th("sparseIndices",n,t,r),th("outputShape",n,t,r),th("sparseValues",n,t,r),th("defaultValue",n,t,r))];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"reduction":return Gt((function(){return function(n,t,r){switch(n.op){case"Max":var e=th("axis",n,t,r),i=th("keepDims",n,t,r);return[Hc(th("x",n,t,r),e,i)];case"Mean":return e=th("axis",n,t,r),i=th("keepDims",n,t,r),[Xc(th("x",n,t,r),e,i)];case"Min":return e=th("axis",n,t,r),i=th("keepDims",n,t,r),[$c(th("x",n,t,r),e,i)];case"Sum":return e=th("axis",n,t,r),i=th("keepDims",n,t,r),[Yc(th("x",n,t,r),e,i)];case"All":return e=th("axis",n,t,r),i=th("keepDims",n,t,r),[zc(th("x",n,t,r),e,i)];case"Any":return e=th("axis",n,t,r),i=th("keepDims",n,t,r),[Gc(th("x",n,t,r),e,i)];case"ArgMax":return e=th("axis",n,t,r),[Uc(th("x",n,t,r),e)];case"ArgMin":return e=th("axis",n,t,r),[qc(th("x",n,t,r),e)];case"Prod":return e=th("axis",n,t,r),i=th("keepDims",n,t,r),[Jc(th("x",n,t,r),e,i)];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"slice_join":return Gt((function(){return function(n,t,r){switch(n.op){case"ConcatV2":case"Concat":var e=th("n",n,t,r),i=th("axis",n,t,r),o=th("tensors",n,t,r);return o=o.slice(0,e),[Sr(o,i)];case"GatherV2":case"Gather":i=th("axis",n,t,r);var a=th("x",n,t,r),u=th("indices",n,t,r);return[rc(a,u.asType("int32"),i)];case"ReverseV2":case"Reverse":return i=th("axis",n,t,r),a=th("x",n,t,r),[Cc(a,i)];case"Slice":var s=th("begin",n,t,r),c=th("size",n,t,r);return[Fc(th("x",n,t,r),s,c)];case"StridedSlice":s=th("begin",n,t,r);var f=th("end",n,t,r),l=th("strides",n,t,r),d=th("beginMask",n,t,r),h=th("endMask",n,t,r),v=th("ellipsisMask",n,t,r),p=th("newAxisMask",n,t,r),m=th("shrinkAxisMask",n,t,r),x=th("x",n,t,r);if(1===s.length&&x.shape.length>1)for(var y=1;y<x.shape.length;y++)s.push(0),f.push(x.shape[y]),l.push(l[0]);return[ff(x,s,f,l,d,h,v,p,m)];case"Pack":return Gt((function(){var e=th("axis",n,t,r),i=th("tensors",n,t,r),o=i[0].shape,a=i[0].squeeze().shape,u=i.map((function(n){var t=cn.arraysEqual(n.shape,o);if(!t&&!cn.arraysEqual(n.squeeze().shape,a))throw new Error("the input tensors shape does not match");return t?n:n.reshape(o)}));return[jr(u,e)]}));case"Unpack":return Gt((function(){var e=th("axis",n,t,r),i=th("tensor",n,t,r);return Hr(i,e)}));case"Tile":var b=th("reps",n,t,r);return[bs(th("x",n,t,r),b)];case"Split":case"SplitV":i=th("axis",n,t,r);var g=th("numOrSizeSplits",n,t,r);return Dr(th("x",n,t,r),g,i);case"ScatterNd":u=th("indices",n,t,r);var w=th("values",n,t,r),C=th("shape",n,t,r);return[df(u,w,C)];case"GatherNd":var N=th("x",n,t,r);return u=th("indices",n,t,r),[bf(N,u)];case"SparseToDense":u=th("sparseIndices",n,t,r),C=th("outputShape",n,t,r);var E=th("sparseValues",n,t,r),R=th("defaultValue",n,t,r);return[yf(u,E,C,E.dtype===R.dtype?R:R.asType(E.dtype))];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"spectral":return Gt((function(){return function(n,t,r){switch(n.op){case"FFT":return[hf(th("x",n,t,r))];case"IFFT":return[vf(th("x",n,t,r))];case"RFFT":return[pf(th("x",n,t,r))];case"IRFFT":return[mf(th("x",n,t,r))];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"transformation":return Gt((function(){return function(n,t,r){switch(n.op){case"Cast":return[Lr(th("x",n,t,r),th("dtype",n,t,r))];case"ExpandDims":var e=th("axis",n,t,r);return[zr(th("x",n,t,r),e)];case"Squeeze":return e=th("axis",n,t,r),[qr(th("x",n,t,r),e)];case"Reshape":return[Gr(th("x",n,t,r),th("shape",n,t,r))];case"PadV2":case"Pad":return[Ns(th("x",n,t,r),ah(th("padding",n,t,r),2),th("constantValue",n,t,r))];case"SpaceToBatchND":var i=th("blockShape",n,t,r),o=ah(th("paddings",n,t,r),2);return[Ur(th("x",n,t,r),i,o)];case"BatchToSpaceND":i=th("blockShape",n,t,r);var a=ah(th("crops",n,t,r),2);return[Pr(th("x",n,t,r),i,a)];case"DepthToSpace":var u=th("blockSize",n,t,r),s=th("dataFormat",n,t,r).toUpperCase();return[Wr(th("x",n,t,r),u,s)];default:throw TypeError("Node type "+n.op+" is not implemented")}}(n,t,r)}));case"custom":var e=nh(n.op);if(e&&e.customExecutor)return e.customExecutor(new Ph(n,t,r));throw TypeError("Custom op "+n.op+" is not registered.");default:throw TypeError("Unknown op '"+n.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(n,t,r);return e instanceof Promise?e.then((function(n){return[].concat(n)})):[].concat(e)}var Wh=function(){function n(n,t){this.weightMap=n,this.tensorArrayMap=t,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return n.prototype.newFrame=function(n,t){return{id:n,frameName:t,iterationId:0}},Object.defineProperty(n.prototype,"currentContext",{get:function(){return this.contexts},set:function(n){this.contexts!==n&&(this.contexts=n,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),n.prototype.generateCurrentContextIds=function(){for(var n=[],t=0;t<this.contexts.length-1;t++){var r=this.contexts.slice(0,this.contexts.length-t);n.push(this.contextIdforContexts(r))}n.push(""),this._currentContextIds=n},n.prototype.contextIdforContexts=function(n){return n?n.map((function(n){return 0===n.id&&0===n.iterationId?"":n.frameName+"-"+n.iterationId})).join("/"):""},n.prototype.enterFrame=function(n){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,n)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},n.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},n.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var n=Object.assign({},this.contexts[this.contexts.length-1]);n.iterationId+=1,n.id=this.lastId,this.contexts.splice(-1,1,n),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},n.prototype.getWeight=function(n){return this.weightMap[n]},n.prototype.addTensorArray=function(n){this.tensorArrayMap[n.id]=n},n.prototype.getTensorArray=function(n){return this.tensorArrayMap[n]},n}();function zh(n,t,r){for(var e=new Set,i=[],o=null,a=null,u=new Set,s=Object.keys(n).map((function(n){return oh(n)[0]})),c=t.slice();c.length>0;){var f=c.pop();(qh(f)||jh(f))&&null==o&&(a=(o=f).children.map((function(n){return n.name})).filter((function(n){return e.has(n)}))),e.add(f.name),null==r[f.name]&&-1===s.indexOf(f.name)&&(0!==f.inputs.length?f.inputs.forEach((function(n){u.has(n.name)||(u.add(n.name),c.push(n))})):i.push(f.name))}return{inputs:n,outputs:t,usedNodes:e,missingInputs:i,dynamicNode:o,syncInputs:a}}var Gh=["Switch","Merge","Enter","Exit","NextIteration"],Uh=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function qh(n){return Gh.indexOf(n.op)>=0}function jh(n){return Uh.indexOf(n.op)>=0}var Hh=function(){function n(n){this.graph=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=n.outputs,this._inputs=n.inputs,this._signature=n.signature}return Object.defineProperty(n.prototype,"weightMap",{get:function(){return this._weightMap},set:function(n){var t=Object.keys(n).map((function(t){return n[t].map((function(n){return n.id}))}));this.weightIds=[].concat.apply([],t),this._weightMap=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this._inputs.map((function(n){return{name:n.name,shape:n.attrParams.shape?n.attrParams.shape.value:void 0,dtype:n.attrParams.dtype?n.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this._outputs.map((function(n){return{name:n.name,shape:n.attrParams.shape?n.attrParams.shape.value:void 0,dtype:n.attrParams.dtype?n.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this._inputs.map((function(n){return n.signatureKey||n.name}))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this._outputs.map((function(n){return n.signatureKey||n.name}))},enumerable:!0,configurable:!0}),n.prototype.getCompilationKey=function(n,t){var r=n.map((function(n){return n.name})).sort(),e=t.map((function(n){return n.name})).sort();return r.join(this.SEPERATOR)+"--"+e.join(this.SEPERATOR)},n.prototype.compile=function(n,t){var r=zh(n,t,this.weightMap),e=r.missingInputs,i=r.dynamicNode;if(null!=i)throw new Error("This execution contains the node '"+i.name+"', which has the dynamic op '"+i.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+r.syncInputs+"]");if(e.length>0){var o=t.map((function(n){return n.name})),a=Object.keys(n);throw new Error("Cannot compute the outputs ["+o+"] from the provided inputs ["+a+"]. Missing the following inputs: ["+e+"]")}return function(n,t,r){var e=r.usedNodes,i=[];Object.keys(r.inputs).map((function(n){return oh(n)[0]})).map((function(t){return n.nodes[t]})).forEach((function(n){e.has(n.name)&&i.push(n)})),n.weights.forEach((function(n){e.has(n.name)&&i.push(n)}));for(var o=new Set,a=[];i.length>0;){var u=i.pop();o.add(u.name),t[u.name]||a.push(u),u.children.forEach((function(n){!o.has(n.name)&&e.has(n.name)&&n.inputs.every((function(n){return o.has(n.name)}))&&i.push(n)}))}return a}(this.graph,this.weightMap,r)},n.prototype.execute=function(n,t){var r=this;n=this.mapInputs(n);var e=Object.keys(n).sort();this.checkInputs(n),this.checkInputShapeAndType(n),t=this.mapOutputs(t),this.checkOutputs(t);var i=e.map((function(n){return r.graph.nodes[oh(n)[0]]})),o=t.map((function(n){return r.graph.nodes[oh(n)[0]]})),a=this.getCompilationKey(i,o),u=this.compiledMap.get(a);null==u&&(u=this.compile(n,o),this.compiledMap.set(a,u));var s={};return Gt((function(){var e=new Wh(r._weightMap,s),i=Yd({},r.weightMap);Object.keys(n).forEach((function(t){var r=oh(t),e=r[0],o=[];o[r[1]]=n[t],i[e]=o}));for(var o=r.getFrozenTensorIds(i),a={},c=0;c<u.length;c++){var f=u[c];if(!i[f.name]){var l=Bh(f,i,e);if(l instanceof Promise)throw new Error("The execution of the op '"+f.op+"' returned a promise. Please use model.executeAsync() instead.");i[f.name]=l,r.checkTensorForDisposal(f.name,f,i,e,o,t,a)}}return t.map((function(n){return rh(n,i,e)}))}))},n.prototype.getFrozenTensorIds=function(n){var t=[].concat.apply([],Object.keys(n).map((function(t){return n[t]})).map((function(n){return n.map((function(n){return n.id}))})));return new Set(t)},n.prototype.checkTensorForDisposal=function(n,t,r,e,i,o,a){"control"!==t.category&&-1===o.indexOf(n)&&(r[n].forEach((function(n){null!=n&&(a[n.id]=(a[n.id]||0)+t.children.length)})),t.inputs.forEach((function(n){if("control"!==n.category){var t=function(n,t,r){return t[ih(n,r.currentContextId)]}(n.name,r,e);null!=t&&t.forEach((function(n){if(n&&!i.has(n.id)){var t=a[n.id];1===t?(n.dispose(),delete a[n.id]):null!=t&&a[n.id]--}}))}})))},n.prototype.executeAsync=function(n,t){return Jd(this,void 0,void 0,(function(){var r,e,i,o,a,u=this;return Zd(this,(function(s){switch(s.label){case 0:return n=this.mapInputs(n),this.checkInputs(n),this.checkInputShapeAndType(n),t=this.mapOutputs(t),this.checkOutputs(t),r=new Wh(this._weightMap,{}),[4,this.executeWithControlFlow(n,r,t)];case 1:return e=s.sent(),i=t.map((function(n){return rh(n,e,r)})),o=new Set(i.map((function(n){return n.id}))),a=new Set(Object.keys(n).map((function(t){return n[t].id}))),Object.keys(e).forEach((function(n){e[n].forEach((function(n){!n||n.isDisposed||o.has(n.id)||a.has(n.id)||-1!==u.weightIds.indexOf(n.id)||n.dispose()}))})),[2,i]}}))}))},n.prototype.executeWithControlFlow=function(n,t,r){return Jd(this,void 0,void 0,(function(){var e,i,o,a,u,s,c,f,l,d,h,v,p,m,x,y,b=this;return Zd(this,(function(g){switch(g.label){case 0:e=Object.keys(n),i=e.map((function(n){return b.graph.nodes[oh(n)[0]]})),o=r.map((function(n){return b.graph.nodes[oh(n)[0]]})),a=zh(n,o,this.weightMap),u=a.usedNodes,s=a.missingInputs,c=a.dynamicNode,f=a.syncInputs,l=i.concat(this.graph.weights).map((function(n){return{node:n,contexts:t.currentContext}})),d=Yd({},this.weightMap),Object.keys(n).forEach((function(t){var r=oh(t),e=r[0],i=[];i[r[1]]=n[t],d[e]=i})),h={},v=this.getFrozenTensorIds(d),p={},g.label=1;case 1:return l.length>0?(m=this.processStack(i,l,t,d,p,v,r,h,u),[4,Promise.all(m)]):[3,3];case 2:return g.sent(),[3,1];case 3:if(null==c&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(x=o.filter((function(n){return!qh(n)&&!rh(n.name,d,t)})).map((function(n){return n.name}))).length>0)throw y="",null!=c&&(y="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+f+"]"),new Error("Cannot compute the outputs ["+x+"] from the provided inputs ["+e+"]. Consider providing the following inputs: ["+s+"]. "+y);return[2,d]}}))}))},n.prototype.processStack=function(n,t,r,e,i,o,a,u,s){for(var c=this,f=[],l=function(){var l=t.pop();r.currentContext=l.contexts;var h="";if("Enter"===l.node.op&&th("isConstant",l.node,e,r)&&(h=eh(l.node.name,r)[0]),-1===n.indexOf(l.node)){var v=Bh(l.node,e,r);h||(h=eh(l.node.name,r)[0]);var p=r.currentContext;v instanceof Promise?f.push(v.then((function(n){return e[h]=n,r.currentContext=p,c.checkTensorForDisposal(h,l.node,e,r,o,a,u),c.processChildNodes(l.node,t,r,e,i,s),n}))):(e[h]=v,d.checkTensorForDisposal(h,l.node,e,r,o,a,u),d.processChildNodes(l.node,t,r,e,i,s))}else d.processChildNodes(l.node,t,r,e,i,s)},d=this;t.length>0;)l();return f},n.prototype.processChildNodes=function(n,t,r,e,i,o){n.children.forEach((function(n){var a=eh(n.name,r)[0];!i[a]&&o.has(n.name)&&("Merge"===n.op?n.inputNames.some((function(n){return!!rh(n,e,r)}))&&(i[a]=!0,t.push({contexts:r.currentContext,node:n})):n.inputNames.every((function(n){return!!rh(n,e,r)}))&&(i[a]=!0,t.push({contexts:r.currentContext,node:n})))}))},n.prototype.dispose=function(){var n=this;Object.keys(this.weightMap).forEach((function(t){return n.weightMap[t].forEach((function(n){return n.dispose()}))}))},n.prototype.checkInputShapeAndType=function(n){var t=this;Object.keys(n).forEach((function(r){var e=n[r],i=oh(r)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var a=o.attrParams.shape.value,u=a.length===e.shape.length&&e.shape.every((function(n,t){return-1===a[t]||a[t]===n}));cn.assert(u,(function(){return"The shape of dict['"+o.name+"'] provided in model.execute(dict) must be ["+a+"], but was ["+e.shape+"]"}))}o.attrParams.dtype&&o.attrParams.dtype.value&&cn.assert(e.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['"+o.name+"'] provided in model.execute(dict) must be "+o.attrParams.dtype.value+", but was "+e.dtype}))}))},n.prototype.mapInputs=function(n){var t={};for(var r in n)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[r]?t[this._signature.inputs[r].name]=n[r]:t[r]=n[r];return t},n.prototype.checkInputs=function(n){var t=this,r=Object.keys(n).filter((function(n){var r=oh(n)[0];return null==t.graph.nodes[r]}));if(r.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+r+"] that are not part of graph")},n.prototype.mapOutputs=function(n){var t=this;return n.map((function(n){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[n]?t._signature.outputs[n].name:n}),{})},n.prototype.checkOutputs=function(n){var t=this;n.forEach((function(n){var r=oh(n)[0];if(!t.graph.nodes[r])throw new Error("The output '"+n+"' is not found in the graph")}))},n}(),Xh=function(){function n(n,t){void 0===t&&(t={}),this.modelUrl=n,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={})}return Object.defineProperty(n.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),n.prototype.findIOHandler=function(){var n=this.modelUrl;if(null!=n.load)this.handler=n;else if(null!=this.loadOptions.requestInit)this.handler=Ad.browserHTTPRequest(n,this.loadOptions);else{var t=Ad.getLoadHandlers(n,this.loadOptions.onProgress);if(0===t.length)t.push(Ad.browserHTTPRequest(n,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[n]+"'");this.handler=t[0]}},n.prototype.load=function(){return Jd(this,void 0,void 0,(function(){var n,t,r,e;return Zd(this,(function(i){switch(i.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return n=this,[4,this.handler.load()];case 1:return n.artifacts=i.sent(),r={},null!=this.artifacts.userDefinedMetadata&&(r=this.artifacts.userDefinedMetadata.signature),this.version=(t=this.artifacts.modelTopology).versions.producer+"."+t.versions.minConsumer,e=Ad.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new Hh(Nh.Instance.transformGraph(t,r)),this.executor.weightMap=this.convertTensorMapToTensorsMap(e),[2,!0]}}))}))},n.prototype.save=function(n){return Jd(this,void 0,void 0,(function(){var t;return Zd(this,(function(){if("string"==typeof n){if(0===(t=Ad.getSaveHandlers(n)).length)throw new Error("Cannot find any save handlers for URL '"+n+"'");if(t.length>1)throw new Error("Found more than one ("+t.length+") save handlers for URL '"+n+"'");n=t[0]}if(null==n.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,n.save(this.artifacts)]}))}))},n.prototype.predict=function(n){return this.execute(n,this.outputNodes)},n.prototype.normalizeInputs=function(n){if(!(n instanceof bn||Array.isArray(n)))return n;if((n=Array.isArray(n)?n:[n]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+n.length+" input tensors.");return this.inputNodes.reduce((function(t,r,e){return t[r]=n[e],t}),{})},n.prototype.normalizeOutputs=function(n){return n=n||this.outputNodes,Array.isArray(n)?n:[n]},n.prototype.execute=function(n,t){n=this.normalizeInputs(n),t=this.normalizeOutputs(t);var r=this.executor.execute(n,t);return r.length>1?r:r[0]},n.prototype.executeAsync=function(n,t){return Jd(this,void 0,void 0,(function(){var r;return Zd(this,(function(e){switch(e.label){case 0:return n=this.normalizeInputs(n),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(n,t)];case 1:return[2,(r=e.sent()).length>1?r:r[0]]}}))}))},n.prototype.convertTensorMapToTensorsMap=function(n){return Object.keys(n).reduce((function(t,r){return t[r]=[n[r]],t}),{})},n.prototype.dispose=function(){this.executor.dispose()},n}();function $h(n,t){return void 0===t&&(t={}),Jd(this,void 0,void 0,(function(){var r;return Zd(this,(function(e){switch(e.label){case 0:if(null==n)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==t&&(t={}),t.fromTFHub&&null==n.load&&(n.endsWith("/")||(n+="/"),n+="model.json?tfjs-format=file"),[4,(r=new Xh(n,t)).load()];case 1:return e.sent(),[2,r]}}))}))}
/**
    * @license
    * Copyright 2020 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Kh(n,t,r,e){return new(r||(r=Promise))((function(i,o){function a(n){try{s(e.next(n))}catch(n){o(n)}}function u(n){try{s(e.throw(n))}catch(n){o(n)}}function s(n){n.done?i(n.value):new r((function(t){t(n.value)})).then(a,u)}s((e=e.apply(n,t||[])).next())}))}function Yh(n,t){var r,e,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,e&&(i=2&o[0]?e.return:o[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,o[1])).done)return i;switch(e=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,e=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(n,a)}catch(n){o=[6,n],e=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}var Jh,Zh={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}},Qh=function(){function n(n,t){this.modelPath=t||"https://storage.googleapis.com/tfjs-models/savedmodel/"+this.getPrefix(n)+"/model.json"}return n.prototype.getPrefix=function(n){return"lite_mobilenet_v2"===n?"ssd"+n:"ssd_"+n},n.prototype.load=function(){return Kh(this,void 0,void 0,(function(){var n,t,r;return Yh(this,(function(e){switch(e.label){case 0:return n=this,[4,$h(this.modelPath)];case 1:return n.model=e.sent(),t=Nr([1,300,300,3],"int32"),[4,this.model.executeAsync(t)];case 2:return r=e.sent(),[4,Promise.all(r.map((function(n){return n.data()})))];case 3:return e.sent(),r.map((function(n){return n.dispose()})),t.dispose(),[2]}}))}))},n.prototype.infer=function(n,t){return Kh(this,void 0,void 0,(function(){var r,e,i,o,a,u,s,c,f,l,d,h;return Yh(this,(function(v){switch(v.label){case 0:return r=Gt((function(){return n instanceof bn||(n=Td.fromPixels(n)),n.expandDims(0)})),e=r.shape[1],i=r.shape[2],[4,this.model.executeAsync(r)];case 1:return o=v.sent(),a=o[0].dataSync(),u=o[1].dataSync(),r.dispose(),Ut(o),s=function(n,t){var r="function"==typeof Symbol&&n[Symbol.iterator];if(!r)return n;var e,i,o=r.call(n),a=[];try{for(;(void 0===t||t-- >0)&&!(e=o.next()).done;)a.push(e.value)}catch(n){i={error:n}}finally{try{e&&!e.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}(this.calculateMaxScores(a,o[0].shape[1],o[0].shape[2]),2),c=s[0],f=s[1],l=Ht(),jt("cpu"),d=Gt((function(){var n=mr(u,[o[1].shape[1],o[1].shape[3]]);return Jf.nonMaxSuppression(n,c,t,.5,.5)})),h=d.dataSync(),d.dispose(),jt(l),[2,this.buildDetectedObjects(i,e,u,c,h,f)]}}))}))},n.prototype.buildDetectedObjects=function(n,t,r,e,i,o){for(var a=i.length,u=[],s=0;s<a;s++){for(var c=[],f=0;f<4;f++)c[f]=r[4*i[s]+f];var l=c[0]*t,d=c[1]*n,h=c[2]*t,v=c[3]*n;c[0]=d,c[1]=l,c[2]=v-d,c[3]=h-l,u.push({bbox:c,class:Zh[o[i[s]]+1].displayName,score:e[i[s]]})}return u},n.prototype.calculateMaxScores=function(n,t,r){for(var e=[],i=[],o=0;o<t;o++){for(var a=Number.MIN_VALUE,u=-1,s=0;s<r;s++)n[o*r+s]>a&&(a=n[o*r+s],u=s);e[o]=a,i[o]=u}return[e,i]},n.prototype.detect=function(n,t){return void 0===t&&(t=20),Kh(this,void 0,void 0,(function(){return Yh(this,(function(){return[2,this.infer(n,t)]}))}))},n.prototype.dispose=function(){null!=this.model&&this.model.dispose()},n}(),nv="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},tv=(function(n){
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var t=t||function(n){if(!(void 0===n||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return n.URL||n.webkitURL||n},r=n.document.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in r,i=/constructor/i.test(n.HTMLElement)||n.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(t){(n.setImmediate||n.setTimeout)((function(){throw t}),0)},u=function(n){setTimeout((function(){"string"==typeof n?t().revokeObjectURL(n):n.remove()}),4e4)},s=function(n){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob([String.fromCharCode(65279),n],{type:n.type}):n},c=function(c,f,l){l||(c=s(c));var d,h=this,v="application/octet-stream"===c.type,p=function(){!function(n,t){for(var r=(t=[].concat(t)).length;r--;){var e=n["on"+t[r]];if("function"==typeof e)try{e.call(n,n)}catch(i){a(i)}}}(h,"writestart progress write writeend".split(" "))};if(h.readyState=h.INIT,e)return d=t().createObjectURL(c),void setTimeout((function(){var n,t;r.href=d,r.download=f,n=r,t=new MouseEvent("click"),n.dispatchEvent(t),p(),u(d),h.readyState=h.DONE}));!function(){if((o||v&&i)&&n.FileReader){var r=new FileReader;return r.onloadend=function(){var t=o?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");n.open(t,"_blank")||(n.location.href=t),t=void 0,h.readyState=h.DONE,p()},r.readAsDataURL(c),void(h.readyState=h.INIT)}d||(d=t().createObjectURL(c)),v?n.location.href=d:n.open(d,"_blank")||(n.location.href=d),h.readyState=h.DONE,p(),u(d)}()},f=c.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(n,t,r){return t=t||n.name||"download",r||(n=s(n)),navigator.msSaveOrOpenBlob(n,t)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,function(n,t,r){return new c(n,t||n.name||"download",r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||nv.content);n.exports&&(n.exports.saveAs=t)}(Jh={exports:{}}),Jh.exports).saveAs;const rv=class{constructor(t){n(this,t),this.cameraReady=!1,this.video=null,this.model=null,this.whatToDetect="bird"}async componentWillLoad(){this.model=await function(n){return void 0===n&&(n={}),Kh(this,void 0,void 0,(function(){var t,r,e;return Yh(this,(function(i){switch(i.label){case 0:if(null==Xd)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(r=n.modelUrl,-1===["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(t=n.base||"lite_mobilenet_v2"))throw new Error("ObjectDetection constructed with invalid base model "+t+". Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.");return[4,(e=new Qh(t,r)).load()];case 1:return i.sent(),[2,e]}}))}))}(),console.log(this.model)}async snapAndDetect(){this.canvas.getContext("2d").drawImage(this.video,0,0,this.canvas.width,this.canvas.height),this.canvasBig.getContext("2d").drawImage(this.video,0,0,this.canvasBig.width,this.canvasBig.height);const n=await this.model.detect(this.canvas);console.log({predictions:n}),n&&n.length>0&&n.find(n=>n.class===this.whatToDetect)&&(console.log("found a bird!!!"),this.canvasBig.toBlob((function(n){console.log("blob",n),tv(n,`bird-${Date.now()}.png`)})))}componentDidLoad(){this.video=this.el.querySelector("#video"),this.canvas=this.el.querySelector("#canvas"),this.canvasBig=this.el.querySelector("#canvasBig"),navigator.mediaDevices.getUserMedia({video:{width:{min:1280},height:{min:720},facingMode:{exact:"environment"}},audio:!1}).then(n=>(this.video.srcObject=n,this.video.play())).then(()=>{console.log("ready!"),this.cameraReady=!0}).catch(n=>{console.error(n)})}startDetectionTimer(){this.timer=window.setInterval(()=>{this.snapAndDetect()},5e3)}componentDidUnload(){window.clearInterval(this.timer)}render(){return[t("ion-header",null,t("ion-toolbar",{color:"primary"},t("ion-title",null,"Home"))),t("ion-content",{class:"ion-padding"},t("video",{id:"video"},"Video stream not available."),t("canvas",{style:{display:"none"},id:"canvas",width:"320",height:"240"}),t("canvas",{style:{display:"none"},id:"canvasBig",width:"1280",height:"720"}),this.cameraReady&&t("p",null,"Camera Ready"),!this.cameraReady&&t("p",null,"Camera Loading"),this.model&&t("p",null,"Model Ready"),!this.model&&t("p",null,"Model Loading"),t("ion-button",{onClick:async()=>{console.log("hey"),this.snapAndDetect()},expand:"block"},"Manual Prediction"),t("ion-button",{onClick:async()=>{this.startDetectionTimer()},expand:"block"},"Start Detection"))]}get el(){return r(this)}};rv.style="";export{rv as app_home}